////
// lib/forumApi.js
const API_URL =
  process.env.NEXT_PUBLIC_STRAPI_API_URL ||
  "https://onmotor-strapi.onrender.com";

/* ğŸŸ© ×§×‘×œ×ª ×›×œ ×”×§×˜×’×•×¨×™×•×ª */
export async function fetchForumCategories() {
  const res = await fetch(`${API_URL}/api/forum-categories?populate=*`, {
    cache: "no-store",
  });
  if (!res.ok) throw new Error("×©×’×™××” ×‘×˜×¢×™× ×ª ×§×˜×’×•×¨×™×•×ª");
  const json = await res.json();

  console.log("ğŸ“ ×§×˜×’×•×¨×™×•×ª ×©×”×ª×§×‘×œ×•:", json.data);

  return (
    json.data?.map((item) => {
      const attrs = item.attributes || {};
      return {
        id: item.id,
        documentId: item.documentId,
        name: attrs.name || item.name || "×œ×œ× ×©×",
        slug: attrs.slug || item.slug || "",
        description: attrs.description || item.description || "",
      };
    }) || []
  );
}

/* ğŸŸ¦ ×§×‘×œ×ª ×›×œ ×”×©×¨×©×•×¨×™× ×œ×¤×™ slug ×§×˜×’×•×¨×™×” */
export async function fetchThreadsByCategorySlug(slug) {
  const decodedSlug = decodeURIComponent(slug || "").trim();

  const res = await fetch(
    `${API_URL}/api/forum-threads?filters[category][slug][$eq]=${decodedSlug}&sort=pinned:desc,lastActivity:desc&populate=comments`,
    { cache: "no-store" }
  );

  if (!res.ok) throw new Error("×©×’×™××” ×‘×˜×¢×™× ×ª ×“×™×•× ×™× ×œ×¤×™ ×§×˜×’×•×¨×™×”");
  const json = await res.json();

  console.log("ğŸ“¦ forum threads:", json.data);

  return (
    json.data?.map((item) => {
      const attrs = item.attributes || {};
      const commentsRelation = attrs.comments;

      // âœ… ×§×•×‘×¢ ××¡×¤×¨ ×ª×’×•×‘×•×ª *××”×§×©×¨ ×¢×¦××•* ×›×¤×™ ×©×—×•×–×¨ ××”-API
      const commentsCount =
        commentsRelation?.data?.length ??
        (Array.isArray(commentsRelation) ? commentsRelation.length : 0) ??
        0;

      return {
        id: item.id,
        documentId: item.documentId,
        title: attrs.title || item.title,
        slug: attrs.slug || item.slug,
        content: extractText(attrs.content || item.content),
        author: attrs.author || item.author,
        date: attrs.date || item.date,
        pinned: attrs.pinned,
        locked: attrs.locked,
        views: attrs.views || 0,
        lastActivity:
          attrs.lastActivity || attrs.updatedAt || attrs.createdAt || null,

        // ğŸ’¬ ×ª××™×“ ××¡×¤×¨ ×ª×’×•×‘×•×ª ××—×•×©×‘ ××”×§×©×¨
        commentsCount,

        category:
          attrs.category?.data?.attributes?.name ||
          item.category?.name ||
          null,
      };
    }) || []
  );
}


/* ğŸ”¹ ×—×™×œ×•×¥ ×˜×§×¡×˜ ×Ö¾Rich Text Blocks */
function extractText(blocks) {
  if (!blocks) return "";
  if (typeof blocks === "string") return blocks;
  if (Array.isArray(blocks)) {
    return blocks
      .map((b) => b.children?.map((child) => child.text).join(" "))
      .join("\n");
  }
  return "";
}
/* ğŸŸ§ ×§×‘×œ×ª ×“×™×•×Ÿ ×œ×¤×™ slug */
export async function fetchThreadBySlug(threadSlug) {
  try {
    const decodedSlug = decodeURIComponent(threadSlug || "").trim();
    console.log("ğŸ“ ×˜×•×¢×Ÿ ×“×™×•×Ÿ ×œ×¤×™ slug:", decodedSlug);

    const SITE_URL =
      process.env.NEXT_PUBLIC_SITE_URL || "https://www.onmotormedia.com";
    const proxyUrl = `/api/forum-thread?slug=${encodeURIComponent(
      decodedSlug
    )}`;

    console.log("ğŸŒ ×§×¨×™××” ×“×¨×š proxy:", proxyUrl);
    const res = await fetch(proxyUrl, { cache: "no-store" });

    if (!res.ok) {
      console.error("âŒ ×©×’×™××” ×‘×§×¨×™××” ×“×¨×š proxy:", res.status, res.statusText);
      throw new Error("×©×’×™××” ×‘×˜×¢×™× ×ª ×“×™×•×Ÿ ×“×¨×š proxy");
    }

    const json = await res.json();
    console.log("ğŸ“¦ ×ª×’×•×‘×ª Proxy:", json);

    const item = json.data?.[0];
    if (!item) {
      console.warn("âš ï¸ ×œ× × ××¦× ×“×™×•×Ÿ ×¢× slug:", decodedSlug);
      throw new Error("×“×™×•×Ÿ ×œ× × ××¦×");
    }

    const attrs = item.attributes ? item.attributes : item;

    // âœ… ×©×œ×™×—×” ×œÖ¾Strapi ×œ×¢×“×›×•×Ÿ views (×”×¤×¢×œ×ª afterFindOne)
    try {
      await fetch(
        `${API_URL}/api/forum-threads?filters[slug][$eq]=${decodedSlug}`,
        { cache: "no-store" }
      );
    } catch (err) {
      console.warn("âš ï¸ ×¢×“×›×•×Ÿ views × ×›×©×œ:", err);
    }

    // ğŸŸ¢ ×ª×’×•×‘×•×ª ××œ××•×ª
    const comments =
      (attrs.comments?.data || []).map((c) => {
        const ca = c.attributes || {};
        const rawAuthor =
          ca.author ??
          ca.name ??
          ca.username ??
          ca.user?.username ??
          ca.user?.name ??
          "";
        return {
          id: c.id,
          text: ca.text || ca.content || "",
          author: rawAuthor || "×× ×•× ×™××™",
          date: ca.date || ca.createdAt || ca.updatedAt || null,
          reply_to: ca.reply_to?.data?.id || null,
        };
      }) || [];

    // ğŸŸ© ×—×™×©×•×‘ ×ª××¨×™×š ×ª×’×•×‘×” ××—×¨×•× ×” ×××™×ª×™
    let latestCommentDate = null;
    if (attrs.comments?.data?.length) {
      const allDates = attrs.comments.data
        .map((c) =>
          new Date(
            c.attributes?.createdAt ||
              c.attributes?.updatedAt ||
              c.attributes?.date ||
              0
          )
        )
        .filter((d) => !isNaN(d));
      if (allDates.length) {
        latestCommentDate = new Date(Math.max(...allDates));
      }
    }

    return {
      id: item.id,
      documentId: item.documentId,
      title: attrs.title || "×œ×œ× ×›×•×ª×¨×ª",
      slug: attrs.slug || "",
      content: Array.isArray(attrs.content)
        ? attrs.content
            .map((block) =>
              block.children?.map((c) => c.text || "").join(" ")
            )
            .join("\n\n")
        : attrs.content || "",
      author: attrs.author || "×œ× ×¦×•×™×Ÿ",
      date: attrs.date || null,
      pinned: attrs.pinned || false,
      locked: attrs.locked || false,
      views: attrs.views || 0,
      lastActivity:
        latestCommentDate?.toISOString() ||
        attrs.lastActivity ||
        attrs.updatedAt ||
        attrs.date ||
        null,
      category:
        attrs.category?.data?.attributes?.name ||
        attrs.category?.name ||
        null,
      comments:
        (attrs.comments?.data || []).map((c) => {
          const ca = c.attributes || {};
          return {
            id: c.id,
            text: ca.text || ca.content || "",
            author:
              ca.author ??
              ca.name ??
              ca.username ??
              ca.user?.username ??
              ca.user?.name ??
              "×× ×•× ×™××™",
            createdAt: ca.createdAt,
            updatedAt: ca.updatedAt,
            reply_to: ca.reply_to?.data?.id || null,
          };
        }) || [],
    };
  } catch (err) {
    console.error("âŒ fetchThreadBySlug (proxy) error:", err);
    throw err;
  }
}


// lib/forumApi.js
export async function fetchCommentsByThreadSlug(threadSlug) {
  try {
    const decodedSlug = decodeURIComponent(threadSlug).trim();
    console.log("ğŸ’¬ ×˜×•×¢×Ÿ ×ª×’×•×‘×•×ª ×œ×¤×™ slug:", decodedSlug);

    const query = new URLSearchParams({
      "filters[forum_thread][slug][$eq]": decodedSlug,
      "populate": "*",
      "sort[0]": "createdAt:asc",
      "pagination[pageSize]": "100",
    });

    const res = await fetch(
      `${API_URL}/api/forum-comments?${query.toString()}`,
      { cache: "no-store" }
    );

    if (!res.ok)
      throw new Error(`×©×’×™××” ×‘×˜×¢×™× ×ª ×ª×’×•×‘×•×ª (${res.status})`);

    const json = await res.json();

    const comments = (json.data || []).map((item) => {
      // âš™ï¸ ×× ××™×Ÿ attributes â€“ × ×©×ª××© ×™×©×™×¨×•×ª ×‘×¤×¨×•×¤×¡ ×”×¨××©×™×™×
      const a = item.attributes || item;

      return {
        id: item.id,
        author: a.author || a.user?.username || "×× ×•× ×™××™",
        text: a.text || a.content || "â€” ××™×Ÿ ×ª×•×›×Ÿ â€”",
        date: a.date || a.createdAt || a.updatedAt || null,
        createdAt: a.createdAt || null,
        reply_to: a.reply_to?.id || a.reply_to?.data?.id || null,
      };
    });

    console.log("ğŸ’¬ ×ª×’×•×‘×•×ª ×©×”×ª×§×‘×œ×• ×-Strapi:", comments);
    return comments;
  } catch (err) {
    console.error("âŒ fetchCommentsByThreadSlug error:", err);
    return [];
  }
}

/* ğŸŸ¥ ×”×•×¡×¤×ª ×ª×’×•×‘×” ×œ×¤×™ slug ×©×œ ×“×™×•×Ÿ */
export async function addCommentByThreadSlug({
  threadSlug,
  text,
  author,
  reply_to,
}) {
  try {
    console.log("ğŸ“¨ ×©×œ×™×—×ª ×ª×’×•×‘×” ×—×“×©×”...");
    console.log("ğŸ§© slug ×©×”×ª×§×‘×œ:", threadSlug);

    const decodedSlug = decodeURIComponent(threadSlug).trim();

    // ğŸŸ¢ ×©×œ×™×¤×ª ××–×”×” ×”×“×™×•×Ÿ ×œ×¤×™ slug
    const threadRes = await fetch(
      `${API_URL}/api/forum-threads?filters[slug][$eq]=${decodedSlug}`
    );
    const threadJson = await threadRes.json();
    const thread = threadJson?.data?.[0];

    if (!thread) {
      console.error("âŒ ×œ× × ××¦× ×“×™×•×Ÿ ×ª×•×× ×œ-slug:", decodedSlug);
      throw new Error("×œ× × ××¦× ×“×™×•×Ÿ ×ª×•×× ×œ-slug");
    }

    const threadId = thread.id;
    console.log("ğŸ§© ××–×”×” ×“×™×•×Ÿ ×©× ××¦×:", threadId);

    // ğŸ§± ×’×•×£ ×”×‘×§×©×” â€” ×™×¦×™×¨×ª ×ª×’×•×‘×” ×—×“×©×”
    const body = {
      data: {
        text,
        author,
        forum_thread: threadId, // âœ… ×§×©×¨ ×™×©×™×¨ ×œ×¤×™ ID ×¤× ×™××™
        reply_to: reply_to || null,
        date: new Date().toISOString(),
        publishedAt: new Date().toISOString(),
      },
    };

    console.log("ğŸ“¦ ×’×•×£ ×©× ×©×œ×— ×œ-Strapi:", JSON.stringify(body, null, 2));

    const res = await fetch(`${API_URL}/api/forum-comments`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(body),
    });

    const responseText = await res.text();
    console.log("ğŸ“© ×ª×’×•×‘×ª Strapi (×ª×’×•×‘×”):", responseText);

    if (!res.ok) {
      console.error("âŒ ×©×’×™××” ×‘×©×œ×™×—×ª ×ª×’×•×‘×”:", res.status, res.statusText);
      throw new Error(`×©×’×™××” ×‘×©×œ×™×—×ª ×ª×’×•×‘×” (${res.status})`);
    }

    let json = null;
    try {
      json = JSON.parse(responseText);
    } catch {
      console.log("ğŸ“© ×ª×’×•×‘×” ×œ× ×‘×¤×•×¨××˜ JSON:", responseText);
    }

    // ğŸ•“ ×”×©×”×™×” ×§×¦×¨×” ×œ×•×•×“× ×©×”×ª×’×•×‘×” × ×©××¨×” ×‘××¡×“
    await new Promise((r) => setTimeout(r, 400));

    // ğŸ”¢ ×¢×“×›×•×Ÿ ×¡×¤×™×¨×ª ×ª×’×•×‘×•×ª ×œ×“×™×•×Ÿ
    try {
      // ××©×™×›×ª ×›×œ ×”×ª×’×•×‘×•×ª ×”×§×©×•×¨×•×ª ×œ×“×™×•×Ÿ
      const commentsRes = await fetch(
        `${API_URL}/api/forum-comments?filters[forum_thread][id][$eq]=${threadId}`
      );
      const commentsJson = await commentsRes.json();
      const currentCount = commentsJson?.data?.length || 0;

      // âœ… ×¢×“×›×•×Ÿ ×”×©×“×” commentsCount ×‘-Strapi ×’× ×× ×”×•× null
      await fetch(`${API_URL}/api/forum-threads/${threadId}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          data: {
            commentsCount: currentCount,
          },
        }),
      });

      console.log(`ğŸ”¢ commentsCount ×¢×•×“×›×Ÿ ×œÖ¾${currentCount}`);
    } catch (err) {
      console.error("âš ï¸ ×¢×“×›×•×Ÿ commentsCount × ×›×©×œ:", err);
    }


    // ğŸŸ¡ ×¢×“×›×•×Ÿ ×ª××¨×™×š ×¤×¢×™×œ×•×ª ××—×¨×•×Ÿ
    await updateLastActivity(threadId, new Date().toISOString());


    console.log("âœ… ×ª×’×•×‘×” × ×•×¦×¨×” ×‘×”×¦×œ×—×” ×‘-Strapi");
    return json?.data;
  } catch (err) {
    console.error("âŒ addCommentByThreadSlug error:", err);
    throw err;
  }
}

/* ğŸŸ¨ ×¤×ª×™×—×ª ×©×¨×©×•×¨ ×—×“×© */
export async function addThread({ title, content, author, categorySlug }) {
  try {
    const catRes = await fetch(
      `${API_URL}/api/forum-categories?filters[slug][$eq]=${categorySlug}`
    );
    const catJson = await catRes.json();
    const categoryId = catJson?.data?.[0]?.id;

    if (!categoryId) throw new Error("×œ× × ××¦××” ×§×˜×’×•×¨×™×” ××ª××™××” ×œ-slug");

    const normalizeSlug = (text) => {
      return text
        .normalize("NFD")
        .replace(/[\u0590-\u05FF]/g, "")
        .replace(/[^\w\s-]/g, "")
        .trim()
        .replace(/\s+/g, "-")
        .toLowerCase();
    };

    const threadSlug = normalizeSlug(title) || `thread-${Date.now()}`;

    const contentBlocks = [
      {
        type: "paragraph",
        children: [{ type: "text", text: content }],
      },
    ];

    const body = {
      data: {
        title,
        slug: threadSlug,
        content: contentBlocks,
        author,
        category: { connect: [{ id: categoryId }] },
        pinned: false,
        locked: false,
        views: 0,
        date: new Date().toISOString(),
        lastActivity: new Date().toISOString(),
        publishedAt: new Date().toISOString(),
      },
    };

    console.log("ğŸ“¦ BODY ×©× ×©×œ×— ×œÖ¾Strapi:", JSON.stringify(body, null, 2));

    const res = await fetch(`${API_URL}/api/forum-threads`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(body),
    });

    const responseText = await res.text();
    let json = null;

    try {
      json = JSON.parse(responseText);
    } catch {
      console.log("ğŸ“© ×ª×’×•×‘×” ×œ× ×‘×¤×•×¨××˜ JSON:", responseText);
    }

    if (!res.ok) {
      console.error("âŒ ×©×’×™××” ×‘×™×¦×™×¨×ª ×“×™×•×Ÿ ×—×“×©:", res.status, res.statusText);
      console.log("ğŸ“© ×ª×’×•×‘×ª ×©×¨×ª ××œ××”:", responseText);
      throw new Error(`×©×’×™××” ×‘×™×¦×™×¨×ª ×“×™×•×Ÿ ×—×“×© (${res.status})`);
    }

    console.log("âœ… × ×•×¦×¨ ×“×™×•×Ÿ:", json);
    return json?.data;
  } catch (err) {
    console.error("âš ï¸ addThread error:", err);
    throw err;
  }
}

/* ğŸŸ¦ ×”×¢×œ××ª views */
export async function incrementThreadViews(threadId, currentViews = 0) {
  try {
    await fetch(`${API_URL}/api/forum-threads/${threadId}`, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        data: { views: currentViews + 1 },
      }),
    });
  } catch (err) {
    console.error("âš ï¸ incrementThreadViews:", err);
  }
}

/* ğŸŸª ×¢×“×›×•×Ÿ ×ª××¨×™×š ×¤×¢×™×œ×•×ª ××—×¨×•×Ÿ */
export async function updateLastActivity(threadId, date = new Date().toISOString()) {
  try {
    await fetch(`${API_URL}/api/forum-threads/${threadId}`, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        data: { lastActivity: date },
      }),
    });
  } catch (err) {
    console.error("âš ï¸ updateLastActivity:", err);
  }
}




////
// app/forum/[slug]/[threadSlug]/CommentsSection.jsx
'use client';

import { useEffect, useState } from 'react';
import {
  fetchCommentsByThreadSlug,
  addCommentByThreadSlug,
} from '@/lib/forumApi';
import CommentItem from './CommentItem';

export default function CommentsSection({ threadSlug, threadLocked }) {
  const [comments, setComments] = useState([]);
  const [replyTo, setReplyTo] = useState(null);
  const [newComment, setNewComment] = useState({ author: '', text: '' });
  const [submitting, setSubmitting] = useState(false);

  useEffect(() => {
    loadComments();
  }, [threadSlug]);

  async function loadComments() {
    try {
      const data = await fetchCommentsByThreadSlug(threadSlug);
      console.log('ğŸ§© ×ª×’×•×‘×•×ª × ×˜×¢× ×• (××§×•×¨):', data);

      // ğŸ§  × × ×§×” ×•× ×—×–×™×¨ ×¢×¨×›×™× ×‘×˜×•×—×™×
      const sanitized = data.map((c) => ({
        ...c,
        author: c.author?.trim() || '×× ×•× ×™××™',
        text: c.text?.trim() || 'â€” ××™×Ÿ ×ª×•×›×Ÿ â€”',
      }));

      console.log('âœ… ×ª×’×•×‘×•×ª ×œ××—×¨ × ×™×§×•×™:', sanitized);
      setComments(sanitized);
    } catch (err) {
      console.error('âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×ª×’×•×‘×•×ª:', err);
    }
  }

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!newComment.text.trim()) return;
    setSubmitting(true);
    try {
      await addCommentByThreadSlug({
        threadSlug,
        text: newComment.text,
        author: newComment.author?.trim() || '×× ×•× ×™××™',
        reply_to: replyTo,
      });
      setNewComment({ author: '', text: '' });
      setReplyTo(null);
      await loadComments();
    } catch (err) {
      console.error('âŒ ×©×’×™××” ×‘×©×œ×™×—×ª ×ª×’×•×‘×”:', err);
    } finally {
      setSubmitting(false);
    }
  };

  return (
    <div>
      <h3 className="text-2xl font-bold text-[#e60000] mb-6 text-right border-b-2 border-[#e60000] pb-2">
        ×ª×’×•×‘×•×ª ({comments.length})
      </h3>

      <div className="space-y-4">
        {comments.length === 0 ? (
          <p className="text-center text-gray-700">××™×Ÿ ×ª×’×•×‘×•×ª ×¢×“×™×™×Ÿ.</p>
        ) : (
          comments.map((c) => (
            <CommentItem
              key={c.id}
              comment={c}
              comments={comments}
              setReplyTo={setReplyTo}
            />
          ))
        )}
      </div>

      {!threadLocked ? (
        <form
          onSubmit={handleSubmit}
          className="mt-10 border-2 border-[#e60000] rounded-xl bg-white shadow-md p-6 text-black"
        >
          {replyTo && (
            <div className="text-sm text-gray-600 mb-3">
              ××’×™×‘ ×œÖ¾×ª×’×•×‘×” #{replyTo}{' '}
              <button
                type="button"
                onClick={() => setReplyTo(null)}
                className="text-[#e60000] hover:underline"
              >
                ×‘×™×˜×•×œ
              </button>
            </div>
          )}

          <label className="block mb-2 text-sm text-right font-semibold">
            ×©×
          </label>
          <input
            type="text"
            value={newComment.author}
            onChange={(e) =>
              setNewComment({ ...newComment, author: e.target.value })
            }
            className="w-full bg-[#fad2d2] border-2 border-[#e60000] rounded px-3 py-2 mb-4 text-black focus:outline-none focus:border-[#ff3333]"
            placeholder="×œ×“×•×’××”: ×™××™×¨ ADV1290"
          />

          <label className="block mb-2 text-sm text-right font-semibold">
            ×ª×’×•×‘×”
          </label>
          <textarea
            value={newComment.text}
            onChange={(e) =>
              setNewComment({ ...newComment, text: e.target.value })
            }
            className="w-full bg-[#fad2d2] border-2 border-[#e60000] rounded px-3 py-2 h-32 mb-4 text-black resize-none focus:outline-none focus:border-[#ff3333]"
            placeholder="×›×ª×•×‘ ×›××Ÿ ××ª ×ª×’×•×‘×ª×š..."
          />

          <button
            type="submit"
            disabled={submitting}
            className={`w-full py-2 rounded font-semibold text-white transition ${
              submitting
                ? 'bg-gray-500 cursor-not-allowed'
                : 'bg-[#e60000] hover:bg-[#ff3333]'
            }`}
          >
            {submitting ? '×©×•×œ×—...' : '×¤×¨×¡× ×ª×’×•×‘×”'}
          </button>
        </form>
      ) : (
        <p className="text-center text-[#e60000] mt-6 font-semibold">
          ğŸ”’ ×”×“×™×•×Ÿ × ×¢×•×œ. ×œ× × ×™×ª×Ÿ ×œ×”×•×¡×™×£ ×ª×’×•×‘×•×ª.
        </p>
      )}
    </div>
  );
}



//
//app\forum\[slug]\[threadSlug]\CommentItem.jsx
'use client';
import { useEffect, useRef } from 'react';

export default function CommentItem({ comment, comments, setReplyTo }) {
  const ref = useRef(null);

  // ××–×”×” ×™×™×—×•×“×™ ×œ×›×œ ×ª×’×•×‘×” (×œ×’×œ×™×œ×”)
  useEffect(() => {
    if (ref.current) {
      ref.current.id = `comment-${comment.id}`;
    }
  }, [comment.id]);

  // ××¦×™××ª ×©× ×”××’×™×‘ ×©××œ×™×• ××’×™×‘×™×
  const repliedTo = comment.reply_to
    ? comments.find((c) => c.id === comment.reply_to)
    : null;

  const handleScrollToReplied = () => {
    if (!repliedTo) return;
    const el = document.getElementById(`comment-${repliedTo.id}`);
    if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
  };

  // ×ª××¨×™×š ×ª×§×™×Ÿ
  const dateString = comment.date
    ? new Date(comment.date).toLocaleString('he-IL')
    : comment.createdAt
    ? new Date(comment.createdAt).toLocaleString('he-IL')
    : 'â€”';

  // ×ª×•×›×Ÿ ×”×ª×’×•×‘×” â€“ ×©×“×” text ××• content
  const commentText = comment.text || comment.content || '';

  return (
    <div
      ref={ref}
      className="border-2 border-[#e60000] bg-white rounded-xl shadow-md p-4 scroll-mt-24"
    >
      <div className="flex justify-between items-center mb-2">
        <p className="font-semibold text-[#e60000]">{comment.author || '×× ×•× ×™××™'}</p>
        <p className="text-xs text-gray-600">{dateString}</p>
      </div>

      {/* ×ª×’×•×‘×” ×œ××™×©×”×• */}
      {repliedTo && (
        <p className="text-xs text-gray-600 mb-2">
          ×‘×ª×’×•×‘×” ×œÖ¾{' '}
          <button
            onClick={handleScrollToReplied}
            className="text-[#e60000] font-semibold hover:underline"
          >
            {repliedTo.author || '×× ×•× ×™××™'}
          </button>
        </p>
      )}

      {/* ×ª×•×›×Ÿ ×××™×ª×™ */}
      <p className="whitespace-pre-line leading-relaxed text-black mb-3">
        {commentText.trim() ? commentText : 'â€” ××™×Ÿ ×ª×•×›×Ÿ â€”'}
      </p>

      <button
        onClick={() => setReplyTo(comment.id)}
        className="text-sm text-[#e60000] hover:underline"
      >
        ×”×©×‘
      </button>
    </div>
  );
}


// app/forum/[slug]/[threadSlug]/CommentItem.jsx
'use client';
import { useEffect, useRef } from 'react';

export default function CommentItem({ comment, comments, setReplyTo }) {
  const ref = useRef(null);

  useEffect(() => {
    if (ref.current) {
      ref.current.id = `comment-${comment.id}`;
    }
  }, [comment.id]);

  // ×ª×’×•×‘×•×ª-××©× ×” (×ª×’×•×‘×•×ª ×œ×ª×’×•×‘×” ×–×•)
  const childComments = comments.filter((c) => c.reply_to === comment.id);

  const repliedTo = comment.reply_to
    ? comments.find((c) => c.id === comment.reply_to)
    : null;

  const handleScrollToReplied = () => {
    if (!repliedTo) return;
    const el = document.getElementById(`comment-${repliedTo.id}`);
    if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
  };

  const dateString = comment.date
    ? new Date(comment.date).toLocaleString('he-IL')
    : comment.createdAt
    ? new Date(comment.createdAt).toLocaleString('he-IL')
    : 'â€”';

  const commentText = comment.text || comment.content || '';

  return (
    <div
      ref={ref}
      className="border-2 border-[#e60000] bg-white rounded-xl shadow-md p-4 scroll-mt-24 text-right"
    >
      <div className="flex justify-between items-center mb-2">
        <p className="font-semibold text-[#e60000]">{comment.author || '×× ×•× ×™××™'}</p>
        <p className="text-xs text-gray-600">{dateString}</p>
      </div>

      {repliedTo && (
        <p className="text-xs text-gray-600 mb-2">
          ×‘×ª×’×•×‘×” ×œÖ¾{' '}
          <button
            onClick={handleScrollToReplied}
            className="text-[#e60000] font-semibold hover:underline"
          >
            {repliedTo.author || '×× ×•× ×™××™'}
          </button>
        </p>
      )}

      <p className="whitespace-pre-line leading-relaxed text-black mb-3">
        {commentText.trim() ? commentText : 'â€” ××™×Ÿ ×ª×•×›×Ÿ â€”'}
      </p>

      <button
        onClick={() => setReplyTo(comment.id)}
        className="text-sm text-[#e60000] hover:underline"
      >
        ×”×©×‘
      </button>

      {/* ğŸŸ¢ ×ª×’×•×‘×•×ª ××©× ×” (××•×¤×™×¢×•×ª ×‘×¤× ×™×) */}
      {childComments.length > 0 && (
        <div className="mt-4 pl-4 border-r-2 border-[#e60000]/40 space-y-3">
          {childComments.map((child) => (
            <CommentItem
              key={child.id}
              comment={child}
              comments={comments}
              setReplyTo={setReplyTo}
            />
          ))}
        </div>
      )}
    </div>
  );
}

// app/forum/[slug]/page.jsx
'use client';

import { useEffect, useState } from 'react';
import { useParams } from 'next/navigation';
import Link from 'next/link';
import PageContainer from '@/components/PageContainer';
import { fetchThreadsByCategorySlug } from '@/lib/forumApi';
import { getForumLabel } from '@/utils/labelMap';
import NewPostForm from '../NewPostForm';

export default function ForumCategoryPage() {
  const params = useParams();
  const slug = params?.slug ? decodeURIComponent(params.slug) : '';
  const [threads, setThreads] = useState([]);
  const [loading, setLoading] = useState(true);
  const [showForm, setShowForm] = useState(false);

  const categoryLabel = getForumLabel(slug);

  const loadThreads = async () => {
    try {
      const data = await fetchThreadsByCategorySlug(slug);
      setThreads(data);
    } catch (err) {
      console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ×“×™×•× ×™×:', err);
    } finally {
      setLoading(false);
    }
  };

    // ğŸ§© ×˜×¢×™× ×ª ×“×™×•× ×™× ×›×•×œ×œ ×¡×¤×™×¨×ª ×ª×’×•×‘×•×ª ×××™×ª×™×ª ×œ×¤×™ fetchCommentsByThreadSlug
  useEffect(() => {
    async function load() {
      try {
        const threadsData = await fetchThreadsByCategorySlug(slug);

        // ğŸ§® × ×—×©×‘ ×œ×›×œ ×“×™×•×Ÿ ××ª ××¡×¤×¨ ×”×ª×’×•×‘×•×ª ×“×¨×š ××•×ª×• API ×©×‘×• ××©×ª××© ×¢××•×“ ×”×“×™×•×Ÿ ×¢×¦××•
        const withCounts = await Promise.all(
          threadsData.map(async (t) => {
            try {
              // × ×©×ª××© ×‘×“×™×•×§ ×‘××•×ª×” ×¤×•× ×§×¦×™×” ×©××©××©×ª ××ª CommentsSection
              const comments = await fetchCommentsByThreadSlug(t.slug);
              return { ...t, commentsCount: comments.length };
            } catch (err) {
              console.error(`âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×ª×’×•×‘×•×ª ×œ×“×™×•×Ÿ ${t.slug}:`, err);
              return { ...t, commentsCount: 0 };
            }
          })
        );

        setThreads(withCounts);
      } catch (err) {
        console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ×“×™×•× ×™×:', err);
      } finally {
        setLoading(false);
      }
    }

    load();
  }, [slug]);


  return (
    <PageContainer
      title={categoryLabel}
      breadcrumbs={[
        { label: '×“×£ ×”×‘×™×ª', href: '/' },
        { label: '×¤×•×¨×•×', href: '/forum' },
        { label: categoryLabel, href: `/forum/${slug}` },
      ]}
    >
      <div className="bg-[#faafaf] text-black min-h-screen py-8 px-2 sm:px-4 transition-colors duration-500">
        {/* ğŸŸ¥ ×§×•×¤×¡×” ×›×•×œ×œ×ª */}
        <div className="border-2 border-[#e60000] rounded-xl bg-white shadow-md mb-8">
          {/* ğŸ”´ ×›×¤×ª×•×¨ ×¤×ª×™×—×” */}
          <div className="flex justify-end items-center p-4 bg-[#fff5f5] rounded-t-xl">
            <button
              onClick={() => setShowForm(!showForm)}
              className="px-5 py-2 bg-[#e60000] text-white rounded-lg hover:bg-[#ff3333] transition font-semibold"
            >
              {showForm ? '×¡×’×•×¨ ×˜×•×¤×¡' : '×¤×ª×— ×“×™×•×Ÿ ×—×“×©'}
            </button>
          </div>

          {/* ğŸ§¾ ×˜×•×¤×¡ ×¤×ª×™×—×ª ×“×™×•×Ÿ */}
          {showForm && (
            <div className="p-6 border-t-2 border-[#e60000] bg-[#ffeaea] rounded-b-xl">
              <NewPostForm
                categorySlug={slug}
                onCreated={loadThreads}
                onClose={() => setShowForm(false)}
              />
            </div>
          )}
        </div>

        {/* ğŸ—‚ï¸ ×¨×©×™××ª ×“×™×•× ×™× */}
        {loading ? (
          <p className="text-center text-gray-700">×˜×•×¢×Ÿ ×“×™×•× ×™×...</p>
        ) : threads.length === 0 ? (
          <p className="text-center text-gray-700">××™×Ÿ ×“×™×•× ×™× ×‘×§×˜×’×•×¨×™×” ×–×•.</p>
        ) : (
          <ul className="space-y-6">
            {threads.map((t) => (
              <li
                key={t.id}
                className="border-2 border-[#e60000] rounded-xl bg-white shadow-md transition hover:shadow-lg hover:-translate-y-1 duration-200"
              >
                <Link href={`/forum/${slug}/${t.slug}`} className="block p-5">
                  {/* ğŸ§­ ×›×•×ª×¨×ª ×•×¤×¨×˜×™ ×™×•×¦×¨ â€” ×”×™×¤×•×š ×¦×“×“×™× */}
                  <div className="flex justify-between items-start border-b-2 border-[#e60000] pb-3 mb-3">
                    {/* ×›×•×ª×¨×ª ××™××™×Ÿ */}
                    <h3 className="text-xl font-bold text-[#e60000] text-right">
                      {t.title}
                    </h3>

                    {/* ×¤×¨×˜×™ ×™×•×¦×¨ ××©×××œ */}
                    <div className="text-left">
                      <p className="text-sm">
                        × ×›×ª×‘ ×¢×œ ×™×“×™{' '}
                        <span className="font-semibold text-[#e60000]">
                          {t.author || '×× ×•× ×™××™'}
                        </span>
                      </p>
                      <p className="text-sm text-gray-700 mt-1">
                        ×¦×¤×™×•×ª: {t.views || 0}â€¢ ×ª×’×•×‘×•×ª: {t.commentsCount || 0}
                      </p>
                    </div>
                  </div>

                  {/* ğŸ’¬ ×ª×•×›×Ÿ ×”×“×™×•×Ÿ */}
                  <p className="text-sm leading-relaxed whitespace-pre-line mb-4 text-[#181818]">
                    {t.content?.length > 250
                      ? t.content.slice(0, 250) + '...'
                      : t.content}
                  </p>

                  {/* ğŸ•“ ×ª××¨×™×›×™× */}
                  <div className="text-xs text-gray-700 border-t-2 border-[#e60000] pt-2 flex justify-between">
                    <span>
                      × ×•×¦×¨ ×‘×ª××¨×™×š:{' '}
                      {t.date
                        ? new Date(t.date).toLocaleString('he-IL')
                        : 'â€”'}
                    </span>
                    <span>
                      ×¢×•×“×›×Ÿ ×œ××—×¨×•× ×”:{' '}
                      {t.lastActivity
                        ? new Date(t.lastActivity).toLocaleString('he-IL')
                        : 'â€”'}
                    </span>
                  </div>
                </Link>
              </li>
            ))}
          </ul>
        )}
      </div>
    </PageContainer>
  );
}

///
//


// app/forum/[slug]/[threadSlug]/page.jsx
'use client';

import { useEffect, useState } from 'react';
import { useParams } from 'next/navigation';
import PageContainer from '@/components/PageContainer';
import {
  fetchThreadBySlug,
  fetchCommentsByThreadSlug,
  addCommentByThreadSlug,
  incrementThreadViews,
} from '@/lib/forumApi';
import { labelMap } from '@/utils/labelMap';

export default function ForumThreadPage() {
  const { slug, threadSlug } = useParams();
  const decodedThreadSlug = decodeURIComponent(threadSlug || ""); // âœ… ×¤×¢× ×•×— ××œ× ×©×œ ×”×¡×œ××’

  const [thread, setThread] = useState(null);
  const [comments, setComments] = useState([]);
  const [replyTo, setReplyTo] = useState(null);
  const [loading, setLoading] = useState(true);
  const [newComment, setNewComment] = useState({ author: '', text: '' });
  const [submitting, setSubmitting] = useState(false);
  const [statusMessage, setStatusMessage] = useState(null);

  useEffect(() => {
    async function load() {
      try {
        console.log("ğŸ“¥ ×˜×•×¢×Ÿ ×“×™×•×Ÿ ×œ×¤×™ slug:", decodedThreadSlug);
        const t = await fetchThreadBySlug(decodedThreadSlug); // âœ… ×©×™××•×© ×‘×¢×¨×š ×”××¤×•×¢× ×—
        console.log("ğŸ§© ×ª×•×¦××” ×Ö¾fetchThreadBySlug:", t);

        setThread(t);
        if (t?.id) await incrementThreadViews(t.id, t.views);
        const c = await fetchCommentsByThreadSlug(decodedThreadSlug);
        setComments(c);
      } catch (err) {
        console.error('âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×“×™×•×Ÿ:', err);
        setStatusMessage({ text: '×©×’×™××” ×‘×˜×¢×™× ×ª ×”×“×™×•×Ÿ', type: 'error' });
      } finally {
        setLoading(false);
      }
    }
    load();
  }, [decodedThreadSlug]); // âœ… ×××–×™×Ÿ ×œ×’×¨×¡×” ×”××¤×•×¢× ×—×ª

  // ğŸŸ¢ ×˜×•×¤×¡ ×ª×’×•×‘×”
  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!newComment.text.trim()) {
      setStatusMessage({ text: '× × ×œ××œ× ×ª×•×›×Ÿ ×ª×’×•×‘×”', type: 'error' });
      return;
    }

    setSubmitting(true);
    try {
      await addCommentByThreadSlug({
        threadSlug: decodedThreadSlug, // âœ… ×©×™××•×© ×‘××•×ª×• ×¢×¨×š
        text: newComment.text,
        author: newComment.author || '×× ×•× ×™××™',
        reply_to: replyTo,
      });

      setNewComment({ author: '', text: '' });
      setReplyTo(null);
      const updatedComments = await fetchCommentsByThreadSlug(decodedThreadSlug);
      setComments(updatedComments);

      setStatusMessage({ text: '×”×ª×’×•×‘×” ×¤×•×¨×¡××” ×‘×”×¦×œ×—×” ğŸ‰', type: 'success' });
      setTimeout(() => setStatusMessage(null), 3000);
    } catch (err) {
      console.error('âŒ ×©×’×™××” ×‘×©×œ×™×—×ª ×ª×’×•×‘×”:', err);
      setStatusMessage({ text: '×©×’×™××” ×‘×©×œ×™×—×ª ×ª×’×•×‘×”', type: 'error' });
    } finally {
      setSubmitting(false);
    }
  };

  const categoryLabel = labelMap[slug] || slug;


  return (
    <PageContainer
      title={thread ? thread.title : '×˜×•×¢×Ÿ...'}
      breadcrumbs={[
        { label: '×“×£ ×”×‘×™×ª', href: '/' },
        { label: '×¤×•×¨×•×', href: '/forum' },
        { label: categoryLabel, href: `/forum/${slug}` },
        { label: thread?.title || '×“×™×•×Ÿ', href: `/forum/${slug}/${threadSlug}` },
      ]}
    >
      <div className="bg-[#111111] text-gray-200 min-h-screen py-8 px-2 sm:px-4">
        {loading ? (
          <p className="text-center text-gray-400">×˜×•×¢×Ÿ ×“×™×•×Ÿ...</p>
        ) : !thread ? (
          <p className="text-center text-red-500">âŒ ×“×™×•×Ÿ ×œ× × ××¦×</p>
        ) : (
          <>
            {/* ğŸŸ¥ ×¤×•×¡×˜ ×¤×ª×™×—×” */}
            <div className="border border-gray-700 rounded-lg bg-[#1a1a1a] shadow-md mb-8">
              <div className="p-4 border-b border-gray-700 flex justify-between items-center">
                <div className="flex items-center gap-2">
                  {thread.pinned && (
                    <span className="text-[#e60000] font-bold text-sm">ğŸ“Œ × ×¢×•×¥</span>
                  )}
                  {thread.locked && (
                    <span className="text-[#ff3333] font-bold text-sm">ğŸ”’ × ×¢×•×œ</span>
                  )}
                  <h2 className="text-xl sm:text-2xl font-semibold text-white">
                    {thread.title}
                  </h2>
                </div>
                <p className="text-sm text-gray-400 text-right">
                  × ×›×ª×‘ ×¢×œ ×™×“×™ {thread.author}
                  <br />
                  ×¦×¤×™×•×ª: {thread.views || 0}
                </p>
              </div>
              <div className="p-6 text-gray-100 whitespace-pre-line leading-relaxed">
                {thread.content}
              </div>
              <div className="px-6 pb-4 text-xs text-gray-500 border-t border-gray-700">
                ×¢×•×“×›×Ÿ ×œ××—×¨×•× ×”:{" "}
                {thread.lastActivity
                  ? new Date(thread.lastActivity).toLocaleString("he-IL")
                  : "â€”"}
              </div>
            </div>

            {/* ğŸŸ¦ ×¨×©×™××ª ×ª×’×•×‘×•×ª */}
            <div className="space-y-6">
              {comments.length === 0 ? (
                <p className="text-gray-400 text-center">××™×Ÿ ×ª×’×•×‘×•×ª ×¢×“×™×™×Ÿ.</p>
              ) : (
                comments.map((c, i) => (
                  <div
                    key={c.id}
                    className="flex flex-col md:flex-row border border-gray-700 bg-[#1a1a1a] rounded-lg shadow-md"
                  >
                    <div className="md:w-1/4 bg-[#151515] border-b md:border-b-0 md:border-l border-gray-700 text-center p-4">
                      <img
                        src="/default-avatar.png"
                        alt="avatar"
                        className="w-16 h-16 mx-auto rounded-full mb-2 border border-gray-700"
                      />
                      <p className="font-semibold text-gray-100">{c.author || "×× ×•× ×™××™"}</p>
                      <p className="text-xs text-gray-500 mt-1">
                        ×ª×’×•×‘×” #{i + 1}
                        <br />
                        {new Date(c.date).toLocaleString("he-IL")}
                      </p>
                      <button
                        onClick={() => setReplyTo(c.id)}
                        className="text-[#e60000] hover:text-[#ff3333] text-xs mt-3 underline"
                      >
                        ×”×©×‘
                      </button>
                    </div>

                    <div className="flex-1 p-4 text-gray-100">
                      {c.reply_to && (
                        <p className="text-xs text-gray-500 mb-1">
                          ×‘×ª×’×•×‘×” ×œ×”×•×“×¢×” #{c.reply_to}
                        </p>
                      )}
                      <p className="whitespace-pre-line leading-relaxed">{c.text}</p>
                    </div>
                  </div>
                ))
              )}
            </div>

            {/* ğŸŸ¢ ×˜×•×¤×¡ ×ª×’×•×‘×” */}
            {!thread.locked && (
              <form
                onSubmit={handleSubmit}
                className="mt-10 border border-gray-700 rounded-lg bg-[#1a1a1a] shadow-md p-6 text-gray-200"
              >
                {replyTo && (
                  <div className="text-sm text-gray-400 mb-3">
                    ××’×™×‘ ×œÖ¾×ª×’×•×‘×” #{replyTo}{" "}
                    <button
                      type="button"
                      onClick={() => setReplyTo(null)}
                      className="text-[#e60000] hover:text-[#ff3333]"
                    >
                      ×‘×™×˜×•×œ
                    </button>
                  </div>
                )}

                <h3 className="text-lg font-semibold text-white mb-4 text-right">
                  ×”×©××¨ ×ª×’×•×‘×”
                </h3>

                <label className="block mb-2 text-sm font-medium text-gray-400 text-right">
                  ×©×
                </label>
                <input
                  type="text"
                  value={newComment.author}
                  onChange={(e) =>
                    setNewComment({ ...newComment, author: e.target.value })
                  }
                  className="w-full bg-[#2a2a2a] border border-gray-600 rounded px-3 py-2 mb-4 text-gray-100 focus:outline-none focus:border-[#e60000]"
                  placeholder="×œ×“×•×’××”: ×¨×•×›×‘ ×-TMAX..."
                />

                <label className="block mb-2 text-sm font-medium text-gray-400 text-right">
                  ×ª×’×•×‘×”
                </label>
                <textarea
                  value={newComment.text}
                  onChange={(e) =>
                    setNewComment({ ...newComment, text: e.target.value })
                  }
                  className="w-full bg-[#2a2a2a] border border-gray-600 rounded px-3 py-2 h-32 mb-4 text-gray-100 resize-none focus:outline-none focus:border-[#e60000]"
                  placeholder="×›×ª×•×‘ ×›××Ÿ ××ª ×ª×’×•×‘×ª×š..."
                />

                <button
                  type="submit"
                  disabled={submitting}
                  className={`w-full px-6 py-2 rounded font-semibold text-white transition ${
                    submitting
                      ? "bg-gray-500 cursor-not-allowed"
                      : "bg-[#e60000] hover:bg-[#ff3333]"
                  }`}
                >
                  {submitting ? "×©×•×œ×—..." : "×¤×¨×¡× ×ª×’×•×‘×”"}
                </button>

                {statusMessage && (
                  <p
                    className={`mt-4 text-center font-medium ${
                      statusMessage.type === "success"
                        ? "text-green-500"
                        : "text-red-500"
                    }`}
                  >
                    {statusMessage.text}
                  </p>
                )}
              </form>
            )}

            {thread.locked && (
              <p className="text-center text-red-500 mt-6">
                ğŸ”’ ×”×“×™×•×Ÿ × ×¢×•×œ. ×œ× × ×™×ª×Ÿ ×œ×”×•×¡×™×£ ×ª×’×•×‘×•×ª.
              </p>
            )}
          </>
        )}
      </div>
    </PageContainer>
  );
}


///
// app/forum/[slug]/page.jsx
'use client';

import { useEffect, useState } from 'react';
import { useParams } from 'next/navigation';
import Link from 'next/link';
import PageContainer from '@/components/PageContainer';
import { fetchThreadsByCategorySlug, addThread } from '@/lib/forumApi';
import { getForumLabel } from '@/utils/labelMap';

export default function ForumCategoryPage() {
  const params = useParams();
  const slug = params?.slug ? decodeURIComponent(params.slug) : '';
  const [threads, setThreads] = useState([]);
  const [loading, setLoading] = useState(true);
  const [newThread, setNewThread] = useState({ title: '', content: '', author: '' });
  const [submitting, setSubmitting] = useState(false);
  const [statusMessage, setStatusMessage] = useState(null);

  // âœ… ×©× ×”×§×˜×’×•×¨×™×” ×‘×¢×‘×¨×™×ª ×œ×¤×™ ×”×¡×œ××’
  const categoryLabel = getForumLabel(slug);

  const loadThreads = async () => {
    try {
      const data = await fetchThreadsByCategorySlug(slug);
      setThreads(data);
    } catch (err) {
      console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ×“×™×•× ×™×:', err);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    loadThreads();
  }, [slug]);

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!newThread.title.trim() || !newThread.content.trim()) {
      alert('× × ×œ××œ× ×›×•×ª×¨×ª ×•×ª×•×›×Ÿ');
      return;
    }

    setSubmitting(true);
    try {
      await addThread({
        title: newThread.title,
        content: newThread.content,
        author: newThread.author || '×× ×•× ×™××™',
        categorySlug: slug,
      });
      setNewThread({ title: '', content: '', author: '' });
      await loadThreads();
      setStatusMessage({ text: 'âœ… ×”×“×™×•×Ÿ × ×•×¡×£ ×‘×”×¦×œ×—×”!', type: 'success' });
      setTimeout(() => setStatusMessage(null), 2500);
    } catch (err) {
      setStatusMessage({ text: 'âŒ ×©×’×™××” ×‘×™×¦×™×¨×ª ×“×™×•×Ÿ', type: 'error' });
    } finally {
      setSubmitting(false);
    }
  };

  return (
    <PageContainer
      title={`${categoryLabel}`}
      breadcrumbs={[
        { label: '×“×£ ×”×‘×™×ª', href: '/' },
        { label: '×¤×•×¨×•×', href: '/forum' },
        { label: categoryLabel, href: `/forum/${slug}` },
      ]}
    >
      <div className="bg-[#111111] text-gray-200 min-h-screen py-8 px-2 sm:px-4">
        {loading ? (
          <p className="text-center text-gray-400">×˜×•×¢×Ÿ ×“×™×•× ×™×...</p>
        ) : threads.length === 0 ? (
          <p className="text-center text-gray-400">××™×Ÿ ×“×™×•× ×™× ×‘×§×˜×’×•×¨×™×” ×–×•.</p>
        ) : (
          <ul className="divide-y divide-gray-800 border border-gray-700 rounded-lg overflow-hidden bg-[#1a1a1a] shadow-md">
            {threads.map((t) => (
              <li
                key={t.id}
                className="hover:bg-[#2a0a0a] transition cursor-pointer group"
              >
                <Link href={`/forum/${slug}/${t.slug}`} className="block p-5">
                  <div className="flex flex-col sm:flex-row sm:justify-between sm:items-center">
                    <div className="flex items-center gap-2 mb-2 sm:mb-0">
                      {t.pinned && (
                        <span className="text-[#e60000] font-bold text-xs bg-[#300] px-2 py-1 rounded">
                          ğŸ“Œ × ×¢×•×¥
                        </span>
                      )}
                      {t.locked && (
                        <span className="text-[#ff3333] font-bold text-xs bg-[#400] px-2 py-1 rounded">
                          ğŸ”’ × ×¢×•×œ
                        </span>
                      )}
                      <h3 className="text-lg font-semibold text-white group-hover:text-[#e60000] transition">
                        {t.title}
                      </h3>
                    </div>
                    <div className="text-sm text-gray-400 text-left sm:text-right">
                      <p>
                        × ×›×ª×‘ ×¢×œ ×™×“×™{' '}
                        <span className="text-gray-300">{t.author}</span>
                      </p>
                      <p className="text-xs text-gray-500 mt-1">
                        ×¦×¤×™×•×ª: {t.views || 0} â€¢{' '}
                        {t.lastActivity
                          ? `×¢×“×›×•×Ÿ ××—×¨×•×Ÿ: ${new Date(
                              t.lastActivity
                            ).toLocaleDateString('he-IL')}`
                          : 'â€”'}
                      </p>
                    </div>
                  </div>

                  <p className="text-gray-400 text-sm mt-2 line-clamp-2 whitespace-pre-line">
                    {t.content.length > 300
                      ? t.content.slice(0, 300) + '...'
                      : t.content}
                  </p>
                </Link>
              </li>
            ))}
          </ul>
        )}

        {/* ğŸ”» ×˜×•×¤×¡ ×¤×ª×™×—×ª ×“×™×•×Ÿ ×—×“×© */}
        <form
          onSubmit={handleSubmit}
          className="mt-8 border border-gray-700 rounded-lg bg-[#1a1a1a] shadow-md p-6 text-gray-200"
        >
          <h3 className="text-xl font-semibold text-white mb-4 text-right border-b border-gray-700 pb-2">
            ×¤×ª×— ×“×™×•×Ÿ ×—×“×©
          </h3>

          <label className="block mb-2 text-sm font-medium text-gray-400 text-right">
            ×©×
          </label>
          <input
            type="text"
            value={newThread.author}
            onChange={(e) =>
              setNewThread({ ...newThread, author: e.target.value })
            }
            className="w-full bg-[#2a2a2a] border border-gray-600 rounded px-3 py-2 mb-4 text-gray-100 focus:outline-none focus:border-[#e60000]"
            placeholder="×œ×“×•×’××”: ×¨×•×›×‘ ×-TMAX..."
          />

          <label className="block mb-2 text-sm font-medium text-gray-400 text-right">
            ×›×•×ª×¨×ª
          </label>
          <input
            type="text"
            value={newThread.title}
            onChange={(e) =>
              setNewThread({ ...newThread, title: e.target.value })
            }
            className="w-full bg-[#2a2a2a] border border-gray-600 rounded px-3 py-2 mb-4 text-gray-100 focus:outline-none focus:border-[#e60000]"
            placeholder="×œ×“×•×’××”: ×‘×¢×™×” ×‘××¢×¨×›×ª ×‘×œ×™××” ×©×œ GSX..."
          />

          <label className="block mb-2 text-sm font-medium text-gray-400 text-right">
            ×ª×•×›×Ÿ
          </label>
          <textarea
            value={newThread.content}
            onChange={(e) =>
              setNewThread({ ...newThread, content: e.target.value })
            }
            className="w-full bg-[#2a2a2a] border border-gray-600 rounded px-3 py-2 h-32 mb-4 text-gray-100 resize-none focus:outline-none focus:border-[#e60000]"
            placeholder="×›×ª×•×‘ ×›××Ÿ ××ª ×ª×•×›×Ÿ ×”×“×™×•×Ÿ..."
          />

          <button
            type="submit"
            disabled={submitting}
            className={`w-full px-6 py-2 rounded font-semibold text-white transition ${
              submitting
                ? 'bg-gray-500 cursor-not-allowed'
                : 'bg-[#e60000] hover:bg-[#ff3333]'
            }`}
          >
            {submitting ? '×©×•×œ×—...' : '×¤×¨×¡× ×“×™×•×Ÿ'}
          </button>

          {statusMessage && (
            <p
              className={`mt-4 text-center font-medium ${
                statusMessage.type === 'success'
                  ? 'text-green-500'
                  : 'text-red-500'
              }`}
            >
              {statusMessage.text}
            </p>
          )}
        </form>
      </div>
    </PageContainer>
  );
}


////

// components/PageContainer.jsx
'use client';
import React from 'react';
import Breadcrumbs from './Breadcrumbs';
import SidebarMiddleLayer from './SidebarMiddleLayer';
import SidebarLeftLayer from './SidebarLeftLayer';
import useIsMobile from '@/hooks/useIsMobile';

export default function PageContainer({ title, breadcrumbs = [], children }) {
  const isMobile = useIsMobile();

  return (
    <div className="w-screen sm:w-full overflow-x-hidden sm:overflow-visible bg-[#f9f9f9]">
      <main
        dir="rtl"
        className="min-h-screen flex-1 mb-0 px-0 sm:px-0 pt-[1px] pb-[2px] text-right"
      >
        {/* ğŸ”´ ×‘×¨×“×§×¨××‘×¡ */}
        {breadcrumbs.length > 0 && (
          <div className="mb-1">
            <Breadcrumbs items={breadcrumbs} />
          </div>
        )}

        {/* ğŸ”¶ ×›×•×ª×¨×ª ×¨××©×™×ª */}
        {title && (
          <h1 className="text-2xl sm:text-3xl font-bold text-black mb-2 border-b-2 border-[#e60000] pb-1">
            {title}
          </h1>
        )}

        {/* ğŸ”µ ×©×œ×•×©×ª ×”×‘×œ×•×§×™× */}
        <div className="w-full flex flex-col lg:flex-row min-h-screen bg-gray-100">
          
          {/* âœ… ×ª×•×›×Ÿ ×¨××©×™ â€“ Sticky */}
          <div className="w-full lg:w-1/2 flex-shrink-0 px-0 py-0 lg:border-l border-[#e60000]">
            <div className="sticky top-[70px]"> 
              {children}
            </div>
          </div>

          {/* ×¡×™×™×“×¨ ×××¦×¢×™ */}
          <div
            className={`w-full lg:w-1/4 flex-shrink-0 px-0 py-0 ${
              !isMobile ? 'border-l border-[#e60000]' : ''
            }`}
          >
            <SidebarMiddleLayer />
          </div>

          {/* ×¡×™×™×“×¨ ×©×××œ×™ */}
          <div
            className={`w-full lg:w-1/4 flex-shrink-0 px-0 py-0 ${
              !isMobile ? 'border-r border-[#e60000]' : ''
            }`}
          >
            <SidebarLeftLayer />
          </div>
        </div>
      </main>
    </div>
  );
}
///
// app/articles/[slug]/page.jsx
export const dynamic = 'force-dynamic';

import PageContainer from "@/components/PageContainer";
import ArticleHeader from "@/components/ArticleHeader";
import SimpleKeyValueTable from "@/components/SimpleKeyValueTable";
import Tags from "@/components/Tags";
import SimilarArticles from "@/components/SimilarArticles";
import { notFound } from "next/navigation";
import CommentsSection from "@/components/CommentsSection";
import Gallery from "@/components/Gallery";
import { labelMap } from "@/utils/labelMap";
import InlineImage from "@/components/InlineImage";
import EmbedContent from "@/components/EmbedContent";
import ScrollToTableButton from "@/components/ScrollToTableButton";
import ScrollToGalleryButton from "@/components/ScrollToGalleryButton";




const API_URL = process.env.STRAPI_API_URL;
const PUBLIC_API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL || API_URL;
const SITE_URL = "https://www.onmotormedia.com";
const PLACEHOLDER_IMG = "/default-image.jpg";

// âœ… ××ª×§× ×ª × ×ª×™×‘×™ ×ª××•× ×•×ª ×™×—×¡×™×™× ×‘×ª×•×š HTML
function fixRelativeImages(html) {
Â  if (!html) return html;
Â  return html.replace(
Â  Â  /<img\s+[^>]*src=["'](?!https?:\/\/)([^"']+)["']/g,
Â  Â  (match, src) => {
Â  Â  Â  const fullSrc = src.startsWith("/")
Â  Â  Â  Â  ? `${PUBLIC_API_URL}${src}`
Â  Â  Â  Â  : `${PUBLIC_API_URL}/uploads/${src}`;
Â  Â  Â  return match.replace(src, fullSrc);
Â  Â  }
Â  );
}

// âœ… ×¤×•× ×§×¦×™×” ×¤×©×•×˜×” ×œ×ª×™×§×•×Ÿ ×§×™×©×•×¨×™ ××“×™×”
function resolveImageUrl(rawUrl) {
Â  if (!rawUrl) return PLACEHOLDER_IMG;
Â  if (rawUrl.startsWith("http")) return rawUrl;
Â  return `${PUBLIC_API_URL}${rawUrl.startsWith("/") ? rawUrl : `/uploads/${rawUrl}`}`;
}

// âœ… ×¤×•× ×§×¦×™×•×ª ×¢×–×¨ ×œ×§×™×©×•×¨×™× ×‘Ö¾Rich Text
function normalizeHref(href) {
Â  if (!href) return '#';
Â  if (/^https?:\/\//i.test(href) || href.startsWith('mailto:') || href.startsWith('tel:')) return href;
Â  return href.startsWith('/') ? href : `/${href}`;
}

function isExternal(href) {
Â  return /^https?:\/\//i.test(href);
}

function renderMarks(text, node) {
Â  let t = text ?? '';
Â  if (node?.bold) t = `<strong>${t}</strong>`;
Â  if (node?.italic) t = `<em>${t}</em>`;
Â  if (node?.underline) t = `<u>${t}</u>`;
Â  return t;
}

function toHtmlFromStrapiChildren(children) {
Â  if (!Array.isArray(children)) return '';
Â  return children.map((node) => {
Â  Â  // ×¦×•××ª ×§×™×©×•×¨
Â  Â  if (node?.type === 'link' || node?.url) {
Â  Â  Â  const href = normalizeHref(node.url || '#');
Â  Â  Â  const inner = node.children?.length
Â  Â  Â  Â  ? toHtmlFromStrapiChildren(node.children)
Â  Â  Â  Â  : renderMarks(node.text || '', node);
Â  Â  Â  const target = isExternal(href) ? '_blank' : '_self';
Â  Â  Â  const rel = isExternal(href) ? 'noopener noreferrer' : '';
Â  Â  Â  return `<a href="${href}" target="${target}" rel="${rel}" class="text-blue-600 underline hover:text-blue-800">${inner}</a>`;
Â  Â  }

Â  Â  // ×˜×§×¡×˜ ×¨×’×™×œ
Â  Â  if (typeof node?.text === 'string') {
Â  Â  Â  return renderMarks(node.text, node);
Â  Â  }

Â  Â  // ×× ×™×© ×™×œ×“×™× × ×•×¡×¤×™×
Â  Â  if (node?.children?.length) {
Â  Â  Â  return toHtmlFromStrapiChildren(node.children);
Â  Â  }

Â  Â  return '';
Â  }).join('');
}

export async function generateMetadata({ params }) {
Â  const API_URL = process.env.STRAPI_API_URL;
Â  const SITE_URL = "https://www.onmotormedia.com";

Â  try {
Â  Â  // ========= â¬‡ï¸ ×”×ª×™×§×•×Ÿ ×”×’×“×•×œ ×›××Ÿ â¬‡ï¸ =========
Â  Â  // ×× ×• ××©×ª××©×™× ×‘-populate=* ×‘×“×™×•×§ ×›××• ×‘×¤×•× ×§×¦×™×” ArticlePage
Â  Â  // ×›×“×™ ×œ×”×‘×˜×™×— ×©×× ×• ××§×‘×œ×™× ××ª ××•×ª×• ××‘× ×” × ×ª×•× ×™× "×©×˜×•×—"
Â  Â  const res = await fetch(
Â  Â  Â  `${API_URL}/api/articles?filters[slug][$eq]=${params.slug}&populate=*`,
Â  Â  Â  { cache: "no-store" }
Â  Â  );

Â  Â  if (!res.ok) {
Â  Â  Â  throw new Error(`API fetch failed with status ${res.status}`);
Â  Â  }

Â  Â  const json = await res.json();
Â  Â  
Â  Â  //  ========= â¬‡ï¸ ×”×ª×™×§×•×Ÿ ×”×©× ×™ â¬‡ï¸ =========
Â  Â  //  ×”×¡×¨× ×• ××ª .attributes ×›×“×™ ×œ×”×ª××™× ×œ××‘× ×” ×”"×©×˜×•×—"
Â  Â  const article = json.data?.[0]; 

Â  Â  if (!article) {
Â  Â  Â  return {}; // ×—×–×¨×” ×œ×‘×¨×™×¨×ª ××—×“×œ
Â  Â  }

Â  Â  const title = article.title || "OnMotor Media";
Â  Â  
Â  Â  // ========= â¬‡ï¸ ×”×œ×•×’×™×§×” ×©×‘×™×§×©×ª (×ª×™××•×¨) â¬‡ï¸ =========
Â  Â  const description =
Â  Â  Â  article.headline ||
Â  Â  Â  article.description ||
Â  Â  Â  article.subdescription ||
Â  Â  Â  "×›×ª×‘×” ××ª×•×š ××’×–×™×Ÿ OnMotor Media";

Â  Â  let imageUrl = "https://www.onmotormedia.com/full_Logo.jpg";
Â  Â  
Â  Â  // ========= â¬‡ï¸ ×”×œ×•×’×™×§×” ×©×‘×™×§×©×ª (×ª××•× ×”) â¬‡ï¸ =========
Â  Â  if (
Â  Â  Â  Array.isArray(article.external_media_links) &&
Â  Â  Â  article.external_media_links.length > 1 &&
Â  Â  Â  article.external_media_links[1]?.startsWith("http")
Â  Â  ) {
Â  Â  Â  imageUrl = article.external_media_links[1].trim();
Â  Â  } else if (article.image?.data?.attributes?.url) {
Â  Â  Â  // ×”×œ×•×’×™×§×” ×”××§×•×¨×™×ª ×©×œ×š ×œ-populate=* ×”× ×™×—×” ××‘× ×” ××§×•× ×Ÿ ×œ×ª××•× ×”
Â  Â  Â  imageUrl = `${API_URL}${article.image.data.attributes.url}`;
Â  Â  } else if (article.image?.url) {
Â  Â  Â  // ×œ××§×¨×” ×©×”×ª××•× ×” ×’× "×©×˜×•×—×”"
Â  Â  Â  imageUrl = resolveImageUrl(article.image.url);
Â  Â  }

Â  Â  return {
Â  Â  Â  title: `${title} | OnMotor Media`,
Â  Â  Â  description,
Â  Â  Â  alternates: { canonical: `${SITE_URL}/articles/${params.slug}` },
Â  Â  Â  openGraph: {
Â  Â  Â  Â  title,
Â  Â  Â  Â  description,
Â  Â  Â  Â  type: "article",
Â  Â  Â  Â  locale: "he_IL",
Â  Â  Â  Â  url: `${SITE_URL}/articles/${params.slug}`,
Â  Â  Â  Â  siteName: "OnMotor Media",
Â  Â  Â  Â  images: [
Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  url: imageUrl,
Â  Â  Â  Â  Â  Â  width: 1200,
Â  Â  Â  Â  Â  Â  height: 630,
Â  Â  Â  Â  Â  Â  alt: title,
Â  Â  Â  Â  Â  },
Â  Â  Â  Â  ],
Â  Â  Â  },
Â  Â  Â  twitter: {
Â  Â  Â  Â  card: "summary_large_image",
Â  Â  Â  Â  title,
Â  Â  Â  Â  description,
Â  Â  Â  Â  images: [imageUrl],
Â  Â  Â  },
Â  Â  };
Â  } catch (err) {
Â  Â  console.error("âš ï¸ Metadata generation error:", err);
Â  Â  return {}; // ×‘××§×¨×” ×©×œ ×©×’×™××”, ×—×–×•×¨ ×œ×‘×¨×™×¨×ª ×”××—×“×œ ××”-layout
Â  }
}
// ===================================================================
//      ×”×¤×•× ×§×¦×™×” ×”×¨××©×™×ª ×©×œ ×”×“×£ - ×—×–×¨×” ×œ×§×•×“ ×”××§×•×¨×™ ×©×œ×š
// ===================================================================

export default async function ArticlePage({ params }) {
Â  const res = await fetch(
Â  Â  `${API_URL}/api/articles?filters[slug][$eq]=${params.slug}&populate=*`,
Â  Â  { next: { revalidate: 0 } }
Â  );

Â  const json = await res.json();
Â  const rawArticle = json.data?.[0];
Â  if (!rawArticle) return notFound();

Â  const data = rawArticle; // <-- ×—×–×¨× ×• ×œ×§×•×“ ×”××§×•×¨×™ ×©×œ×š (×œ×œ× .attributes)

Â  // âœ… ×˜×™×¤×•×œ ×‘×’×œ×¨×™×” (×ª××•× ×•×ª ××§×•××™×•×ª)
Â  const galleryItems = data.gallery?.data
Â  Â  ? data.gallery.data.map((item) => item.attributes)
Â  Â  : data.gallery || [];

Â  // âœ… ×’×œ×¨×™×” ×¨×’×™×œ×”
Â  const gallery = galleryItems.map((img) => ({
Â  Â  src: resolveImageUrl(img.url),
Â  Â  alt: img.alternativeText || "×ª××•× ×” ××”×’×œ×¨×™×”",
Â  }));

Â  // âœ… ×§×¨×™××” ×œ×©×“×•×ª ×—×“×©×™×
Â  const externalImageUrls = Array.isArray(data.externalImageUrls)
Â  Â  ? data.externalImageUrls
Â  Â  : data.externalImageUrls
Â  Â  ? [data.externalImageUrls]
Â  Â  : [];

Â  const externalMediaUrl = data.externalMediaUrl || null;

Â  // âœ… ×ª××•× ×” ×¨××©×™×ª â€” ×›×•×œ×œ external_media_links
Â  let mainImage = PLACEHOLDER_IMG;
Â  let mainImageAlt = "×ª××•× ×” ×¨××©×™×ª";

  // ×—×–×¨×” ×œ×œ×•×’×™×§×ª ×”×ª××•× ×” ×”××§×•×¨×™×ª ×©×œ×š
Â  if (galleryItems?.length > 0 && galleryItems[0]?.url) {
Â  Â  mainImage = resolveImageUrl(galleryItems[0].url);
Â  Â  mainImageAlt = galleryItems[0].alternativeText || "×ª××•× ×” ×¨××©×™×ª";
Â  } else if (data.image?.data?.attributes?.url) { // ×”×ª×××” ×œ××‘× ×” ×©×œ populate=*
Â  Â  mainImage = resolveImageUrl(data.image.data.attributes.url);
Â  Â  mainImageAlt = data.image.data.attributes.alternativeText || "×ª××•× ×” ×¨××©×™×ª";
Â  } else if (
Â  Â  Array.isArray(data.external_media_links) &&
Â  Â  data.external_media_links.length > 1 &&
Â  Â  typeof data.external_media_links[1] === "string" &&
Â  Â  data.external_media_links[1].startsWith("http")
Â  ) {
Â  Â  mainImage = data.external_media_links[1].trim();
Â  Â  mainImageAlt = "×ª××•× ×” ×¨××©×™×ª ××”××“×™×” ×”×—×™×¦×•× ×™×ª";
Â  }

Â  const article = {
Â  Â  title: data.title || "×›×ª×‘×” ×œ×œ× ×›×•×ª×¨×ª",
Â  Â  description: data.description || "",
Â  Â  image: mainImage,
Â  Â  imageAlt: mainImageAlt,
Â  Â  author: data.author || "××¢×¨×›×ª OnMotor",
Â  Â  date: data.date || "2025-06-22",
Â  Â  time: data.time || "10:00",
Â  Â  tags: data.tags || [],
Â  Â  content: data.content || "",
Â  Â  tableData: data.tableData || {},
Â  Â  href: `/articles/${params.slug}`,
Â  Â  category: data.category || "general",
Â  Â  subcategory: Array.isArray(data.subcategory)
Â  Â  Â  ? data.subcategory[0]
Â  Â  Â  : data.subcategory,
Â  Â  values: Array.isArray(data.Values)
Â  Â  Â  ? data.Values
Â  Â  Â  : data.Values
Â  Â  Â  ? [data.Values]
Â  Â  Â  : [],
Â  Â  headline: data.headline || data.title,
Â  Â  subdescription: data.subdescription || "",
Â  Â  slug: params.slug,
Â  Â  gallery,
Â  Â  externalImageUrls,
Â  Â  externalMediaUrl,
Â  Â  external_media_links: data.external_media_links || [],
Â  	font_family: data.font_family || "Heebo, sans-serif",
Â  };

Â  // âœ… ×¤×™×¨×•×¨×™ ×œ×—×
Â  const breadcrumbs = [{ label: "×“×£ ×”×‘×™×ª", href: "/" }];
Â  if (article.category) {
Â  Â  breadcrumbs.push({
Â  Â  Â  label: labelMap[article.category] || article.category,
Â  Â  Â  href: `/${article.category}`,
Â  Â  });
Â  }
Â  if (article.subcategory) {
Â  Â  breadcrumbs.push({
Â  Â  Â  label: labelMap[article.subcategory] || article.subcategory,
Â  Â  Â  href: `/${article.category}/${article.subcategory}`,
Â  Â  });
Â  }
Â  if (article.values?.length > 0) {
Â  Â  const valueKey = article.values[0];
Â  Â  breadcrumbs.push({
Â  Â  Â  label: labelMap[valueKey] || valueKey,
Â  Â  Â  href: `/${article.category}/${article.subcategory}/${valueKey}`,
Â  Â  });
Â  }
Â  breadcrumbs.push({ label: article.title });

Â  // âœ… ×¨×™× ×“×•×¨ ×ª×•×›×Ÿ ×¢×™×§×¨×™ (×›×•×œ×œ ×§×™×©×•×¨×™×, ×ª××•× ×•×ª, Embed)
Â  const renderParagraph = (block, i) => {
Â  Â  // ×˜×§×¡×˜ ×¨×’×™×œ
Â  Â  if (typeof block === "string") {
Â  Â  Â  const cleanText = fixRelativeImages(block.trim());
Â  	Â  const hasHTMLTags = /<\/?[a-z][\s\S]*>/i.test(cleanText);

Â  	Â  if (hasHTMLTags) {
Â  	Â  Â  return (
Â  	Â  	Â  <div
Â  	Â  	Â  Â  key={i}
Â  	Â  	Â  Â  className="article-text text-gray-800 text-[18px] leading-relaxed"
Â  	Â  	Â  Â  dangerouslySetInnerHTML={{ __html: cleanText }}
Â  	Â  	Â  />
Â  	Â  Â  );
Â  	Â  }

Â  	Â  const urlMatch = cleanText.match(/https?:\/\/[^\s]+/);
Â  	Â  if (urlMatch) {
Â  	Â  Â  const url = urlMatch[0].trim();
Â  	Â  Â  if (/\.(jpg|jpeg|png|gif|webp)$/i.test(url)) {
Â  	Â  	Â  return <InlineImage key={i} src={url} alt="×ª××•× ×” ××ª×•×š ×”×›×ª×‘×”" caption="" />;
Â  	Â  Â  }
Â  	Â  Â  if (
Â  	Â  	Â  /(youtube\.com|youtu\.be|facebook\.com|instagram\.com|tiktok\.com|x\.com|twitter\.com)/i.test(
Â  	Â  	Â  Â  url
Â  	Â  	Â  )
Â  	Â  Â  ) {
Â  	Â  	Â  return <EmbedContent key={i} url={url} />;
Â  	Â  Â  }
Â  	Â  Â  return (
Â  	Â  	Â  <p key={i} className="article-text text-blue-600 underline">
Â  	Â  	Â  Â  <a href={url} target="_blank" rel="noopener noreferrer">{url}</a>
Â  	Â  	Â  </p>
Â  	Â  Â  );
Â  	Â  }

Â  	Â  return (
Â  	Â  Â  <p
Â  	Â  	Â  key={i}
Â  	Â  	Â  className="article-text text-gray-800 text-[18px] leading-relaxed"
Â  	Â  	Â  dangerouslySetInnerHTML={{ __html: cleanText.replace(/\n/g, "<br/>") }}
Â  	Â  Â  />
Â  	Â  );
Â  Â  }
    
Â  Â  // ×‘×œ×•×§ ××¡×•×’ ×¤×¡×§×” (Rich Text ×-Strapi)
Â  Â  if (block.type === "paragraph" && block.children) {
Â  Â  Â  let html = toHtmlFromStrapiChildren(block.children);
Â  Â  Â  html = fixRelativeImages(html);

Â  	Â  const urlMatch = html.match(/https?:\/\/[^\s"']+/);
Â  	Â  if (urlMatch) {
Â  	Â  Â  const url = urlMatch[0];
Â  	Â  Â  if (/\.(jpg|jpeg|png|gif|webp)$/i.test(url)) {
Â  	Â  	Â  return <InlineImage key={i} src={url} alt="×ª××•× ×”" caption="" />;
Â  	Â  Â  }
Â  	Â  Â  if (
Â  	Â  	Â  /(youtube\.com|youtu\.be|facebook\.com|instagram\.com|tiktok\.com|x\.com|twitter\.com)/i.test(
Â  	Â  	Â  Â  url
Â  	Â  	Â  )
Â  	Â  Â  ) {
Â  	Â  	Â  return <EmbedContent key={i} url={url} />;
Â  	Â  Â  }
Â  	Â  }

Â  	Â  return (
Â  	Â  Â  <p
Â  	Â  	Â  key={i}
Â  	Â  	Â  className="article-text text-gray-800 text-[18px] leading-relaxed"
Â  	Â  	Â  dangerouslySetInnerHTML={{ __html: html }}
Â  	Â  Â  />
Â  	Â  );
Â  Â  }

Â  Â  // ×›×•×ª×¨×•×ª
Â  Â  if (block.type === "heading") {
Â  Â  Â  const level = block.level || 2;
Â  Â  Â  const Tag = `h${Math.min(level, 3)}`;
Â  	Â  const text = block.children?.map((c) => c.text).join("") || "";
Â  	Â  return (
Â  	Â  Â  <Tag
Â  	Â  	Â  key={i}
Â  	Â  	Â  className="font-bold text-2xl text-gray-900 mt-4 mb-2"
Â  	Â  	Â  dangerouslySetInnerHTML={{ __html: fixRelativeImages(text) }}
Â  	Â  	Â  />
Â  	Â  );
Â  Â  }

Â  Â  // ×ª××•× ×” ××ª×•×š ×‘×œ×•×§ Strapi
Â  Â  if (block.type === "image") {
Â  Â  Â  const imageData =
Â  Â  Â  Â  block.image?.data?.attributes || block.image?.attributes || block.image;
Â  Â  Â  if (!imageData?.url) return null;
Â  Â  Â  const alt = imageData.alternativeText || "×ª××•× ×” ××ª×•×š ×”×›×ª×‘×”";
Â  Â  Â  const caption = imageData.caption || "";
Â  	Â  return (
Â  	Â  Â  <InlineImage
Â  	Â  	Â  key={i}
Â  	Â  	Â  src={
Â  	Â  	Â  Â  imageData.url.startsWith("http")
Â  	Â  	Â  Â  Â  ? imageData.url
Â  	Â  	Â  Â  Â  : `${PUBLIC_API_URL}${imageData.url}`
Â  	Â  	Â  }
Â  	Â  	Â  alt={alt}
Â  	Â  	Â  caption={caption}
Â  	Â  Â  />
Â  	Â  );
Â  Â  }

Â  Â  return null;
Â  };

Â  const paragraphs = Array.isArray(article.content)
Â  Â  ? article.content
Â  Â  : article.content.split("\n\n");

Â  return (
    <>
Â  Â  <PageContainer title={article.title} breadcrumbs={breadcrumbs}>
Â  Â  Â  <div
Â  Â  Â  Â  className="mx-auto max-w-[740px] space-y-2 text-right leading-relaxed text-base text-gray-800 px-2"
Â  	Â  Â  style={{ fontFamily: article.font_family }}
Â  Â  Â  >
Â  	Â  Â  <ArticleHeader
Â  	Â  	Â  author={article.author}
Â  	Â  	Â  date={article.date}
Â  	Â  	Â  time={article.time}
Â  	Â  	Â  image={article.image}
Â  	Â  	Â  imageAlt={article.imageAlt}
Â  	Â  	Â  title={article.headline}
Â  	Â  	Â  subdescription={article.subdescription}
Â  	Â  	Â  tags={article.tags}
Â  	Â  Â  />

Â  	Â  Â  {article.description && (
Â  	Â  Â  Â  <p className="font-bold text-2xl text-gray-600">{article.description}</p>
Â  	Â  Â  )}
        {article.subdescription && (
          <p className="second-description text-gray-700 text-[18px]">{article.subdescription}</p>
        )}
Â  	Â  Â  {paragraphs.map(renderParagraph)}

Â  	Â  Â  {article.tableData && (
          <div className="article-table-section">
            <SimpleKeyValueTable data={article.tableData} />
          </div>
        )}

Â  	Â  Â  <div className="article-gallery-section">
          <Gallery
            images={article.gallery}
            externalImageUrls={article.externalImageUrls}
            externalMediaUrl={article.externalMediaUrl}
            external_media_links={article.external_media_links}
          />
        </div>


Â  	Â  Â  <Tags tags={article.tags} />
Â  	Â  Â  <SimilarArticles currentSlug={article.slug} category={article.category} />
Â  	Â  Â  <CommentsSection articleUrl={`${SITE_URL}${article.href}`} />
Â  	Â  </div>
Â  Â  </PageContainer>
Â  Â  <ScrollToTableButton />
Â  Â  <ScrollToGalleryButton />
    </>
Â  );
}

///
"https://cdn2.yamaha-motor.eu/prod/product-assets/2026/XS850GP/2026-Yamaha-XS850GP-EU-Legend_Yellow-Action-011-03.jpg",
  "https://cdn2.yamaha-motor.eu/prod/product-assets/2026/XS850GP/2026-Yamaha-XS850GP-EU-Legend_Yellow-Static-005-03.jpg",
  "https://cdn2.yamaha-motor.eu/prod/product-assets/2026/XS850GP/2026-Yamaha-XS850GP-EU-Legend_Yellow-Static-004-03.jpg",
  "https://cdn2.yamaha-motor.eu/prod/product-assets/2026/XS850GP/2026-Yamaha-XS850GP-EU-Legend_Yellow-Action-004-03.jpg",
  "https://cdn2.yamaha-motor.eu/prod/product-assets/2026/XS850GP/2026-Yamaha-XS850GP-EU-Legend_Yellow-360-Degrees-001-03.jpg",
  "https://cdn2.yamaha-motor.eu/prod/product-assets/2026/XS850GP/2026-Yamaha-XS850GP-EU-NA-Detail-010-03.jpg",
  "https://cdn2.yamaha-motor.eu/prod/product-assets/2026/XS850GP/2026-Yamaha-XS850GP-EU-Legend_Yellow-Static-008-03.jpg",
  "https://cdn2.yamaha-motor.eu/prod/product-assets/2026/XS850GP/2026-Yamaha-XS850GP-EU-Legend_Yellow-Action-005-03.jpg",

////

//components\TabLeftSidebar.jsx
'use client';
import React, { useState, useEffect, useRef } from 'react';
import Image from 'next/image';
import useIsMobile from '@/hooks/useIsMobile';


const tabs = ['××—×¨×•× ×™×', '×‘×“×¨×›×™×', '×¤×•×¤×•×œ×¨×™'];
const API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL;


// ğŸ‘‡ ×¤×•× ×§×¦×™×” ×©××•×¦×™××” ×©× ××ª×¨ × ×§×™ ××ª×•×š ×›×ª×•×‘×ª
function extractDomainName(url) {
  try {
    const host = new URL(url).hostname.replace('www.', '');
    const parts = host.split('.');

    let base = '';
    if (parts.length >= 3 && ['co', 'org', 'net'].includes(parts[parts.length - 2])) {
      base = parts[parts.length - 3]; // ×œ×“×•×’××”: ynet.co.il â†’ ynet
    } else {
      base = parts[0]; // ×œ×“×•×’××”: example.com â†’ example
    }

    // ××•×ª ×¨××©×•× ×” ×’×“×•×œ×”
    return base.charAt(0).toUpperCase() + base.slice(1);
  } catch {
    return 'Website';
  }
}

export default function TabLeftSidebar() {
  const isMobile = useIsMobile();
  const [hasInteracted, setHasInteracted] = useState(false);
  const scrollContainerRef = useRef(null);
  const sidebarRef = useRef(null);

  const [activeTab, setActiveTab] = useState('××—×¨×•× ×™×');
  const [latestArticles, setLatestArticles] = useState([]);
  const [onRoadArticles, setOnRoadArticles] = useState([]);
  const [viralContent, setViralContent] = useState([]);
  const [popularContent, setPopularContent] = useState([]);
  const [victims, setVictims] = useState([]);
  const [isPaused, setIsPaused] = useState(false);

  // ×¤×•× ×§×¦×™×” ×œ×¢×™×‘×•×“ ××•×‘×™×™×§×˜ ×›×ª×‘×”/×¤×¨×™×˜ ××›×œ ×¡×•×’
  const normalizeItem = (obj, type = 'article') => {
    const a = obj.attributes || obj;

    // ğŸ‘‡ ×§×‘×™×¢×ª ××§×•×¨ ×œ×¤×™ ×”-URL
    let autoSource = '';
    if (a.url) {
      if (a.url.includes('youtube.com') || a.url.includes('youtu.be')) {
        autoSource = 'YouTube';
      } else if (a.url.includes('tiktok.com')) {
        autoSource = 'TikTok';
      } else if (a.url.includes(process.env.NEXT_PUBLIC_SHOPIFY_STORE_DOMAIN)) {
        autoSource = 'Shopify';
      } else if (a.url.includes('instagram.com')) {
        autoSource = 'Instagram';
      } else if (a.url.includes('facebook.com')) {
        autoSource = 'Facebook';
      } else {
        autoSource = extractDomainName(a.url);
      }
    }

    // --- â­ï¸ ×œ×•×’×™×§×ª ×ª××•× ×•×ª â­ï¸ ---
    let img = null;
    const gallery = a.gallery; // ××’×™×¢ ×-populate=*

    if (type === 'latest-article') {
      // "××—×¨×•× ×™×": × ×¡×” ×ª××•× ×” ×©× ×™×™×” (index 1), ×× ××™×Ÿ, ×—×–×•×¨ ×œ×¨××©×•× ×” (index 0)
      const imgData = gallery?.[1] || gallery?.[0];
      if (imgData?.url) {
        img = `${API_URL}${imgData.url}`;
      }
    } else if (type === 'onroad-article') {
      // "×‘×“×¨×›×™×": × ×¡×” ×ª××•× ×” ×©×œ×™×©×™×ª (index 2), ×× ××™×Ÿ, ×—×–×•×¨ ×œ×¨××©×•× ×” (index 0)
      const imgData = gallery?.[2] || gallery?.[0];
      if (imgData?.url) {
        img = `${API_URL}${imgData.url}`;
      }
    } else {
      // "×¤×•×¤×•×œ×¨×™" ×•×›×œ ×”×©××¨: ×”×©××¨ ××ª ×”×œ×•×’×™×§×” ×”××§×•×¨×™×ª (××©×™×›×” ××©×“×” image)
      if (a.image?.data?.attributes?.url) {
        img = `${API_URL}${a.image.data.attributes.url}`;
      } else if (a.image?.url) {
        img = `${API_URL}${a.image.url}`;
      }
    }

    // ×¤×•×œ×‘××§ ×›×œ×œ×™ ×× ×©×•× ×œ×•×’×™×§×” ×œ× ××¦××” ×ª××•× ×” (×¨×œ×•×•× ×˜×™ ×‘×¢×™×§×¨ ×œ×›×ª×‘×•×ª)
    if (!img && gallery?.[0]?.url) {
      img = `${API_URL}${gallery[0].url}`;
    }
    
    if (img && img.trim() === '') {
      img = null;
    }
    // --- â­ï¸ ×¡×•×£ ×”×œ×•×’×™×§×” â­ï¸ ---

    return {
      id: obj.id,
      title: a.title || a.name || '',
      slug: a.slug || '',
      description: a.description || '',
      image: img, // â­ï¸ ×”×ª××•× ×” ××¡×˜×¨××¤×™ (×× ×§×™×™××ª)
      date: a.date?.split('T')[0] || a.publishedAt?.split('T')[0] || '',
      url: a.url || '',
      views: a.views ?? null,
      source: a.source || autoSource,
    };
  };

  useEffect(() => {
    const fetchLatest = async () => {
      try {
        const res = await fetch(`${API_URL}/api/articles?sort=date:desc&populate=*`);
        const data = (await res.json()).data || [];
        setLatestArticles(data.map((a) => normalizeItem(a, 'latest-article')));
      } catch (err) {
        console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ××—×¨×•× ×™×:', err);
      }
    };

    const fetchOnRoad = async () => {
      try {
        const res = await fetch(
         `${API_URL}/api/articles?filters[tags_txt][$contains]=iroads&sort=date:desc&populate=*`
        );
        const data = (await res.json()).data || [];
        setOnRoadArticles(data.map((a) => normalizeItem(a, 'onroad-article')));
      } catch (err) {
        console.error("×©×’×™××” ×‘×˜×¢×™× ×ª '×‘×“×¨×›×™×':", err);
      }
    };

    const fetchViral = async () => {
      try {
        const res = await fetch(`${API_URL}/api/viral-contents?sort=views:desc&populate=*`);
        const data = (await res.json()).data || [];
        setViralContent(data.map((v) => normalizeItem(v, 'viral')));
      } catch (err) {
        console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ×•×™×¨××œ×™:', err);
      }
    };

    const fetchPopular = async () => {
      try {
        const res = await fetch(`${API_URL}/api/populars?sort=date:desc&populate=*`);
        const data = (await res.json()).data || [];

        const withPreview = await Promise.all(
          data.map(async (item) => {
            const norm = normalizeItem(item, 'popular'); 

            // --- â­ï¸ ×ª×™×§×•×Ÿ: "×¨×§ ×× ××™×Ÿ ×ª××•× ×” ××¡×˜×¨××¤×™, × ×¡×” ×œ××©×•×š ×-preview" â­ï¸ ---
            // ×”×—×–×¨× ×• ××ª ×”×ª× ××™ ×œ×§×“××•×ª×•
            if (!norm.image && norm.url) {
              try {
                const previewRes = await fetch(
                  `/api/preview?url=${encodeURIComponent(norm.url)}`
                );
                const previewJson = await previewRes.json();
                
                if (previewJson?.image) {
                  norm.image = previewJson.image;
                }
              } catch (err) {
                console.error('Preview fetch error:', err);
              }
            }
            // --- â­ï¸ ×¡×•×£ ×”×ª×™×§×•×Ÿ â­ï¸ ---

            // âœ… fallback ×¡×•×¤×™
            if (!norm.image) {
              norm.image = '/default-image.jpg';
            }

            return norm;
          })
        );

        setPopularContent(withPreview);
      } catch (err) {
        console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ×¤×•×¤×•×œ×¨×™:', err);
      }
    };

    const fetchVictims = async () => {
      try {
        const res = await fetch(`${API_URL}/api/victims?sort=date:desc&populate=*`);
        const data = (await res.json()).data || [];
        setVictims(data.map((v) => normalizeItem(v, 'victim')));
      } catch (err) {
        console.error('×©×’×™××” ×‘×˜×¢×™× ×ª × ×¤×’×¢×™×:', err);
      }
    };

    fetchLatest();
    fetchOnRoad();
    fetchViral();
    fetchPopular();
    fetchVictims();
  }, []);

  useEffect(() => {
    if (isMobile) return;
    const container = scrollContainerRef.current;
    if (!container) return;

    const speed = 1;
    let frame;

    const step = () => {
      if (!isPaused) {
        container.scrollTop += speed;
        if (container.scrollTop >= container.scrollHeight - container.clientHeight) {
          container.scrollTop = 0;
        }
      }
      frame = requestAnimationFrame(step);
    };
    frame = requestAnimationFrame(step);
    return () => cancelAnimationFrame(frame);
  }, [activeTab, isPaused, isMobile]);

  useEffect(() => {
    if (!isMobile || !sidebarRef.current || !hasInteracted) return;
    setTimeout(() => {
    const y = sidebarRef.current.getBoundingClientRect().top + window.scrollY - 100; // ğŸ”´ ×›××Ÿ 100px ×–×” ×”×”×¤×¨×©
    window.scrollTo({ top: y, behavior: 'smooth' });
  }, 0);
}, [activeTab, isMobile, hasInteracted]);

  const getStyledContent = (items) => {
    return items.map((item, i) => {
      const even = i % 2 === 0;
      const bg = even ? 'bg-red-50 text-black' : 'bg-neutral-900 text-white';
      return (
        <a
          key={item.id}
          href={item.url || (item.slug ? `/articles/${item.slug}` : '#')}
          target={item.url ? '_blank' : '_self'}
          rel={item.url ? 'noopener noreferrer' : ''}
          className={`flex gap-2 items-start p-1 rounded transition-transform duration-200 ${bg} hover:scale-[1.03] hover:shadow-sm`}
        >
          <div className="w-20 h-14 relative rounded overflow-hidden flex-shrink-0">
            <Image
              src={item.image || '/default-image.jpg'}
              alt={item.title}
              fill
              style={{ objectFit: 'cover' }}
              className="rounded"
            />
          </div>
          <div className="flex flex-col text-right">
            <p className="font-bold text-sm line-clamp-1">{item.title}</p>
            <p
              className={`text-xs ${even ? 'text-gray-700' : 'text-gray-300'} line-clamp-2`}
            >
              {item.description}
            </p>
            {item.date && (
              <span
                className={`text-xs ${even ? 'text-gray-500' : 'text-gray-400'} mt-1`}
              >
                {item.date}
              </span>
            )}
            {(item.views || item.source) && (
              <span className="text-xs text-gray-400 mt-1">
                {item.views ? `${item.views} ×¦×¤×™×•×ª` : ''}
                {item.views && item.source ? ' Â· ' : ''}
                {item.source || ''}
              </span>
            )}
          </div>
        </a>
      );
    });
  };
  

  let content = [];
  if (activeTab === '××—×¨×•× ×™×') {
    content = getStyledContent(latestArticles);
  } else if (activeTab === '×‘×“×¨×›×™×') {
    content = getStyledContent(onRoadArticles);
  } else if (activeTab === '×¤×•×¤×•×œ×¨×™') {
    content = getStyledContent(popularContent);
  } else {
    content = getStyledContent(viralContent);
  }

  return (
    <div
      ref={sidebarRef}
      className={`flex flex-col min-h-0 bg-white shadow-md w-full text-sm ${
        isMobile ? 'w-screen rounded-none' : ''
      }`}
    >
      <div
        className="flex border-b text-sm font-semibold bg-white sticky top-0 z-10 shadow-sm"
        dir="rtl"
      >
        {tabs.map((tab) => (
          <button
            key={tab}
            onClick={() => {
              setActiveTab(tab);
              setHasInteracted(true);
            }}
            className={`w-1/3 text-center py-2 ${
              activeTab === tab
                ? 'text-black border-b-2 border-red-500 bg-white'
                : 'text-gray-500 bg-gray-100'
            }`}
          >
            {tab}
          </button>
        ))}
      </div>
      <div
        ref={scrollContainerRef}
        onMouseEnter={() => setIsPaused(true)}
        onMouseLeave={() => setIsPaused(false)}
        className="custom-scrollbar overflow-x-hidden p-1 space-y-1 flex-1 overflow-y-auto max-h-[380px]"
        dir="rtl"
      >
        {content}
      </div>
        
      
    </div>
  );
}
///
//components\CategoryPage.jsx
'use client';
import React, { useEffect, useState } from 'react';
import SectionWithHeader from './SectionWithHeader';
import LimitedArticles from './LimitedArticles';
import { labelMap } from '@/utils/labelMap';

const API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL;

// ×§×™×‘×•×¥ ×œ×¤×™ ×ª×ª ×§×˜×’×•×¨×™×•×ª ×¨×’×™×œ×•×ª
function groupBySubcategory(articles) {
  return articles.reduce((acc, article) => {
    const subcategories = Array.isArray(article.subcategory)
      ? article.subcategory
      : [article.subcategory];

    subcategories.forEach((subcat) => {
      if (!acc[subcat]) acc[subcat] = [];
      acc[subcat].push(article);
    });

    return acc;
  }, {});
}

// ×§×™×‘×•×¥ ×œ×¤×™ Values (×œ×ª×ª×™Ö¾×ª×ª×™ ×§×˜×’×•×¨×™×•×ª ×©×œ ××“×¨×™×›×™×)
function groupByValues(articles) {
  return articles.reduce((acc, article) => {
    const values = Array.isArray(article.Values)
      ? article.Values
      : [article.Values];

    values.forEach((val) => {
      if (!acc[val]) acc[val] = [];
      acc[val].push(article);
    });

    return acc;
  }, {});
}

export default function CategoryPage({ categoryKey = ' ', subcategoryKey = null, guideSubKey = null }) {
  const [articles, setArticles] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    async function fetchArticles() {
      try {
        let url = `${API_URL}/api/articles?populate=*`;

        // âœ… ×¡×™× ×•×Ÿ ×œ×¤×™ ×§×˜×’×•×¨×™×” ×¨××©×™×ª
        if (categoryKey) {
          url += `&filters[category][$eq]=${categoryKey}`;
        }

        const res = await fetch(url);
        const json = await res.json();
        let data = json.data || [];

        // âœ… ×¡×™× ×•×Ÿ ×‘×¦×“ ×”×œ×§×•×— ×œ×¤×™ ×ª×ªÖ¾×§×˜×’×•×¨×™×” (×‘×’×œ×œ ××’×‘×œ×ª SQLite)
        if (subcategoryKey) {
          data = data.filter((a) => {
            const sub = a.subcategory;
            if (!sub) return false;
            if (Array.isArray(sub)) return sub.includes(subcategoryKey);
            if (typeof sub === 'string') return sub.includes(subcategoryKey);
            return false;
          });
        }

        // âœ… ×¡×™× ×•×Ÿ ×œ×¤×™ ×ª×ªÖ¾×ª×ª ×§×˜×’×•×¨×™×” (Values)
        if (guideSubKey) {
          data = data.filter((a) => {
            const vals = a.Values;
            if (!vals) return false;
            if (Array.isArray(vals)) return vals.includes(guideSubKey);
            if (typeof vals === 'string') return vals.includes(guideSubKey);
            return false;
          });
        }

        const mapped = data.map((a) => ({
          id: a.id,
          title: a.title,
          slug: a.slug,
          image: a.image?.url ? `${API_URL}${a.image.url}` : '/default-image.jpg',
          imageAlt: a.imageAlt || '',
          category: a.category || 'general',
          subcategory: Array.isArray(a.subcategory)
            ? a.subcategory
            : [a.subcategory ?? 'general'],
          Values: Array.isArray(a.Values)
            ? a.Values
            : [a.Values ?? null],
          description: a.description,
          headline: a.headline || a.title,
          subdescription: a.subdescription,
          href: `/articles/${a.slug}`,
          tags: a.tags || [],
          date: a.date || '',
          time: a.time || '00:00',
        }));
        // âœ… ××™×•×Ÿ ×œ×¤×™ ×ª××¨×™×š + ×©×¢×” + ×“×§×” (××”×—×“×© ×œ×™×©×Ÿ)
        const sorted = mapped.sort((a, b) => {
          const aDateTime = new Date(`${a.date}T${a.time}`);
          const bDateTime = new Date(`${b.date}T${b.time}`);
          return bDateTime - aDateTime;
        });

        setArticles(sorted);

        
      } catch (err) {
        console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ×›×ª×‘×•×ª:', err);
      } finally {
        setLoading(false);
      }
    }

    fetchArticles();
  }, [categoryKey, subcategoryKey, guideSubKey]);

  if (loading) {
    return <p className="text-center text-gray-500">×˜×•×¢×Ÿ ×›×ª×‘×•×ª...</p>;
  }

  if (articles.length === 0) {
    return <p className="text-center text-gray-500">××™×Ÿ ×¢×“×™×™×Ÿ ×›×ª×‘×•×ª ×‘×§×˜×’×•×¨×™×” ×–×•</p>;
  }

  // âœ… ×œ×•×’×™×§×ª ×§×™×‘×•×¥
  const grouped =
    guideSubKey
      ? { [guideSubKey]: articles }
      : subcategoryKey === 'guides'
        ? groupByValues(articles)
        : subcategoryKey
          ? { [subcategoryKey]: articles }
          : groupBySubcategory(articles);

  const hebTitle = guideSubKey
    ? `${labelMap['guides']} - ${labelMap[guideSubKey] || guideSubKey}`
    : subcategoryKey
      ? labelMap[subcategoryKey] || subcategoryKey
      : labelMap[categoryKey] || categoryKey;

  const shouldShowMainTitle =
    subcategoryKey !== null || guideSubKey !== null || Object.keys(grouped).length === 1;

  return (
    <div className="max-w-screen-xl mx-auto px-0">
      <div className="flex flex-col gap-0" dir="rtl">
        {!subcategoryKey && !guideSubKey && shouldShowMainTitle && (
          <SectionWithHeader
            title={hebTitle}
            href={`/${categoryKey}`}
            variant="main"
          />
        )}

        {Object.entries(grouped).map(([subKey, subArticles]) => (
          <div key={subKey} className="bg-white shadow">
            {!guideSubKey && Object.keys(grouped).length > 1 && (
              <SectionWithHeader
                title={labelMap[subKey] || subKey}
                href={
                  subcategoryKey === 'guides'
                    ? `/${categoryKey}/${subcategoryKey}/${subKey}`
                    : `/${categoryKey}/${subKey}`
                }
                variant="category"
              />
            )}

            <LimitedArticles articles={subArticles} initialCount={2} />
          </div>
        ))}
      </div>
    </div>
  );
}
///
//components\SearchBar.jsx
'use client';
import React, { useState, useEffect, useId } from "react";
import { useRouter } from 'next/navigation';
import Fuse from 'fuse.js';
import Image from 'next/image';
import { IoClose } from "react-icons/io5";
import generateSearchSuggestions from "@/lib/generateSearchSuggestions";



export default function SearchBar({ onSelect = () => {} }) {
  const router = useRouter();
  const [query, setQuery] = useState('');
  const [filtered, setFiltered] = useState([]);
  const [isFocused, setIsFocused] = useState(false);
  const [isHovered, setIsHovered] = useState(false);
  const [activeIndex, setActiveIndex] = useState(-1);
  const [suggestions, setSuggestions] = useState([]);

  // ğŸ†” useId ××‘×˜×™×— ××–×”×” ×™×™×—×•×“×™ ×œ×›×œ ××•×¤×¢ ×¨×›×™×‘
  const inputId = useId();

  useEffect(() => {
    async function fetchSuggestions() {
      const data = await generateSearchSuggestions();
      setSuggestions(data);
    }
    fetchSuggestions();
  }, []);

  const fuse = new Fuse(suggestions, {
    keys: ['title'],
    threshold: 0.3,
    includeMatches: true,
    minMatchCharLength: 1,
    ignoreLocation: true,
    useExtendedSearch: true,
  });

  const isPopular = !query.trim();
  const showResults = (isFocused || isHovered) && (isPopular ? popularSuggestions : filtered);

  const handleChange = (e) => {
    const value = e.target.value;
    setQuery(value);
    setActiveIndex(-1);

    if (!value.trim()) {
      setFiltered([]);
      return;
    }

    const results = fuse.search(value.trim());
    setFiltered(results.map(result => ({
      ...result.item,
      matches: result.matches
    })));
  };

  const handleSelect = (path) => {
    router.push(path);
    onSelect();
    closeSearch();
  };

  const closeSearch = () => {
    setQuery('');
    setFiltered([]);
    setIsFocused(false);
    setIsHovered(false);
    setActiveIndex(-1);
  };

  const highlightMatch = (text, matches) => {
    const match = matches?.find(m => m.key === 'title');
    if (!match || !match.indices.length) return text;

    const parts = [];
    let lastIndex = 0;
    match.indices.forEach(([start, end], i) => {
      parts.push(text.slice(lastIndex, start));
      parts.push(<mark key={i} className="bg-yellow-300 px-0.5">{text.slice(start, end + 1)}</mark>);
      lastIndex = end + 1;
    });
    parts.push(text.slice(lastIndex));
    return parts;
  };

  return (
    <div
      className="relative lg:w-72 text-right"
      onMouseEnter={() => setIsHovered(true)}
      onMouseLeave={() => setTimeout(() => setIsHovered(false), 150)}
    >
      <form
        autoComplete="off"
        onSubmit={(e) => e.preventDefault()}
        className="relative w-full"
      >
        {/* âœ… label ××©×•×™×š ×œ×©×“×” ×œ×¤×™ id ×™×™×—×•×“×™ */}
        <label htmlFor={inputId} className="sr-only">
          ×—×™×¤×•×© ×‘××ª×¨ OnMotor Media
        </label>

        <input
          dir="rtl"
          id={inputId}
          name={`search-input-${inputId}`}
          type="text"
          autoComplete="new-password"
          autoCorrect="off"
          spellCheck="false"
          value={query}
          onChange={handleChange}
          onFocus={() => setIsFocused(true)}
          onKeyDown={(e) => {
            if (!showResults.length) return;
            if (e.key === 'ArrowDown') {
              e.preventDefault();
              setActiveIndex((prev) => (prev + 1) % showResults.length);
            } else if (e.key === 'ArrowUp') {
              e.preventDefault();
              setActiveIndex((prev) => (prev - 1 + showResults.length) % showResults.length);
            } else if (e.key === 'Enter') {
              e.preventDefault();
              const selected = showResults[activeIndex];
              if (selected) handleSelect(selected.path);
            } else if (e.key === 'Escape') {
              e.preventDefault();
              closeSearch();
            }
          }}
          placeholder="×—×¤×© ×‘××ª×¨..."
          className="text-right text-white placeholder-white p-1 pr-1 rounded border border-red-600 w-full transition-all duration-300"
        />

        {(query.trim() || showResults.length > 0) && (
          <button
            type="button"
            onClick={closeSearch}
            className="absolute left-2 top-1/2 -translate-y-1/2 text-white hover:text-red-600 text-xl"
            aria-label="× ×§×” ×•×¡×’×•×¨ ×—×™×¤×•×©"
          >
            <IoClose />
          </button>
        )}
      </form>

      {showResults.length > 0 && (
        <ul
          dir="rtl"
          className="absolute top-full mt-0 right-0 bg-white border border-gray-300 rounded shadow-lg z-50 w-full text-sm text-black max-h-60 overflow-y-auto"
        >
          {isPopular && (
            <div className="flex justify-end p-2 border-b border-gray-200">
              <button
                type="button"
                onClick={closeSearch}
                className="text-white hover:text-red-600 transition text-xl"
                aria-label="×¡×’×•×¨ ×”×¦×¢×•×ª ×¤×•×¤×•×œ×¨×™×•×ª"
              >
                <IoClose />
              </button>
            </div>
          )}

          {showResults.map((item, idx) => (
            <li
              key={idx}
              onClick={() => handleSelect(item.path)}
              className={`flex items-center gap-2 cursor-pointer px-3 py-2
                ${idx === activeIndex ? 'bg-gray-200 font-bold' : 'hover:bg-gray-100'}`}
            >
              {item.image && (
                <div className="relative w-10 h-10 flex-shrink-0 rounded overflow-hidden">
                  <Image src={item.image} alt={item.title} fill className="object-cover" />
                </div>
              )}
              <span className="flex-1 overflow-hidden text-ellipsis whitespace-nowrap">
                {highlightMatch(item.title, item.matches || [])}
              </span>
            </li>
          ))}
        </ul>
      )}
    </div>
  );
}


///
// app/articles/[slug]/page.jsx
export const dynamic = 'force-dynamic';

import PageContainer from "@/components/PageContainer";
import ArticleHeader from "@/components/ArticleHeader";
import SimpleKeyValueTable from "@/components/SimpleKeyValueTable";
import Tags from "@/components/Tags";
import SimilarArticles from "@/components/SimilarArticles";
import { notFound } from "next/navigation";
import CommentsSection from "@/components/CommentsSection";
import Gallery from "@/components/Gallery";
import { labelMap } from "@/utils/labelMap";
import InlineImage from "@/components/InlineImage";
import EmbedContent from "@/components/EmbedContent";

const API_URL = process.env.STRAPI_API_URL;

export default async function ArticlePage({ params }) {
  const res = await fetch(
    `${API_URL}/api/articles?filters[slug][$eq]=${params.slug}&populate=*`,
    { next: { revalidate: 0 } }
  );

  const json = await res.json();
  const rawArticle = json.data?.[0];
  if (!rawArticle) return notFound();

  const data = rawArticle;

  const article = {
    title: data.title || "×›×ª×‘×” ×œ×œ× ×›×•×ª×¨×ª",
    description: data.description || "××™×Ÿ ×ª×™××•×¨ ×–××™×Ÿ",
    image: data.image?.url ? `${API_URL}${data.image.url}` : "/default-image.jpg",
    imageAlt: data.image?.alternativeText || "×ª××•× ×” ×¨××©×™×ª",
    author: data.author || "××¢×¨×›×ª OnMotor",
    date: data.date || "2025-06-22",
    time: data.time || "10:00",
    tags: data.tags || [],
    content: data.content || "",
    tableData: data.tableData || {},
    href: `/articles/${params.slug}`,
    category: data.category || "general",
    subcategory: Array.isArray(data.subcategory)
      ? data.subcategory[0]
      : data.subcategory,
    values: Array.isArray(data.Values)
      ? data.Values
      : data.Values
      ? [data.Values]
      : [],
    headline: data.headline || data.title,
    subdescription: data.subdescription || "",
    slug: params.slug,
    gallery:
      data.gallery?.map((img) => ({
        src: `${API_URL}${img.url}`,
        alt: img.alternativeText || "×ª××•× ×” ××”×’×œ×¨×™×”",
      })) || [],
    font_family: data.font_family || "Heebo, sans-serif",
  };

  // âœ… ×¤×™×¨×•×¨×™ ×œ×—×
  const breadcrumbs = [{ label: "×“×£ ×”×‘×™×ª", href: "/" }];
  if (article.category) {
    breadcrumbs.push({
      label: labelMap[article.category] || article.category,
      href: `/${article.category}`,
    });
  }
  if (article.subcategory) {
    breadcrumbs.push({
      label: labelMap[article.subcategory] || article.subcategory,
      href: `/${article.category}/${article.subcategory}`,
    });
  }
  if (article.values?.length > 0) {
    const valueKey = article.values[0];
    breadcrumbs.push({
      label: labelMap[valueKey] || valueKey,
      href: `/${article.category}/${article.subcategory}/${valueKey}`,
    });
  }
  breadcrumbs.push({ label: article.title });

  // âœ… ×¨×™× ×“×•×¨ ×‘×œ×•×§×™× ×›×•×œ×œ ×§×™×©×•×¨×™×, ×ª××•× ×•×ª ×•×”×˜××¢×•×ª
  const renderParagraph = (block, i) => {
    // ---- ×˜×§×¡×˜ ×¨×’×™×œ (string) ----
    if (typeof block === "string") {
      const cleanText = block.trim();

      if (cleanText.startsWith("[[img:") && cleanText.endsWith("]]")) {
        const parts = cleanText.slice(6, -2).split("||");
        const [src, alt = "", caption = ""] = parts;
        return <InlineImage key={i} src={src} alt={alt} caption={caption} />;
      }

      const hasHTMLTags = /<\/?[a-z][\s\S]*>/i.test(cleanText);
      if (hasHTMLTags) {
        return (
          <p
            key={i}
            className="article-text text-gray-800 text-[18px] leading-relaxed"
            dangerouslySetInnerHTML={{ __html: cleanText }}
          />
        );
      }

      const urlMatch = cleanText.match(/https?:\/\/[^\s]+/);
      if (urlMatch) return <EmbedContent key={i} url={urlMatch[0]} />;

      return (
        <p
          key={i}
          className="article-text text-gray-800 text-[18px] leading-relaxed"
          dangerouslySetInnerHTML={{ __html: cleanText.replace(/\n/g, "<br/>") }}
        />
      );
    }

    // ---- Rich Text ×-Strapi ----
    if (block.type === "paragraph" && block.children) {
      const html = block.children
        .map((child) => {
          // âœ… ×ª××™×›×” ×‘×§×™×©×•×¨ ×©××’×™×¢ ×›Ö¾block ×©×œ× ××¡×•×’ link
          if (child.type === "link" && child.url) {
            const label =
              (child.children && child.children[0]?.text) || child.url;
            const href = child.url.startsWith("http")
              ? child.url
              : `${child.url.startsWith("/") ? child.url : "/" + child.url}`;
            return `<a href="${href}" target="_blank" rel="noopener noreferrer"
              class="text-blue-600 underline hover:text-blue-800 transition-colors duration-150">${label}</a>`;
          }

          // âœ… ×˜×§×¡×˜ ×¨×’×™×œ ×¢× ×¢×™×¦×•×‘
          let text = child.text || "";
          if (child.bold) text = `<strong>${text}</strong>`;
          if (child.italic) text = `<em>${text}</em>`;
          if (child.underline) text = `<u>${text}</u>`;
          return text;
        })
        .join("");

      const cleanHtml = html.replace(/<[^>]+>/g, "").trim();
      const urlMatch = cleanHtml.match(/https?:\/\/[^\s"']+/);
      if (urlMatch && cleanHtml === urlMatch[0]) {
        return <EmbedContent key={i} url={urlMatch[0]} />;
      }

      return (
        <p
          key={i}
          className="article-text text-gray-800 text-[18px] leading-relaxed"
          dangerouslySetInnerHTML={{ __html: html }}
        />
      );
    }

    // ---- ×›×•×ª×¨×•×ª ----
    if (block.type === "heading") {
      const level = block.level || 2;
      const Tag = `h${Math.min(level, 3)}`;
      const text = block.children?.map((c) => c.text).join("") || "";
      return (
        <Tag
          key={i}
          className="font-bold text-2xl text-gray-900 mt-4 mb-2"
          dangerouslySetInnerHTML={{ __html: text }}
        />
      );
    }

    return null;
  };

  // âœ… ×‘× ×™×™×ª ×”×¤×¡×§××•×ª
  let paragraphs = [];
  if (typeof article.content === "string") {
    paragraphs = article.content.split("\n\n");
  } else if (Array.isArray(article.content)) {
    paragraphs = article.content;
  }

  return (
    <PageContainer title={article.title} breadcrumbs={breadcrumbs}>
      <div
        className="mx-auto max-w-[740px] space-y-2 text-right leading-relaxed text-base text-gray-800 px-2"
        style={{ fontFamily: article.font_family }}
      >
        <ArticleHeader
          author={article.author}
          date={article.date}
          time={article.time}
          image={article.image}
          imageAlt={article.imageAlt}
          title={article.headline}
          subdescription={article.subdescription}
        />

        {article.description && (
          <p className="font-bold text-2xl text-gray-600">{article.description}</p>
        )}

        {paragraphs.map(renderParagraph)}

        {article.tableData && <SimpleKeyValueTable data={article.tableData} />}
        <Gallery images={article.gallery} />
        <Tags tags={article.tags} />
        <SimilarArticles currentSlug={article.slug} category={article.category} />
        <CommentsSection articleUrl={`https://www.onmotormedia.com${article.href}`} />
      </div>
    </PageContainer>
  );
}
///

///
//components\Header.jsx
'use client';
import React, { useEffect, useRef, useState } from 'react';
import { gsap } from 'gsap';
import NavigationMenu from './NavigationMenu';
import SearchBar from './SearchBar';
import SocialIcons from './SocialIcons';
import { useAuthModal } from '@/contexts/AuthModalProvider';

export default function Header() {
  const { user, openModal, hydrated } = useAuthModal();
  const logoRef = useRef(null);
  const lettersRef = useRef([]);
  const containerRef = useRef(null);
  const isAnimating = useRef(false);

  useEffect(() => {
    const tl = gsap.timeline();

    tl.fromTo(
      logoRef.current,
      { rotate: -90, scale: 0.8 },
      { rotate: 0, scale: 1, duration: 1.2, ease: 'elastic.out(1, 0.5)' }
    );

    tl.fromTo(
      lettersRef.current,
      { y: 15, opacity: 0, rotate: -10 },
      {
        y: 0,
        opacity: 1,
        rotate: 0,
        duration: 0.6,
        stagger: 0.05,
        ease: 'back.out(1.7)',
      },
      '-=0.9'
    );
  }, []);

  const handleClick = () => {
    if (isAnimating.current) return;
    isAnimating.current = true;

    const tl = gsap.timeline({
      onComplete: () => {
        window.location.href = '/';
      },
    });

    tl.to(containerRef.current, {
      x: -4,
      duration: 0.05,
      repeat: 5,
      yoyo: true,
      ease: 'power1.inOut',
    });

    tl.to(
      logoRef.current,
      { rotate: '+=720', duration: 1.2, ease: 'power3.out' },
      '-=0.2'
    );

    tl.to(
      lettersRef.current,
      {
        y: -10,
        x: 5,
        rotate: 5,
        duration: 0.4,
        stagger: 0.05,
        ease: 'power1.out',
        yoyo: true,
        repeat: 1,
      },
      '-=1'
    );
  };

  const logoText = [
    { char: 'O', red: true },
    { char: 'n' },
    { char: 'M', red: true },
    { char: 'otor\u00A0' },
    { char: 'M', red: true },
    { char: 'edia' },
  ];

  return (
    <header className="sticky top-0 z-50 bg-black text-[#C0C0C0] h-[80px] fixed w-full flex flex-row-reverse items-center justify-between px-2 md:px-6 py-2 shadow-md border-b border-gray-800">
      <div
        ref={containerRef}
        className="flex flex-row-reverse items-center gap-2 min-w-0 cursor-pointer"
        onClick={handleClick}
      >
        <div className="hidden lg:block z-50" dir="rtl">
          {!hydrated ? (
            <div className="w-[80px] h-[32px]" />
          ) : user?.email ? (
            <button
              onClick={(e) => {
                e.stopPropagation();
                openModal('inline', '×”×ª× ×ª×§×•×ª');
              }}
              className="bg-green-600 text-white px-3 py-1 rounded text-sm font-bold whitespace-nowrap"
            >
              {user?.email?.charAt(0).toUpperCase()} ××—×•×‘×¨
            </button>
          ) : (
            <button
              onClick={(e) => {
                e.stopPropagation();
                openModal('inline', '×”×ª×—×‘×¨×•×ª / ×”×¨×©××”');
              }}
              className="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm font-bold whitespace-nowrap"
            >
              ×”×ª×—×‘×¨
            </button>
          )}
        </div>

        <img
          ref={logoRef}
          src="/OnMotorLogonoback.png"
          alt="OnMotor Logo"
          className="w-20 shrink-0 z-50"
          dir="rtl"
        />

        <div className="truncate overflow-visible">
          <h1 dir="ltr" className="text-2xl lg:text-4xl font-bold whitespace-nowrap z-50 flex">
            {logoText.map((part, i) => (
              <span
                key={i}
                ref={(el) => (lettersRef.current[i] = el)}
                className={`inline-block ${part.red ? 'text-[#e60000]' : ''}`}
              >
                {part.char}
              </span>
            ))}
          </h1>
          <p className="text-xs lg:text-sm font-bold text-right whitespace-nowrap truncate">
            ××™×¤×” ×©×× ×•×¢ ×•×’×œ×’×œ×™× ×¤×•×’×©×™× ××“×™×”
          </p>
        </div>
      </div>

      <div className="hidden mobileMenu:hidden lg:flex items-end flex-shrink-0 z-50 suppressHydrationWarning">
        <div dir="ltr" className="flex items-center">
          <div className="w-0 h-15 gap-2">
            <SearchBar />
          </div>

          <div className="flex flex-col items-end gap-4">
            <div className="flex items-center h-10 top-0">
              <SocialIcons size="text-3xl" />
            </div>
            <div dir="ltr" className="flex items-center h-0">
              <NavigationMenu />
            </div>
          </div>
        </div>
      </div>
    </header>
  );
}

///

///
// components/AuthBox.jsx
'use client';
import React, { useState, useEffect, useRef } from 'react';
import { FaChevronUp } from 'react-icons/fa';
import useIsMobile from '@/hooks/useIsMobile';
import { useRouter } from 'next/navigation';
import { useAuthModal } from '@/contexts/AuthModalProvider';
import { loginUser, logoutUser, getCurrentUser } from '@/utils/auth';
import PasswordField from '@/components/PasswordField';

export default function AuthBox({ mode = 'inline', boxRef }) {
  const isMobile = useIsMobile();
  const router = useRouter();
  const { user, setUser } = useAuthModal();

  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [rememberMe, setRememberMe] = useState(false);
  const [loginError, setLoginError] = useState('');
  const [statusMsg, setStatusMsg] = useState('');

  const [activeForm, setActiveForm] = useState(null); // "register" | "reset" | "change" | null
  const refs = { register: useRef(null), reset: useRef(null), change: useRef(null) };

  const [formData, setFormData] = useState({
    registerEmail: '',
    registerPassword: '',
    registerConfirm: '',
    resetEmail: '',
    currentPassword: '',
    newPassword: ''
  });

  useEffect(() => {
    const stored = localStorage.getItem('user');
    if (stored) setUser(JSON.parse(stored));
    const lastEmail = localStorage.getItem('lastEmail');
    if (lastEmail) setEmail(lastEmail);
  }, [setUser]);

  useEffect(() => {
    if (user) setActiveForm(null);
  }, [user]);

  useEffect(() => {
    if (isMobile && boxRef?.current) {
      boxRef.current.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  }, [isMobile, user, boxRef]);

  const handleLogin = async () => {
    setStatusMsg('');
    try {
      const res = await fetch('/api/user/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password }),
        credentials: 'include'
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.error);
      loginUser({ email: data.user.email, jwt: data.jwt });
      setUser(data.user);
      localStorage.setItem('user', JSON.stringify(data.user));
      if (rememberMe) localStorage.setItem('lastEmail', email);
      setStatusMsg('×”×ª×—×‘×¨×ª ×‘×”×¦×œ×—×”!');
      setLoginError('');
    } catch (err) {
      setLoginError(err.message);
    }
  };

  const handleLogout = async () => {
    await logoutUser();
    localStorage.clear();
    setUser(null);
    setEmail('');
    setPassword('');
    setStatusMsg(''); // âœ… ×× ×§×” ××ª ×”×”×•×“×¢×”
    setLoginError('');
  };

  const handleAction = async (type) => {
    setStatusMsg('');
    const body = {};
    let url = '';
    if (type === 'register') {
      const { registerEmail, registerPassword, registerConfirm } = formData;
      if (registerPassword !== registerConfirm)
        return setStatusMsg('×”×¡×™×¡×××•×ª ××™× ×Ÿ ×ª×•×××•×ª');
      body.email = registerEmail;
      body.password = registerPassword;
      url = '/api/user/register';
    } else if (type === 'reset') {
      body.email = formData.resetEmail;
      url = '/api/user/forgot-password';
    } else if (type === 'change') {
      body.currentPassword = formData.currentPassword;
      body.newPassword = formData.newPassword;
      url = '/api/user/change-password';
    }

    try {
      const res = await fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body),
        credentials: 'include'
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.error);
      setStatusMsg(
        type === 'register'
          ? '× ×¨×©××ª ×‘×”×¦×œ×—×”!'
          : type === 'reset'
          ? '× ×©×œ×—×” ×¡×™×¡××” ×—×“×©×” ×œ××™××™×™×œ ×©×œ×š'
          : '×”×¡×™×¡××” ×¢×•×“×›× ×” ×‘×”×¦×œ×—×”'
      );
    } catch (err) {
      setStatusMsg(err.message);
    }
  };

  return (
    <div dir="rtl" className="text-center" ref={boxRef}>
      {isMobile && mode === 'side' && (
        <button
          onClick={() => router.back()}
          className="text-sm bg-white text-black px-2 py-2 rounded shadow hover:bg-gray-200 transition"
        >
          ×¡×’×•×¨ <FaChevronUp className="inline" />
        </button>
      )}

      <div className="transition-all duration-500 ease-in-out mt-2 max-w-md bg-white text-black border border-gray-300 rounded p-3 text-sm shadow-md">
        <h3 className="font-semibold text-black mb-6">
          {user ? '× ×™×”×•×œ ×—×©×‘×•×Ÿ' : '×”×ª×—×‘×¨×•×ª / ×”×¨×©××”'}
        </h3>

        {/* === ××©×ª××© ××—×•×‘×¨ === */}
        {user ? (
          <>
            <p className="mb-4">×©×œ×•×, {user.email}</p>
            <button
              onClick={handleLogout}
              className="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 mb-2 w-full"
            >
              ×”×ª× ×ª×§
            </button>
            <div className="flex justify-center gap-3 text-xs">
              <button onClick={() => setActiveForm('change')} className="text-blue-600 underline">
                ×©× ×” ×¡×™×¡××”
              </button>
              <button onClick={() => setActiveForm('reset')} className="text-blue-600 underline">
                ×©×›×—×ª×™ ×¡×™×¡××”
              </button>
            </div>
          </>
        ) : (
          <>
            <input
              type="email"
              placeholder="××™××™×™×œ"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              onKeyDown={(e) => e.key === 'Enter' && handleLogin()}
              className="w-full px-3 py-2 mb-2 border border-gray-300 rounded text-right text-sm focus:outline-none focus:ring-1 focus:ring-red-500"
            />

            <PasswordField
              placeholder="×¡×™×¡××”"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              onEnter={handleLogin}
              className="w-full mb-2"
            />

            <div className="flex items-center justify-start mb-2">
              <input
                type="checkbox"
                id="rememberMe"
                checked={rememberMe}
                onChange={(e) => setRememberMe(e.target.checked)}
                className="ml-2"
              />
              <label htmlFor="rememberMe" className="text-sm text-black">
                ×”×©××¨ ××—×•×‘×¨
              </label>
            </div>

            <button
              onClick={handleLogin}
              className="bg-[#e60000] text-white px-3 py-2 rounded hover:bg-red-700 text-sm w-full"
            >
              ×”×ª×—×‘×¨
            </button>

            {loginError && <p className="text-red-600 mt-1 text-xs">{loginError}</p>}
            {statusMsg && !loginError && (
              <p className="text-green-600 mt-1 text-xs">{statusMsg}</p>
            )}

            <div className="mt-3 flex justify-center gap-3 text-xs">
              <button onClick={() => setActiveForm('register')} className="text-blue-600 underline">
                ×¦×•×¨ ×—×©×‘×•×Ÿ
              </button>
              <button onClick={() => setActiveForm('reset')} className="text-blue-600 underline">
                ×©×›×—×ª×™ ×¡×™×¡××”
              </button>
            </div>
          </>
        )}

        {/* === ×˜×¤×¡×™× ×¤× ×™××™×™× === */}
        {activeForm === 'register' && (
          <FormBox title="×¦×•×¨ ×—×©×‘×•×Ÿ" onClose={() => setActiveForm(null)} refEl={refs.register}>
            <input
              type="email"
              placeholder="××™××™×™×œ"
              value={formData.registerEmail}
              onChange={(e) =>
                setFormData((f) => ({ ...f, registerEmail: e.target.value }))
              }
              onKeyDown={(e) => e.key === 'Enter' && handleAction('register')}
              className="w-full px-3 py-2 mb-2 border border-gray-300 rounded text-right text-sm focus:ring-1 focus:ring-red-500"
            />
            <PasswordField
              placeholder="×¡×™×¡××”"
              value={formData.registerPassword}
              onChange={(e) =>
                setFormData((f) => ({ ...f, registerPassword: e.target.value }))
              }
              onEnter={() => handleAction('register')}
              className="mb-2"
            />
            <PasswordField
              placeholder="××™××•×ª ×¡×™×¡××”"
              value={formData.registerConfirm}
              onChange={(e) =>
                setFormData((f) => ({ ...f, registerConfirm: e.target.value }))
              }
              onEnter={() => handleAction('register')}
              className="mb-2"
            />
            <SubmitButton text="×”×¨×©××”" color="green" onClick={() => handleAction('register')} />
            {statusMsg && <p className="text-green-600 mt-2 text-xs">{statusMsg}</p>}
          </FormBox>
        )}

        {activeForm === 'reset' && (
          <FormBox title="×©×›×—×ª×™ ×¡×™×¡××”" onClose={() => setActiveForm(null)} refEl={refs.reset}>
            <input
              type="email"
              placeholder="××™××™×™×œ ×œ××™×¤×•×¡"
              value={formData.resetEmail}
              onChange={(e) =>
                setFormData((f) => ({ ...f, resetEmail: e.target.value }))
              }
              onKeyDown={(e) => e.key === 'Enter' && handleAction('reset')}
              className="w-full px-3 py-2 mb-2 border border-gray-300 rounded text-right text-sm focus:ring-1 focus:ring-red-500"
            />
            <SubmitButton text="×©×œ×— ×¡×™×¡××” ×—×“×©×”" color="blue" onClick={() => handleAction('reset')} />
            {statusMsg && <p className="text-green-600 mt-2 text-xs">{statusMsg}</p>}
          </FormBox>
        )}

        {activeForm === 'change' && (
          <FormBox title="×©× ×” ×¡×™×¡××”" onClose={() => setActiveForm(null)} refEl={refs.change}>
            <PasswordField
              placeholder="×¡×™×¡××” × ×•×›×—×™×ª"
              value={formData.currentPassword}
              onChange={(e) =>
                setFormData((f) => ({ ...f, currentPassword: e.target.value }))
              }
              onEnter={() => handleAction('change')}
              className="mb-2"
            />
            <PasswordField
              placeholder="×¡×™×¡××” ×—×“×©×”"
              value={formData.newPassword}
              onChange={(e) =>
                setFormData((f) => ({ ...f, newPassword: e.target.value }))
              }
              onEnter={() => handleAction('change')}
              className="mb-2"
            />
            <SubmitButton text="×¢×“×›×Ÿ ×¡×™×¡××”" color="yellow" onClick={() => handleAction('change')} />
            {statusMsg && <p className="text-green-600 mt-2 text-xs">{statusMsg}</p>}
          </FormBox>
        )}
      </div>
    </div>
  );
}

/* === ×¨×›×™×‘×™ ××©× ×” === */
function FormBox({ title, children, onClose, refEl }) {
  return (
    <div
      ref={refEl}
      className="mt-4 bg-gray-100 p-3 rounded text-right text-sm relative"
    >
      <button
        onClick={onClose}
        className="absolute top-2 left-2 text-gray-500 hover:text-black"
      >
        âœ–
      </button>
      <h4 className="font-semibold mb-2 pr-6">{title}</h4>
      {children}
    </div>
  );
}

function SubmitButton({ text, color, onClick }) {
  const colors = {
    green: 'bg-green-600 hover:bg-green-700',
    blue: 'bg-blue-600 hover:bg-blue-700',
    yellow: 'bg-yellow-600 hover:bg-yellow-700'
  };
  return (
    <button
      type="button"
      onClick={onClick}
      className={`${colors[color]} text-white px-3 py-2 rounded text-sm w-full`}
    >
      {text}
    </button>
  );
}
/////

///global.css454 ///

@import url('https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;700&display=swap');
@import "tailwindcss";
@tailwind base;
@tailwind components;
@tailwind utilities;


@keyframes parts-bounce {
  0%, 100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-5px);
  }
}

.animate-parts-bounce {
  animation: parts-bounce 1s infinite;
}


:root {
  --background: #ffffff;
  --foreground: #171717;
}

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);
}

@media (prefers-color-scheme: dark) {
  :root {
    --background: #0a0a0a;
    --foreground: #ededed;
  }
}

body {
  margin: 0;
  padding: 0;
  max-width: 100%;
  overflow-x: hidden;
  background: var(--background);
  color: var(--foreground);
  font-family: 'Heebo', sans-serif;
}

@keyframes spinEaseOut {
  0% {
    transform: rotate(0deg);
  }
  70% {
    transform: rotate(900deg);
  }
  100% {
    transform: rotate(1080deg);
  }
}

@keyframes bounceDecay {
  0% {
    transform: translateY(0);
  }
  20% {
    transform: translateY(-20px);
  }
  40% {
    transform: translateY(0);
  }
  60% {
    transform: translateY(-10px);
  }
  80% {
    transform: translateY(0);
  }
  100% {
    transform: translateY(-5px);
  }
}
@keyframes marquee {
  0% {
    transform: translateX(100%);
  }
  100% {
    transform: translateX(-100%);
  }
}

.news-ticker-line {
  position: absolute;
  white-space: nowrap;
  animation: marquee 15s linear infinite;
  direction: rtl;
  font-weight: bold;
}

.animate-spin-ease-out {
  animation: spinEaseOut 1.5s ease-out forwards;
}

.animate-bounce-decay {
  animation: bounceDecay 1s ease-out forwards;
}

select {
  max-width: 100%;
  text-overflow: ellipsis;
  white-space: nowrap;
}
@keyframes marquee-loop {
  0% {
    transform: translateX(100%);
  }
  100% {
    transform: translateX(-100%);
  }
}

.animate-marquee-loop {
  display: inline-block;
  white-space: nowrap;
  animation: marquee-loop 15s linear infinite;
}

/* ğŸ¯ ×¢×™×¦×•×‘ ×¤×¡×™ ×’×œ×™×œ×” ×‘×›×œ ×”××ª×¨ ××• ×¨×§ ×œ××œ×× ×˜×™× ×¢× overflow */
::-webkit-scrollbar {
  width: 6px; /* ×¢×•×‘×™ ×¤×¡ ×”×’×œ×™×œ×” */
}

::-webkit-scrollbar-track {
  background: transparent; /* ×¨×§×¢ ×”××¡×™×œ×” */
}

::-webkit-scrollbar-thumb {
  background-color: #a0a0a0; /* ×¦×‘×¢ ×”×™×“×™×ª */
  border-radius: 8px;        /* ×¢×™×’×•×œ ×¤×™× ×•×ª */
  border: 1px solid #555;    /* ××¡×’×¨×ª ×¢×“×™× ×” */
}

::-webkit-scrollbar-thumb:hover {
  background-color: #ff1a1a; /* ××“×•× ×‘×¢×ª ××¢×‘×¨ ×¢×›×‘×¨ */
}

/* ×¢×™×¦×•×‘ ×¤×¡ ×’×œ×™×œ×” ×¨×§ ×œ××–×•×¨ ×”×¡×™×™×“×¨ */
.custom-scrollbar::-webkit-scrollbar {
  width: 8px;
}

.custom-scrollbar::-webkit-scrollbar-thumb {
  background-color: #ff1a1a;;
  border-radius: 10px;
}

.custom-scrollbar::-webkit-scrollbar-thumb:hover {
  background-color: #ff1a1a;
}

/* ğŸ¨ ×©×œ×™×˜×” ×‘×¤×•× ×˜ ×©×œ ×”×˜×§×¡×˜×™× ×‘×œ×‘×“ */
.article-text {
  font-family: 'Heebo', sans-serif; /* ××• ×›×œ ×¤×•× ×˜ ×©×ª×’×“×™×¨ ×‘×¡×˜×¨×¤××™ */
  font-size: 18px;
  line-height: 1.8;
}

/* ğŸ›‘ ××œ ×ª×©×¤×™×¢ ×¢×œ iframes ××• embeds */
.article-text iframe,
.article-text blockquote,
.article-text .instagram-media,
.article-text .tiktok-embed,
.article-text .twitter-tweet,
.article-text .fb-post {
  all: unset; /* ××¡×™×¨ ×›×œ ×”×©×¤×¢×” ×©×œ ×”×¤×•× ×˜ ×©×œ×š */
  font-family: initial;
  font-size: initial;
  line-height: normal;
}
/* ğŸ§© ×‘×™×˜×•×œ ××¨×•×•×—×™× ××™×•×ª×¨×™× ××ª×—×ª ×œ×”×˜××¢×•×ª */
.instagram-media,
.tiktok-embed,
.twitter-tweet,
.fb-post,
iframe[src*="facebook.com"],
iframe[src*="instagram.com"],
iframe[src*="tiktok.com"],
iframe[src*="twitter.com"],
iframe[src*="x.com"] {
  margin-bottom: 0 !important;
  margin-top: 0.5rem !important;
}

/* ×”×ª×××” ×œ××•×‘×™×™×œ */
@media (max-width: 640px) {
  .instagram-media,
  .tiktok-embed,
  .twitter-tweet,
  .fb-post {
    margin-top: 0.2rem !important;
  }
}
///// components/EmbedContent.jsx 

// components/EmbedContent.jsx
"use client";
import React, { useEffect } from "react";

export default function EmbedContent({ url }) {
  useEffect(() => {
    // --- ×˜×¢×™× ×ª SDKs ×©×œ ×¤×œ×˜×¤×•×¨××•×ª ---
    const loadScript = (id, src) => {
      if (!document.getElementById(id)) {
        const s = document.createElement("script");
        s.id = id;
        s.src = src;
        s.async = true;
        document.body.appendChild(s);
      }
    };

    loadScript("instagram-embed", "https://www.instagram.com/embed.js");
    loadScript("tiktok-embed", "https://www.tiktok.com/embed.js");
    loadScript("twitter-embed", "https://platform.twitter.com/widgets.js");
    loadScript("facebook-jssdk", "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v17.0");

    // --- Instagram ×¢×™×‘×•×“ ××—×“×© ---
    if (url.includes("instagram.com")) {
      const tryProcess = () => {
        if (window.instgrm && window.instgrm.Embeds) window.instgrm.Embeds.process();
      };
      tryProcess();
      const t = setTimeout(tryProcess, 800);
      return () => clearTimeout(t);
    }

    // --- Facebook ×¨×¢× ×•×Ÿ ---
    if (url.includes("facebook.com")) {
      const tryProcessFB = () => {
        if (window.FB && window.FB.XFBML) window.FB.XFBML.parse();
      };
      tryProcessFB();
      const t = setTimeout(tryProcessFB, 800);
      return () => clearTimeout(t);
    }
  }, [url]);

  // --- ×¢×™×¦×•×‘ ××—×™×“ ---
  const wrapperClass =
    "flex justify-center items-center mt-2 sm:mt-4 mb-1 w-full max-w-full text-center";

  // âœ… YouTube
  if (url.includes("youtube.com") || url.includes("youtu.be")) {
    let videoId = "";
    if (url.includes("shorts/")) videoId = url.split("shorts/")[1]?.split("?")[0];
    else if (url.includes("watch?v=")) videoId = url.split("v=")[1]?.split("&")[0];
    else videoId = url.split("/").pop()?.split("?")[0];

    return (
      <div className={wrapperClass}>
        <div className="w-full max-w-[720px] aspect-video">
          <iframe
            src={`https://www.youtube.com/embed/${videoId}`}
            allowFullScreen
            title="YouTube Video"
            className="w-full h-full rounded-xl"
          />
        </div>
      </div>
    );
  }

  // âœ… TikTok
  if (url.includes("tiktok.com")) {
    const videoId = url.split("/video/")[1]?.split("?")[0];
    return (
      <div className={wrapperClass}>
        <blockquote
          className="tiktok-embed"
          cite={url}
          data-video-id={videoId}
          style={{ maxWidth: "360px", minWidth: "320px" }}
        >
          <a href={url}></a>
        </blockquote>
      </div>
    );
  }

  // âœ… Instagram
  if (url.includes("instagram.com")) {
    return (
      <div className={wrapperClass}>
        <blockquote
          className="instagram-media"
          data-instgrm-permalink={url}
          data-instgrm-version="14"
          style={{ maxWidth: "400px", margin: "0 auto" }}
        />
      </div>
    );
  }

  // âœ… Facebook (×¤×•×¡×˜ ××• ×¨×™×œ)
  if (url.includes("facebook.com")) {
    return (
      <div className={wrapperClass}>
        <div
          className="fb-post"
          data-href={url}
          data-width="500"
          style={{ margin: "0 auto" }}
        ></div>
      </div>
    );
  }

  // âœ… X / Twitter
  if (url.includes("twitter.com") || url.includes("x.com")) {
    const fixedUrl = url.replace("x.com", "twitter.com");
    return (
      <div className={wrapperClass}>
        <blockquote className="twitter-tweet">
          <a href={fixedUrl}></a>
        </blockquote>
      </div>
    );
  }

  // âœ… ×‘×¨×™×¨×ª ××—×“×œ â€“ ×§×™×©×•×¨ ×¨×’×™×œ
  return (
    <div className={wrapperClass}>
      <a
        href={url}
        target="_blank"
        rel="noopener noreferrer"
        className="text-blue-600 underline break-words"
      >
        {url}
      </a>
    </div>
  );
}
////
// app/articles/[slug]/page.jsx
export const dynamic = 'force-dynamic';

import PageContainer from "@/components/PageContainer";
import ArticleHeader from "@/components/ArticleHeader";
import SimpleKeyValueTable from "@/components/SimpleKeyValueTable";
import Tags from "@/components/Tags";
import SimilarArticles from "@/components/SimilarArticles";
import { notFound } from "next/navigation";
import CommentsSection from "@/components/CommentsSection";
import Gallery from "@/components/Gallery";
import { labelMap } from "@/utils/labelMap";
import InlineImage from "@/components/InlineImage";
import EmbedContent from "@/components/EmbedContent";

const API_URL = process.env.STRAPI_API_URL;

export default async function ArticlePage({ params }) {
  const res = await fetch(
    `${API_URL}/api/articles?filters[slug][$eq]=${params.slug}&populate=*`,
    { next: { revalidate: 0 } }
  );

  const json = await res.json();
  const rawArticle = json.data?.[0];
  if (!rawArticle) return notFound();

  const data = rawArticle;

  const article = {
    title: data.title || "×›×ª×‘×” ×œ×œ× ×›×•×ª×¨×ª",
    description: data.description || "××™×Ÿ ×ª×™××•×¨ ×–××™×Ÿ",
    image: data.image?.url ? `${API_URL}${data.image.url}` : "/default-image.jpg",
    imageSrc: data.image?.url ? `${API_URL}${data.image.url}` : "/default-image.jpg",
    imageAlt: data.image?.alternativeText || "×ª××•× ×” ×¨××©×™×ª",
    author: data.author || "××¢×¨×›×ª OnMotor",
    date: data.date || "2025-06-22",
    time: data.time || "10:00",
    tags: data.tags || [],
    content: data.content || "",
    tableData: data.tableData || {},
    href: `/articles/${params.slug}`,
    category: data.category || "general",
    subcategory: Array.isArray(data.subcategory)
      ? data.subcategory[0]
      : data.subcategory,
    values: Array.isArray(data.Values)
      ? data.Values
      : data.Values
      ? [data.Values]
      : [],
    headline: data.headline || data.title,
    subdescription: data.subdescription || "",
    slug: params.slug,
    gallery:
      data.gallery?.map((img) => ({
        src: `${API_URL}${img.url}`,
        alt: img.alternativeText || "×ª××•× ×” ××”×’×œ×¨×™×”",
      })) || [],
    font_family: data.font_family || "Heebo, sans-serif",
  };

  // âœ… ×‘× ×™×™×ª ×¤×™×¨×•×¨×™ ×œ×—×
  const breadcrumbs = [{ label: "×“×£ ×”×‘×™×ª", href: "/" }];
  if (article.category) {
    breadcrumbs.push({
      label: labelMap[article.category] || article.category,
      href: `/${article.category}`,
    });
  }
  if (article.subcategory) {
    breadcrumbs.push({
      label: labelMap[article.subcategory] || article.subcategory,
      href: `/${article.category}/${article.subcategory}`,
    });
  }
  if (article.values && article.values.length > 0) {
    const valueKey = article.values[0];
    breadcrumbs.push({
      label: labelMap[valueKey] || valueKey,
      href: `/${article.category}/${article.subcategory}/${valueKey}`,
    });
  }
  breadcrumbs.push({ label: article.title });

  // âœ… ×¤×•× ×§×¦×™×™×ª ×¨×™× ×“×•×¨ ×ª×•××›×ª Rich Text ×•×”×˜××¢×•×ª
  const renderParagraph = (block, i) => {
    // ××—×¨×•×–×ª ×¤×©×•×˜×”
    if (typeof block === "string") {
      const cleanText = block.trim();

      if (cleanText.startsWith("[[img:") && cleanText.endsWith("]]")) {
        const parts = cleanText.slice(6, -2).split("||");
        const [src, alt = "", caption = ""] = parts;
        return (
          <InlineImage
            key={i}
            src={src.trim()}
            alt={alt.trim()}
            caption={caption.trim()}
          />
        );
      }

      const urlMatch = cleanText.match(/https?:\/\/[^\s]+/);
      if (urlMatch) return <EmbedContent key={i} url={urlMatch[0]} />;

      return (
        <p
          key={i}
          className="article-text text-gray-800 text-[18px] leading-relaxed"
          dangerouslySetInnerHTML={{ __html: cleanText }}
        />
      );
    }

    // Rich Text ×‘×œ×•×§ ×©×œ ×¡×˜×¨×¤××™
    if (block.type === "paragraph" && block.children) {
      const html = block.children
        .map((child) => {
          let text = child.text || "";
          if (child.bold) text = `<strong>${text}</strong>`;
          if (child.italic) text = `<em>${text}</em>`;
          if (child.underline) text = `<u>${text}</u>`;
          if (child.type === "link" && child.url) {
            text = `<a href="${child.url}" target="_blank" rel="noopener noreferrer" 
            class="text-blue-600 underline hover:text-blue-800 transition-colors duration-150">
            ${text}</a>`;
          }
          return text;
        })
        .join("");

      // âœ… ×ª×™×§×•×Ÿ ×œ×–×™×”×•×™ ×§×™×©×•×¨×™× ×¢×˜×•×¤×™× ×‘×ª×’×™×•×ª (×›×•×œ×œ reels)
      const cleanHtml = html.replace(/<[^>]+>/g, "").trim(); // ××¡×™×¨ ×ª×’×™×•×ª
      const urlMatch = cleanHtml.match(/https?:\/\/[^\s"']+/);

      if (urlMatch && cleanHtml === urlMatch[0]) {
        return <EmbedContent key={i} url={urlMatch[0]} />;
      }

      return (
        <p
          key={i}
          className="article-text text-gray-800 text-[18px] leading-relaxed"
          dangerouslySetInnerHTML={{ __html: html }}
        />
      );
    }

    // ×›×•×ª×¨×•×ª
    if (block.type === "heading") {
      const level = block.level || 2;
      const Tag = `h${Math.min(level, 3)}`;
      const text = block.children?.map((c) => c.text).join("") || "";
      return (
        <Tag
          key={i}
          className="font-bold text-2xl text-gray-900 mt-4 mb-2"
          dangerouslySetInnerHTML={{ __html: text }}
        />
      );
    }

    return null;
  };

  // âœ… ×‘× ×™×™×ª ×¤×¡×§××•×ª ××ª×•×š content
  let paragraphs = [];
  if (typeof article.content === "string") {
    paragraphs = article.content.split("\n\n");
  } else if (Array.isArray(article.content)) {
    paragraphs = article.content;
  }

  return (
    <PageContainer title={article.title} breadcrumbs={breadcrumbs}>
      <div
        className="mx-auto max-w-[740px] space-y-2 text-right leading-relaxed text-base text-gray-800 px-2"
        style={{ fontFamily: article.font_family }}
      >
        <ArticleHeader
          author={article.author}
          date={article.date}
          time={article.time}
          image={article.image}
          imageSrc={article.imageSrc}
          imageAlt={article.imageAlt}
          title={article.headline}
          subdescription={article.subdescription}
        />

        {article.description && (
          <p className="font-bold text-2xl text-gray-600">{article.description}</p>
        )}

        {/* âœ… ××¦×™×’ ×˜×§×¡×˜×™×, ×ª××•× ×•×ª ×•×”×˜××¢×•×ª */}
        {paragraphs.map(renderParagraph)}

        {article.tableData && <SimpleKeyValueTable data={article.tableData} />}

        <Gallery images={article.gallery} />

        <Tags tags={article.tags} />

        <SimilarArticles
          currentSlug={article.slug}
          category={article.category}
        />

        <CommentsSection articleUrl={`https://onmotor-media.com${article.href}`} />
      </div>
    </PageContainer>
  );
}



// components/EmbedContent.jsx  234
"use client";
import React, { useEffect } from "react";

export default function EmbedContent({ url }) {
  useEffect(() => {
    // Instagram: ×œ×”×¨×™×¥ ×¢×™×‘×•×“ ×©×œ ×”Ö¾embeds ××—×¨×™ ×©×”××œ×× ×˜ × ×›× ×¡ ×œÖ¾DOM
    if (url.includes("instagram.com")) {
      const tryProcess = () => {
        if (window.instgrm && window.instgrm.Embeds) {
          window.instgrm.Embeds.process();
        }
      };
      // ××™×™×“×™×ª + ×¢×•×“ × ×™×¡×™×•×Ÿ ×§×˜×Ÿ ××—×¨×™ ×—×¦×™ ×©× ×™×”
      tryProcess();
      const t = setTimeout(tryProcess, 500);
      return () => clearTimeout(t);
    }
  }, [url]);

  // === EMBED BLOCKS ===

  // YouTube
  if (url.includes("youtube.com") || url.includes("youtu.be")) {
    let videoId = "";
    if (url.includes("shorts/")) {
      videoId = url.split("shorts/")[1]?.split("?")[0];
    } else if (url.includes("watch?v=")) {
      videoId = url.split("v=")[1]?.split("&")[0];
    } else {
      videoId = url.split("/").pop()?.split("?")[0];
    }
    return (
      <div className="my-4 aspect-video">
        <iframe
          src={`https://www.youtube.com/embed/${videoId}`}
          title="YouTube video"
          allowFullScreen
          className="w-full h-full rounded-lg"
        />
      </div>
    );
  }

  // Instagram
  if (url.includes("instagram.com")) {
    return (
      <div className="my-4">
        <blockquote
          className="instagram-media"
          data-instgrm-permalink={url}
          data-instgrm-version="14"
          style={{ maxWidth: "540px", margin: "0 auto" }}
        />
      </div>
    );
  }

  // Facebook
  if (url.includes("facebook.com")) {
    return (
      <div className="my-4">
        <div className="fb-post" data-href={url} data-width="w-full" />
      </div>
    );
  }

  // Twitter/X
  if (url.includes("twitter.com") || url.includes("x.com")) {
    return (
      <div className="my-4">
        <blockquote className="twitter-tweet">
          <a href={url}></a>
        </blockquote>
      </div>
    );
  }

  // TikTok
  if (url.includes("tiktok.com")) {
    const videoId = url.split("/video/")[1]?.split("?")[0];
    return (
      <div className="my-4">
        <blockquote
          className="tiktok-embed"
          cite={url}
          data-video-id={videoId}
          style={{ maxWidth: "605px", minWidth: "325px" }}
        >
          <a href={url}></a>
        </blockquote>
      </div>
    );
  }

  // Default â€“ link
  return (
    <a
      href={url}
      target="_blank"
      rel="noopener noreferrer"
      className="text-blue-600 underline break-words"
    >
      {url}
    </a>
  );
}






///12:08-9/21///
//components\ProductGrid.jsx
'use client';
import Link from 'next/link';

export default function ProductGrid({ products = [], loading=false, onLoadMore, hasMore=false }) {
  return (
    <div dir="rtl" className="space-y-4">
      {loading && <div>×˜×•×¢×Ÿ...</div>}
      <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
        {products.map(p => {
          const img = p.images?.edges?.[0]?.node?.url;
          const price = p.variants?.edges?.[0]?.node?.price;
          return (
            <Link key={p.id} href={`/shop/${p.handle}`} className="border rounded-lg overflow-hidden hover:shadow">
              {img && <img src={img} alt={p.title} className="w-full h-40 object-cover" />}
              <div className="p-3 space-y-1">
                <div className="font-medium">{p.title}</div>
                {price && <div className="text-sm opacity-70">{price.amount} {price.currencyCode}</div>}
              </div>
            </Link>
          );
        })}
      </div>
      {hasMore && (
        <div className="flex justify-center">
          <button onClick={onLoadMore} className="border px-4 py-2 rounded-md">×˜×¢×Ÿ ×¢×•×“</button>
        </div>
      )}
    </div>
  );
}









////9/15/16:27

// /app/shop/page.jsx
"use client";
import { useState, useEffect } from "react";
import ShopSidebar from "@/components/ShopSidebar";
import ProductGrid from "@/components/ProductGrid";
import SkuSearchBar from "@/components/SkuSearchBar";

export default function ShopPage() {
  const [filters, setFilters] = useState({});
  const [products, setProducts] = useState([]);
  const [loading, setLoading] = useState(false);

  // ×—×™×¤×•×© ×œ×¤×™ ××§×´×˜ ×™×©×™×¨
  async function handleSkuSearch(sku) {
    setLoading(true);
    const res = await fetch("/api/shopify/search", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ sku }),
    });
    const data = await res.json();
    setProducts(data);
    setLoading(false);
  }

  // ×—×™×¤×•×© ×œ×¤×™ ×¡×™× ×•×Ÿ Sidebar
  useEffect(() => {
    if (!filters) return;

    async function fetchProducts() {
      setLoading(true);
      const res = await fetch("/api/shopify/search", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(filters),
      });
      const data = await res.json();
      setProducts(data);
      setLoading(false);
    }

    // ×œ×”×¨×™×¥ ×—×™×¤×•×© ×¨×§ ×× × ×‘×—×¨ ××©×”×•
    if (
      filters.vehicleType ||
      filters.vendor ||
      filters.model ||
      filters.year ||
      filters.category
    ) {
      fetchProducts();
    }
  }, [filters]);

  return (
    <div className="flex flex-col md:flex-row gap-6 p-4">
      {/* Sidebar */}
      <div className="md:w-1/4">
        <ShopSidebar onFilterChange={setFilters} />
      </div>

      {/* Main Content */}
      <div className="flex-1">
        {/* ×—×™×¤×•×© ××§×´×˜ */}
        <SkuSearchBar onSearch={handleSkuSearch} />

        {/* Loader */}
        {loading && <p className="text-center">×˜×•×¢×Ÿ ××•×¦×¨×™×...</p>}

        {/* ××•×¦×¨×™× */}
        <ProductGrid products={products} />
      </div>
    </div>
  );
}
//////////

// /app/api/shopify/search/route.js
import { NextResponse } from "next/server";

const SHOPIFY_DOMAIN = process.env.SHOPIFY_STORE_DOMAIN;
const SHOPIFY_API_VERSION = process.env.SHOPIFY_API_VERSION || "2024-07";
const SHOPIFY_TOKEN = process.env.SHOPIFY_STOREFRONT_TOKEN;

export async function POST(req) {
  try {
    const { sku, manufacturer, model, year, category } = await req.json();

    // ×‘× ×™×™×ª query string ×œ×—×™×¤×•×©
    let queryString = "";

    if (sku) {
      queryString = `sku:${sku}`;
    } else {
      if (manufacturer) queryString += ` vendor:${manufacturer}`;
      if (model) queryString += ` product_type:${model}`;
      if (year) queryString += ` tag:year:${year}`;
      if (category) queryString += ` tag:cat:${category}`;
    }

    const query = `
      {
        products(first: 20, query: "${queryString.trim()}") {
          edges {
            node {
              id
              title
              description
              images(first: 1) {
                edges {
                  node { url }
                }
              }
              variants(first: 1) {
                edges {
                  node {
                    sku
                    price { amount currencyCode }
                  }
                }
              }
            }
          }
        }
      }
    `;

    const res = await fetch(
      `https://${SHOPIFY_DOMAIN}/api/${SHOPIFY_API_VERSION}/graphql.json`,
      {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-Shopify-Storefront-Access-Token": SHOPIFY_TOKEN,
        },
        body: JSON.stringify({ query }),
      }
    );

    const data = await res.json();
    return NextResponse.json(
      data.data.products.edges.map((edge) => edge.node)
    );
  } catch (error) {
    console.error("Shopify API error:", error);
    return NextResponse.json({ error: "Failed to fetch products" }, { status: 500 });
  }
}

////

/** @type {import('next').NextConfig} */
const nextConfig = {
  images: {
    remotePatterns: [
      {
        protocol: 'http',
        hostname: 'localhost',
        port: '1337',
        pathname: '/uploads/**',
      },
    ],
  },
};

export default nextConfig;




////9/15/16:27
// components/CommentForm.jsx
'use client';
import React, { useState, useEffect } from 'react';
import { supabase } from '../lib/supabase'; // ×•×“× ×©×”× ×ª×™×‘ × ×›×•×Ÿ ×‘×¤×¨×•×™×§×˜ ×©×œ×š

function generateAvatar(name) {
  return name?.charAt(0).toUpperCase() || '?';
}

function timeAgo(date) {
  const localDate = new Date(new Date(date).getTime() + 3 * 60 * 60 * 1000); // UTC+3
  const seconds = Math.floor((new Date() - localDate) / 1000);
  const intervals = [
    { singular: '×©× ×”', plural: '×©× ×™×', seconds: 31536000 },
    { singular: '×—×•×“×©', plural: '×—×•×“×©×™×', seconds: 2592000 },
    { singular: '×™×•×', plural: '×™××™×', seconds: 86400 },
    { singular: '×©×¢×”', plural: '×©×¢×•×ª', seconds: 3600 },
    { singular: '×“×§×”', plural: '×“×§×•×ª', seconds: 60 },
    { singular: '×©× ×™×™×”', plural: '×©× ×™×•×ª', seconds: 1 }
  ];
  for (const interval of intervals) {
    const count = Math.floor(seconds / interval.seconds);
    if (count > 0) {
      const label = count === 1 ? interval.singular : interval.plural;
      return `×œ×¤× ×™ ${count} ${label}`;
    }
  }
  return '×”×¨×’×¢';
}

export default function CommentForm({ articleId }) {
  const [name, setName] = useState('');
  const [comment, setComment] = useState('');
  const [comments, setComments] = useState([]);
  const [replyTo, setReplyTo] = useState(null);
  const [replyContent, setReplyContent] = useState('');
  const [replyName, setReplyName] = useState('');
  const [sortBy, setSortBy] = useState('new');

  useEffect(() => {
    const fetchComments = async () => {
      const { data, error } = await supabase
        .from('comments')
        .select('*')
        .eq('article_id', articleId)
        .order('date', { ascending: true });
      if (!error) setComments(data);
    };
    if (articleId) fetchComments();
  }, [articleId]);

  const submitComment = async (e) => {
    e.preventDefault();
    if (!name || !comment) return;
    const newComment = {
      article_id: articleId,
      name,
      comment,
      likes: 0,
      parent_id: null,
    };
    const { data, error } = await supabase
      .from('comments')
      .insert([newComment])
      .select();
    if (!error && data?.[0]) {
      setComments(prev => [data[0], ...prev]);
      setName('');
      setComment('');
    }
  };

  const submitReply = async (parentId) => {
    if (!replyContent || !replyName) return;
    const reply = {
      article_id: articleId,
      name: replyName,
      comment: replyContent,
      likes: 0,
      parent_id: parentId,
    };
    const { data, error } = await supabase
      .from('comments')
      .insert([reply])
      .select();
    if (!error && data?.[0]) {
      setComments(prev => [...prev, data[0]]);
      setReplyContent('');
      setReplyName('');
      setReplyTo(null);
    }
  };

  const likeComment = async (id) => {
    const comment = comments.find(c => c.id === id);
    if (!comment) return;
    const { data, error } = await supabase
      .from('comments')
      .update({ likes: comment.likes + 1 })
      .eq('id', id)
      .select();
    if (!error && data?.[0]) {
      setComments(prev => prev.map(c => c.id === id ? data[0] : c));
    }
  };

  const deleteComment = async (id) => {
    const { error } = await supabase.from('comments').delete().eq('id', id);
    if (!error) {
      setComments(prev => prev.filter(c => c.id !== id && c.parent_id !== id));
    }
  };

  const sorted = [...comments].sort((a, b) => {
    if (sortBy === 'likes') return b.likes - a.likes;
    return new Date(b.date) - new Date(a.date);
  });

  const parents = sorted.filter(c => !c.parent_id);
  const childrenMap = sorted.filter(c => c.parent_id).reduce((map, reply) => {
    (map[reply.parent_id] = map[reply.parent_id] || []).push(reply);
    return map;
  }, {});

  return (
    <div className="w-full text-right space-y-4 border-t-2 border-red-600 pt-1">
      <h3 className="text-xl font-semibold text-gray-700 mt-0">×”×©××¨ ×ª×’×•×‘×”</h3>
      <form onSubmit={submitComment} className="space-y-2">
        <div>
          <label className="block text-sm text-gray-600 mb-1">×©×:</label>
          <input
            type="text"
            value={name}
            onChange={e => setName(e.target.value)}
            className="w-1/4 bg-white px-4 py-2 border rounded"
            required
          />
        </div>
        <div>
          <label className="block text-sm text-gray-600 mb-1">×ª×’×•×‘×”:</label>
          <textarea
            value={comment}
            onChange={e => setComment(e.target.value)}
            className="w-1/2 bg-white px-4 py-2 border rounded"
            rows={4}
            required
          />
        </div>
        <button type="submit" className="bg-red-600 text-white px-6 py-2 rounded">
          ×©×œ×— ×ª×’×•×‘×”
        </button>
      </form>

      <div className="text-sm flex gap-4 items-center">
        <span>××™×•×Ÿ:</span>
        <button onClick={() => setSortBy('new')} className={sortBy === 'new' ? 'text-red-600 font-bold' : 'text-gray-600'}>×”×›×™ ×—×“×©×™×</button>
        <button onClick={() => setSortBy('likes')} className={sortBy === 'likes' ? 'text-red-600 font-bold' : 'text-gray-600'}>×”×›×™ ××”×•×‘×™×</button>
        <span className="ml-auto">×¡×”"×› ×ª×’×•×‘×•×ª: {comments.length}</span>
      </div>

      <div className="space-y-6">
        {parents.map((c) => (
          <div key={c.id} className="border rounded bg-white p-4">
            <div className="flex justify-between items-center">
              <div className="flex items-center gap-2">
                <div className="w-8 h-8 rounded-full bg-red-600 text-white flex justify-center items-center font-bold">{generateAvatar(c.name)}</div>
                <div className="text-sm font-semibold text-gray-800">{c.name}</div>
              </div>
              <div className="text-xs text-gray-500">{timeAgo(c.date)}</div>
            </div>
            <p className="mt-2 text-gray-700 text-sm whitespace-pre-line">{c.comment}</p>
            <div className="mt-2 flex gap-4 text-sm text-gray-600">
              <button onClick={() => likeComment(c.id)}>â¤ï¸ {c.likes}</button>
              <button onClick={() => setReplyTo(c.id)}>×”×©×‘</button>
              <button onClick={() => deleteComment(c.id)}>ğŸ—‘ï¸ ××—×§</button>
            </div>

            {replyTo === c.id && (
              <div className="mt-4 bg-gray-50 border p-4 rounded">
                <h4 className="text-sm font-semibold text-gray-700 mb-2">
                  âœï¸ ×›×ª×•×‘ ×ª×’×•×‘×ª ××©× ×” ×œÖ¾{c.name}
                </h4>
                <div className="flex flex-wrap gap-2 items-start">
                  <input
                    type="text"
                    placeholder="×”×©× ×©×œ×š"
                    value={replyName}
                    onChange={(e) => setReplyName(e.target.value)}
                    className="w-1/4 bg-white px-3 py-2 border rounded"
                  />
                  <textarea
                    rows={3}
                    placeholder="×ª×’×•×‘×ª ××©× ×”..."
                    value={replyContent}
                    onChange={(e) => setReplyContent(e.target.value)}
                    className="w-1/2 bg-white px-3 py-2 border rounded"
                  />
                </div>
                <div className="mt-2 flex gap-2">
                  <button
                    onClick={() => submitReply(c.id)}
                    className="bg-red-600 text-white px-4 py-1 rounded hover:bg-red-700 text-sm"
                  >
                    ×©×œ×—
                  </button>
                  <button
                    onClick={() => setReplyTo(null)}
                    className="text-gray-500 hover:text-gray-800 text-sm"
                  >
                    ×‘×™×˜×•×œ
                  </button>
                </div>
              </div>
            )}

            {(childrenMap[c.id] || []).map((r) => (
              <div key={r.id} className="mt-4 pl-4 border-r-2 border-gray-200 space-y-3">
                <div className="bg-gray-50 p-3 rounded border">
                  <div className="flex items-center justify-between">
                    <div className="flex items-center gap-2">
                      <div className="w-7 h-7 rounded-full bg-gray-600 text-white flex justify-center items-center text-sm font-bold">{generateAvatar(r.name)}</div>
                      <div className="text-sm font-semibold text-gray-700">{r.name}</div>
                    </div>
                    <div className="text-xs text-gray-500">{timeAgo(r.date)}</div>
                  </div>
                  <p className="mt-1 text-sm text-gray-700 whitespace-pre-line">{r.comment}</p>
                  <div className="mt-1 flex gap-3 text-xs text-gray-600">
                    <button onClick={() => likeComment(r.id)}>â¤ï¸ {r.likes}</button>
                    <button onClick={() => deleteComment(r.id)}>ğŸ—‘ï¸ ××—×§</button>
                  </div>
                </div>
              </div>
            ))}
          </div>
        ))}
      </div>
    </div>
  );
}

/////////////
C:\Users\yosef\Desktop\onmotor-media - Copy\components\CommentsSection.jsx
'use client';
import React from 'react';
import CommentForm from './CommentForm';
import FacebookComments from './FacebookComments';

// ×›××Ÿ ×× ×—× ×• ×× ×™×—×™× ×©Ö¾articleUrl ××©××© ×›Ö¾slug ×©×œ ×”×›×ª×‘×” ×•××©××© ×’× ×›Ö¾articleId
export default function CommentsSection({ articleUrl }) {
  const articleId = articleUrl; // ××¤×©×¨ ×œ×©× ×•×ª ××ª ×”×©× ×× ×ª×¨×¦×”

  return (
    <div className="flex flex-col lg:flex-row gap-10 mt-12" dir="rtl">
      
      {/* ×¦×“ ×©×××œ: ×ª×’×•×‘×•×ª ×§×™×™××•×ª + ×¤×™×™×¡×‘×•×§ */}      
      <div className="lg:w-1/2 w-full space-y-6">
        <h3 className="text-xl font-bold border-red-600 border-t-2 pb-2">×ª×’×•×‘×•×ª ×”×’×•×œ×©×™×</h3>

        
        {/* ×ª×’×•×‘×•×ª ×¤×™×™×¡×‘×•×§ */}
        <FacebookComments url={articleUrl} />
      </div>

      {/* ×¦×“ ×™××™×Ÿ: ×˜×•×¤×¡ ×”×©××¨×ª ×ª×’×•×‘×” (×›×•×œ×œ articleId) */}
      <div className="lg:w-1/2 w-full">
        <CommentForm articleId={articleId} />
      </div>
    </div>
  );
}



// components/MainGridContentDesktop.jsx
'use client';
import React, { useEffect, useState } from 'react';
import ArticleCard from './ArticleCards/ArticleCard';
import SectionWithHeader from './SectionWithHeader';
import useIsMobile from '@/hooks/useIsMobile';
import SidebarFixed from './SidebarFixed';
import LeftSidebar from './LeftSidebar';

const API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL;

export default function MainGridContent() {
  const isMobile = useIsMobile();
  const [articles, setArticles] = useState([]);
  const [loading, setLoading] = useState(true);
  const [offsetY, setOffsetY] = useState(0);

  useEffect(() => {
    const handleScroll = () => {
      setOffsetY(window.scrollY * 0.3);
    };
    window.addEventListener("scroll", handleScroll);
    return () => window.removeEventListener("scroll", handleScroll);
  }, []);

  useEffect(() => {
    async function fetchArticles() {
      try {
        const res = await fetch(`${API_URL}/api/articles?populate=*`);
        const json = await res.json();

        const mapped = json.data?.map((a) => {
          return {
            id: a.id,
                title: a.title,
                slug: a.slug,
                image: a.image?.url ? `${API_URL}${a.image.url}` : '/default-image.jpg',
                imageAlt: a.imageAlt || '',
                category: a.category || 'general',
                subcategory: Array.isArray(a.subcategory)
                  ? a.subcategory
                  : [a.subcategory ?? 'general'],
                description: a.description,
                headline: a.headline || a.title,
                subdescription: a.subdescription,
                href: `/articles/${a.slug}`,
                tags: a.tags || [],
          };
        }) || [];

        setArticles(mapped);
      } catch (err) {
        console.error("âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×›×ª×‘×•×ª:", err);
      } finally {
        setLoading(false);
      }
    }

    fetchArticles();
  }, []);

  const categories = [...new Set(articles.map(article => article.category))];

  return (
    <div className="w-full flex flex-col xl:flex-row h-auto min-h-screen bg-gray-100">
      {/* ×ª×•×›×Ÿ ×¨××©×™ (×™××™×Ÿ) */}
      <div className="xl:w-1/2 flex-shrink-0 px-0 sm:px-0 py-0 lg:border-l xl:border-red-500">
        <div className="bg-white p-2 rounded-xl shadow space-y-0">
          {categories.map(category => (
            <div key={category}>
              <SectionWithHeader title={category} href={`/${category}`} />
              <div className="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-0">
                {articles
                  .filter(article => article.category === category && article.slug && article.href)
                  .map(article => (
                    <ArticleCard key={article.slug || article.id} article={article} />
                  ))}
              </div>
            </div>
          ))}
        </div>
      </div>

      {/* ×‘×œ×•×§×™× ×¦×“×“×™×™× */}
      {isMobile ? (
        <div className="w-full flex flex-col gap-6 px-0 sm:px-0 py-0">
          <SidebarFixed />
        <div className="w-[300px] h-fit sticky top-0">
          <LeftSidebar />
        </div>

        </div>
      ) : (
        <>
          <div className="xl:w-1/4 flex-shrink-0 px-0 sm:px-0 py-0 border-l border-red-500">
            <SidebarFixed />
          </div>
          <div className="lg:w-1/4 flex-shrink-0 px-0 sm:px-0 py-0 border-red-500">
            <LeftSidebar />
          </div>
        </>
      )}
    </div>
  );
}

////////////////
//components\ArticleCards\ArticleCard.jsx
'use client';
import React, { useState } from 'react';
import Link from 'next/link';
import Image from 'next/image';

export default function ArticleCard({ article }) { // ×”-`article` ×›××Ÿ ×”×•× ×›×‘×¨ ×”××•×‘×™×™×§×˜ ×”×××•×¤×” ×™×©×™×¨×•×ª
  const [isTouched, setIsTouched] = useState(false);

  const handleTouchStart = () => setIsTouched(true);

  const showDescription = isTouched ? true : false;

  // ×”-imageUrl ×›×‘×¨ ×××•×¨ ×œ×”×™×•×ª ××œ× ×•××¢×•×‘×“ ×‘-MainGridContentDesktop
  // ×”-API_URL ×›×‘×¨ ×›×œ×•×œ ×‘-imageUrl
  const imageUrl = article.image; // ×’×™×©×” ×™×©×™×¨×” ×œ-image ×›×™ ×”×•× ×›×‘×¨ URL ××œ×
  const imageAltText = article.imageAlt || article.title || 'Article image'; // ×’×™×©×” ×™×©×™×¨×” ×œ-imageAlt/title

  return (
    <Link
      href={article.href} // ×’×™×©×” ×™×©×™×¨×” ×œ-href
      className="group block relative overflow-hidden rounded-lg shadow-md transition-all duration-300 hover:shadow-xl"
      onTouchStart={handleTouchStart}
    >
      <div className="relative aspect-[1/1] w-full">
        {imageUrl && typeof imageUrl === 'string' && imageUrl !== '/default-image.jpg' ? ( // ×•×“× ×©×™×© URL ×•×–×” ×œ× ×ª××•× ×ª ×‘×¨×™×¨×ª ××—×“×œ ×¨×™×§×”
          <Image
            src={imageUrl}
            alt={imageAltText}
            fill
            className="object-cover w-full h-full group-hover:scale-105 transition-transform duration-300"
          />
        ) : (
          <div className="flex items-center justify-center h-full bg-gray-200 text-gray-500">
            ××™×Ÿ ×ª××•× ×”
          </div>
        )}

        <div
          className={`absolute bottom-0 w-full text-white p-4 transition-all duration-300
          ${showDescription ? 'bg-[#e60000]/150' : 'bg-gradient-to-t from-black/90 via-black/70 to-transparent group-hover:bg-[#e60000]/90'}`}
        >
          <h3 className={`text-lg font-bold transition-all duration-300 ${showDescription ? 'mb-2' : 'group-hover:mb-2'}`}>
            {article.title} {/* ×’×™×©×” ×™×©×™×¨×” ×œ-title */}
          </h3>

          <p className={`text-sm overflow-hidden transition-all duration-300
            ${showDescription ? 'max-h-20 opacity-100' : 'max-h-0 opacity-0 group-hover:max-h-20 group-hover:opacity-100'}`}>
            {article.description} {/* ×’×™×©×” ×™×©×™×¨×” ×œ-description */}
          </p>
        </div>
      </div>
    </Link>
  );
}

///
import MainGridContentMobile from '@/components/MainGridContentMobile';
<div className="xl:hidden">
        <MainGridContentMobile articles={articles} />
      </div>
////
//components\MainGridContentMobile.jsx
'use client';
import React from 'react';

import articles from '@/data/articles';
export default function MainGridContentMobile() {
  const categories = [...new Set(articles.map(article => article.category))];

  return (
    <div className="w-full px-0 md:px-0 overflow-x-hidden" dir="rtl">
      
    </div>
  );
}
///

// components/LeftSidebar.jsx
'use client';
import React, { useState, useEffect } from 'react';
import Image from 'next/image';

const tabs = ['××—×¨×•× ×™×', '×¤×•×¤×•×œ×¨×™', '×ª×’×•×‘×•×ª'];
const API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL;

export default function LeftSidebar() {
  const [activeTab, setActiveTab] = useState('×ª×’×•×‘×•×ª');
  const [articles, setArticles] = useState([]);

  useEffect(() => {
    async function fetchArticles() {
      try {
        const res = await fetch(`${API_URL}/api/articles?populate=*`);
        const json = await res.json();
        const data = json.data || [];

        const mapped = data.map((a) => ({
          id: a.id,
          title: a.title,
          slug: a.slug,
          image: a.image?.data?.attributes?.url || '/default-image.jpg',
          date: a.publishedAt?.split('T')[0] || '',
          category: a.category || '××—×¨×•× ×™×',
        }));

        setArticles(mapped);
      } catch (err) {
        console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ×›×ª×‘×•×ª ××”Ö¾Strapi:', err);
      }
    }

    fetchArticles();
  }, []);

  const filteredArticles = articles.filter((a) => a.category === activeTab);

  return (
    <div className="flex flex-col min-h-0 bg-white rounded-xl shadow-md w-full overflow-hidden text-sm">
      {/* ×˜××‘×™× */}
      <div className="flex border-b text-sm font-semibold" dir="rtl">
        {tabs.map((tab) => (
          <button
            key={tab}
            onClick={() => setActiveTab(tab)}
            className={`w-1/3 text-center py-2 ${
              activeTab === tab
                ? 'text-black border-b-2 border-red-500 bg-white'
                : 'text-gray-500 bg-gray-100'
            }`}
          >
            {tab}
          </button>
        ))}
      </div>

      {/* ×›×ª×‘×•×ª */}
      <div className="p-3 space-y-3 flex-1" dir="rtl">
        <h4 className="font-bold text-base px-1">×ª×’×™×•×ª</h4>
        <div className="space-y-3">
          {filteredArticles.slice(0, 5).map((article) => (
            <a
              key={article.id}
              href={`/articles/${article.slug}`}
              className="flex gap-3 items-start hover:opacity-90"
            >
              <div className="w-20 h-14 relative rounded overflow-hidden flex-shrink-0">
                <Image
                  src={article.image}
                  alt={article.title}
                  layout="fill"
                  objectFit="cover"
                  className="rounded"
                />
              </div>
              <div className="flex flex-col text-right">
                <p className="font-semibold text-sm leading-snug line-clamp-2">
                  {article.title}
                </p>
                <span className="text-xs text-gray-500 mt-1">{article.date}</span>
              </div>
            </a>
          ))}
        </div>
      </div>
    </div>
  );
}
//////////////////

////components\ArticleCards\ArticleCard.jsx
'use client';
import React, { useState } from 'react';
import Link from 'next/link';
import Image from 'next/image';

export default function ArticleCard({ article }) {
  const [isTouched, setIsTouched] = useState(false);

  const handleTouchStart = () => setIsTouched(true);
  // ××•×¤×¦×™×•× ×œ×™: ×›×“×™ ×œ×¡×’×•×¨ ×‘×—×–×¨×” ××—×¨×™ ××’×¢
  // const handleTouchEnd = () => setIsTouched(false);

  const showDescription = isTouched ? true : false;

  return (
    <Link
      href={article.href}
      className="group block relative overflow-hidden rounded-lg shadow-md transition-all duration-300 hover:shadow-xl"
      onTouchStart={handleTouchStart}
    >
      <div className="relative h-64">
        <Image
          src={article.image}
          alt={article.title}
          fill
          className="object-cover w-full h-full group-hover:scale-105 transition-transform duration-300"
        />
        
        {/* ×©×›×‘×ª ×¨×§×¢ ××“×•××” ×‘×©×§×™×¤×•×ª ×”×“×¨×’×ª×™×ª */}
        <div
          className={`absolute bottom-0 w-full text-white p-4 transition-all duration-300
          ${showDescription ? 'bg-[#e60000]/150' : 'bg-gradient-to-t from-black/90 via-black/70 to-transparent group-hover:bg-[#e60000]/90'}`}
        >
          <h3 className={`text-lg font-bold transition-all duration-300 ${showDescription ? 'mb-2' : 'group-hover:mb-2'}`}>
            {article.title}
          </h3>

          <p className={`text-sm overflow-hidden transition-all duration-300 
            ${showDescription ? 'max-h-20 opacity-100' : 'max-h-0 opacity-0 group-hover:max-h-20 group-hover:opacity-100'}`}>
            {article.description}
          </p>
        </div>
      </div>
    </Link>
  );
}

//////////////
// components/MainGridContentDesktop.jsx
'use client';
import React, { useEffect, useState } from 'react';
import ArticleCard from './ArticleCards/ArticleCard';
import SectionWithHeader from './SectionWithHeader';
import useIsMobile from '@/hooks/useIsMobile';
import SidebarFixed from './SidebarFixed';
import LeftSidebar from './LeftSidebar';

const API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL;

export default function MainGridContent() {
  const isMobile = useIsMobile();
  const [articles, setArticles] = useState([]);
  const [loading, setLoading] = useState(true);
  const [offsetY, setOffsetY] = useState(0);

  useEffect(() => {
    const handleScroll = () => {
      setOffsetY(window.scrollY * 0.3);
    };
    window.addEventListener("scroll", handleScroll);
    return () => window.removeEventListener("scroll", handleScroll);
  }, []);

  useEffect(() => {
    async function fetchArticles() {
      try {
        const res = await fetch(`${API_URL}/api/articles?populate=*`);
        const json = await res.json();

        const mapped = json.data?.map((item) => {
          return {
            title: item.title || '×œ×œ× ×›×•×ª×¨×ª',
            slug: item.slug,
            href: `/articles/${item.slug}`,
            image: item.imageSrc
              ? `${API_URL}${item.imageSrc}`
              : '/default-image.jpg',
            category: item.category || 'general',
            subcategory: Array.isArray(item.subcategory)
              ? item.subcategory
              : item.subcategory ? [item.subcategory] : ['×›×œ×œ×™'],
            description: item.description,
            ...item,
          };
        }) || [];

        setArticles(mapped);
      } catch (err) {
        console.error("âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×›×ª×‘×•×ª:", err);
      } finally {
        setLoading(false);
      }
    }

    fetchArticles();
  }, []);

  const categories = [...new Set(articles.map(article => article.category))];

  return (
    <div className="w-full flex flex-col xl:flex-row h-auto min-h-screen bg-gray-100">
      {/* ×ª×•×›×Ÿ ×¨××©×™ (×™××™×Ÿ) */}
      <div className="xl:w-1/2 flex-shrink-0 px-0 sm:px-0 py-0 lg:border-l xl:border-red-500">
        <div className="bg-white p-2 rounded-xl shadow space-y-1">
          {categories.map(category => (
            <div key={category}>
              <SectionWithHeader title={category} href={`/${category}`} />
              <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-1">
                {articles
                  .filter(article => article.category === category && article.slug && article.href)
                  .map(article => (
                    <ArticleCard key={article.slug || article.id} article={article} />
                  ))}
              </div>
            </div>
          ))}
        </div>
      </div>

      {/* ×‘×œ×•×§×™× ×¦×“×“×™×™× */}
      {isMobile ? (
        <div className="w-full flex flex-col gap-6 px-0 sm:px-0 py-0">
          <SidebarFixed />
          <LeftSidebar />
        </div>
      ) : (
        <>
          <div className="xl:w-1/4 flex-shrink-0 px-0 sm:px-0 py-0 border-l border-red-500">
            <SidebarFixed />
          </div>
          <div className="lg:w-1/4 flex-shrink-0 px-0 sm:px-0 py-0 border-red-500">
            <LeftSidebar />
          </div>
        </>
      )}
    </div>
  );
}



///////////////////
///app\articles\[slug]\page.jsx
import articlesData from '@/data/articles';
import PageContainer from "@/components/PageContainer";
import ArticleHeader from "@/components/ArticleHeader";
import SimpleKeyValueTable from "@/components/SimpleKeyValueTable";
import Tags from "@/components/Tags";
import SimilarArticles from "@/components/SimilarArticles";
import { notFound } from "next/navigation";
import CommentsSection from "@/components/CommentsSection";
import InlineImage from "@/components/InlineImage";
import Gallery from "@/components/Gallery";
import categoryLabels from '@/data/categoryLabels'; // âœ… ××™×™×‘××™× ××ª ×”××™×œ×•×Ÿ

export default function ArticlePage({ params }) {
  const rawArticle = articlesData.find((a) => a.slug === params.slug);
  if (!rawArticle) return notFound();

  const defaultArticle = {
    title: "×›×ª×‘×” ×œ×œ× ×›×•×ª×¨×ª",
    description: "××™×Ÿ ×ª×™××•×¨ ×–××™×Ÿ",
    image: "/default-image.jpg",
    imageSrc: "/default-image.jpg",
    imageAlt: "×ª××•× ×” ×›×œ×œ×™×ª",
    author: "××¢×¨×›×ª OnMotor",
    date: "2025-06-22",
    time: "10:00",
    tags: [],
    content: "",
    tableData: {},
    href: "",
    category: "general",
    subcategory: "general",
    headline: "×›×•×ª×¨×ª ×‘×ª×•×š ×”×›×ª×‘×”",
    subdescription: "",
  };

  const article = { ...defaultArticle, ...rawArticle };
  const paragraphs = article.content?.split("\n\n") || [];

  // âœ… ×™×¦×™×¨×ª × ×ª×™×‘ ×“×™× ××™ ×œÖ¾breadcrumbs
  const breadcrumbs = [
    { label: "×“×£ ×”×‘×™×ª", href: "/" },
  ];

  if (article.category) {
    breadcrumbs.push({
      label: categoryLabels[article.category] || article.category,
      href: `/${article.category}`,
    });
  }

  if (article.subcategory) {
    breadcrumbs.push({
      label: categoryLabels[article.subcategory] || article.subcategory,
      href: `/${article.category}/${article.subcategory}`,
    });
  }

  breadcrumbs.push({ label: article.title });

  // âœ… ×¤×¡×§××•×ª (×˜×§×¡×˜ ××• ×ª××•× ×•×ª ××©×•×‘×¦×•×ª)
  const renderParagraph = (text, i) => {
    if (text.startsWith("[[img:") && text.endsWith("]]")) {
      const parts = text.slice(6, -2).split("|");
      const [src, alt = "", caption = ""] = parts;
      return (
        <InlineImage key={i} src={src.trim()} alt={alt.trim()} caption={caption.trim()} />
      );
    }
    return (
      <p key={i} className="text-gray-800 text-2xl leading-relaxed">{text}</p>
    );
  };

  return (
    <PageContainer title={article.title} breadcrumbs={breadcrumbs}>
      <div className="mx-auto max-w-[740px] space-y-6 text-right leading-relaxed text-base text-gray-800">
        <ArticleHeader
          author={article.author}
          date={article.date}
          time={article.time}
          image={article.image}
          imageSrc={article.imageSrc}
          imageAlt={article.imageAlt}
          title={article.headline || article.title}
          subdescription={article.subdescription}
        />

        {article.description && (
          <p className="font-bold text-3xl text-gray-800">{article.description}</p>
        )}

        {paragraphs.map(renderParagraph)}

        {article.tableData && <SimpleKeyValueTable data={article.tableData} />}

        <Gallery galleryPath={article.galleryPath || `/images/articles/${article.slug}/gallery`} />

        <Tags tags={article.tags} />

        <SimilarArticles currentSlug={article.slug} category={article.category} />

        <CommentsSection articleUrl={`https://onmotor-media.com${article.href}`} />
      </div>
    </PageContainer>
  );
}


/////////
// components/AuthBox.jsx
'use client';

import React, { useState, useEffect, useRef } from 'react';
import useIsMobile from '@/hooks/useIsMobile';
import { FaChevronUp } from 'react-icons/fa';
import { loginUser, logoutUser, getCurrentUser } from '@/utils/auth';
import { useRouter } from 'next/navigation';

export default function AuthBox({ mode = 'inline', boxRef }) {
  const isMobile = useIsMobile();
  const router = useRouter();
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [rememberMe, setRememberMe] = useState(false);
  const [loginError, setLoginError] = useState('');
  const [loginSuccess, setLoginSuccess] = useState(false);
  const [isOpen, setIsOpen] = useState(true);
  const [user, setUser] = useState(null);
  const [isLoadingLogin, setIsLoadingLogin] = useState(false);

  const [showReset, setShowReset] = useState(false);
  const [resetEmail, setResetEmail] = useState('');
  const [resetStatus, setResetStatus] = useState('');
  const [isLoadingReset, setIsLoadingReset] = useState(false);

  const [showRegister, setShowRegister] = useState(false);
  const [registerEmail, setRegisterEmail] = useState('');
  const [registerPassword, setRegisterPassword] = useState('');
  const [registerConfirm, setRegisterConfirm] = useState('');
  const [registerStatus, setRegisterStatus] = useState('');
  const [isLoadingRegister, setIsLoadingRegister] = useState(false);

  const [showChangePassword, setShowChangePassword] = useState(false);
  const [currentPassword, setCurrentPassword] = useState('');
  const [newPassword, setNewPassword] = useState('');
  const [changeStatus, setChangeStatus] = useState('');
  const [isLoadingChangePassword, setIsLoadingChangePassword] = useState(false);

  const resetRef = useRef(null);
  const registerRef = useRef(null);
  const changePassRef = useRef(null);

  useEffect(() => {
    (async () => {
      const stored = await getCurrentUser();
      setUser(stored);
    })();
    const lastEmail = localStorage.getItem('lastEmail');
    if (lastEmail) setEmail(lastEmail);
  }, []);

  useEffect(() => {
    if (isMobile && isOpen && boxRef?.current) {
      boxRef.current.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  }, [isOpen, isMobile, boxRef, user]);

  useEffect(() => {
    if (showReset && resetRef.current) {
      resetRef.current.scrollIntoView({ behavior: 'smooth', block: 'end' });
    } else if (showRegister && registerRef.current) {
      registerRef.current.scrollIntoView({ behavior: 'smooth', block: 'end' });
    } else if (showChangePassword && changePassRef.current) {
      changePassRef.current.scrollIntoView({ behavior: 'smooth', block: 'end' });
    }
  }, [showReset, showRegister, showChangePassword]);

  const handleLogin = async () => {
    setIsLoadingLogin(true);
    try {
      const res = await fetch('/api/user/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password }),
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || 'Login failed');

      loginUser(data.user);
      setUser(data.user);
      if (rememberMe) localStorage.setItem('lastEmail', email);
      setLoginSuccess(true);
      setLoginError('');
    } catch (err) {
      setLoginError(err.message);
      setLoginSuccess(false);
    } finally {
      setIsLoadingLogin(false);
    }
  };

  const handleLogout = async () => {
    await logoutUser();
    localStorage.removeItem('lastEmail');
    setUser(null);
    router.refresh();
  };

  const handleDeleteAccount = async () => {
    if (!confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×”×—×©×‘×•×Ÿ?')) return;
    try {
      const res = await fetch('/api/user/delete', { method: 'DELETE' });
      if (!res.ok) throw new Error('Error deleting account');
      await logoutUser();
      setUser(null);
      alert('×”×—×©×‘×•×Ÿ × ××—×§ ×‘×”×¦×œ×—×”');
      router.refresh();
    } catch {
      alert('××™×¨×¢×” ×©×’×™××” ×‘××—×™×§×ª ×”×—×©×‘×•×Ÿ');
    }
  };

  const handleForgotPassword = async () => {
    setIsLoadingReset(true);
    setResetStatus('');
    const res = await fetch('/api/user/forgot-password', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email: resetEmail }),
    });
    setResetStatus(res.ok ? '× ×©×œ×—×” ×¡×™×¡××” ×—×“×©×” ×œ××™××™×™×œ ×©×œ×š' : '××™×¨×¢×” ×©×’×™××”');
    setIsLoadingReset(false);
  };

  const handleRegister = async () => {
    if (registerPassword !== registerConfirm) {
      setRegisterStatus('×”×¡×™×¡×××•×ª ×œ× ×ª×•×××•×ª');
      return;
    }
    setIsLoadingRegister(true);
    const res = await fetch('/api/user/register', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email: registerEmail, password: registerPassword }),
    });
    const data = await res.json();
    setRegisterStatus(res.ok ? '× ×¨×©××ª ×‘×”×¦×œ×—×”!' : data.error || '×©×’×™××” ×‘×”×¨×©××”');
    setIsLoadingRegister(false);
  };

  const handleChangePassword = async () => {
    setIsLoadingChangePassword(true);
    const res = await fetch('/api/user/change-password', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ currentPassword, newPassword }),
    });
    setChangeStatus(res.ok ? '×”×¡×™×¡××” ×¢×•×“×›× ×” ×‘×”×¦×œ×—×”' : '×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”×¡×™×¡××”');
    setIsLoadingChangePassword(false);
  };

  return (
    <div dir="rtl" className="text-center" ref={boxRef}>
      {isMobile && mode === 'side' && (
        <button
          onClick={() => setIsOpen(false)}
          className="text-sm bg-white text-black px-2 py-2 rounded shadow hover:bg-gray-200 transition"
        >
          ×¡×’×•×¨ <FaChevronUp className="inline" />
        </button>
      )}

      <div className="transition-all duration-500 ease-in-out overflow-hidden mt-2 max-w-md px-0 bg-white text-black border border-gray-300 rounded p-1 text-sm shadow-md">
        <h3 className="font-semibold text-black mb-6">
          {user ? '× ×™×”×•×œ ×—×©×‘×•×Ÿ' : '×”×ª×—×‘×¨×•×ª'}
        </h3>

        {user ? (
          <>
            <p className="mb-4">×©×œ×•×, {user.email}</p>
            <div className="flex flex-col gap-2 mb-4 items-center">
              <button
                onClick={handleLogout}
                className="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"
              >
                ×”×ª× ×ª×§
              </button>
              <button
                onClick={handleDeleteAccount}
                className="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700"
              >
                ××—×™×§×ª ×—×©×‘×•×Ÿ
              </button>
            </div>
            <div className="text-xs text-center space-x-2 flex justify-center">
              <button
                onClick={() => {
                  setShowChangePassword(true);
                  setShowReset(false);
                  setShowRegister(false);
                }}
                className="text-blue-600 underline"
              >
                ×©× ×” ×¡×™×¡××
              </button>
              <span>|</span>
              <button
                onClick={() => {
                  setShowReset(true);
                  setShowChangePassword(false);
                  setShowRegister(false);
                }}
                className="text-blue-600 underline"
              >
                ×©×›×—×ª×™ ×¡×™×¡××
              </button>
            </div>
          </>
        ) : (
          <>
            <input
              type="email"
              placeholder="××™××™×™×œ"
              value={email}
              onChange={e => setEmail(e.target.value)}
              className="w-[90%] px-2 py-1 mb-2 border border-gray-300 rounded text-right text-sm"
            />
            <input
              type="password"
              placeholder="×¡×™×¡××"
              value={password}
              onChange={e => setPassword(e.target.value)}
              className="w-[90%] px-2 py-1 mb-2 border border-gray-300 rounded text-right text-sm"
            />
            <div className="flex items-center justify-start mb-2">
              <input
                type="checkbox"
                id="rememberMe"
                checked={rememberMe}
                onChange={e => setRememberMe(e.target.checked)}
                className="ml-2"
              />
              <label htmlFor="rememberMe" className="text-sm text-black">×”×©××¨ ××—×•×‘×¨</label>
            </div>
            <button
              onClick={handleLogin}
              className="bg-[#e60000] text-white px-3 py-1 rounded hover:bg-red-700 text-sm w-full flex items-center justify-center"
            >
              {isLoadingLogin
                ? <span className="loader mr-2 w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></span>
                : '×”×ª×—×‘×¨'}
            </button>
            {loginError && <p className="text-red-600 mt-1 text-xs">{loginError}</p>}
            {loginSuccess && <p className="text-green-600 mt-1 text-xs">×”×ª×—×‘×¨×ª ×‘×”×¦×œ×—×”!</p>}

            <div className="mt-3 text-xs text-center space-x-1 flex flex-wrap justify-center">
              <button
                onClick={() => { setShowRegister(true); setShowReset(false); setShowChangePassword(false); }}
                className="text-blue-600 underline"
              >×¦×•×¨ ×—×©×‘×•×Ÿ</button>
              <span>|</span>
              <button
                onClick={() => { setShowReset(true); setShowRegister(false); setShowChangePassword(false); }}
                className="text-blue-600 underline"
              >×©×›×—×ª×™ ×¡×™×¡××”</button>
              <span>|</span>
              <button
                onClick={() => { setShowChangePassword(true); setShowReset(false); setShowRegister(false); }}
                className="text-blue-600 underline"
              >×©× ×” ×¡×™×¡××”</button>
            </div>
          </>
        )}

        


        {showReset && (
          <div ref={resetRef} className="mt-4 bg-gray-100 p-3 rounded text-right text-sm relative">
            <button onClick={() => setShowReset(false)} className="absolute top-2 left-2 text-gray-500 hover:text-black">âœ–</button>
            <h4 className="font-semibold mb-2 pr-6">×©×›×—×ª×™ ×¡×™×¡××”</h4>
            <input
              type="email"
              placeholder="××™××™×™×œ ×œ××™×¤×•×¡"
              value={resetEmail}
              onChange={e => setResetEmail(e.target.value)}
              className="w-full px-2 py-1 mb-2 border border-gray-300 rounded"
            />
            <button onClick={handleForgotPassword} className="bg-blue-600 text-white px-3 py-1 rounded text-sm">
              {isLoadingReset ? '×©×•×œ×—...' : '×©×œ×— ×¡×™×¡××” ×—×“×©×”'}
            </button>
            {resetStatus && <p className="text-green-600 mt-2 text-xs">{resetStatus}</p>}
          </div>
        )}

        {showRegister && (
          <div ref={registerRef} className="mt-4 bg-gray-100 p-3 rounded text-right text-sm relative">
            <button onClick={() => setShowRegister(false)} className="absolute top-2 left-2 text-gray-500 hover:text-black">âœ–</button>
            <h4 className="font-semibold mb-2 pr-6">×¦×•×¨ ×—×©×‘×•×Ÿ</h4>
            <input
              type="email"
              placeholder="××™××™×™×œ"
              value={registerEmail}
              onChange={e => setRegisterEmail(e.target.value)}
              className="w-full px-2 py-1 mb-2 border border-gray-300 rounded"
            />
            <input
              type="password"
              placeholder="×¡×™×¡××”"
              value={registerPassword}
              onChange={e => setRegisterPassword(e.target.value)}
              className="w-full px-2 py-1 mb-2 border border-gray-300 rounded"
            />
            <input
              type="password"
              placeholder="××™××•×ª ×¡×™×¡××”"
              value={registerConfirm}
              onChange={e => setRegisterConfirm(e.target.value)}
              className="w-full px-2 py-1 mb-2 border border-gray-300 rounded"
            />
            <button onClick={handleRegister} className="bg-green-600 text-white px-3 py-1 rounded text-sm">
              {isLoadingRegister ? '× ×¨×©×...' : '×”×¨×©××”'}
            </button>
            {registerStatus && <p className="text-green-600 mt-2 text-xs">{registerStatus}</p>}
          </div>
        )}

        {showChangePassword && (
          <div ref={changePassRef} className="mt-4 bg-gray-100 p-3 rounded text-right text-sm relative">
            <button onClick={() => setShowChangePassword(false)} className="absolute top-2 left-2 text-gray-500 hover:text-black">âœ–</button>
            <h4 className="font-semibold mb-2 pr-6">×©× ×” ×¡×™×¡××”</h4>
            <input
              type="password"
              placeholder="×¡×™×¡××” × ×•×›×—×™×ª"
              value={currentPassword}
              onChange={e => setCurrentPassword(e.target.value)}
              className="w-full px-2 py-1 mb-2 border border-gray-300 rounded"
            />
            <input
              type="password"
              placeholder="×¡×™×¡××” ×—×“×©×”"
              value={newPassword}
              onChange={e => setNewPassword(e.target.value)}
              className="w-full px-2 py-1 mb-2 border border-gray-300 rounded"
            />
            <button onClick={handleChangePassword} className="bg-yellow-600 text-white px-3 py-1 rounded text-sm">
              {isLoadingChangePassword ? '××¢×“×›×Ÿ...' : '×¢×“×›×Ÿ ×¡×™×¡××”'}
            </button>
            {changeStatus && <p className="text-green-600 mt-2 text-xs">{changeStatus}</p>}
          </div>
        )}
      </div>
    </div>
  );
}


// C:\Users\yosef\onmotor-media - Copy\components\AuthBox.jsx
'use client';

import React, { useState, useEffect, useRef } from 'react';
import useIsMobile from '@/hooks/useIsMobile';
import { FaChevronUp } from 'react-icons/fa';
import { loginUser, logoutUser, getCurrentUser } from '@/utils/auth';
import { useRouter } from 'next/navigation';

export default function AuthBox({ mode = 'inline', boxRef }) {
  const isMobile = useIsMobile();
  
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [rememberMe, setRememberMe] = useState(false);
  const [loginError, setLoginError] = useState('');
  const [loginSuccess, setLoginSuccess] = useState(false);
  const [isOpen, setIsOpen] = useState(true);
  const [user, setUser] = useState(null);
  const [isLoadingLogin, setIsLoadingLogin] = useState(false);

  const [showReset, setShowReset] = useState(false);
  const [resetEmail, setResetEmail] = useState('');
  const [resetStatus, setResetStatus] = useState('');
  const [isLoadingReset, setIsLoadingReset] = useState(false);

  const [showRegister, setShowRegister] = useState(false);
  const [registerEmail, setRegisterEmail] = useState('');
  const [registerPassword, setRegisterPassword] = useState('');
  const [registerConfirm, setRegisterConfirm] = useState('');
  const [registerStatus, setRegisterStatus] = useState('');
  const [isLoadingRegister, setIsLoadingRegister] = useState(false);

  const [showChangePassword, setShowChangePassword] = useState(false);
  const [currentPassword, setCurrentPassword] = useState('');
  const [newPassword, setNewPassword] = useState('');
  const [changeStatus, setChangeStatus] = useState('');
  const [isLoadingChangePassword, setIsLoadingChangePassword] = useState(false);

  const resetRef = useRef(null);
  const registerRef = useRef(null);
  const changePassRef = useRef(null);

  useEffect(() => {
    const stored = getCurrentUser();
    setUser(stored);
    const lastEmail = localStorage.getItem('lastEmail');
    if (lastEmail) setEmail(lastEmail);
  }, []);

  useEffect(() => {
    if (isMobile && isOpen && boxRef?.current) {
      boxRef.current.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  }, [isOpen, isMobile, boxRef, user]);

  useEffect(() => {
    if (showReset && resetRef.current) {
      resetRef.current.scrollIntoView({ behavior: 'smooth', block: 'end' });
    } else if (showRegister && registerRef.current) {
      registerRef.current.scrollIntoView({ behavior: 'smooth', block: 'end' });
    } else if (showChangePassword && changePassRef.current) {
      changePassRef.current.scrollIntoView({ behavior: 'smooth', block: 'end' });
    }
  }, [showReset, showRegister, showChangePassword]);

  const handleLogin = async () => {
    setIsLoadingLogin(true);
    try {
      const res = await fetch('/api/user/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password }),
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || 'Login failed');

      loginUser(data.user);
      setUser(data.user);
      if (rememberMe) localStorage.setItem('lastEmail', email);
      setLoginSuccess(true);
      setLoginError('');
    } catch (err) {
      setLoginError(err.message);
      setLoginSuccess(false);
    } finally {
      setIsLoadingLogin(false);
    }
  };

  const handleLogout = () => {
    logoutUser();
    localStorage.removeItem('lastEmail');
    setUser(null);
  };

  const handleDeleteAccount = async () => {
    if (!confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×”×—×©×‘×•×Ÿ?')) return;
    try {
      const res = await fetch('/api/user/delete', { method: 'DELETE' });
      if (!res.ok) throw new Error('Error deleting account');
      logoutUser();
      setUser(null);
      alert('×”×—×©×‘×•×Ÿ × ××—×§ ×‘×”×¦×œ×—×”');
    } catch {
      alert('××™×¨×¢×” ×©×’×™××” ×‘××—×™×§×ª ×”×—×©×‘×•×Ÿ');
    }
  };

  const handleForgotPassword = async () => {
    setIsLoadingReset(true);
    setResetStatus('');
    const res = await fetch('/api/user/forgot-password', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email: resetEmail }),
    });
    setResetStatus(res.ok ? '× ×©×œ×—×” ×¡×™×¡××” ×—×“×©×” ×œ××™××™×™×œ ×©×œ×š' : '××™×¨×¢×” ×©×’×™××”');
    setIsLoadingReset(false);
  };

  const handleRegister = async () => {
    if (registerPassword !== registerConfirm) {
      setRegisterStatus('×”×¡×™×¡×××•×ª ×œ× ×ª×•×××•×ª');
      return;
    }
    setIsLoadingRegister(true);
    const res = await fetch('/api/user/register', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email: registerEmail, password: registerPassword }),
    });
    const data = await res.json();
    setRegisterStatus(res.ok ? '× ×¨×©××ª ×‘×”×¦×œ×—×”!' : data.error || '×©×’×™××” ×‘×”×¨×©××”');
    setIsLoadingRegister(false);
  };

  const handleChangePassword = async () => {
    setIsLoadingChangePassword(true);
    const res = await fetch('/api/user/change-password', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ currentPassword, newPassword }),
    });
    setChangeStatus(res.ok ? '×”×¡×™×¡××” ×¢×•×“×›× ×” ×‘×”×¦×œ×—×”' : '×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”×¡×™×¡××”');
    setIsLoadingChangePassword(false);
  };

  return (
    <div dir="rtl" className="text-center" ref={boxRef}>
      {isMobile && mode === 'side' && (
        <button
          onClick={() => setIsOpen(false)}
          className="text-sm bg-white text-black px-2 py-2 rounded shadow hover:bg-gray-200 transition"
        >
          ×¡×’×•×¨ <FaChevronUp className="inline" />
        </button>
      )}

      <div className="transition-all duration-500 ease-in-out overflow-hidden mt-2 max-w-md px-0 bg-white text-black border border-gray-300 rounded p-1 text-sm shadow-md">
        <h3 className="font-semibold text-black mb-6">
          {user ? '× ×™×”×•×œ ×—×©×‘×•×Ÿ' : '×”×ª×—×‘×¨×•×ª'}
        </h3>

        {user ? (
          <>
            <p className="mb-4">×©×œ×•×, {user.email}</p>
            <div className="flex flex-col gap-2 mb-4 items-center">
              <button
                onClick={handleLogout}
                className="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"
              >
                ×”×ª× ×ª×§
              </button>
              <button
                onClick={handleDeleteAccount}
                className="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700"
              >
                ××—×™×§×ª ×—×©×‘×•×Ÿ
              </button>
            </div>
            <div className="text-xs text-center space-x-2 flex justify-center">
              <button
                onClick={() => {
                  setShowChangePassword(true);
                  setShowReset(false);
                  setShowRegister(false);
                }}
                className="text-blue-600 underline"
              >
                ×©× ×” ×¡×™×¡××
              </button>
              <span>|</span>
              <button
                onClick={() => {
                  setShowReset(true);
                  setShowChangePassword(false);
                  setShowRegister(false);
                }}
                className="text-blue-600 underline"
              >
                ×©×›×—×ª×™ ×¡×™×¡××
              </button>
            </div>
          </>
        ) : (
          <>
            <input
              type="email"
              placeholder="××™××™×™×œ"
              value={email}
              onChange={e => setEmail(e.target.value)}
              className="w-[90%] px-2 py-1 mb-2 border border-gray-300 rounded text-right text-sm"
            />
            <input
              type="password"
              placeholder="×¡×™×¡××"
              value={password}
              onChange={e => setPassword(e.target.value)}
              className="w-[90%] px-2 py-1 mb-2 border border-gray-300 rounded text-right text-sm"
            />
            <div className="flex items-center justify-start mb-2">
              <input
                type="checkbox"
                id="rememberMe"
                checked={rememberMe}
                onChange={e => setRememberMe(e.target.checked)}
                className="ml-2"
              />
              <label htmlFor="rememberMe" className="text-sm text-black">×”×©××¨ ××—×•×‘×¨</label>
            </div>
            <button
              onClick={handleLogin}
              className="bg-[#e60000] text-white px-3 py-1 rounded hover:bg-red-700 text-sm w-full flex items-center justify-center"
            >
              {isLoadingLogin
                ? <span className="loader mr-2 w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></span>
                : '×”×ª×—×‘×¨'}
            </button>
            {loginError && <p className="text-red-600 mt-1 text-xs">{loginError}</p>}
            {loginSuccess && <p className="text-green-600 mt-1 text-xs">×”×ª×—×‘×¨×ª ×‘×”×¦×œ×—×”!</p>}

            <div className="mt-3 text-xs text-center space-x-1 flex flex-wrap justify-center">
              <button
                onClick={() => { setShowRegister(true); setShowReset(false); setShowChangePassword(false); }}
                className="text-blue-600 underline"
              >×¦×•×¨ ×—×©×‘×•×Ÿ</button>
              <span>|</span>
              <button
                onClick={() => { setShowReset(true); setShowRegister(false); setShowChangePassword(false); }}
                className="text-blue-600 underline"
              >×©×›×—×ª×™ ×¡×™×¡××”</button>
              <span>|</span>
              <button
                onClick={() => { setShowChangePassword(true); setShowReset(false); setShowRegister(false); }}
                className="text-blue-600 underline"
              >×©× ×” ×¡×™×¡××”</button>
            </div>
          </>
        )}

        {showReset && (
          <div ref={resetRef} className="mt-4 bg-gray-100 p-3 rounded text-right text-sm relative">
            <button onClick={() => setShowReset(false)} className="absolute top-2 left-2 text-gray-500 hover:text-black">âœ–</button>
            <h4 className="font-semibold mb-2 pr-6">×©×›×—×ª×™ ×¡×™×¡××”</h4>
            <input
              type="email"
              placeholder="××™××™×™×œ ×œ××™×¤×•×¡"
              value={resetEmail}
              onChange={e => setResetEmail(e.target.value)}
              className="w-full px-2 py-1 mb-2 border border-gray-300 rounded"
            />
            <button onClick={handleForgotPassword} className="bg-blue-600 text-white px-3 py-1 rounded text-sm">
              {isLoadingReset ? '×©×•×œ×—...' : '×©×œ×— ×¡×™×¡××” ×—×“×©×”'}
            </button>
            {resetStatus && <p className="text-green-600 mt-2 text-xs">{resetStatus}</p>}
          </div>
        )}

        {showRegister && (
          <div ref={registerRef} className="mt-4 bg-gray-100 p-3 rounded text-right text-sm relative">
            <button onClick={() => setShowRegister(false)} className="absolute top-2 left-2 text-gray-500 hover:text-black">âœ–</button>
            <h4 className="font-semibold mb-2 pr-6">×¦×•×¨ ×—×©×‘×•×Ÿ</h4>
            <input
              type="email"
              placeholder="××™××™×™×œ"
              value={registerEmail}
              onChange={e => setRegisterEmail(e.target.value)}
              className="w-full px-2 py-1 mb-2 border border-gray-300 rounded"
            />
            <input
              type="password"
              placeholder="×¡×™×¡××”"
              value={registerPassword}
              onChange={e => setRegisterPassword(e.target.value)}
              className="w-full px-2 py-1 mb-2 border border-gray-300 rounded"
            />
            <input
              type="password"
              placeholder="××™××•×ª ×¡×™×¡××”"
              value={registerConfirm}
              onChange={e => setRegisterConfirm(e.target.value)}
              className="w-full px-2 py-1 mb-2 border border-gray-300 rounded"
            />
            <button onClick={handleRegister} className="bg-green-600 text-white px-3 py-1 rounded text-sm">
              {isLoadingRegister ? '× ×¨×©×...' : '×”×¨×©××”'}
            </button>
            {registerStatus && <p className="text-green-600 mt-2 text-xs">{registerStatus}</p>}
          </div>
        )}

        {showChangePassword && (
          <div ref={changePassRef} className="mt-4 bg-gray-100 p-3 rounded text-right text-sm relative">
            <button onClick={() => setShowChangePassword(false)} className="absolute top-2 left-2 text-gray-500 hover:text-black">âœ–</button>
            <h4 className="font-semibold mb-2 pr-6">×©× ×” ×¡×™×¡××”</h4>
            <input
              type="password"
              placeholder="×¡×™×¡××” × ×•×›×—×™×ª"
              value={currentPassword}
              onChange={e => setCurrentPassword(e.target.value)}
              className="w-full px-2 py-1 mb-2 border border-gray-300 rounded"
            />
            <input
              type="password"
              placeholder="×¡×™×¡××” ×—×“×©×”"
              value={newPassword}
              onChange={e => setNewPassword(e.target.value)}
              className="w-full px-2 py-1 mb-2 border border-gray-300 rounded"
            />
            <button onClick={handleChangePassword} className="bg-yellow-600 text-white px-3 py-1 rounded text-sm">
              {isLoadingChangePassword ? '××¢×“×›×Ÿ...' : '×¢×“×›×Ÿ ×¡×™×¡××”'}
            </button>
            {changeStatus && <p className="text-green-600 mt-2 text-xs">{changeStatus}</p>}
          </div>
        )}
      </div>
    </div>
  );
}



// File: strapi/config/database.js
module.exports = ({ env }) => ({
  connection: {
    client: 'sqlite',
    connection: {
      filename: env('DATABASE_FILENAME', '.tmp/data.db'),
    },
    useNullAsDefault: true,
  },
});


//data\articles\newsMotorcycle.js
const newsMotorcycle = [
{
  id: 101,
  slug: "ktm-990-duke-2024",
  title: "ktm-990-duke-2024 ",
  headline: "×”××”×¤×›×” ×‘×“×¨×š: ×”×›×™×¨×• ××ª ×”Ö¾KTM 990 DUKE ×”×—×“×© â€“ ×”×“×•×›×¡ ×—×–×¨ ×œ×›×‘×™×© ×—× ××ª××™×“",
  description: "×× ×—×©×‘×ª× ×©×›×‘×¨ ×¨××™×ª× ×”×›×•×œ ×‘×–×™×¨×ª ×”× ×™×™×§×“ ×”×‘×™× ×•× ×™×™×...",
  subdescription: "×‘-×§×˜× ×œ× ××—×›×™× ×œ××ª×—×¨×™× ×•×™×¦××• ×¢× ××›×•× ×” ×©××¢×œ×” ×¢×¨×’×•× ×•×ª",
  href: "/articles/ktm-990-duke-2024",
  image: "/images/articles/ktm-990-duke-2024/ktm990.jpg",
  imageSrc: "/images/articles/ktm-990-duke-2024/ktm990-main.jpg",
  galleryPath: "/images/articles/ktm-990-duke-2024/gallery",
  imageAlt: "×”Ö¾KTM 990 Duke ×”×—×“×© ×‘×¤×¢×•×œ×”",

  category: "news",
  subcategory: ["global",],

  display: {
    homepage: true,
    sidebar: false,
    mainSlider: true,
    newsletter: false
  },

  priority: 1,

  author: "×™×•×¡×£ ×¡×‘×’",
  date: "22.06.2025",
  time: "14:50",
  tags: ["KTM", "DUKE", "××•×¤× ×•×¢×™×"],
  content: "   ",

 tableData: {
      "× ×¤×— ×× ×•×¢": "947 ×¡×\"×§",
      "×ª×¦×•×¨×ª ×× ×•×¢": "×˜×•×•×™×Ÿ ××§×‘×™×œ×™, 4 ×¤×¢×™××•×ª, 8 ×©×¡×ª×•××™×",
      "×”×¡×¤×§ ××¨×‘×™": "123 ×›\"×¡ @ 9,500 ×¡×œ\"×“",
      "××•×× ×˜ ××¨×‘×™": "10.3 ×§×’\"× @ 6,750 ×¡×œ\"×“",
      "×”×™×œ×•×›×™×": "6 ×”×™×œ×•×›×™× ×¢× quickshifter ×“×•-×›×™×•×•× ×™",
      "××¢×¨×›×ª ×§×™×¨×•×¨": "×§×™×¨×•×¨ ××™×",
      "×©×œ×“×”": "××¡×‘×š ×›×¨×•××•×œ (Chromoly Trellis Frame)",
      "××©×§×œ ×™×‘×©": "179 ×§\"×’",
      "××©×§×œ ×¨×˜×•×‘": "×›Ö¾199 ×§\"×’",
      "××™×›×œ ×“×œ×§": "14 ×œ×™×˜×¨",
      "×¦×¨×™×›×ª ×“×œ×§ ×××•×¦×¢×ª": "×›Ö¾4.5 ×œ'/100 ×§\"×",
      "×§×•×˜×¨ ×’×œ×’×œ ×§×“××™": "17 ××™× ×¥'",
      "×§×•×˜×¨ ×’×œ×’×œ ××—×•×¨×™": "17 ××™× ×¥'",
      "×¦××™×’ ×§×“××™": "120/70-ZR17",
      "×¦××™×’ ××—×•×¨×™": "180/55-ZR17",
      "×‘×•×œ× ×§×“××™": "WP APEX 43 ×\"×, ×”×¤×™×š, ×›×•×•× ×•×Ÿ ××œ×",
      "×‘×•×œ× ××—×•×¨×™": "WP APEX, ×–×¨×•×¢ ××—×ª, ×›×•×•× ×•×Ÿ ××œ×",
      "×‘×œ××™× ×§×“××™×™×": "Brembo, ×“×™×¡×§ ×›×¤×•×œ 300 ×\"×",
      "×‘×œ× ××—×•×¨×™": "×“×™×¡×§ ×‘×•×“×“ 240 ×\"×",
      "××¢×¨×›×•×ª ×¢×–×¨": "ABS ×‘×¤× ×™×™×”, ×‘×§×¨×ª ××—×™×–×”, ×•×•×™×œ×™, ×–×™× ×•×§, ×¨×›×™×‘×”, ×©×™×•×˜, ××¡×š TFT",
      "×’×•×‘×” ××•×©×‘": "825 ×\"×",
      "×‘×¡×™×¡ ×’×œ×’×œ×™×": "1,482 ×\"×",
      "××¨×•×•×— ×’×—×•×Ÿ": "186 ×\"×",
      "××¢×¨×›×ª ×ª××•×¨×”": "LED ××œ××” ×›×•×œ×œ DRL",
      "××—×™×¨ ×‘×™×©×¨××œ (×”×¢×¨×›×”)": "×›Ö¾89,000 ×©\"×—"
    }
  },
  {
  id: 102,
  slug: "new-moto-parking-tlv",
  title: "×—× ×™×•×Ÿ ×—×“×© ×œ××•×¤× ×•×¢×™× ×‘×ª×œ ××‘×™×‘",
  headline: "×¤×ª×¨×•×Ÿ ×—×“×© ×œ×¨×•×›×‘×™×: ×—× ×™×•×Ÿ ×™×™×¢×•×“×™ ×œ××•×¤× ×•×¢×™× × ×¤×ª×— ×‘×“×¨×•× ×ª×œ ××‘×™×‘",
  description: "××—×¨×™ ×©× ×™× ×©×œ ×ª×œ×•× ×•×ª ××¦×“ ×¨×•×›×‘×™ ×“×•Ö¾×’×œ×’×œ×™, ×”×¢×™×¨ ×ª×œ ××‘×™×‘ ×—×•× ×›×ª ×—× ×™×•×Ÿ ×—×“×© ×•×™×™×¢×•×“×™ ×œ××•×¤× ×•×¢×™× ×‘×©×›×•× ×ª ×¤×œ×•×¨× ×˜×™×Ÿ.",
  subdescription: "×”×—× ×™×•×Ÿ ××¦×™×¢ ×¢×©×¨×•×ª ××§×•××•×ª ×—× ×™×™×”, ××¦×œ××•×ª ××‘×˜×—×” ×•×¢××“×•×ª ×˜×¢×™× ×” ×œ×›×œ×™× ×—×©××œ×™×™×.",
  href: "/articles/new-moto-parking-tlv",
  image: "/images/articles/new-moto-parking-tlv/parking.jpg",
  imageSrc: "/images/articles/new-moto-parking-tlv/parking-main.jpg",
  galleryPath: "/images/articles/new-moto-parking-tlv/gallery",
  imageAlt: "×—× ×™×•×Ÿ ××•×¤× ×•×¢×™× ×™×™×¢×•×“×™ ×—×“×© ×‘×“×¨×•× ×ª×œ ××‘×™×‘",

  category: "news",
  subcategory: ["local"],

  display: {
    homepage: true,
    sidebar: true,
    mainSlider: false,
    newsletter: false
  },

  priority: 2,

  author: "×™×•×¡×£ ×¡×‘×’",
  date: "29.06.2025",
  time: "14:30",
  tags: ["", " ", ""],
  content:"    " ,
ğŸ“ 

  tableData: {
    " " : " ",
    " ": " "}
}
];

export default newsMotorcycle;



// app/api/register/route.js
import fs from 'fs';
import path from 'path';
import bcrypt from 'bcryptjs';
import { sendEmail } from '@/utils/mailer';
import { buildEmailTemplate } from '@/utils/emailTemplate';


const usersPath = path.join(process.cwd(), 'data', 'users.json');

function readUsers() {
  if (!fs.existsSync(usersPath)) return [];
  return JSON.parse(fs.readFileSync(usersPath, 'utf-8'));
}

function writeUsers(users) {
  fs.writeFileSync(usersPath, JSON.stringify(users, null, 2), 'utf-8');
}

export async function POST(request) {
  const { email, password } = await request.json();

  if (!email || !password) {
    return new Response(JSON.stringify({ error: '×—×¡×¨ ××™××™×™×œ ××• ×¡×™×¡××”' }), { status: 400 });
  }

  const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{6,}$/;
  if (!passwordRegex.test(password)) {
    return new Response(JSON.stringify({
      error: '×”×¡×™×¡××” ×—×™×™×‘×ª ×œ×”×›×™×œ ×œ×¤×—×•×ª 6 ×ª×•×•×™×, ×›×•×œ×œ ××•×ª ×’×“×•×œ×”, ××•×ª ×§×˜× ×” ×•××¡×¤×¨'
    }), { status: 400 });
  }

  const users = readUsers();
  const emailExists = users.find(u => u.email === email);

  if (emailExists) {
    return new Response(JSON.stringify({ error: '××™××™×™×œ ×›×‘×¨ ×¨×©×•×' }), { status: 409 });
  }

  const hashedPassword = await bcrypt.hash(password, 10);
  const newUser = {
    id: Date.now(),
    email,
    password: hashedPassword
  };

  users.push(newUser);
  writeUsers(users);

  try {
    await sendEmail({
  to: email,
  subject: '×‘×¨×•×š ×”×‘× ×œ-OnMotor Media',
  html: buildEmailTemplate(email, '×‘×¨×•×š ×”×‘× ×œÖ¾OnMotor Media', `
    <p>×ª×•×“×” ×©× ×¨×©××ª ×œ××ª×¨ <strong>OnMotor Media</strong>!</p>
    <p>×©××—×™× ×©×”×¦×˜×¨×¤×ª ×œ××©×¤×—×ª ×”×¨×•×›×‘×™× ×©×œ× ×• ğŸï¸</p>
    <a href="https://onmotormedia.com" style="
      display:inline-block;
      margin-top:20px;
      background:#d32f2f;
      color:white;
      padding:10px 20px;
      text-decoration:none;
      border-radius:5px;
      font-weight:bold;">×›× ×™×¡×” ×œ××ª×¨</a>
  `)
});

  } catch (err) {
    console.error('Failed to send welcome email:', err);
  }

  return new Response(JSON.stringify({ success: true, user: { email } }), {
    status: 201,
    headers: { 'Content-Type': 'application/json' }
  });
}



×¤×§×•×“×•×ª
dot -Tpng tree.dot -o tree.png

npm run dev

×¡×™×›×•×
.env (×‘×©×•×¨×©) ×¢× DATABASE_URL="file:./dev.db".

schema.prisma ×‘×ª×™×§×™×™×ª prisma/ ×›×¤×™ ×©×”×•×“×’×.

npx prisma migrate dev --name init ×›×“×™ ×œ×‘× ×•×ª ×”×›×œ.

npx prisma studio ×œ×•×•×™×“×•× ×•×¡×§×™×¨×ª ×”× ×ª×•× ×™×.

×™×™×‘×•× ×•×©×™××•×© ×‘Ö¾@prisma/client ×‘×§×•×“ ×©×œ×š.

×›×¢×ª ×™×© ×œ×š ×‘×¡×™×¡ × ×ª×•× ×™× SQLite ××§×•××™ ×•××•×›×Ÿ ×œ×¤×™×ª×•×—, ×¢× ××•×“×œ Article ×•×œ-Prisma Client ×–××™×Ÿ ×œ×›×œ ×§×¨×™××” ×•×›×ª×™×‘×”. ×‘×”×¦×œ×—×”!


AuthNewsletterBox  ××™×™×‘× ××œ×™×• ../hooks/useIsMobile ×¤×¢×™×œ 
// ××§×•×©×¨ ×œ
//maingridcompontent maingridcontentdesktop mobilemenu 
//slidingmobilemenu
// ×¨×›×™×‘ ×”×¨×©××” ×œ××ª×¨ ×•×œ×§×‘×œ×ª ×—×“×©×•×ª ×‘××™×™×œ 

ArticleCard    ×›×œ×•××¨ ×œ× ××™×™×‘× ×œ×‘×“ × ×§×¡×˜ ×•×›×• ×¤×¢×™×œ
// ××§×•×©×¨ ×œ maingridcontent&mobail&desktop
// ×¨×›×™×‘ ×œ××™×§×•× ×”×ª××•× ×” ×•×”×›×™×ª×•×‘ ×‘×›×ª×‘×•×ª ×‘×“×£ ×”×¨××©×™ ××¡×•×“×¨ ×›×‘×¨ ×œ××•×‘×™×™×œ ×•×œ××—×©×‘
// ×¨×›×™×‘ ×œ××™×§×•× ×”×ª××•× ×” ×‘×›×ª×‘×•×ª ××¡×•×“×¨ ×›×‘×¨ ×œ××•×‘×™×™×œ ×•×œ××—×©×‘

ClientLayout ×¤×¢×™×œ
// ×¤×¨×™×¡×” ×•××™×§×•× ×‘×“×£ ×”×¨××©×™, ×—×œ×•×§×” ×œ××‘× ×™×, ×—×œ×•×§×ª ×”×“×£ ×‘××—×©×‘
//××§×•×©×¨ Layout

FloatingArticles
//××§×•×©×¨  ×œ(pagecontablayout) ×œ× × ×‘×“×§

Footer
//×¤×©×•×˜ ×¤×•×˜×¨

Header
//×¨××©×™×ª ×¨×’×™×œ
//××§×•×©×¨ ×œ
//×× ×•×¢ ×—×™×¤×•×© - ×ª×¤×¨×™×˜ - ×ª×¤×¨×™×˜ × ×™×™×“ - ××™×™×§×•× ×™×

MainArticles
///×œ× ××§×•×©×¨ ×œ× ×¤×¢×™×œ

MainGridContent
///×œ× ××§×•×©×¨ ×œ× ×¤×¢×™×œ

MainGridContentDesktop
// ××§×•×©×¨ Page

MainGridContentMobile
// ××§×•×©×¨ Page


MobileMenu
//×ª×¤×¨×™×˜ × ×¤×ª×— ×‘× ×™×™×“ 
××§×•×©×¨ ×œ×”×“×¨

SlidingMobileMenu
/// ×œ× ××§×•×©×¨ ×œ× ×¤×¢×™×œ

MobileMenuButton
/// ×œ× ××§×•×©×¨ ×œ× ×¤×¢×™×œ

MobileSocialMenu
// ××§×•×©×¨ MobileMenu
// ××™×™×‘× SocialIcons

NavigationMenu
// ××§×•×©×¨ MobileMenu Header

NewsTicker
//××§×•×©×¨ ClientLayout

PageContentLayout   × ××—×§
// Page\news   C:\Users\yosef\onmotor-media - Copy\app\news\page.jsx × ××—×§  je

/////
SearchBar ××§×•×©×¨ ×¤×¢×™×œ
// header mobilemenu slidingmobilemenu  
×‘×”××©×š ×œ×©×œ×‘:
××™×™×§×•×Ÿ ×—×™×¤×•×© ğŸ”
×× ×™××¦×™×” ×œ×”×¦×¢×•×ª
×˜×¢×™× ×” ×Ö¾API
/////

SectionWithHeader ×œ× ××§×•×©×¨ ×œ× ×¤×¢×™×œ

SocialIcons ××§×•×©×¨ ×¤×¢×™×œ
//


PageContainer.jsx ×¤×¢×™×œ
//×©××© ×›×ª×‘× ×™×ª ×œ×›×œ ×¢××•×“ ×ª×•×›×Ÿ 

Breadcrumbs.jsx ×œ× ××§×•×©×¨ ×œ× ×¤×¢×™×œ
// ×‘××™×“×ª ×”×¦×•×¨×š (×œ××©×œ: "×“×£ ×”×‘×™×ª / ×—×“×©×•×ª / ×¡×§×™×¨×” ×—×“×©×”")

NewsContent
//×œ× ×¤×¢×™×œ

jsconfig.json ×¤×¢×™×œ 
// ×©×™×˜×” ×œ×™×‘×•×

searchSuggestions  //data\searchSuggestions.js
// × ×ª×•× ×™× ×œ×× ×•×¢ ×—×™×¤×•×© ××§×•×©×¨ ×œ searchbar

lib\generateSearchSuggestions.js
// ××™×™×¦×¨ ×“××˜×” ×œ×× ×•×¢ ×—×™×¤×•×© ××‘×•×¡×¡ ×ª×•×›×Ÿ ×§×™×™×/×ª×•×›×Ÿ ×—×“×©


////
// components/SimpleKeyValueTable.jsx 
×˜×‘×œ×” ×“×™× ××™×ª ×œ×¤×™ ××¤×ª×—×•×ª
////

/////
app/articles/[slug]/page.jsx ×§×•×‘×¥ ×›×ª×‘×” ×“×™× ××™×ª


/////

////
âœ…Gallery.jsx
×’×œ×¨×™×™×ª ×ª××•× ×•×ª
import Gallery from "@/components/Gallery";
{/* ğŸ–¼ï¸ ×’×œ×¨×™×” ×‘×¡×•×£ ×”×›×ª×‘×” ×× ×§×™×™××ª */}  ×‘×ª×—×ª×™×ª ArticlePage, ×œ×¤× ×™ </PageContainer>:
<Gallery images={article.gallery || []} />

///

/// 
âœ… components/InlineImage.jsx
import InlineImage from "@/components/InlineImage";
<InlineImage
  src="/images/articles/ktm990-mid.jpg"
  alt="KTM 990 - ××‘×˜ ×¦×“×“×™"
  caption="×”Ö¾KTM 990 ×‘×¤×•×–×™×¦×™×™×ª ×¤×¢×•×œ×”"
  [[img:/× ×ª×™×‘/×œ×ª××•× ×”.jpg|alt ×˜×§×¡×˜|×›×™×ª×•×‘ ××ª×—×ª ×œ×ª××•× ×”]]

/>
////


×©×œ×‘ 4 (×¨×©×•×ª): ××‘× ×” ×§×‘×¦×™× ××•×¦×¢
bash
Copy
Edit
/app
  /news/page.jsx
  /reviews/page.jsx
  /tips/page.jsx
  /gear/page.jsx

/components
  /CategoryPage.jsx
  /SectionWithHeader.jsx
  /ArticleCard.jsx

/data
  /articlesData.js


  ××‘× ×” ×§×‘×¦×™× ××•×¦×¢ ×œ×›×ª×‘×•×ª
  app/
â”œâ”€â”€ articles/
â”‚   â””â”€â”€ [slug]/
â”‚       â””â”€â”€ page.jsx         â† ×ª×¦×•×’×ª ×¢××•×“ ×”×›×ª×‘×”
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ArticleHeader.jsx     â† ×›×•×ª×‘ + ×ª××¨×™×š + ×©×¢×” + ×ª××•× ×” ×¨××©×™×ª
â”‚   â”œâ”€â”€ ArticleContent.jsx    â† ×’×•×£ ×”×›×ª×‘×” (×›×•×œ×œ ×˜×‘×œ×” ×“×™× ××™×ª)
â”‚   â”œâ”€â”€ Tags.jsx       â† ×ª×’×™×•×ª
â”‚   â”œâ”€â”€ RelatedArticles.jsx   â† ×›×ª×‘×•×ª ×§×©×•×¨×•×ª
â”‚   â”œâ”€â”€ CommentForm.jsx       â† ×˜×•×¤×¡ ×ª×’×•×‘×” ×¨×’×™×œ
â”‚   â””â”€â”€ FacebookComments.jsx  â† ×¤×œ××’×™×Ÿ ×¤×™×™×¡×‘×•×§
â”œâ”€â”€ data/
â”‚   â””â”€â”€ articlesData.js       â† × ×ª×•× ×™ ×›×ª×‘×•×ª

//////
app/
â”œâ”€â”€ articles/
â”‚   â””â”€â”€ [slug]/
â”‚       â””â”€â”€ page.jsx               â† ×“×£ ×”×›×ª×‘×” â€“ ×“×™× ××™ ×œ×¤×™ ×›×ª×•×‘×ª URL
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ PageContainer.jsx         â† ×¢×•×˜×£ ××ª ×”×“×£ ×›×•×œ×• (×›×•×ª×¨×ª + ×‘×¨×“×§×¨××‘×¡)
â”‚   â”œâ”€â”€ ArticleHeader.jsx         â† ××¦×™×’: ×©× ×”×›×•×ª×‘, ×ª××¨×™×š, ×©×¢×”, ×ª××•× ×” ×¨××©×™×ª
â”‚   â”œâ”€â”€ ArticleContent.jsx        â† ××¤×¦×œ ×œ×¤×¡×§××•×ª + ××¦×™×’ ××ª ×ª×•×›×Ÿ ×”×›×ª×‘×”
â”‚   â”œâ”€â”€ SimpleKeyValueTable.jsx   â† ×˜×‘×œ×ª × ×ª×•× ×™× ×“×™× ××™×ª ××ª×•×š ××™×œ×•×Ÿ
â”‚   â”œâ”€â”€ Tags.jsx           â† ××¦×™×’ ×ª×’×™×•×ª ×œ×—×™×¦×” ×¢× ×§×™×©×•×¨×™×
â”‚   â”œâ”€â”€SimilarArticles.jsx       â† ×›×ª×‘×•×ª ×“×•××•×ª (×œ×¤×™ ×§×˜×’×•×¨×™×” ××• ×ª×’×™×•×ª)
â”‚   â”œâ”€â”€ CommentForm.jsx           â† ×˜×•×¤×¡ ×ª×’×•×‘×” ×‘××ª×¨ (×©× + ×ª×•×›×Ÿ ×ª×’×•×‘×”)
â”‚   â””â”€â”€ FacebookComments.jsx      â† ×ª×’×•×‘×•×ª ×¤×™×™×¡×‘×•×§ (×¤×œ××’×™×Ÿ)

data/
â””â”€â”€ articlesData.js  â† ××§×•×¨ ×›×œ ×”× ×ª×•× ×™× ×©×œ ×”×›×ª×‘×•×ª (×›×•×œ×œ ×ª×•×›×Ÿ ××œ×, ×ª××•× ×•×ª, ×˜×‘×œ×”, ×›×•×ª×‘ ×•×›×•')

////
×§×©×¨×™× ×‘×™×Ÿ ×”×§×‘×¦×™× (×–×¨×™××ª × ×ª×•× ×™×)

page.jsx  â†  ×§×•×¨× ××ª ×›×œ ×”× ×ª×•× ×™× ×œ×¤×™ slug ××”Ö¾articlesData.js
   â””â”€â”€ PageContainer
       â”œâ”€â”€ ArticleHeader       â† ××§×‘×œ: author, date, time, image
       â”œâ”€â”€ ArticleContent      â† ××§×‘×œ: content (split ×œ×¤×¡×§××•×ª)
       â”œâ”€â”€ SimpleKeyValueTable â† ××§×‘×œ: tableData
       â”œâ”€â”€ Tags         â† ××§×‘×œ: tags
       â”œâ”€â”€ FacebookComments    â† ×§×‘×•×¢
       â”œâ”€â”€ CommentForm         â† ×§ // ×œ×˜×¤×œ ×‘×©××™×¨×ª ×ª×’×•×‘×•×ª ××• ××¢×¨×›×ª ×œ×‘×“×™×§×ª ×”×ª×’×•×‘×”// ×§×‘×•×¢
       â””â”€â”€ RelatedArticles     â† ××§×‘×œ: category / tags
///
components\CommentsSection.jsx
××‘× ×” ×ª×’×•×‘×•×ª
///

////
×¡×¤×¨ ×—×•×§×™× ××‘×•×¡×¡ ×‘×™× ×” ××œ××›×•×ª×™×ª
/app
â”‚
â”œâ”€â”€ /law-book                   â† ×¡×¤×¨ ×”×—×•×§×™× âœ…
â”‚   â”œâ”€â”€ page.jsx                â† ×¢××•×“ ×¨××©×™ ×©×œ ×”×§×˜×’×•×¨×™×” âœ…
â”‚   â”œâ”€â”€ ask-question.jsx        â† ×“×£ ×œ×©×œ×™×—×ª ×©××œ×” ×—×“×©×” (×™×›×•×œ ×œ×”×™×•×ª ××•×“×œ ××• ××–×•×¨ ×‘×“×£ ×”×¨××©×™) âœ…
â”‚   â””â”€â”€ /[questionId]           â† ×“×£ ×©×œ ×©××œ×” ×‘×•×“×“×ª (×“×™× ×××™) âœ…
â”‚       â””â”€â”€ page.jsx  âœ…
â”‚
â”œâ”€â”€ /api   âœ…
â”‚   â””â”€â”€ /law-book    âœ…  
â”‚       â””â”€â”€ ask.js              â† API Route ×©×©×•×œ×— ×©××œ×” ×œ-OpenAI ×•××—×–×™×¨ ×ª×©×•×‘×”  âœ…
â”‚
/components
â”œâ”€â”€ LawBookForm.jsx             â† ×¨×›×™×‘ ×ª×™×‘×ª ×©××œ×” âœ…
â”œâ”€â”€ LawBookAnswer.jsx           â† ×”×¦×’×ª ×ª×©×•×‘×” âœ…
â”œâ”€â”€ LawBookQuestionList.jsx     â† ×¨×©×™××ª ×©××œ×•×ª × ×¤×•×¦×•×ª âœ…
â””â”€â”€ Loader.jsx                  â† ×˜×•×¢×Ÿ (×¡×¤×™× ×¨) âœ…

âœ… ×¡×¤×¨ ×”×—×•×§×™× â€“ ×ª×©×ª×™×ª ×¨××©×•× ×™×ª (AI Q&A)

ğŸ“… ×ª××¨×™×š ×”×§××”: 2025-06-22  
âš™ï¸ ××¦×‘: ×”×•×§× ×‘×¡×™×¡ ××œ× â€“ ×¦×“ ×œ×§×•×— + API  
ğŸ“ ××™×§×•×: /app/law-book + /components + /api/law-book

---

law-book/page.jsx  â†  ×“×£ ×¨××©×™ ×¢× ×ª×™×‘×ª ×©××œ×” ×•×¨×©×™××ª ×©××œ×•×ª  
   â””â”€â”€ LawBookForm             â† ×˜×•×¤×¡ ×©××œ×” â†’ onQuestionSubmit  
       â””â”€â”€ Loader              â† ×× ×™××¦×™×™×ª ×˜×¢×™× ×”  
   â””â”€â”€ LawBookQuestionList     â† ××§×‘×œ: questions (××¢×¨×š ×©×œ ×©××œ×”+×ª×©×•×‘×”)

law-book/[questionId]/page.jsx  â†  ×“×£ ×œ×©××œ×” ×‘×•×“×“×ª  
   â””â”€â”€ LawBookAnswer           â† ××§×‘×œ: questionId â†’ ×ª×¦×•×’×” ×¢×ª×™×“×™×ª ×× ×ª×•× ×™ DB

api/law-book/ask.js  â†  API Route ×œ×©×œ×™×—×ª ×©××œ×” ×œÖ¾OpenAI  
   â†³ ××§×‘×œ POST ×¢× ×©××œ×”  
   â†³ ××—×–×™×¨ ×ª×©×•×‘×” ×Ö¾GPT ×¢× × ×™×¡×•×— ×¨×©××™, ××‘×•×¡×¡ ×—×•×§×™×  
   â†³ ×“×•×¨×© ×”×’×“×¨×ª ××©×ª× ×” ×¡×‘×™×‘×” OPENAI_API_KEY ×‘×§×•×‘×¥ .env.local

components/LawBookForm.jsx         â† ×˜×•×¤×¡ ×©××œ×” ×¢× textarea ×•×›×¤×ª×•×¨ ×©×œ×™×—×”  
components/LawBookQuestionList.jsx â† ××¦×™×’ ×©××œ×•×ª ×•×ª×©×•×‘×•×ª ×œ××—×¨ ×©×œ×™×—×”  
components/LawBookAnswer.jsx       â† ××¦×™×’ ×ª×©×•×‘×” ×‘×“×£ ×¢×¦×××™  
components/Loader.jsx              â† ×˜×•×¢×Ÿ... (×‘××”×œ×š ×©×œ×™×—×ª ×©××œ×”)

---

ğŸ› ï¸ ×”×¢×¨×•×ª:
â†’ ×—×•×‘×” ×œ×”×’×“×™×¨ `.env.local` ×¢×:
   OPENAI_API_KEY=your-key-here

â†’ ×‘×¢×ª×™×“:
   - ××—×¡×•×Ÿ × ×ª×•× ×™× ×‘Ö¾Supabase / MongoDB  
   - ×©×œ×™×¤×ª ×ª×©×•×‘×•×ª ×™×©× ×•×ª ×œ×¤×™ ×“××™×•×Ÿ ×©××œ×”  
   - ×ª×’×•×‘×•×ª ×’×•×œ×©×™× ×•×“×™×¨×•×’ ××™×›×•×ª ×ª×©×•×‘×”  
   - ××™× ×˜×’×¨×¦×™×” ×¢× ×× ×•×¢ RAG (×©×œ×™×¤×ª ×—×•×§×™× ×××¡××›×™×)

////××‘× ×” ×ª×™×§×™×•×ª ×œ×›×ª×‘×•×ª ×•×œ×›×œ ×¢××•×“
/components/ArticleCards
  ArticleCard.jsx              â† ×ª×¦×•×’×ª ×‘×¨×™×¨×ª ××—×“×œ (××” ×©×™×© ×œ×š ×¢×›×©×™×•)
  ArticleCardCompact.jsx       â† ×œ×’×¨×™×“ ×¦×¤×•×£ ××• ×¡×™×™×“×‘×¨
  ArticleCardWide.jsx          â† ×œ×›×¨×˜×™×¡ ×¨×•×—×‘×™ ×¢× ×ª××•× ×” ××™××™×Ÿ
  ArticleCardOverlay.jsx       â† ×œ××©×œ ×¢× ×ª×’×™×•×ª, ×ª××¨×™×š, ×§×˜×’×•×¨×™×” ××•×¦×’×ª

////

/data/
  â””â”€â”€ /articles/
        â”œâ”€â”€ news.js
        â”œâ”€â”€ tips.js
        â”œâ”€â”€ reviews.js
        â”œâ”€â”€ tests.js
        â””â”€â”€ index.js (×××—×“ ××ª ×›×•×œ×)


///app\news\global\page.jsx

import PageContainer from '@/components/PageContainer';
import ArticleCard from '@/components/ArticleCards/ArticleCard';
import articlesData from '@/data/articles';

export default function GlobalNews() {
  const globalArticles = articlesData.filter(
    a => a.category === 'news' && a.subcategory === 'global'
  );

  return (
    <PageContainer
      title="×—×“×©×•×ª ××”×¢×•×œ×"
      breadcrumbs={[
        { label: '×“×£ ×”×‘×™×ª', href: '/' },
        { label: '×—×“×©×•×ª', href: '/news' },
        { label: '×—×“×©×•×ª ××”×¢×•×œ×' }
      ]}
    >
      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        {globalArticles.map(article => (
          <ArticleCard key={article.id} article={article} />
        ))}
      </div>
    </PageContainer>
  );
}

///app\news\local\page.jsx

import PageContainer from '@/components/PageContainer';
import ArticleCard from '@/components/ArticleCards/ArticleCard';
import articlesData from '@/data/articles';

export default function LocalNews() {
  const localArticles = articlesData.filter(
    a => a.category === 'news' && a.subcategory === 'local'
  );

  return (
    <PageContainer
      title="×—×“×©×•×ª ××§×•××™×•×ª"
      breadcrumbs={[
        { label: '×“×£ ×”×‘×™×ª', href: '/' },
        { label: '×—×“×©×•×ª', href: '/news' },
        { label: '×—×“×©×•×ª ××§×•××™×•×ª' }
      ]}
    >
      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        {localArticles.map(article => (
          <ArticleCard key={article.id} article={article} />
        ))}
      </div>
    </PageContainer>
  );
}

/////
///app\news\[subcategory]\page.jsx

/////
××¢×¨×š ×œ×›×ª×‘×”
const forumArticles = [
  {
    id: 1001,
    slug: "example-slug",
    title: "×›×•×ª×¨×ª ×œ×“×•×’××”",
    headline: "×›×•×ª×¨×ª ××©× ×™×ª ×× ×™×©",
    description: "",
    subdescription: "",
    href: "/articles/example-slug",
    image: "/images/articles/example-slug/cover.jpg",
    imageSrc: "/images/articles/example-slug/main.jpg",
    galleryPath: "/images/articles/example-slug/gallery",
    imageAlt: "×ª×™××•×¨ ×ª××•× ×”",

    category: "forum",
    subcategory: "tech", // ××• "rides", ××• "sale"

    display: {
      homepage: false,
      sidebar: false,
      mainSlider: false,
      newsletter: false
    },

    priority: 1,

    author: "×©× ×”×›×•×ª×‘",
    date: "25.06.2025",
    time: "12:00",
    tags: ["×“×•×’××”", "×¤×•×¨×•×"],
    content: ``,
    tableData: {}
  },
];

export default forumArticles;
///


//components\AuthNewsletterBox.jsx
'use client';
import React, { useState, useEffect } from 'react';
import useIsMobile from '@/hooks/useIsMobile';
import { FaChevronDown, FaChevronUp } from 'react-icons/fa';
import { loginUser } from '@/utils/auth'; // âœ… ×œ×•×•×“× ×©×§×™×™× ×”×§×•×‘×¥ ×”×–×”

export default function AuthNewsletterBox({ mode = 'inline' }) {
  const isMobile = useIsMobile();
  const [hydrated, setHydrated] = useState(false);

  const [email, setEmail] = useState('');
  const [success, setSuccess] = useState(false);
  const [username, setUsername] = useState('');
  const [password, setPassword] = useState('');
  const [loginError, setLoginError] = useState('');
  const [loginSuccess, setLoginSuccess] = useState(false);
  const [agreed, setAgreed] = useState(false);
  const [isOpen, setIsOpen] = useState(true);
  const [showTerms, setShowTerms] = useState(false);

  useEffect(() => {
    setHydrated(true);
  }, []);

  const handleLogin = async () => {
    try {
      const res = await fetch('/api/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password }),
      });

      if (!res.ok) throw new Error('×©× ××©×ª××© ××• ×¡×™×¡××” ×©×’×•×™×™×');

      await res.json();
      loginUser(username); // âœ… ×©××•×¨ ××ª ×”××©×ª××©
      setLoginSuccess(true);
      setLoginError('');
      window.location.reload(); // âœ… ×˜×¢×Ÿ ××ª ×”×“×£ ××—×“×© ×›×“×™ ×œ×©×§×£ ×”×ª×—×‘×¨×•×ª
    } catch (err) {
      setLoginError(err.message);
      setLoginSuccess(false);
    }
  };

  const handleSubscribe = async (e) => {
    e.preventDefault();
    if (!agreed) {
      alert('×™×© ×œ××©×¨ ××ª ×ª× ××™ ×”×©×™××•×© ×¢×œ ×× ×ª ×œ×”×™×¨×©×');
      return;
    }
    setSuccess(true);
    setTimeout(() => setSuccess(false), 3000);
  };

  if (!hydrated || (isMobile && mode === 'side' && !isOpen)) {
    return (
      <div dir="rtl" className="text-center">
        <button
          onClick={() => setIsOpen(true)}
          className="text-sm bg-white text-black px-3 py-2 rounded shadow hover:bg-gray-200 transition"
        >
          ×”×ª×—×‘×¨×•×ª / ×”×¨×©××” <FaChevronDown className="inline" />
        </button>
      </div>
    );
  }

  return (
    <div dir="rtl" className="text-center">
      {isMobile && mode === 'side' && (
        <button
          onClick={() => setIsOpen(false)}
          className="text-sm bg-white text-black px-3 py-2 rounded shadow hover:bg-gray-200 transition"
        >
          ×¡×’×•×¨ ×”×ª×—×‘×¨×•×ª / ×”×¨×©××” <FaChevronUp className="inline" />
        </button>
      )}

      <div
        className={`transition-all duration-500 ease-in-out overflow-hidden mt-4
          ${mode === 'inline' ? 'w-[320px] bg-white text-black' : ''}
          ${mode === 'modal' ? '' : mode === 'side' ? 'fixed top-32 left-4 bg-white z-50 w-[320px]' : ''}
          border border-gray-300 rounded p-6 text-sm shadow-md`}
      >
        <form onSubmit={handleSubscribe} className="mb-4">
          <label className="block mb-1 font-semibold text-black"> ×”×¨×©××” ×œ× ×™×•×–×œ×˜×¨ </label>
          <input
            type="email"
            value={email}
            onChange={(e) => setEmail(e.target.value)}
            placeholder="onmotormedia@gmail.com"
            className="w-full px-1 py-1 border border-gray-300 rounded text-right text-sm"
          />
          <div className={`flex items-center mt-2 ${isMobile ? 'justify-end' : ''}`}>
            <input
              type="checkbox"
              id="agree"
              className="ml-2 accent-[#e60000]"
              checked={agreed}
              onChange={(e) => setAgreed(e.target.checked)}
            />
            <label htmlFor="agree" className="text-xs text-gray-700">
              ×× ×™ ××¡×›×™× ×œ{' '}
              <button
                type="button"
                className="text-blue-600 underline hover:text-blue-800"
                onClick={() => setShowTerms(true)}
              >
                ×ª× ××™ ×”×©×™××•×© ×©×œ ×”××ª×¨
              </button>
            </label>
          </div>
          <button
            type="submit"
            className="mt-2 bg-[#e60000] text-white px-3 py-1 rounded hover:bg-red-700 text-sm w-full"
          >
            ×©×œ×—
          </button>
          {success && <p className="text-green-600 mt-1 text-xs">×”×”×¨×©××” ×”×¦×œ×™×—×”!</p>}
        </form>

        <div className="border-t pt-3">
          <h3 className="font-semibold text-black mb-2">×”×ª×—×‘×¨×•×ª</h3>
          <input
            type="text"
            placeholder="×©× ××©×ª××©"
            value={username}
            onChange={(e) => setUsername(e.target.value)}
            className="w-full px-2 py-1 mb-2 border border-gray-300 rounded text-right text-sm"
          />
          <input
            type="password"
            placeholder="×¡×™×¡××”"
            value={password}
            onChange={(e) => setPassword(e.target.value)}
            className="w-full px-2 py-1 mb-2 border border-gray-300 rounded text-right text-sm"
          />
          <div className={`flex items-center mb-2 ${isMobile ? 'justify-end' : ''}`}>
            <input id="remember" type="checkbox" className="ml-2 accent-[#e60000]" />
            <label htmlFor="remember" className="text-xs text-gray-700">×–×›×•×¨ ××•×ª×™</label>
          </div>
          <button
            type="button"
            onClick={handleLogin}
            className="bg-[#e60000] text-white px-3 py-1 rounded hover:bg-red-700 text-sm w-full"
          >
            ×”×ª×—×‘×¨
          </button>

          {loginError && <p className="text-red-600 mt-1 text-xs">{loginError}</p>}
          {loginSuccess && <p className="text-green-600 mt-1 text-xs">×”×ª×—×‘×¨×ª ×‘×”×¦×œ×—×”!</p>}

          <div className="mt-2 text-center text-xs">
            <a href="/auth/signup" className="text-[#e60000] hover:underline ml-2">×¦×•×¨ ×—×©×‘×•×Ÿ</a>
            |
            <a href="/auth/forgot-password" className="text-[#e60000] hover:underline mr-2">×©×›×—×ª×™ ×¡×™×¡××”</a>
          </div>
        </div>
      </div>

      {showTerms && (
        <div className="fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center">
          <div className="bg-white rounded-lg p-6 max-w-md w-full text-right text-sm relative shadow-lg">
            <button
              onClick={() => setShowTerms(false)}
              className="absolute top-2 left-3 text-gray-600 hover:text-black"
            >
              âœ–
            </button>
            <h2 className="text-lg font-bold mb-2">×ª× ××™ ×”×©×™××•×©</h2>
            <p className="mb-4">
              ×©×™××•×© ×‘××ª×¨ OnMotor Media ×›×¤×•×£ ×œ×”×¡×›××” ×œ×ª× ××™ ×”×©×™××•×©. × × ×œ× ×œ×¤×¨×¡× ×ª×›× ×™× ×¤×•×’×¢× ×™×™×, ×œ× ×—×•×§×™×™× ××• ×›××œ×• ×”×¤×•×’×¢×™× ×‘×–×›×•×™×•×ª ×™×•×¦×¨×™×. ×”××©×ª××© ××—×¨××™ ×œ×ª×•×›×Ÿ ×©×”×•× ××¤×¨×¡×.
            </p>
            <button
              onClick={() => setShowTerms(false)}
              className="bg-[#e60000] text-white px-4 py-1 rounded hover:bg-red-700"
            >
              ××™×©×•×¨
            </button>
          </div>
        </div>
      )}
    </div>
  );
}
///

 ×§×‘×¦×™× ×‘×¦×“ ×”×©×¨×ª (API)
1. /app/api/forgot-password/route.js
 ×××¤×¡ ×¡×™×¡××” ×¢"×™ ×©×œ×™×—×ª ×¡×™×¡××” ×–×× ×™×ª ×œ××™××™×™×œ ×©×œ ×”××©×ª××©.

2. /app/api/change-password/route.js
 ××©× ×” ×¡×™×¡××” ×§×™×™××ª ×œ××©×ª××© ××—×•×‘×¨ ×œ××—×¨ ××™××•×ª ×¡×™×¡××” × ×•×›×—×™×ª.

3. /app/api/login/route.js
 ××××ª ×”×ª×—×‘×¨×•×ª ×œ×¤×™ ×©× ××©×ª××© ××• ××™××™×™×œ, ××—×–×™×¨ ××ª ×¤×¨×˜×™ ×”××©×ª××© ×× ×”×¦×œ×™×—.

 ×§×‘×¦×™× ×‘×¦×“ ×”×œ×§×•×— (React Components + Utilities)
4. /components/AuthBox.jsx
 ×§×•×¤×¡×” ×¢× ×˜×¤×¡×™×: ×”×ª×—×‘×¨×•×ª, ×”×¨×©××”, ×©×›×—×ª×™ ×¡×™×¡××”, ×©×™× ×•×™ ×¡×™×¡××”.
 ×ª×•××š ×’× ×‘××•×‘×™×™×œ (××¦×‘ "side") ×¢× ×’×œ×™×œ×” ××•×˜×•××˜×™×ª ×•×”×ª×××ª ×¨×•×—×‘.

5. /components/NewsletterBox.jsx
 ×˜×•×¤×¡ ×”×¨×©××” ×œ× ×™×•×–×œ×˜×¨.
 ×›×•×œ×œ ×˜×™×¤×•×œ ×‘×¤×ª×™×—×” ×•×¡×’×™×¨×” ×‘××•×‘×™×™×œ, ×’×œ×™×œ×” ××•×˜×•××˜×™×ª, ××•×“××œ ×©×œ ×ª× ××™ ×©×™××•×©.

 Utilities
6. /utils/auth.js
 × ×™×”×•×œ ××¦×‘ ×”×ª×—×‘×¨×•×ª ×‘Ö¾localStorage â€“ ×›×•×œ×œ:

getCurrentUser() â€“ ×”×—×–×¨×ª ×”××©×ª××© ×”× ×•×›×—×™

loginUser() â€“ ×©××™×¨×ª ×”×ª×—×‘×¨×•×ª

logoutUser() â€“ × ×™×ª×•×§

isLoggedIn() â€“ ×‘×“×™×§×ª ×”×ª×—×‘×¨×•×ª

 Hooks
7. /hooks/useIsMobile.js (×”×•×–×›×¨ ×‘×©×™××•×©)
 ×”×•×§ ×©×‘×•×“×§ ×× ×”×ª×¦×•×’×” ×”×™× ×‘××•×‘×™×™×œ, ×‘×©×™××•×© ×‘×¨×›×™×‘×™× AuthBox ×•Ö¾NewsletterBox.

 ×§×‘×¦×™ JSON/× ×ª×•× ×™×
8. /data/users.json
 ×§×•×‘×¥ × ×ª×•× ×™× ×”×××›×¡×Ÿ ××ª ×›×œ ×”××©×ª××©×™× ×›×•×œ×œ ×¡×™×¡×××•×ª ××•×¦×¤× ×•×ª.
 ××©××© ×œ×›×œ ×¤×¢×•×œ×•×ª ×§×¨×™××”/×¢×“×›×•×Ÿ ××©×ª××©×™× ×‘××¢×¨×›×ª.

