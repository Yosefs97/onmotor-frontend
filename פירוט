////
//1,310,813 / 1,000,000
//1,311,026 / 1,000,000
//1,311,190 / 1,000,000
//1,311,306 / 1,000,000
//1,311,722 / 1,000,000
//1,418,444 / 1,000,000
//1,416,498 / 1,000,000 21:05-22.11.2025
//1,416,532 / 1,000,000 21:06
//1,416,557 / 1,000,000 21:07
//1,416,579 / 1,000,000 21:08

//1,490,270 / 1,000,000
//1,490,292 / 1,000,000
//1,488,302 / 1,000,000
//1,488,411 / 1,000,000
//1,488,470 / 1,000,000
//1,486,314 Requests
//1,486,411 Requests
//1,486,432 Requests
//1,486,502 Requests
//1,486,511 Requests
//1,486,984 Requests
//1,487,009 Requests
//1,346,528 Invocations
//1,353,544 Invocations
//1,353,373 Invocations





///
×× ×™ ××¢×©×” ×œ×š ×¡×“×¨.
×××© ××”×ª×—×œ×” ×•×¢×“ ×”×¡×•×£ ×›×•×œ×œ ×ª×•×›×Ÿ ×”×§×‘×¦×™×


// components/TabLeftSidebar.jsx
'use client';

import React, { useState, useEffect, useRef } from 'react';
import Image from 'next/image';
import Link from 'next/link';
import useIsMobile from '@/hooks/useIsMobile';

const tabs = ['××—×¨×•× ×™×', '×‘×“×¨×›×™×', '×¤×•×¤×•×œ×¨×™'];

/* ğŸ‘‡ ×¤×•× ×§×¦×™×” ×©××•×¦×™××” ×©× ××ª×¨ × ×§×™ ××ª×•×š ×›×ª×•×‘×ª (×œ××§×¨×” ×©××™×Ÿ source ××”×©×¨×ª) */
function extractDomainName(url) {
Â  try {
Â  Â  const host = new URL(url).hostname.replace('www.', '');
Â  Â  const parts = host.split('.');
Â  Â  let base = '';
Â  Â  if (
Â  Â  Â  parts.length >= 3 &&
Â  Â  Â  ['co', 'org', 'net'].includes(parts[parts.length - 2])
Â  Â  ) {
Â  Â  Â  base = parts[parts.length - 3];
Â  Â  } else {
Â  Â  Â  base = parts[0];
Â  Â  }
Â  Â  return base.charAt(0).toUpperCase() + base.slice(1);
Â  } catch {
Â  Â  return 'Website';
Â  }
}

export default function TabLeftSidebar() {
Â  const isMobile = useIsMobile();
Â  const [hasInteracted, setHasInteracted] = useState(false);
Â  const scrollContainerRef = useRef(null);
Â  const sidebarRef = useRef(null);

Â  const [activeTab, setActiveTab] = useState('××—×¨×•× ×™×');
Â  const [latestArticles, setLatestArticles] = useState([]);
Â  const [onRoadArticles, setOnRoadArticles] = useState([]);
Â  const [popularContent, setPopularContent] = useState([]);
Â  const [isPaused, setIsPaused] = useState(false);

Â  /* âœ… ×©×œ×™×¤×” ××—×ª ××”×©×¨×ª */
Â  useEffect(() => {
Â  Â  const fetchSidebarData = async () => {
Â  Â  Â  try {
Â  Â  Â  Â  const res = await fetch('/api/sidebar-left');
Â  Â  Â  Â  if (!res.ok) {
Â  Â  Â  Â  Â  console.error('×©×’×™××” ×‘×˜×¢×™× ×ª sidebar-left:', res.status);
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  const json = await res.json();
Â  Â  Â  Â  setLatestArticles(json.latest || []);
Â  Â  Â  Â  setOnRoadArticles(json.onRoad || []);
Â  Â  Â  Â  setPopularContent(json.popular || []);
Â  Â  Â  } catch (err) {
Â  Â  Â  Â  console.error('×©×’×™××” ×‘×˜×¢×™× ×ª sidebar-left:', err);
Â  Â  Â  }
Â  Â  };

Â  Â  fetchSidebarData();
Â  }, []);

Â  /* âœ… ×’×œ×™×œ×” ×× ×›×™×ª ××ª××©×›×ª ×œ×“×¡×§×˜×•×¤ */
Â  useEffect(() => {
Â  Â  if (isMobile) return;
Â  Â  const container = scrollContainerRef.current;
Â  Â  if (!container) return;

Â  Â  const speed = 1;
Â  Â  let frame;
Â  Â  const step = () => {
Â  Â  Â  if (!isPaused) {
Â  Â  Â  Â  container.scrollTop += speed;
Â  Â  Â  Â  if (container.scrollTop >= container.scrollHeight - container.clientHeight) {
Â  Â  Â  Â  Â  container.scrollTop = 0;
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  Â  frame = requestAnimationFrame(step);
Â  Â  };
Â  Â  frame = requestAnimationFrame(step);
Â  Â  return () => cancelAnimationFrame(frame);
Â  }, [activeTab, isPaused, isMobile]);

Â  /* âœ… ×’×œ×™×œ×” ×œ××™×§×•× ×”-sidebar ×‘××•×‘×™×™×œ ×œ××—×¨ ×‘×—×™×¨×ª ×˜××‘ */
Â  useEffect(() => {
Â  Â  if (!isMobile || !sidebarRef.current || !hasInteracted) return;
Â  Â  setTimeout(() => {
Â  Â  Â  const y = sidebarRef.current.getBoundingClientRect().top + window.scrollY - 100;
Â  Â  Â  window.scrollTo({ top: y, behavior: 'smooth' });
Â  Â  }, 0);
Â  }, [activeTab, isMobile, hasInteracted]);

Â  /* â­ï¸ ×¨×›×™×‘ ×ª×•×›×Ÿ ×©× ×—×¡×•×š ×‘×• ×›×¤×™×œ×•×ª */
Â  function CardContent({ item, even, source }) {
Â  Â  return (
Â  Â  Â  <>
Â  Â  Â  Â  <div className="w-20 h-14 relative rounded overflow-hidden flex-shrink-0">
Â  Â  Â  Â  Â  <Image
Â  Â  Â  Â  Â  Â  src={item.image || '/default-image.jpg'}
Â  Â  Â  Â  Â  Â  alt={item.title || ''}
Â  Â  Â  Â  Â  Â  fill
Â  Â  Â  Â  Â  Â  style={{ objectFit: 'cover' }}
Â  Â  Â  Â  Â  Â  className="rounded"
Â  Â  Â  Â  Â  />
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div className="flex flex-col text-right">
Â  Â  Â  Â  Â  <p className="font-bold text-sm line-clamp-1">{item.title}</p>

Â  Â  Â  Â  Â  <p
Â  Â  Â  Â  Â  Â  className={`text-xs ${
Â  Â  Â  Â  Â  Â  Â  even ? 'text-gray-700' : 'text-gray-300'
Â  Â  Â  Â  Â  Â  } line-clamp-2`}
Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  {item.description}
Â  Â  Â  Â  Â  </p>

Â  Â  Â  Â  Â  {item.date && (
Â  Â  Â  Â  Â  Â  <span
Â  Â  Â  Â  Â  Â  Â  className={`text-xs ${
Â  Â  Â  Â  Â  Â  Â  Â  even ? 'text-gray-500' : 'text-gray-400'
Â  Â  Â  Â  Â  Â  Â  } mt-1`}
Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  {item.date}
Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  )}

Â  Â  Â  Â  Â  {(item.views || source) && (
Â  Â  Â  Â  Â  Â  <span className="text-xs text-gray-400 mt-1">
Â  Â  Â  Â  Â  Â  Â  {item.views ? `${item.views} ×¦×¤×™×•×ª` : ''}
Â  Â  Â  Â  Â  Â  Â  {item.views && source ? ' Â· ' : ''}
Â  Â  Â  Â  Â  Â  Â  {source || ''}
Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  </div>
Â  Â  Â  </>
Â  Â  );
Â  }

Â  /* â­ï¸ ×”×¤×•× ×§×¦×™×” ×©××—×œ×™×˜×” ×× ×œ×”×©×ª××© ×‘Ö¾Link ××• ×‘Ö¾a */
Â  const getStyledContent = (items) => {
Â  Â  return items.map((item, i) => {
Â  Â  Â  const even = i % 2 === 0;
Â  Â  Â  const bg = even ? 'bg-red-50 text-black' : 'bg-neutral-900 text-white';

Â  Â  Â  const source = item.source || (item.url ? extractDomainName(item.url) : '');

Â  Â  Â  const isExternal = item.url && item.url.startsWith('http');
Â  Â  Â  const internalHref = !isExternal && item.slug ? `/articles/${item.slug}` : null;

Â  Â  Â  return (
Â  Â  Â  Â  <div key={item.id}>
Â  Â  Â  Â  Â  {isExternal ? (
Â  Â  Â  Â  Â  Â  /* ğŸ”— ×—×™×¦×•× ×™ â€” × ×¤×ª×— ×‘×˜××‘ ×—×“×© */
Â  Â  Â  Â  Â  Â  <a
Â  Â  Â  Â  Â  Â  Â  href={item.url}
Â  Â  Â  Â  Â  Â  Â  target="_blank"
Â  Â  Â  Â  Â  Â  Â  rel="noopener noreferrer"
Â  Â  Â  Â  Â  Â  Â  className={`flex gap-2 items-start p-1 rounded transition-transform duration-200 ${bg} hover:scale-[1.03] hover:shadow-sm`}
Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  <CardContent item={item} even={even} source={source} />
Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  ) : (
Â  Â  Â  Â  Â  Â  /* ğŸ”— ×¤× ×™××™ â€” SPA ×œ×œ× ×˜×¢×™× ×” ××—×“×© */
Â  Â  Â  Â  Â  Â  <Link
Â  Â  Â  Â  Â  Â  Â  href={internalHref}
Â  Â  Â  Â  Â  Â  Â  prefetch={false}
Â  Â  Â  Â  Â  Â  Â  className={`flex gap-2 items-start p-1 rounded transition-transform duration-200 ${bg} hover:scale-[1.03] hover:shadow-sm`}
Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  <CardContent item={item} even={even} source={source} />
Â  Â  Â  Â  Â  Â  </Link>
Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  </div>
Â  Â  Â  );
Â  Â  });
Â  };

Â  let content = [];
Â  if (activeTab === '××—×¨×•× ×™×') content = getStyledContent(latestArticles);
Â  else if (activeTab === '×‘×“×¨×›×™×') content = getStyledContent(onRoadArticles);
Â  else if (activeTab === '×¤×•×¤×•×œ×¨×™') content = getStyledContent(popularContent);

Â  return (
Â  Â  <div
Â  Â  Â  ref={sidebarRef}
Â  Â  Â  className={`flex flex-col min-h-0 bg-white shadow-md w-full text-sm ${
Â  Â  Â  Â  isMobile ? 'w-screen rounded-none' : ''
Â  Â  Â  }`}
Â  Â  >
Â  Â  Â  <div
Â  Â  Â  Â  className="flex border-b text-sm font-semibold bg-white sticky top-0 z-10 shadow-sm"
Â  Â  Â  Â  dir="rtl"
Â  Â  Â  >
Â  Â  Â  Â  {tabs.map((tab) => (
Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  key={tab}
Â  Â  Â  Â  Â  Â  onClick={() => {
Â  Â  Â  Â  Â  Â  Â  setActiveTab(tab);
Â  Â  Â  Â  Â  Â  Â  setHasInteracted(true);
Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  className={`w-1/3 text-center py-2 ${
Â  Â  Â  Â  Â  Â  Â  activeTab === tab
Â  Â  Â  Â  Â  Â  Â  Â  ? 'text-black border-b-2 border-red-500 bg-white'
Â  Â  Â  Â  Â  Â  Â  Â  : 'text-gray-500 bg-gray-100'
Â  Â  Â  Â  Â  Â  }`}
Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  {tab}
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  ))}
Â  Â  Â  </div>

Â  Â  Â  <div
Â  Â  Â  Â  ref={scrollContainerRef}
Â  Â  Â  Â  onMouseEnter={() => setIsPaused(true)}
Â  Â  Â  Â  onMouseLeave={() => setIsPaused(false)}
Â  Â  Â  Â  className="custom-scrollbar overflow-x-hidden p-1 space-y-1 flex-1 overflow-y-auto max-h-[380px]"
Â  Â  Â  Â  dir="rtl"
Â  Â  Â  >
Â  Â  Â  Â  {content}
Â  Â  Â  </div>
Â  Â  </div>
Â  );
}


// components\SidebarLeftConstants.jsx
'use client';
import React from 'react';
import PriceCheckBox from './PriceCheckBox';
import NewsletterBox from './NewsletterBox';
import GuideBox from './GuideBox';
import FollowUsBox from './FollowUsBox';
import IroadsBox from './IroadsBox';
import ProfessionalsBox from './ProfessionalsBox';
import TabLeftSidebar from './TabLeftSidebar';

export default function SidebarConstants() {
Â  return (
Â  Â  <div className="bg-gray-900 p-2 space-y-2 relative sticky top-0 bottom-0">
Â  Â  Â  <TabLeftSidebar />
Â  Â  Â  <hr className="border-t-2 border-red-600 my-1" />
Â  Â  Â  <PriceCheckBox />
Â  Â  Â  <hr className="border-t-2 border-red-600 my-3" />
Â  Â  Â  <NewsletterBox />
Â  Â  Â  <hr className="border-t-2 border-red-600 my-3" />
Â  Â  Â  <GuideBox />
Â  Â  Â  <hr className="border-t-2 border-red-600 my-3" />
Â  Â  Â  <FollowUsBox />
Â  Â  Â  <hr className="border-t-2 border-red-600 my-3" />
Â  Â  Â  <IroadsBox />
Â  Â  Â  <hr className="border-t-2 border-red-600 my-1" />
Â  Â  Â  <ProfessionalsBox />
Â  Â  Â  <hr className="border-t-2 border-red-600 my-1" />

Â  Â  Â  {/* ××¤×©×¨ ×œ×”×•×¡×™×£ ×›××Ÿ ×§×‘×•×¢×™× × ×•×¡×¤×™× */}
Â  Â  </div>
Â  );
}


// components\SidebarLeftLayer.jsx
'use client';
import React from 'react';

import SidebarLeftConstants from './SidebarLeftConstants';

export default function SidebarLeftLayer() {
Â  return (
Â  Â  <div className="w-full flex flex-col h-full">
Â  Â  Â  {/* ×”×©×›×‘×” ×©×œ SidebarLeftConstants */}
Â  Â  Â  <div className="w-full flex-1 ">
Â  Â  Â  Â  <SidebarLeftConstants />
Â  Â  Â  </div>
Â  Â  </div>
Â  );
}


// components/ClientLayout.jsx
'use client';

import { useEffect, useState } from "react";
import { usePathname } from "next/navigation";
import Header from "./Header";
import Footer from "./Footer";
import NewsTicker from "./NewsTicker";
import MobileMenu from "./MobileMenu";
import MobileShopFilterBar from "./MobileShopFilterBar";
import SidebarMiddleLayer from "./SidebarMiddleLayer";
import SidebarLeftLayer from "./SidebarLeftLayer";
import useIsMobile from "@/hooks/useIsMobile";

// ğŸ‘‡ ×”×•×¡×¤× ×• ××ª tickerHeadlines ×›-Prop
export default function ClientLayout({ children, tickerHeadlines = [] }) {
Â  const pathname = usePathname();
Â  const isMobile = useIsMobile();

Â  const [isAtTop, setIsAtTop] = useState(true);
Â  const [headerHeight, setHeaderHeight] = useState(60);

Â  /* ğŸ“Œ ×˜×¢×™× ×ª ×¡×§×¨×™×¤×˜×™× (×˜×•×•×™×˜×¨/×˜×™×§×˜×•×§) */
Â  useEffect(() => {
Â  Â  const scripts = [
Â  Â  Â  { id: "twitter-embed-script", src: "https://platform.twitter.com/widgets.js" },
Â  Â  Â  { id: "tiktok-embed-script", src: "https://www.tiktok.com/embed.js" },
Â  Â  ];

Â  Â  scripts.forEach(({ id, src }) => {
Â  Â  Â  if (!document.getElementById(id)) {
Â  Â  Â  Â  const script = document.createElement("script");
Â  Â  Â  Â  script.id = id;
Â  Â  Â  Â  script.async = true;
Â  Â  Â  Â  script.src = src;
Â  Â  Â  Â  script.start = src;
Â  Â  Â  Â  document.body.appendChild(script);
Â  Â  Â  }
Â  Â  });
Â  }, []);

Â  /* ğŸ“Œ ×–×™×”×•×™ ×’×œ×™×œ×” ×‘××•×‘×™×™×œ */
Â  useEffect(() => {
Â  Â  if (!isMobile) return;
Â  Â  const onScroll = () => {
Â  Â  Â  setIsAtTop(window.scrollY < 10);
Â  Â  };
Â  Â  window.addEventListener("scroll", onScroll);
Â  Â  return () => window.removeEventListener("scroll", onScroll);
Â  }, [isMobile]);

Â  /* ğŸ“Œ ×—×™×©×•×‘ ×’×•×‘×” Header ×‘××•×¤×Ÿ ×“×™× ××™ */
Â  useEffect(() => {
Â  Â  const header = document.querySelector("header");
Â  Â  if (!header) return;
Â  Â  const updateHeight = () => {
Â  Â  Â  setHeaderHeight(header.getBoundingClientRect().height);
Â  Â  };
Â  Â  updateHeight();
Â  Â  window.addEventListener("resize", updateHeight);
Â  Â  return () => window.removeEventListener("resize", updateHeight);
Â  }, []);

Â  const isShopPage = pathname.startsWith("/shop");

Â  return (
Â  Â  <>
Â  Â  Â  {/* ğŸ” ×ª×¤×¨×™×˜ ××•×‘×™×™×œ */}
Â  Â  Â  <div className="fixed top-4 right-0 z-[9999] lg:hidden">
Â  Â  Â  Â  <MobileMenu />
Â  Â  Â  </div>

Â  Â  Â  <Header />

Â  Â  Â  {/* ğŸ“° NewsTicker */}
Â  Â  Â  <div
Â  Â  Â  Â  className={`
Â  Â  Â  Â  Â  ${isMobile
Â  Â  Â  Â  Â  Â  ? (isAtTop
Â  Â  Â  Â  Â  Â  Â  Â  // âœ… ×ª×™×§×•×Ÿ: ×”×•×¨×“× ×• ××ª ×”-Z-Index ×œ-30 (×‘××§×•× 9998) ×›×“×™ ×©×”×ª×¤×¨×™×˜ ×™×›×¡×” ××•×ª×•
Â  Â  Â  Â  Â  Â  Â  Â  ? `sticky z-20`
Â  Â  Â  Â  Â  Â  Â  Â  : "relative")
Â  Â  Â  Â  Â  Â  // âœ… ×ª×™×§×•×Ÿ ×’× ×‘×“×¡×§×˜×•×¤: z-30
Â  Â  Â  Â  Â  Â  : `sticky z-20`
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  `}
Â  Â  Â  Â  style={{
Â  Â  Â  Â  Â  top: isMobile ? (isAtTop ? headerHeight : 0) : headerHeight,
Â  Â  Â  Â  }}
Â  Â  Â  >
Â  Â  Â  Â  {/* ğŸ‘‡ ××¢×‘×™×¨×™× ××ª ×”× ×ª×•× ×™× ×œ×˜×™×§×¨ */}
Â  Â  Â  Â  <NewsTicker headlines={tickerHeadlines} />
Â  Â  Â  </div>

Â  Â  Â  {isShopPage && <MobileShopFilterBar />}

Â  Â  Â  {/* ğŸŒ ×¤×¨×™×¡×ª ×”×¢××•×“ */}
Â  Â  Â  <div className="w-screen sm:w-full overflow-x-hidden sm:overflow-visible bg-[#f9f9f9]" dir="rtl">
Â  Â  Â  Â  <main
Â  Â  Â  Â  Â  className={`min-h-screen flex flex-col max-w-[1440px] mx-auto mb-0 px-0 sm:px-0 pt-[1px] pb-[2px] text-right bg-gray-100
Â  Â  Â  Â  Â  Â  ${isShopPage ? '' : 'lg:flex-row'}
Â  Â  Â  Â  Â  `}
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  {/* ×ª×•×›×Ÿ ××¨×›×–×™ */}
Â  Â  Â  Â  Â  {children}

Â  Â  Â  Â  Â  {/* ×¡×™×™×“×¨×™× â€“ ××•×¦×’×™× ×¨×§ ×× ×–×” ×œ× shop */}
Â  Â  Â  Â  Â  {!isShopPage && (
Â  Â  Â  Â  Â  Â  <>
Â  Â  Â  Â  Â  Â  Â  <div className={`w-full lg:w-1/4 flex-shrink-0 px-0 sm:px-0 ${!isMobile ? 'border-l border-[#e60000]' : ''}`}>
Â  Â  Â  Â  Â  Â  Â  Â  <SidebarMiddleLayer />
Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  <div className={`w-full lg:w-1/4 flex-shrink-0 px-0 sm:px-0 ${!isMobile ? 'border-r border-[#e60000]' : ''}`}>
Â  Â  Â  Â  Â  Â  Â  Â  <SidebarLeftLayer />
Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </>
Â  Â  Â  Â  Â  )}
Â  Â  Â  Â  </main>
Â  Â  Â  </div>

Â  Â  Â  <Footer />
Â  Â  </>
Â  );
}


// app/layout.js

import './globals.css';
import { AuthModalProvider } from '@/contexts/AuthModalProvider';
import ClientLayout from '@/components/ClientLayout';
import ScrollToTopButton from '@/components/ScrollToTopButton';
import Script from 'next/script';
import { Heebo } from 'next/font/google';

const heebo = Heebo({
Â  subsets: ['hebrew', 'latin'],
Â  weight: ['400', '500', '700'],
Â  display: 'swap',
});

// âœ… ××˜×-×“××˜×” (×ª×§×™×Ÿ)
export const metadata = {
Â  metadataBase: new URL("https://www.onmotormedia.com"),
Â  title: {
Â  Â  default: "OnMotor Media â€“ ××’×–×™×Ÿ ××•×¤× ×•×¢×™× ×™×©×¨××œ×™ | ×—×“×©×•×ª, ×¡×§×™×¨×•×ª ×•×§×”×™×œ×”",
Â  Â  template: "%s | OnMotor Media",
Â  },
Â  description:
Â  Â  "××’×–×™×Ÿ ××•×¤× ×•×¢×™× ×™×©×¨××œ×™ ××•×‘×™×œ â€“ ×—×“×©×•×ª ××•×¤× ×•×¢×™×, ×¡×§×™×¨×•×ª ×“×’××™×, ×¡×§×™×¨×ª ×¦×™×•×“ ×•××‘×—× ×™ ×“×¨×š. ×›×œ ××” ×©×¨×•×›×‘ ×‘×™×©×¨××œ ×¦×¨×™×š ×œ×“×¢×ª.",
Â  openGraph: {
Â  Â  title: "OnMotor Media â€“ ××’×–×™×Ÿ ××•×¤× ×•×¢×™× ×™×©×¨××œ×™",
Â  Â  description:
Â  Â  Â  "×—×“×©×•×ª ××•×¤× ×•×¢×™×, ×¡×§×™×¨×•×ª, ×¦×™×•×“ ×•× ×™×¡×™×•×Ÿ ××”×©×˜×— â€“ ××’×–×™×Ÿ ×”××•×¤× ×•×¢×™× ×œ×¨×•×›×‘ ×‘×™×©×¨××œ.",
Â  Â  url: "https://www.onmotormedia.com",
Â  Â  siteName: "OnMotor Media",
Â  Â  images: [
Â  Â  Â  {
Â  Â  Â  Â  url: "https://www.onmotormedia.com/full_Logo.jpg",
Â  Â  Â  Â  width: 1200,
Â  Â  Â  Â  height: 630,
Â  Â  Â  Â  alt: "OnMotor Media Logo",
Â  Â  Â  },
Â  Â  ],
Â  Â  locale: "he_IL",
Â  Â  type: "website",
Â  },
Â  twitter: {
Â  Â  card: "summary_large_image",
Â  Â  title: "OnMotor Media â€“ ××’×–×™×Ÿ ××•×¤× ×•×¢×™× ×™×©×¨××œ×™",
Â  Â  description:
Â  Â  Â  "×—×“×©×•×ª ××•×¤× ×•×¢×™×, ×¡×§×™×¨×•×ª ×“×’××™× ×œ×§×”×™×œ×ª ×”×¨×•×›×‘×™× ×©×œ ×™×©×¨××œ.",
Â  Â  images: ["https://www.onmotormedia.com/full_Logo.jpg"],
Â  },
};

// âœ… ×¤×•× ×§×¦×™×” ×—×“×©×” ×œ×©×œ×™×¤×ª ×›×•×ª×¨×•×ª ×‘×©×¨×ª (×”×™×™×ª×” ×—×¡×¨×” ×‘×§×•×“ ×©×œ×š)
async function getTickerHeadlines() {
Â  const API_URL = process.env.STRAPI_API_URL;
Â  try {
Â  Â  const url = `${API_URL}/api/articles?filters[$or][0][tags_txt][$contains]=×—×“×©× ×•×ª&filters[$or][1][tags_txt][$contains]=2025&filters[$or][2][tags_txt][$contains]=×—×•×§ ×•×¡×“×¨&sort=publishedAt:desc`;
Â  Â  
Â  Â  // ×§××© ×œ-5 ×“×§×•×ª (300 ×©× ×™×•×ª) ×›×“×™ ×œ×× ×•×¢ ×¢×•××¡ ×‘×§×©×•×ª
Â  Â  const res = await fetch(url, { next: { revalidate: 300 } });
Â  Â  const data = await res.json();

Â  Â  if (data?.data?.length > 0) {
Â  Â  Â  return data.data.map((article) => {
Â  Â  Â  Â  const attrs = article.attributes || article;
Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  text: attrs.headline || attrs.title || "×›×ª×‘×” ×œ×œ× ×›×•×ª×¨×ª",
Â  Â  Â  Â  Â  link: `/articles/${attrs.slug}`,
Â  Â  Â  Â  };
Â  Â  Â  });
Â  Â  }
Â  Â  return [];
Â  } catch (err) {
Â  Â  console.error("Server Error fetching ticker:", err);
Â  Â  return [];
Â  }
}

// âœ… ×”×•×¡×¤× ×• async ×›×“×™ ×©× ×•×›×œ ×œ×”×©×ª××© ×‘-await
export default async function RootLayout({ children }) {
Â  
Â  // âœ… ×©×œ×™×¤×ª ×”× ×ª×•× ×™× ×‘×¤×•×¢×œ (×”×™×” ×—×¡×¨ ×‘×§×•×“ ×©×œ×š)
Â  const tickerHeadlines = await getTickerHeadlines();

Â  return (
Â  Â  <html lang="he" dir="rtl" className={heebo.className}>
Â  Â  Â  <head>
Â  Â  Â  Â  {/* Structured Data */}
Â  Â  Â  Â  <script
Â  Â  Â  Â  Â  type="application/ld+json"
Â  Â  Â  Â  Â  dangerouslySetInnerHTML={{
Â  Â  Â  Â  Â  Â  __html: JSON.stringify({
Â  Â  Â  Â  Â  Â  Â  "@context": "https://schema.org",
Â  Â  Â  Â  Â  Â  Â  "@type": "Organization",
Â  Â  Â  Â  Â  Â  Â  "name": "OnMotor Media",
Â  Â  Â  Â  Â  Â  Â  "url": "https://www.onmotormedia.com",
Â  Â  Â  Â  Â  Â  Â  "logo": "https://www.onmotormedia.com/OnMotorLogonoback.png",
Â  Â  Â  Â  Â  Â  }),
Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  />
Â  Â  Â  </head>

Â  Â  Â  <body className="flex flex-col min-h-screen">
Â  Â  Â  Â  <AuthModalProvider>
Â  Â  Â  Â  Â  <ScrollToTopButton />
Â  Â  Â  Â  Â  {/* âœ… ×›×¢×ª ×”××©×ª× ×” tickerHeadlines ××•×’×“×¨ ×•××•×¢×‘×¨ ×ª×§×™×Ÿ */}
Â  Â  Â  Â  Â  <ClientLayout tickerHeadlines={tickerHeadlines}>{children}</ClientLayout>
Â  Â  Â  Â  </AuthModalProvider>

Â  Â  Â  Â  {/* ×ª×•×¡×£ ×”× ×’×™×©×•×ª */}
Â  Â  Â  Â  <Script src="https://cdn.enable.co.il/licenses/enable-L491236ornf8p4x2-1025-75004/init.js" />
Â  Â  Â  Â  {/* Facebook SDK */}
Â  Â  Â  Â  <Script
Â  Â  Â  Â  Â  src="https://connect.facebook.net/he_IL/sdk.js#xfbml=1&version=v23.0"
Â  Â  Â  Â  Â  strategy="lazyOnload"
Â  Â  Â  Â  />
Â  Â  Â  </body>
Â  Â  </html>
Â  );
}

// components/TabLeftSidebar.jsx
'use client';

import React, { useState, useEffect, useRef } from 'react';
import Image from 'next/image';
import Link from 'next/link';
import useIsMobile from '@/hooks/useIsMobile';

const tabs = ['××—×¨×•× ×™×', '×‘×“×¨×›×™×', '×¤×•×¤×•×œ×¨×™'];

/* ğŸ‘‡ ×¤×•× ×§×¦×™×” ×©××•×¦×™××” ×©× ××ª×¨ × ×§×™ ××ª×•×š ×›×ª×•×‘×ª (×œ××§×¨×” ×©××™×Ÿ source ××”×©×¨×ª) */
function extractDomainName(url) {
  try {
    const host = new URL(url).hostname.replace('www.', '');
    const parts = host.split('.');
    let base = '';
    if (
      parts.length >= 3 &&
      ['co', 'org', 'net'].includes(parts[parts.length - 2])
    ) {
      base = parts[parts.length - 3];
    } else {
      base = parts[0];
    }
    return base.charAt(0).toUpperCase() + base.slice(1);
  } catch {
    return 'Website';
  }
}

export default function TabLeftSidebar() {
  const isMobile = useIsMobile();
  const [hasInteracted, setHasInteracted] = useState(false);
  const scrollContainerRef = useRef(null);
  const sidebarRef = useRef(null);

  const [activeTab, setActiveTab] = useState('××—×¨×•× ×™×');
  const [latestArticles, setLatestArticles] = useState([]);
  const [onRoadArticles, setOnRoadArticles] = useState([]);
  const [popularContent, setPopularContent] = useState([]);
  const [isPaused, setIsPaused] = useState(false);

  /* âœ… ×©×œ×™×¤×” ××—×ª ××”×©×¨×ª */
  useEffect(() => {
    const fetchSidebarData = async () => {
      try {
        const res = await fetch('/api/sidebar-left');
        if (!res.ok) {
          console.error('×©×’×™××” ×‘×˜×¢×™× ×ª sidebar-left:', res.status);
          return;
        }
        const json = await res.json();
        setLatestArticles(json.latest || []);
        setOnRoadArticles(json.onRoad || []);
        setPopularContent(json.popular || []);
      } catch (err) {
        console.error('×©×’×™××” ×‘×˜×¢×™× ×ª sidebar-left:', err);
      }
    };

    fetchSidebarData();
  }, []);

  /* âœ… ×’×œ×™×œ×” ×× ×›×™×ª ××ª××©×›×ª ×œ×“×¡×§×˜×•×¤ */
  useEffect(() => {
    if (isMobile) return;
    const container = scrollContainerRef.current;
    if (!container) return;

    const speed = 1;
    let frame;
    const step = () => {
      if (!isPaused) {
        container.scrollTop += speed;
        if (container.scrollTop >= container.scrollHeight - container.clientHeight) {
          container.scrollTop = 0;
        }
      }
      frame = requestAnimationFrame(step);
    };
    frame = requestAnimationFrame(step);
    return () => cancelAnimationFrame(frame);
  }, [activeTab, isPaused, isMobile]);

  /* âœ… ×’×œ×™×œ×” ×œ××™×§×•× ×”-sidebar ×‘××•×‘×™×™×œ ×œ××—×¨ ×‘×—×™×¨×ª ×˜××‘ */
  useEffect(() => {
    if (!isMobile || !sidebarRef.current || !hasInteracted) return;
    setTimeout(() => {
      const y = sidebarRef.current.getBoundingClientRect().top + window.scrollY - 100;
      window.scrollTo({ top: y, behavior: 'smooth' });
    }, 0);
  }, [activeTab, isMobile, hasInteracted]);

  /* â­ï¸ ×¨×›×™×‘ ×ª×•×›×Ÿ ×©× ×—×¡×•×š ×‘×• ×›×¤×™×œ×•×ª */
  function CardContent({ item, even, source }) {
    return (
      <>
        <div className="w-20 h-14 relative rounded overflow-hidden flex-shrink-0">
          <Image
            src={item.image || '/default-image.jpg'}
            alt={item.title || ''}
            fill
            style={{ objectFit: 'cover' }}
            className="rounded"
          />
        </div>

        <div className="flex flex-col text-right">
          <p className="font-bold text-sm line-clamp-1">{item.title}</p>

          <p
            className={`text-xs ${
              even ? 'text-gray-700' : 'text-gray-300'
            } line-clamp-2`}
          >
            {item.description}
          </p>

          {item.date && (
            <span
              className={`text-xs ${
                even ? 'text-gray-500' : 'text-gray-400'
              } mt-1`}
            >
              {item.date}
            </span>
          )}

          {(item.views || source) && (
            <span className="text-xs text-gray-400 mt-1">
              {item.views ? `${item.views} ×¦×¤×™×•×ª` : ''}
              {item.views && source ? ' Â· ' : ''}
              {source || ''}
            </span>
          )}
        </div>
      </>
    );
  }

  /* â­ï¸ ×”×¤×•× ×§×¦×™×” ×©××—×œ×™×˜×” ×× ×œ×”×©×ª××© ×‘Ö¾Link ××• ×‘Ö¾a */
  const getStyledContent = (items) => {
    return items.map((item, i) => {
      const even = i % 2 === 0;
      const bg = even ? 'bg-red-50 text-black' : 'bg-neutral-900 text-white';

      const source = item.source || (item.url ? extractDomainName(item.url) : '');

      const isExternal = item.url && item.url.startsWith('http');
      const internalHref = !isExternal && item.slug ? `/articles/${item.slug}` : null;

      return (
        <div key={item.id}>
          {isExternal ? (
            /* ğŸ”— ×—×™×¦×•× ×™ â€” × ×¤×ª×— ×‘×˜××‘ ×—×“×© */
            <a
              href={item.url}
              target="_blank"
              rel="noopener noreferrer"
              className={`flex gap-2 items-start p-1 rounded transition-transform duration-200 ${bg} hover:scale-[1.03] hover:shadow-sm`}
            >
              <CardContent item={item} even={even} source={source} />
            </a>
          ) : (
            /* ğŸ”— ×¤× ×™××™ â€” SPA ×œ×œ× ×˜×¢×™× ×” ××—×“×© */
            <Link
              href={internalHref}
              prefetch={false}
              className={`flex gap-2 items-start p-1 rounded transition-transform duration-200 ${bg} hover:scale-[1.03] hover:shadow-sm`}
            >
              <CardContent item={item} even={even} source={source} />
            </Link>
          )}
        </div>
      );
    });
  };

  let content = [];
  if (activeTab === '××—×¨×•× ×™×') content = getStyledContent(latestArticles);
  else if (activeTab === '×‘×“×¨×›×™×') content = getStyledContent(onRoadArticles);
  else if (activeTab === '×¤×•×¤×•×œ×¨×™') content = getStyledContent(popularContent);

  return (
    <div
      ref={sidebarRef}
      className={`flex flex-col min-h-0 bg-white shadow-md w-full text-sm ${
        isMobile ? 'w-screen rounded-none' : ''
      }`}
    >
      <div
        className="flex border-b text-sm font-semibold bg-white sticky top-0 z-10 shadow-sm"
        dir="rtl"
      >
        {tabs.map((tab) => (
          <button
            key={tab}
            onClick={() => {
              setActiveTab(tab);
              setHasInteracted(true);
            }}
            className={`w-1/3 text-center py-2 ${
              activeTab === tab
                ? 'text-black border-b-2 border-red-500 bg-white'
                : 'text-gray-500 bg-gray-100'
            }`}
          >
            {tab}
          </button>
        ))}
      </div>

      <div
        ref={scrollContainerRef}
        onMouseEnter={() => setIsPaused(true)}
        onMouseLeave={() => setIsPaused(false)}
        className="custom-scrollbar overflow-x-hidden p-1 space-y-1 flex-1 overflow-y-auto max-h-[380px]"
        dir="rtl"
      >
        {content}
      </div>
    </div>
  );
}


// components/ClientLayout.jsx
'use client';

import { useEffect, useState } from "react";
import { usePathname } from "next/navigation";
import Header from "./Header";
import Footer from "./Footer";
import NewsTicker from "./NewsTicker";
import MobileMenu from "./MobileMenu";
import MobileShopFilterBar from "./MobileShopFilterBar";
import SidebarMiddleLayer from "./SidebarMiddleLayer";
import SidebarLeftLayer from "./SidebarLeftLayer";
import useIsMobile from "@/hooks/useIsMobile";

export default function ClientLayout({ children }) {
  const pathname = usePathname();
  const isMobile = useIsMobile();

  const [isAtTop, setIsAtTop] = useState(true);
  const [headerHeight, setHeaderHeight] = useState(60);

  /* ğŸ“Œ ×˜×¢×™× ×ª ×¡×§×¨×™×¤×˜×™× (×˜×•×•×™×˜×¨/×˜×™×§×˜×•×§) */
  useEffect(() => {
    const scripts = [
      { id: "twitter-embed-script", src: "https://platform.twitter.com/widgets.js" },
      { id: "tiktok-embed-script", src: "https://www.tiktok.com/embed.js" },
    ];

    scripts.forEach(({ id, src }) => {
      if (!document.getElementById(id)) {
        const script = document.createElement("script");
        script.id = id;
        script.async = true;
        script.src = src;
        document.body.appendChild(script);
      }
    });
  }, []);

  /* ğŸ“Œ ×–×™×”×•×™ ×’×œ×™×œ×” ×‘××•×‘×™×™×œ */
  useEffect(() => {
    if (!isMobile) return;

    const onScroll = () => {
      setIsAtTop(window.scrollY < 10);
    };

    window.addEventListener("scroll", onScroll);
    return () => window.removeEventListener("scroll", onScroll);
  }, [isMobile]);

  /* ğŸ“Œ ×—×™×©×•×‘ ×’×•×‘×” Header ×‘××•×¤×Ÿ ×“×™× ××™ */
  useEffect(() => {
    const header = document.querySelector("header");
    if (!header) return;

    const updateHeight = () => {
      setHeaderHeight(header.getBoundingClientRect().height);
    };

    updateHeight();
    window.addEventListener("resize", updateHeight);

    return () => window.removeEventListener("resize", updateHeight);
  }, []);

  const isShopPage = pathname.startsWith("/shop");

  return (
    <>
      {/* ğŸ” ×ª×¤×¨×™×˜ ××•×‘×™×™×œ */}
      <div className="fixed top-4 right-0 z-[9999] lg:hidden">
        <MobileMenu />
      </div>

      <Header />

      {/* ğŸ“° NewsTicker â€“ ×‘××•×‘×™×™×œ ×™×–×•×– ×‘××•×¨×“ ×”×“×£, ×‘×“×¡×§×˜×•×¤ × ×©××¨ ××§×•×‘×¢ */}
      <div
        className={`
          ${isMobile
            ? (isAtTop
                ? `sticky z-[9998]`
                : "relative")
            : `sticky z-[9998]`
          }
        `}
        style={{
          top: isMobile ? (isAtTop ? headerHeight : 0) : headerHeight,
        }}
      >
        <NewsTicker />
      </div>

      {isShopPage && <MobileShopFilterBar />}

      {/* ğŸŒ ×¤×¨×™×¡×ª ×”×¢××•×“ */}
      <div className="w-screen sm:w-full overflow-x-hidden sm:overflow-visible bg-[#f9f9f9]" dir="rtl">
        <main
          className={`min-h-screen flex flex-col max-w-[1440px] mx-auto mb-0 px-0 sm:px-0 pt-[1px] pb-[2px] text-right bg-gray-100
            ${isShopPage ? '' : 'lg:flex-row'}
          `}
        >
          {/* ×ª×•×›×Ÿ ××¨×›×–×™ */}
          {children}

          {/* ×¡×™×™×“×¨×™× â€“ ××•×¦×’×™× ×¨×§ ×× ×–×” ×œ× shop */}
          {!isShopPage && (
            <>
              <div className={`w-full lg:w-1/4 flex-shrink-0 px-0 sm:px-0 ${!isMobile ? 'border-l border-[#e60000]' : ''}`}>
                <SidebarMiddleLayer />
              </div>

              <div className={`w-full lg:w-1/4 flex-shrink-0 px-0 sm:px-0 ${!isMobile ? 'border-r border-[#e60000]' : ''}`}>
                <SidebarLeftLayer />
              </div>
            </>
          )}
        </main>
      </div>

      <Footer />
    </>
  );
}


//components/NewsTicker.jsx
'use client';
import React, { useState, useEffect, useRef } from "react";
import Link from "next/link";

const API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL;

export default function NewsTicker() {
  const [headlines, setHeadlines] = useState([]);
  const [currentHeadline, setCurrentHeadline] = useState(0);
  const [displayedText, setDisplayedText] = useState('');
  const [charIndex, setCharIndex] = useState(0);
  const [shiftX, setShiftX] = useState(0);
  const [isTyping, setIsTyping] = useState(true);

  const containerRef = useRef(null);
  const textRef = useRef(null);
  const animRef = useRef(null);

  // --- ×˜×¢×™× ×ª ×›×•×ª×¨×•×ª ---
  useEffect(() => {
    async function fetchHeadlines() {
      try {
        const url = `${API_URL}/api/articles?filters[$or][0][tags_txt][$contains]=×—×“×©× ×•×ª&filters[$or][1][tags_txt][$contains]=2025&filters[$or][2][tags_txt][$contains]=×—×•×§ ×•×¡×“×¨&sort=publishedAt:desc`;
        const res = await fetch(url);
        const data = await res.json();

        if (data?.data?.length > 0) {
          const mapped = data.data.map((article) => {
            const attrs = article.attributes || article;
            return {
              text: attrs.headline || attrs.title || "×›×ª×‘×” ×œ×œ× ×›×•×ª×¨×ª",
              link: `/articles/${attrs.slug}`,
            };
          });
          setHeadlines(mapped);
        }
      } catch (err) {
        console.error("âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª × ×™×•×–×˜×™×§×¨:", err);
      }
    }
    fetchHeadlines();
  }, []);

  // --- ××¤×§×˜ ×”×§×œ×“×” ---
  useEffect(() => {
    if (!headlines.length) return;

    const fullText = headlines[currentHeadline].text || "";
    setIsTyping(true);

    if (charIndex < fullText.length) {
      const timeout = setTimeout(() => {
        setDisplayedText(fullText.slice(0, charIndex + 1));
        setCharIndex((prev) => prev + 1);
      }, 60);
      return () => clearTimeout(timeout);
    } else {
      setIsTyping(false);
      const timeout = setTimeout(() => {
        setCharIndex(0);
        setDisplayedText('');
        setCurrentHeadline((prev) => (prev + 1) % headlines.length);
      }, 3000);
      return () => clearTimeout(timeout);
    }
  }, [charIndex, currentHeadline, headlines]);

  // --- ×”×–×–×” ×‘×–××Ÿ ×”×§×œ×“×” (RTL â†’ ×”×–×–×” ×™××™× ×”) ---
  useEffect(() => {
    if (!isTyping) return;
    if (!textRef.current || !containerRef.current) return;

    const textWidth = textRef.current.scrollWidth;
    const containerWidth = containerRef.current.clientWidth;

    if (textWidth > containerWidth) {
      const overflow = textWidth - containerWidth;
      setShiftX(overflow); // â† ×”×–×–×” ×™××™× ×” ×‘×¢×‘×¨×™×ª
    } else {
      setShiftX(0);
    }
  }, [displayedText]);

  // --- ××™×Ÿ ×ª× ×•×¢×” ××—×¨×™ ×¡×™×•× ×”×§×œ×“×” ---
  useEffect(() => {
    if (!isTyping) {
      cancelAnimationFrame(animRef.current);
    }
  }, [isTyping]);

  if (!headlines.length) return null;

  return (
    <div
      dir="rtl"
      className="sticky top-0 z-40 bg-[#e60000] w-full fixed top-[80px] z-[40] overflow-hidden"
      style={{ height: "20px" }}
    >
      <div className="relative flex items-center h-full px-2 text-white font-bold text-base md:text-lg whitespace-nowrap overflow-hidden">
        <span
          className="ml-2 text-sm shrink-0"
          style={{ height: "40px", lineHeight: "40px" }}
        >
          ××” ×—×“×©:
        </span>

        <div
          ref={containerRef}
          className="relative flex-1 text-sm overflow-hidden"
          style={{ height: "40px", lineHeight: "40px", direction: "rtl" }}
        >
          <Link
            ref={textRef}
            href={headlines[currentHeadline].link}
            prefetch={false}
            className="absolute right-0 top-0 transition-transform duration-75 ease-linear"
            style={{
              transform: `translateX(${shiftX}px)`,
              whiteSpace: "nowrap",
            }}
          >
            {displayedText}
            <span className="animate-pulse">|</span>
          </Link>
        </div>
      </div>
    </div>
  );
}


// components/SimilarArticles.jsx
'use client';
import React, { useEffect, useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import ArticleCard from '@/components/ArticleCards/ArticleCard';

const API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL || process.env.STRAPI_API_URL;
const PLACEHOLDER_IMG = '/default-image.jpg';

// ×¤×•× ×§×¦×™×” ×œ×ª×™×§×•×Ÿ ×›×ª×•×‘×ª ×ª××•× ×”
function resolveImageUrl(rawUrl) {
  if (!rawUrl) return PLACEHOLDER_IMG;
  if (rawUrl.startsWith('http')) return rawUrl;
  return `${API_URL}${rawUrl.startsWith('/') ? rawUrl : `/uploads/${rawUrl}`}`;
}

export default function SimilarArticles({ currentSlug, category }) {
  const [similar, setSimilar] = useState([]);
  const [currentGroup, setCurrentGroup] = useState(0);
  const [isMobile, setIsMobile] = useState(false);

  // ğŸ‘‰ Swipe states
  const [touchStartX, setTouchStartX] = useState(null);
  const [touchEndX, setTouchEndX] = useState(null);
  const handleSwipe = () => {
    if (!isMobile) return;
    const dx = touchEndX - touchStartX;
    // ×‘Ö¾RTL: ×”×—×œ×§×” ×©×××œ×” â†’ prev
    if (dx < -50) {
      prevGroup(); 
    }
    // ×‘Ö¾RTL: ×”×—×œ×§×” ×™××™× ×” â†’ next
    if (dx > 50) {
      prevGroup();
    }
  };

  // ×–×™×”×•×™ ××•×‘×™×™×œ
  useEffect(() => {
    const handleResize = () => setIsMobile(window.innerWidth < 768);
    handleResize();
    window.addEventListener('resize', handleResize);
    return () => window.removeEventListener('resize', handleResize);
  }, []);

  // ×©×œ×™×¤×ª ×›×ª×‘×•×ª ×“×•××•×ª
  useEffect(() => {
    async function fetchSimilarArticles() {
      try {
        const res = await fetch(
          `${API_URL}/api/articles?populate=*&filters[slug][$ne]=${currentSlug}&filters[category][$eq]=${category}`,
          { cache: 'no-store' }
        );
        const json = await res.json();
        const data = json.data || [];

        const mapped = data.map((a) => {
          let mainImage = PLACEHOLDER_IMG;
          let mainImageAlt = a.title || '×ª××•× ×” ×¨××©×™×ª';

          const galleryItem = a.gallery?.[0];
          if (galleryItem?.url) {
            mainImage = resolveImageUrl(galleryItem.url);
            mainImageAlt = galleryItem.alternativeText || mainImageAlt;
          } else if (a.image?.url) {
            mainImage = resolveImageUrl(a.image.url);
            mainImageAlt = a.image.alternativeText || mainImageAlt;
          } else if (
            Array.isArray(a.external_media_links) &&
            a.external_media_links.length > 0
          ) {
            const validLinks = a.external_media_links.filter(
              (l) => typeof l === 'string' && l.startsWith('http')
            );

            if (validLinks.length > 1) {
              mainImage = validLinks[1].trim();
            } else if (validLinks.length > 0) {
              mainImage = validLinks[0].trim();
            }

            mainImageAlt = '×ª××•× ×” ×¨××©×™×ª ××”××“×™×” ×”×—×™×¦×•× ×™×ª';
          }

          return {
            id: a.id,
            title: a.title,
            slug: a.slug,
            href: `/articles/${a.slug}`,
            headline: a.headline || a.title,
            description: a.description || '',
            date: a.date,
            image: mainImage,
            imageAlt: mainImageAlt,
          };
        });

        setSimilar(mapped);
      } catch (err) {
        console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ×›×ª×‘×•×ª ×“×•××•×ª:', err);
      }
    }

    fetchSimilarArticles();
  }, [currentSlug, category]);

  // ×—×œ×•×§×” ×œ×§×‘×•×¦×•×ª (3 ×œ×“×¡×§×˜×•×¤, 2 ×œ××•×‘×™×™×œ)
  const groupSize = isMobile ? 2 : 3;
  const groups = [];
  for (let i = 0; i < similar.length; i += groupSize) {
    groups.push(similar.slice(i, i + groupSize));
  }

  // ××¢×‘×¨ ××•×˜×•××˜×™ â€” ×¨×§ ×‘××—×©×‘
  useEffect(() => {
    if (isMobile) return;
    if (groups.length <= 1) return;

    const interval = setInterval(() => {
      setCurrentGroup((prev) => (prev + 1) % groups.length);
    }, 6000);

    return () => clearInterval(interval);
  }, [groups.length, isMobile]);

  if (!similar.length) return null;

  const nextGroup = () =>
    setCurrentGroup((prev) => (prev + 1) % groups.length);

  const prevGroup = () =>
    setCurrentGroup((prev) => (prev - 1 + groups.length) % groups.length);

  return (
    <div className="mt-10 relative bg-white p-4 rounded-md shadow-md">
      <h4 className="text-xl font-semibold mb-4 border-b border-gray-300 pb-2">
        ×›×ª×‘×•×ª ×“×•××•×ª
      </h4>

      <div className="overflow-hidden relative">
        <AnimatePresence mode="wait">
          <motion.div
            key={currentGroup}
            initial={{ x: 200, opacity: 0 }}
            animate={{ x: 0, opacity: 1 }}
            exit={{ x: -200, opacity: 0 }}
            transition={{ duration: 0.6 }}
            className={`grid ${
              isMobile ? 'grid-cols-2' : 'grid-cols-3'
            } gap-4`}
            
            // ğŸ‘‰ ×ª××™×›×” ×‘×”×—×œ×§×” ×‘××•×‘×™×™×œ
            onTouchStart={(e) => setTouchStartX(e.touches[0].clientX)}
            onTouchMove={(e) => setTouchEndX(e.touches[0].clientX)}
            onTouchEnd={handleSwipe}
          >
            {groups[currentGroup].map((article) => (
              <ArticleCard
                key={article.slug || article.id}
                article={article}
              />
            ))}
          </motion.div>
        </AnimatePresence>

        {groups.length > 1 && (
          <>
            <button
              onClick={nextGroup}
              className="absolute left-2 top-1/2 transform -translate-y-1/2
              bg-red-600/90 hover:bg-red-600/60 text-white p-3 rounded-full text-2xl transition"
              aria-label="×”×§×•×“×"
            >
              â€º
            </button>
            <button
              onClick={prevGroup}
              className="absolute right-2 top-1/2 transform -translate-y-1/2
              bg-red-600/90 hover:bg-red-600/60 text-white p-3 rounded-full text-2xl transition"
              aria-label="×”×‘×"
            >
              â€¹
            </button>
          </>
        )}
      </div>

      {groups.length > 1 && (
        <div className="flex justify-center space-x-2 mt-3">
          {groups.map((_, idx) => (
            <button
              key={idx}
              onClick={() => setCurrentGroup(idx)}
              className={`w-3 h-3 rounded-full transition ${
                idx === currentGroup ? 'bg-red-600' : 'bg-gray-400'
              }`}
            />
          ))}
        </div>
      )}
    </div>
  );
}




// âœ… app/articles/[slug]/page.jsx

export const revalidate = 180; // â¬…ï¸ ×”×©×™× ×•×™ ×”×™×—×™×“ ×©×‘×•×¦×¢
import Script from "next/script";
import PageContainer from "@/components/PageContainer";
import ArticleHeader from "@/components/ArticleHeader";
import SimpleKeyValueTable from "@/components/SimpleKeyValueTable";
import Tags from "@/components/Tags";
import SimilarArticles from "@/components/SimilarArticles";
import { notFound } from "next/navigation";
import CommentsSection from "@/components/CommentsSection";
import Gallery from "@/components/Gallery";
import { labelMap } from "@/utils/labelMap";
import InlineImage from "@/components/InlineImage";
import EmbedContent from "@/components/EmbedContent";
import ScrollToTableButton from "@/components/ScrollToTableButton";
import ScrollToGalleryButton from "@/components/ScrollToGalleryButton";
import ScrollToCommentsButton from "@/components/ScrollToCommentsButton";
import { fixRelativeImages, resolveImageUrl, wrapHondaProxy } from "@/lib/fixArticleImages";
import { getArticleImage } from "@/lib/getArticleImage";
import ArticleShareBottom from "@/components/ArticleShareBottom";




const API_URL = process.env.STRAPI_API_URL;
const PUBLIC_API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL || API_URL;
const SITE_URL = "https://www.onmotormedia.com";
const PLACEHOLDER_IMG = "/default-image.jpg";

// âœ… ×¤×•× ×§×¦×™×•×ª ×¢×–×¨ ×œ×§×™×©×•×¨×™× ×‘Ö¾Rich Text
function normalizeHref(href) {
  if (!href) return '#';
  if (/^https?:\/\//i.test(href) || href.startsWith('mailto:') || href.startsWith('tel:')) return href;
  return href.startsWith('/') ? href : `/${href}`;
}

function isExternal(href) {
  return /^https?:\/\//i.test(href);
}

function renderMarks(text, node) {
  let t = text ?? '';
  if (node?.bold) t = `<strong>${t}</strong>`;
  if (node?.italic) t = `<em>${t}</em>`;
  if (node?.underline) t = `<u>${t}</u>`;
  return t;
}

function toHtmlFromStrapiChildren(children) {
  if (!Array.isArray(children)) return '';
  return children.map((node) => {
    if (node?.type === 'link' || node?.url) {
      const href = normalizeHref(node.url || '#');
      const inner = node.children?.length
        ? toHtmlFromStrapiChildren(node.children)
        : renderMarks(node.text || '', node);
      const target = isExternal(href) ? '_blank' : '_self';
      const rel = isExternal(href) ? 'noopener noreferrer' : '';
      return `<a href="${href}" target="${target}" rel="${rel}" class="text-blue-600 underline hover:text-blue-800">${inner}</a>`;
    }
    if (typeof node?.text === 'string') return renderMarks(node.text, node);
    if (node?.children?.length) return toHtmlFromStrapiChildren(node.children);
    return '';
  }).join('');
}

export async function generateMetadata({ params }) {
  const API_URL = process.env.STRAPI_API_URL;
  const SITE_URL = "https://www.onmotormedia.com";

  try {
    const res = await fetch(
      `${API_URL}/api/articles?filters[slug][$eq]=${params.slug}&populate=*`,
      { next: { revalidate: 3600 } }
    );

    if (!res.ok) throw new Error(`API fetch failed with status ${res.status}`);
    const json = await res.json();
    const article = json.data?.[0];
    if (!article) return {};

    const title = article.title || "OnMotor Media";
    const description =
      article.headline ||
      article.description ||
      article.subdescription ||
      "×›×ª×‘×” ××ª×•×š ××’×–×™×Ÿ OnMotor Media";

    // ğŸ§  ×§×¨×™××” ×œ×¤×•× ×§×¦×™×” ×”× ×¤×¨×“×ª
    const imageUrl = getArticleImage(article);

    return {
      title: `${title} | OnMotor Media`,
      description,
      alternates: { canonical: `${SITE_URL}/articles/${params.slug}` },
      openGraph: {
        title,
        description,
        type: "article",
        locale: "he_IL",
        url: `${SITE_URL}/articles/${params.slug}`,
        siteName: "OnMotor Media",
        images: [{ url: imageUrl, width: 1200, height: 630, alt: title }],
      },
      twitter: {
        card: "summary_large_image",
        title,
        description,
        images: [imageUrl],
      },
    };
  } catch (err) {
    console.error("âš ï¸ Metadata generation error:", err);
    return {};
  }
}

// ===================================================================
//                       ArticlePage Component
// ===================================================================
export default async function ArticlePage({ params, setPageTitle, setPageBreadcrumbs }) {
  const res = await fetch(
    `${API_URL}/api/articles?filters[slug][$eq]=${params.slug}&populate=*`,
    { next: { revalidate: 3600 } }
  );

  const json = await res.json();
  const rawArticle = json.data?.[0];
  if (!rawArticle) return notFound();
  const data = rawArticle;

  const galleryItems = data.gallery?.data
    ? data.gallery.data.map((item) => item.attributes)
    : data.gallery || [];

  const gallery = galleryItems.map((img) => ({
    src: resolveImageUrl(img.url),
    alt: img.alternativeText || "×ª××•× ×” ××”×’×œ×¨×™×”",
  }));

  const externalImageUrls = Array.isArray(data.externalImageUrls)
    ? data.externalImageUrls
    : data.externalImageUrls
    ? [data.externalImageUrls]
    : [];

  const externalMediaUrl = data.externalMediaUrl || null;

  let mainImage = PLACEHOLDER_IMG;
  let mainImageAlt = "×ª××•× ×” ×¨××©×™×ª";

  if (galleryItems?.length > 0 && galleryItems[0]?.url) {
    mainImage = resolveImageUrl(galleryItems[0].url);
    mainImageAlt = galleryItems[0].alternativeText || "×ª××•× ×” ×¨××©×™×ª";
  } else if (data.image?.data?.attributes?.url) {
    mainImage = resolveImageUrl(data.image.data.attributes.url);
    mainImageAlt = data.image.data.attributes.alternativeText || "×ª××•× ×” ×¨××©×™×ª";
  } else if (
    Array.isArray(data.external_media_links) &&
    data.external_media_links.length > 1 &&
    typeof data.external_media_links[1] === "string" &&
    data.external_media_links[1].startsWith("http")
  ) {
    mainImage = resolveImageUrl(data.external_media_links[1].trim());
    mainImageAlt = "×ª××•× ×” ×¨××©×™×ª ××”××“×™×” ×”×—×™×¦×•× ×™×ª";
  } else if (
    Array.isArray(data.external_media_links) &&
    data.external_media_links.length > 0 &&
    typeof data.external_media_links[0] === "string" &&
    data.external_media_links[0].startsWith("http")
  ) {
    // fallback ×× ×™×© ×¨×§ ××—×“
    mainImage = resolveImageUrl(data.external_media_links[0].trim());
    mainImageAlt = "×ª××•× ×” ×¨××©×™×ª ××”××“×™×” ×”×—×™×¦×•× ×™×ª";
  }


  const article = {
    title: data.title || "×›×ª×‘×” ×œ×œ× ×›×•×ª×¨×ª",
    description: data.description || "",
    image: mainImage,
    imageAlt: mainImageAlt,
    author: data.author || "××¢×¨×›×ª OnMotor",
    date: data.date || "2025-06-22",
    time: data.time || "10:00",
    tags: data.tags || [],
    content: data.content || "",
    tableData: data.tableData || {},
    href: `/articles/${params.slug}`,
    category: data.category || "general",
    subcategory: Array.isArray(data.subcategory)
      ? data.subcategory[0]
      : data.subcategory,
    values: Array.isArray(data.Values)
      ? data.Values
      : data.Values
      ? [data.Values]
      : [],
    headline: data.headline || data.title,
    subdescription: data.subdescription || "",
    slug: params.slug,
    gallery,
    externalImageUrls,
    externalMediaUrl,
    external_media_links: data.external_media_links || [],
    font_family: data.font_family || "Heebo, sans-serif",
  };

    // ===============================
  // ğŸ“Œ Structured Data (JSON-LD)
  // ===============================
  const jsonLd = {
    "@context": "https://schema.org",
    "@type": "NewsArticle",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": `https://www.onmotormedia.com/articles/${article.slug}`
    },
    "headline": article.title,
    "description": article.description || article.subdescription || "",
    "image": [article.image],
    "author": {
      "@type": "Person",
      "name": article.author || "×¦×•×•×ª OnMotor"
    },
    "publisher": {
      "@type": "Organization",
      "name": "OnMotor Media",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.onmotormedia.com/OnMotorLogonoback.png"
      }
    },
    "datePublished": article.date,
    "dateModified": article.date,
    "inLanguage": "he-IL",
    "articleSection": article.category,
    "keywords": (article.tags || []).join(", "),
    "articleBody": typeof article.content === "string"
      ? article.content.substring(0, 500)
      : ""
  };


  const breadcrumbs = [{ label: "×“×£ ×”×‘×™×ª", href: "/" }];
  if (article.category)
    breadcrumbs.push({
      label: labelMap[article.category] || article.category,
      href: `/${article.category}`,
    });
  if (article.subcategory)
    breadcrumbs.push({
      label: labelMap[article.subcategory] || article.subcategory,
      href: `/${article.category}/${article.subcategory}`,
    });
  if (article.values?.length > 0) {
    const valueKey = article.values[0];
    breadcrumbs.push({
      label: labelMap[valueKey] || valueKey,
      href: `/${article.category}/${article.subcategory}/${valueKey}`,
    });
  }
  breadcrumbs.push({ label: article.title });
  
  


  // âœ… ×¨×™× ×“×•×¨ ×¤×¡×§××•×ª (×›×•×œ×œ Honda + YouTube)
  const renderParagraph = (block, i) => {
    if (typeof block === "string") {
      const cleanText = fixRelativeImages(block.trim());
      const hasHTMLTags = /<\/?[a-z][\s\S]*>/i.test(cleanText);

      if (hasHTMLTags) {
        return (
          <div
            key={i}
            className="article-text text-gray-800 text-[18px] leading-relaxed"
            dangerouslySetInnerHTML={{
              __html: cleanText.replace(
                /(https:\/\/hondanews\.eu[^\s"'<>]+)/gi,
                (match) => wrapHondaProxy(match)
              ),
            }}
          />
        );
      }

      const urlMatch = cleanText.match(/https?:\/\/[^\s]+/);
      if (urlMatch) {
        let url = urlMatch[0].trim();
        if (url.includes("hondanews.eu")) url = wrapHondaProxy(url);
        // âœ… ×ª××™×›×” ×‘×§×™×©×•×¨×™ Kawasaki
        else if (url.includes("content2.kawasaki.com")) {
          // ×× ×§×” ×¤×¨××˜×¨×™× ×›××• ?w=400 ××”×›×ª×•×‘×ª
          url = url.split("?")[0];
        }


        if (
          /\.(jpg|jpeg|png|gif|webp)$/i.test(url) ||
          url.includes("hondanews.eu/image/") ||
          url.includes("/api/proxy-honda?")
        ) {
          return (
            <InlineImage
              key={i}
              src={url}
              alt="×ª××•× ×” ××ª×•×š ×”×›×ª×‘×”"
              caption=""
            />
          );
        }

        if (
          /(youtube\.com|youtu\.be|facebook\.com|instagram\.com|tiktok\.com|x\.com|twitter\.com)/i.test(
            url
          )
        ) {
          return <EmbedContent key={i} url={url} />;
        }

        return (
          <p key={i} className="article-text text-blue-600 underline">
            <a href={url} target="_blank" rel="noopener noreferrer">
              {url}
            </a>
          </p>
        );
      }

      return (
        <p
          key={i}
          className="article-text text-gray-800 text-[18px] leading-relaxed"
          dangerouslySetInnerHTML={{
            __html: cleanText.replace(/\n/g, "<br/>"),
          }}
        />
      );
    }

    if (block.type === "paragraph" && block.children) {
      let html = toHtmlFromStrapiChildren(block.children);
      html = fixRelativeImages(html);

      const urlMatch = html.match(/https?:\/\/[^\s"']+/);
      if (urlMatch) {
        let url = urlMatch[0];
        if (url.includes("hondanews.eu")) url = wrapHondaProxy(url);
        // âœ… ×ª××™×›×” ×‘×§×™×©×•×¨×™ Kawasaki
        else if (url.includes("content2.kawasaki.com")) {
          // ×× ×§×” ×¤×¨××˜×¨×™× ×›××• ?w=400 ××”×›×ª×•×‘×ª
          url = url.split("?")[0];
        }


        if (
          /\.(jpg|jpeg|png|gif|webp)$/i.test(url) ||
          url.includes("hondanews.eu/image/") ||
          url.includes("/api/proxy-honda?") ||
          url.includes("content2.kawasaki.com/ContentStorage/")


        ) {
          return (
            <InlineImage
              key={i}
              src={url}
              alt="×ª××•× ×” ××ª×•×š ×”×›×ª×‘×”"
              caption=""
            />
          );
        }

        if (
          /(youtube\.com|youtu\.be|facebook\.com|instagram\.com|tiktok\.com|x\.com|twitter\.com)/i.test(
            url
          )
        ) {
          return <EmbedContent key={i} url={url} />;
        }
      }

      return (
        <p
          key={i}
          className="article-text text-gray-800 text-[18px] leading-relaxed"
          dangerouslySetInnerHTML={{
            __html: html.replace(
              /(https:\/\/hondanews\.eu[^\s"'<>]+)/gi,
              (match) => wrapHondaProxy(match)
            ),
          }}
        />
      );
    }

        // âœ… ×˜×™×¤×•×œ ×‘×¨×©×™××•×ª (×××•×¡×¤×¨×•×ª ××• × ×§×•×“×ª×™×•×ª)
    if (block.type === "list") {
      const isOrdered = block.format === "ordered";
      const Tag = isOrdered ? "ol" : "ul";
      return (
        <Tag
          key={i}
          dir="rtl"
          className={`my-3 pr-6 space-y-1 text-[18px] text-gray-800 leading-relaxed ${
            isOrdered ? "list-decimal" : "list-disc"
          }`}
        >
          {block.children?.map((item, idx) => {
            const html = toHtmlFromStrapiChildren(item.children || []);
            return (
              <li
                key={idx}
                dangerouslySetInnerHTML={{
                  __html: fixRelativeImages(html),
                }}
              />
            );
          })}
        </Tag>
      );
    }




    if (block.type === "heading") {
      const level = block.level || 2;
      const Tag = `h${Math.min(level, 3)}`;
      const text = block.children?.map((c) => c.text).join("") || "";
      return (
        <Tag
          key={i}
          className="font-bold text-2xl text-gray-900 mt-4 mb-2"
          dangerouslySetInnerHTML={{ __html: fixRelativeImages(text) }}
        />
      );
    }

    if (block.type === "image") {
      const imageData =
        block.image?.data?.attributes || block.image?.attributes || block.image;
      if (!imageData?.url) return null;
      const alt = imageData.alternativeText || "×ª××•× ×” ××ª×•×š ×”×›×ª×‘×”";
      const caption = imageData.caption || "";
      const src = resolveImageUrl(imageData.url);
      return (
        <InlineImage key={i} src={src} alt={alt} caption={caption} />
      );
    }

    return null;
  };


  const paragraphs = Array.isArray(article.content)
    ? article.content
    : article.content.split("\n\n");

  return (
    <>
      <Script
            id="structured-data"
            type="application/ld+json"
            dangerouslySetInnerHTML={{ __html: JSON.stringify(jsonLd) }}
      />


      <PageContainer title={article.title} breadcrumbs={breadcrumbs}>
        <div
          className="mx-auto max-w-[740px] space-y-2 text-right leading-relaxed text-base text-gray-800 px-2"
          style={{ fontFamily: article.font_family }}
        >
          <ArticleHeader
            author={article.author}
            date={article.date}
            time={article.time}
            image={article.image}
            imageAlt={article.imageAlt}
            title={article.headline}
            subdescription={article.subdescription}
            tags={article.tags}
          />

          {article.description && (
            <p className="font-bold text-2xl text-gray-600">{article.description}</p>
          )}
          
          <div className="article-content">
            {paragraphs.map(renderParagraph)}
          </div>
          {article.tableData && (
            <div className="article-table-section">
              <SimpleKeyValueTable data={article.tableData} />
            </div>
          )}

          <div className="article-gallery-section">
            <Gallery
              images={article.gallery}
              externalImageUrls={article.externalImageUrls}
              externalMediaUrl={article.externalMediaUrl}
              external_media_links={article.external_media_links}
            />
          </div>
          <ArticleShareBottom />
          <div className="comments-section">
            <CommentsSection articleUrl={`${SITE_URL}${article.href}`} />
          </div>

          <Tags tags={article.tags} />
          <div className="similar-articles-section">
            <SimilarArticles currentSlug={article.slug} category={article.category} />
          </div>

          
          
          
        </div>
      </PageContainer>
      <ScrollToTableButton />
      <ScrollToGalleryButton />
      <ScrollToCommentsButton />
    </>
  );
}


// components/SidebarFixed.jsx
'use client';

import { useEffect, useState, useRef } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import ResponsiveBoxGrid from './ResponsiveBoxGrid';
import BoxWrapper from './BoxWrapper';

const API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL;

/* âœ… ×¤×•× ×§×¦×™×” ×××•×—×“×ª ×œ×–×™×”×•×™ ×›×ª×•×‘×ª ××“×™×” (Cloudinary / Strapi / ×—×™×¦×•× ×™) */
function resolveMediaUrl(rawUrl) {
  if (!rawUrl) return null;
  if (rawUrl.startsWith('http')) return rawUrl;
  return `${API_URL}${rawUrl.startsWith('/') ? rawUrl : `/uploads/${rawUrl}`}`;
}

/* âœ… ×¤×•× ×§×¦×™×” ×œ× ×¨××•×œ ×œ×™× ×§×™× ×-Google Drive */
function normalizeDriveUrl(url) {
  if (!url) return url;

  // ×× ×–×” ID ×‘×œ×‘×“
  if (/^[a-zA-Z0-9_-]{20,}$/.test(url)) {
    return `/api/drive-proxy?id=${url}`;
  }

  // ×× ×–×” ×œ×™× ×§ ×¨×’×™×œ ×©×œ ×“×¨×™×™×‘
  if (url.includes('drive.google.com/file/d/')) {
    const match = url.match(/\/d\/([^/]+)/);
    if (match && match[1]) {
      return `/api/drive-proxy?id=${match[1]}`;
    }
  }

  return url;
}

export default function SidebarFixed() {
  const [ads, setAds] = useState([]);
  const [currentIndex, setCurrentIndex] = useState(0);
  const hasFetched = useRef(false);

  /* âœ… ×˜×¢×™× ×ª ××•×“×¢×•×ª ×-Strapi â€“ ×¤×¢× ××—×ª ×‘×œ×‘×“ ×‘×§×œ×™×™× ×˜ */
  useEffect(() => {
    if (!API_URL) {
      console.error('âŒ NEXT_PUBLIC_STRAPI_API_URL ×œ× ××•×’×“×¨');
      return;
    }
    if (hasFetched.current) return;
    hasFetched.current = true;

    async function fetchAds() {
      try {
        const res = await fetch(
          `${API_URL}/api/sidebar-middles?populate=image&populate=video`
        );

        if (!res.ok) {
          console.error('âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª sidebar-middle:', res.status);
          return;
        }

        const json = await res.json();

        const items =
          json.data?.map((item) => ({
            id: item.id,
            ...item.attributes,
          })) || [];

        setAds(items);
      } catch (err) {
        console.error('âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª sidebar-middle:', err);
      }
    }

    fetchAds();
  }, []);

  /* âœ… ×§×¨×•×¡×œ×” ××ª×—×œ×¤×ª ×›×œ 5 ×©× ×™×•×ª */
  useEffect(() => {
    if (ads.length > 2) {
      const interval = setInterval(() => {
        setCurrentIndex((prev) => (prev + 2) % ads.length);
      }, 5000);
      return () => clearInterval(interval);
    }
  }, [ads]);

  /* âœ… ×”×—×–×¨×ª ××•×“×¢×” ×œ×¤×™ ××™× ×“×§×¡ */
  const getAdAt = (index) => {
    if (!ads.length) return null;
    return ads[index % ads.length];
  };

  /* âœ… ×›×¨×˜×™×¡ ××•×“×¢×” ×¢× ×œ×•×’×™×§×ª ×ª××•× ×” ×—×“×©×” */
  const AdCard = ({ ad }) => {
    if (!ad) return null;

    const attrs = ad; // ×›×‘×¨ ×©×˜×•×— (id + attributes)

    // × ×•×¨××œ×™×–×¦×™×” ×©×œ ×›×œ ×”× ×ª×™×‘×™×
    const driveUrl = normalizeDriveUrl(attrs.mediaUrl || null);

    // ×ª××•× ×” ×-Strapi (Cloudinary ××• ×™×—×¡×™×ª)
    const imageUrl = Array.isArray(attrs.image) && attrs.image.length > 0
      ? resolveMediaUrl(attrs.image[0].url)
      : resolveMediaUrl(attrs.image?.url);

    // ×•×™×“××• ×-Strapi
    const videoUrl = Array.isArray(attrs.video) && attrs.video.length > 0
      ? resolveMediaUrl(attrs.video[0].url)
      : resolveMediaUrl(attrs.video?.url);

    // âœ… ×¡×“×¨ ×¢×“×™×¤×•×™×•×ª: mediaUrl (×“×¨×™×™×‘/×—×™×¦×•× ×™) > video > image
    let finalUrl = driveUrl || videoUrl || imageUrl;
    let isVideo =
      (finalUrl && finalUrl.endsWith('.mp4')) ||
      finalUrl?.includes('youtube') ||
      finalUrl?.includes('vimeo');

    let content = null;

    if (!finalUrl) {
      content = (
        <div className="w-full h-full bg-gray-800 flex items-center justify-center text-white">
          ××™×Ÿ ××“×™×” ×–××™× ×”
        </div>
      );
    } else if (isVideo) {
      content = (
        <video
          src={finalUrl}
          autoPlay
          loop
          muted
          playsInline
          className="w-full h-full object-cover"
        />
      );
    } else {
      content = (
        <img
          src={finalUrl}
          alt={attrs.title || 'ad'}
          className="w-full h-full object-cover"
          loading="lazy"
        />
      );
    }

    return (
      <div className="border-[3px] border-[#e60000] rounded-xl overflow-hidden shadow-xl bg-black transition-all hover:shadow-[#e60000]/50">
        <div className="w-full aspect-[16/8]">{content}</div>

        {/* ×›×¤×ª×•×¨×™× */}
        <div className="flex justify-center gap-2 p-3">
          {attrs.link && (
            <a
              href={attrs.link}
              target="_blank"
              rel="noopener noreferrer"
              className="relative bg-gradient-to-r from-[#1f1f1f] to-[#3a3a3a] text-white font-bold px-4 py-2 rounded-lg text-center text-sm transition-all duration-300 hover:scale-105 hover:from-[#e60000] hover:to-[#b50000]"
            >
              {attrs.title ? attrs.title : '×œ××ª×¨ ×”××¤×¨×¡×'}
            </a>
          )}
          {attrs.slug && (
            <a
              href={`/articles/${attrs.slug}`}
              className="bg-[#e60000] text-white px-3 py-2 rounded-md hover:bg-[#b50000] text-sm transition-all duration-300"
            >
              ×œ×›×ª×‘×”
            </a>
          )}
        </div>
      </div>
    );
  };

  return (
    <div className="relative bg-gray-900 py-4 sticky top-25">
      <ResponsiveBoxGrid>
        <BoxWrapper>
          <div className="overflow-hidden flex flex-col gap-4">
            <AnimatePresence mode="wait">
              <motion.div
                key={currentIndex}
                initial={{ y: 50, opacity: 0 }}
                animate={{ y: 0, opacity: 1 }}
                exit={{ y: -50, opacity: 0 }}
                transition={{ duration: 1 }}
              >
                <AdCard ad={getAdAt(currentIndex)} />
              </motion.div>
              <motion.div
                key={currentIndex + 1}
                initial={{ y: 50, opacity: 0 }}
                animate={{ y: 0, opacity: 1 }}
                exit={{ y: -50, opacity: 0 }}
                transition={{ duration: 1, delay: 0.1 }}
              >
                <AdCard ad={getAdAt(currentIndex + 1)} />
              </motion.div>
            </AnimatePresence>
          </div>
        </BoxWrapper>
      </ResponsiveBoxGrid>
    </div>
  );
}


// components/CategoryPage.jsx
'use client';
import React, { useEffect, useState } from 'react';
import SectionWithHeader from './SectionWithHeader';
import LimitedArticles from './LimitedArticles';
import { labelMap } from '@/utils/labelMap';

const API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL || process.env.STRAPI_API_URL;
const PLACEHOLDER_IMG = '/default-image.jpg';

// âœ… ×¤×•× ×§×¦×™×” ×©××•×•×“××ª ×›×ª×•×‘×ª ×ª×§×™× ×” ×œ×ª××•× ×” (×›×•×œ×œ Cloudinary)
function resolveImageUrl(rawUrl) {
  if (!rawUrl) return PLACEHOLDER_IMG;
  if (rawUrl.startsWith('http')) return rawUrl;
  return `${API_URL}${rawUrl.startsWith('/') ? rawUrl : `/uploads/${rawUrl}`}`;
}

// ×§×™×‘×•×¥ ×œ×¤×™ ×ª×ªÖ¾×§×˜×’×•×¨×™×•×ª ×¨×’×™×œ×•×ª
function groupBySubcategory(articles) {
  return articles.reduce((acc, article) => {
    const subcategories = Array.isArray(article.subcategory)
      ? article.subcategory
      : [article.subcategory];

    subcategories.forEach((subcat) => {
      if (!acc[subcat]) acc[subcat] = [];
      acc[subcat].push(article);
    });

    return acc;
  }, {});
}

// ×§×™×‘×•×¥ ×œ×¤×™ Values (×œ×ª×ª×™Ö¾×ª×ª×™Ö¾×§×˜×’×•×¨×™×•×ª ×©×œ ××“×¨×™×›×™×)
function groupByValues(articles) {
  return articles.reduce((acc, article) => {
    const values = Array.isArray(article.Values)
      ? article.Values
      : [article.Values];

    values.forEach((val) => {
      if (!acc[val]) acc[val] = [];
      acc[val].push(article);
    });

    return acc;
  }, {});
}

export default function CategoryPage({ categoryKey = ' ', subcategoryKey = null, guideSubKey = null }) {
  const [articles, setArticles] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    async function fetchArticles() {
      try {
        let url = `${API_URL}/api/articles?populate=*`;

        // âœ… ×¡×™× ×•×Ÿ ×œ×¤×™ ×§×˜×’×•×¨×™×” ×¨××©×™×ª
        if (categoryKey) {
          url += `&filters[category][$eq]=${categoryKey}`;
        }

        const res = await fetch(url);
        const json = await res.json();
        let data = json.data || [];

        // âœ… ×¡×™× ×•×Ÿ ×‘×¦×“ ×”×œ×§×•×— ×œ×¤×™ ×ª×ªÖ¾×§×˜×’×•×¨×™×”
        if (subcategoryKey) {
          data = data.filter((a) => {
            const sub = a.subcategory;
            if (!sub) return false;
            if (Array.isArray(sub)) return sub.includes(subcategoryKey);
            if (typeof sub === 'string') return sub.includes(subcategoryKey);
            return false;
          });
        }

        // âœ… ×¡×™× ×•×Ÿ ×œ×¤×™ Values
        if (guideSubKey) {
          data = data.filter((a) => {
            const vals = a.Values;
            if (!vals) return false;
            if (Array.isArray(vals)) return vals.includes(guideSubKey);
            if (typeof vals === 'string') return vals.includes(guideSubKey);
            return false;
          });
        }

        // âœ… ××™×¤×•×™ ×›×ª×‘×•×ª ×¢× ×œ×•×’×™×§×ª ×ª××•× ×” ××—×™×“×”
        const mapped = data.map((a) => {
          let mainImage = PLACEHOLDER_IMG;
          let mainImageAlt = a.title || '×ª××•× ×” ×¨××©×™×ª';

          // 1ï¸âƒ£ ×’×œ×¨×™×”
          const galleryItem = a.gallery?.[0];
          if (galleryItem?.url) {
            mainImage = resolveImageUrl(galleryItem.url);
            mainImageAlt = galleryItem.alternativeText || mainImageAlt;
          }
          // 2ï¸âƒ£ ×ª××•× ×” ×¨××©×™×ª
          else if (a.image?.url) {
            mainImage = resolveImageUrl(a.image.url);
            mainImageAlt = a.image.alternativeText || mainImageAlt;
          }
          // 3ï¸âƒ£ external_media_links
          else if (Array.isArray(a.external_media_links) && a.external_media_links.length > 0) {
            const validLinks = a.external_media_links.filter(
              (l) => typeof l === 'string' && l.startsWith('http')
            );
            if (validLinks.length > 1) {
              mainImage = validLinks[1].trim(); // ×”×©× ×™
            } else if (validLinks.length > 0) {
              mainImage = validLinks[0].trim(); // ×”×¨××©×•×Ÿ
            }
            mainImageAlt = '×ª××•× ×” ×¨××©×™×ª ××”××“×™×” ×”×—×™×¦×•× ×™×ª';
          }

          return {
            id: a.id,
            title: a.title,
            slug: a.slug,
            image: mainImage,
            imageAlt: mainImageAlt,
            category: a.category || 'general',
            subcategory: Array.isArray(a.subcategory)
              ? a.subcategory
              : [a.subcategory ?? 'general'],
            Values: Array.isArray(a.Values)
              ? a.Values
              : [a.Values ?? null],
            description: a.description,
            headline: a.headline || a.title,
            subdescription: a.subdescription,
            href: `/articles/${a.slug}`,
            tags: a.tags || [],
            date: a.date || '',
            time: a.time || '00:00',
          };
        });

        // âœ… ××™×•×Ÿ ××”×—×“×© ×œ×™×©×Ÿ
        const sorted = mapped.sort((a, b) => {
          const aDateTime = new Date(`${a.date}T${a.time}`);
          const bDateTime = new Date(`${b.date}T${b.time}`);
          return bDateTime - aDateTime;
        });

        setArticles(sorted);
      } catch (err) {
        console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ×›×ª×‘×•×ª:', err);
      } finally {
        setLoading(false);
      }
    }

    fetchArticles();
  }, [categoryKey, subcategoryKey, guideSubKey]);

  if (loading) {
    return <p className="text-center text-gray-500">×˜×•×¢×Ÿ ×›×ª×‘×•×ª...</p>;
  }

  if (articles.length === 0) {
    return <p className="text-center text-gray-500">××™×Ÿ ×¢×“×™×™×Ÿ ×›×ª×‘×•×ª ×‘×§×˜×’×•×¨×™×” ×–×•</p>;
  }

  // âœ… ×œ×•×’×™×§×ª ×§×™×‘×•×¥
  const grouped =
    guideSubKey
      ? { [guideSubKey]: articles }
      : subcategoryKey === 'guides'
        ? groupByValues(articles)
        : subcategoryKey
          ? { [subcategoryKey]: articles }
          : groupBySubcategory(articles);

  const hebTitle = guideSubKey
    ? `${labelMap['guides']} - ${labelMap[guideSubKey] || guideSubKey}`
    : subcategoryKey
      ? labelMap[subcategoryKey] || subcategoryKey
      : labelMap[categoryKey] || categoryKey;

  const shouldShowMainTitle =
    subcategoryKey !== null || guideSubKey !== null || Object.keys(grouped).length === 1;

  return (
    <div className="max-w-screen-xl mx-auto px-0">
      <div className="flex flex-col gap-0" dir="rtl">
        {!subcategoryKey && !guideSubKey && shouldShowMainTitle && (
          <SectionWithHeader
            title={hebTitle}
            href={`/${categoryKey}`}
            variant="main"
          />
        )}

        {Object.entries(grouped).map(([subKey, subArticles]) => (
          <div key={subKey} className="bg-white shadow">
            {!guideSubKey && Object.keys(grouped).length > 1 && (
              <SectionWithHeader
                title={labelMap[subKey] || subKey}
                href={
                  subcategoryKey === 'guides'
                    ? `/${categoryKey}/${subcategoryKey}/${subKey}`
                    : `/${categoryKey}/${subKey}`
                }
                variant="category"
              />
            )}

            <LimitedArticles articles={subArticles} initialCount={2} />
          </div>
        ))}
      </div>
    </div>
  );
}



// utils/resolveMainImage.js
import { resolveImageUrl } from "@/lib/fixArticleImages";

const PLACEHOLDER_IMG = "/default-image.jpg";

/**
 * ×‘×•×—×¨ ×ª××•× ×” ×¨××©×™×ª ×œ×›×ª×‘×” ×œ×¤×™ ×¡×“×¨ ×¢×“×™×¤×•×ª:
 * 1. ×ª××•× ×” ×©×œ×™×©×™×ª ×‘×’×œ×¨×™×”
 * 2. ×ª××•× ×” ×¨××©×•× ×” ×‘×’×œ×¨×™×”
 * 3. ×ª××•× ×” ××”×©×“×” image
 * 4. ×§×™×©×•×¨ ×—×™×¦×•× ×™ ××ª×•×š external_media_links
 * 5. ×‘×¨×™×¨×ª ××—×“×œ
 */
export function getMainImage(attrs = {}) {
  let mainImage = PLACEHOLDER_IMG;
  let mainImageAlt = attrs.title || "×ª××•× ×” ×¨××©×™×ª";

  // 1ï¸âƒ£ × ×™×¡×™×•×Ÿ: ×ª××•× ×” ×©×œ×™×©×™×ª ×‘×’×œ×¨×™×”
  if (attrs.gallery?.[2]?.url) {
    mainImage = resolveImageUrl(attrs.gallery[2].url);
    mainImageAlt = attrs.gallery[2].alternativeText || mainImageAlt;
  }
  // 2ï¸âƒ£ × ×™×¡×™×•×Ÿ: ×ª××•× ×” ×¨××©×•× ×” ×‘×’×œ×¨×™×”
  else if (attrs.gallery?.[0]?.url) {
    mainImage = resolveImageUrl(attrs.gallery[0].url);
    mainImageAlt = attrs.gallery[0].alternativeText || mainImageAlt;
  }
  // 3ï¸âƒ£ × ×™×¡×™×•×Ÿ: image
  else if (attrs.image?.data?.attributes?.url) {
    mainImage = resolveImageUrl(attrs.image.data.attributes.url);
    mainImageAlt = attrs.image.data.attributes.alternativeText || mainImageAlt;
  }
  else if (attrs.image?.url) {
    mainImage = resolveImageUrl(attrs.image.url);
    mainImageAlt = attrs.image.alternativeText || mainImageAlt;
  }
  // 4ï¸âƒ£ × ×™×¡×™×•×Ÿ: ×§×™×©×•×¨×™× ×—×™×¦×•× ×™×™×
  else if (Array.isArray(attrs.external_media_links) && attrs.external_media_links.length > 0) {
    const valid = attrs.external_media_links
      .filter((l) => typeof l === "string" && l.startsWith("http"))
      .map((s) => s.trim());

    if (valid.length > 1) {
      mainImage = resolveImageUrl(valid[1]);
    } else if (valid.length > 0) {
      mainImage = resolveImageUrl(valid[0]);
    }

    mainImageAlt = "×ª××•× ×” ××”××“×™×” ×”×—×™×¦×•× ×™×ª";
  }

  return { mainImage, mainImageAlt };
}


// components/TabLeftSidebar.jsx
'use client';
import React, { useState, useEffect, useRef } from 'react';
import Image from 'next/image';
import useIsMobile from '@/hooks/useIsMobile';
import { getMainImage } from '@/utils/resolveMainImage';

const tabs = ['××—×¨×•× ×™×', '×‘×“×¨×›×™×', '×¤×•×¤×•×œ×¨×™'];
const API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL;

/* ğŸ‘‡ ×¤×•× ×§×¦×™×” ×©××•×¦×™××” ×©× ××ª×¨ × ×§×™ ××ª×•×š ×›×ª×•×‘×ª */
function extractDomainName(url) {
  try {
    const host = new URL(url).hostname.replace('www.', '');
    const parts = host.split('.');
    let base = '';
    if (parts.length >= 3 && ['co', 'org', 'net'].includes(parts[parts.length - 2])) {
      base = parts[parts.length - 3];
    } else {
      base = parts[0];
    }
    return base.charAt(0).toUpperCase() + base.slice(1);
  } catch {
    return 'Website';
  }
}

export default function TabLeftSidebar() {
  const isMobile = useIsMobile();
  const [hasInteracted, setHasInteracted] = useState(false);
  const scrollContainerRef = useRef(null);
  const sidebarRef = useRef(null);

  const [activeTab, setActiveTab] = useState('××—×¨×•× ×™×');
  const [latestArticles, setLatestArticles] = useState([]);
  const [onRoadArticles, setOnRoadArticles] = useState([]);
  const [popularContent, setPopularContent] = useState([]);
  const [isPaused, setIsPaused] = useState(false);

  /* âœ… normalizeItem â€“ ×¢×›×©×™×• ×¢× getMainImage() */
  const normalizeItem = (obj, type = 'article') => {
    const a = obj.attributes || obj;

    // ×§×‘×™×¢×ª ××§×•×¨ (YouTube, TikTok ×•×›×•â€™)
    let autoSource = '';
    if (a.url) {
      if (a.url.includes('youtube.com') || a.url.includes('youtu.be')) autoSource = 'YouTube';
      else if (a.url.includes('tiktok.com')) autoSource = 'TikTok';
      else if (a.url.includes('instagram.com')) autoSource = 'Instagram';
      else if (a.url.includes('facebook.com')) autoSource = 'Facebook';
      else autoSource = extractDomainName(a.url);
    }

    // âœ… ×©×™××•×© ×‘×¤×•× ×§×¦×™×” ×”××¨×›×–×™×ª ×œ×‘×—×™×¨×ª ×ª××•× ×”
    const { mainImage } = getMainImage(a);

    return {
      id: obj.id,
      title: a.title || a.name || '',
      slug: a.slug || '',
      description: a.description || '',
      image: mainImage,
      date: a.date?.split('T')[0] || a.publishedAt?.split('T')[0] || '',
      url: a.url || '',
      views: a.views ?? null,
      source: a.source || autoSource,
    };
  };

  /* âœ… ×©×œ×™×¤×•×ª ××”Ö¾API */
  useEffect(() => {
    const fetchLatest = async () => {
      try {
        const res = await fetch(`${API_URL}/api/articles?sort=date:desc&populate=*`);
        const data = (await res.json()).data || [];
        setLatestArticles(data.map((a) => normalizeItem(a, 'latest-article')));
      } catch (err) {
        console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ××—×¨×•× ×™×:', err);
      }
    };

    const fetchOnRoad = async () => {
      try {
        const res = await fetch(`${API_URL}/api/articles?filters[tags_txt][$contains]=iroads&sort=date:desc&populate=*`);
        const data = (await res.json()).data || [];
        setOnRoadArticles(data.map((a) => normalizeItem(a, 'onroad-article')));
      } catch (err) {
        console.error("×©×’×™××” ×‘×˜×¢×™× ×ª '×‘×“×¨×›×™×':", err);
      }
    };

    const fetchPopular = async () => {
      try {
        const res = await fetch(`${API_URL}/api/populars?sort=date:desc&populate=*`);
        const data = (await res.json()).data || [];

        const withPreview = await Promise.all(
          data.map(async (item) => {
            const norm = normalizeItem(item, 'popular');

            if (norm.image && norm.image !== '/default-image.jpg') return norm;

            // × ×¡×” ×œ×”×‘×™× ×ª×¦×•×’×” ××§×“×™××” (metadata) ×× ××™×Ÿ ×ª××•× ×”
            if (norm.url) {
              try {
                const previewRes = await fetch(`/api/preview?url=${encodeURIComponent(norm.url)}`);
                const previewJson = await previewRes.json();
                if (previewJson?.image) norm.image = previewJson.image;
              } catch (err) {
                console.error('Preview fetch error:', err);
              }
            }

            if (!norm.image) norm.image = '/default-image.jpg';
            return norm;
          })
        );

        setPopularContent(withPreview);
      } catch (err) {
        console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ×¤×•×¤×•×œ×¨×™:', err);
      }
    };

  

    

    fetchLatest();
    fetchOnRoad();
    fetchPopular();
  }, []);

  /* âœ… ×’×œ×™×œ×” ×× ×›×™×ª ××ª××©×›×ª */
  useEffect(() => {
    if (isMobile) return;
    const container = scrollContainerRef.current;
    if (!container) return;

    const speed = 1;
    let frame;
    const step = () => {
      if (!isPaused) {
        container.scrollTop += speed;
        if (container.scrollTop >= container.scrollHeight - container.clientHeight) {
          container.scrollTop = 0;
        }
      }
      frame = requestAnimationFrame(step);
    };
    frame = requestAnimationFrame(step);
    return () => cancelAnimationFrame(frame);
  }, [activeTab, isPaused, isMobile]);

  useEffect(() => {
    if (!isMobile || !sidebarRef.current || !hasInteracted) return;
    setTimeout(() => {
      const y = sidebarRef.current.getBoundingClientRect().top + window.scrollY - 100;
      window.scrollTo({ top: y, behavior: 'smooth' });
    }, 0);
  }, [activeTab, isMobile, hasInteracted]);

  /* âœ… ×¨×™× ×“×•×¨ ×”×¤×¨×™×˜×™× ×œ×¤×™ ×˜××‘ */
  const getStyledContent = (items) => {
    return items.map((item, i) => {
      const even = i % 2 === 0;
      const bg = even ? 'bg-red-50 text-black' : 'bg-neutral-900 text-white';
      return (
        <a
          key={item.id}
          href={item.url || (item.slug ? `/articles/${item.slug}` : '#')}
          target={item.url ? '_blank' : '_self'}
          rel={item.url ? 'noopener noreferrer' : ''}
          className={`flex gap-2 items-start p-1 rounded transition-transform duration-200 ${bg} hover:scale-[1.03] hover:shadow-sm`}
        >
          <div className="w-20 h-14 relative rounded overflow-hidden flex-shrink-0">
            <Image
              src={item.image || '/default-image.jpg'}
              alt={item.title}
              fill
              style={{ objectFit: 'cover' }}
              className="rounded"
            />
          </div>
          <div className="flex flex-col text-right">
            <p className="font-bold text-sm line-clamp-1">{item.title}</p>
            <p className={`text-xs ${even ? 'text-gray-700' : 'text-gray-300'} line-clamp-2`}>
              {item.description}
            </p>
            {item.date && (
              <span className={`text-xs ${even ? 'text-gray-500' : 'text-gray-400'} mt-1`}>
                {item.date}
              </span>
            )}
            {(item.views || item.source) && (
              <span className="text-xs text-gray-400 mt-1">
                {item.views ? `${item.views} ×¦×¤×™×•×ª` : ''}
                {item.views && item.source ? ' Â· ' : ''}
                {item.source || ''}
              </span>
            )}
          </div>
        </a>
      );
    });
  };

  let content = [];
  if (activeTab === '××—×¨×•× ×™×') content = getStyledContent(latestArticles);
  else if (activeTab === '×‘×“×¨×›×™×') content = getStyledContent(onRoadArticles);
  else if (activeTab === '×¤×•×¤×•×œ×¨×™') content = getStyledContent(popularContent);
  else content = getStyledContent(viralContent);

  return (
    <div
      ref={sidebarRef}
      className={`flex flex-col min-h-0 bg-white shadow-md w-full text-sm ${isMobile ? 'w-screen rounded-none' : ''}`}
    >
      <div
        className="flex border-b text-sm font-semibold bg-white sticky top-0 z-10 shadow-sm"
        dir="rtl"
      >
        {tabs.map((tab) => (
          <button
            key={tab}
            onClick={() => {
              setActiveTab(tab);
              setHasInteracted(true);
            }}
            className={`w-1/3 text-center py-2 ${
              activeTab === tab
                ? 'text-black border-b-2 border-red-500 bg-white'
                : 'text-gray-500 bg-gray-100'
            }`}
          >
            {tab}
          </button>
        ))}
      </div>

      <div
        ref={scrollContainerRef}
        onMouseEnter={() => setIsPaused(true)}
        onMouseLeave={() => setIsPaused(false)}
        className="custom-scrollbar overflow-x-hidden p-1 space-y-1 flex-1 overflow-y-auto max-h-[380px]"
        dir="rtl"
      >
        {content}
      </div>
    </div>
  );
}



// components/CategoryPage.jsx
'use client';
import React, { useEffect, useState } from 'react';
import SectionWithHeader from './SectionWithHeader';
import LimitedArticles from './LimitedArticles';
import { labelMap } from '@/utils/labelMap';

const API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL || process.env.STRAPI_API_URL;
const PLACEHOLDER_IMG = '/default-image.jpg';

// âœ… ×¤×•× ×§×¦×™×” ×©××•×•×“××ª ×›×ª×•×‘×ª ×ª×§×™× ×” ×œ×ª××•× ×” (×›×•×œ×œ Cloudinary)
function resolveImageUrl(rawUrl) {
  if (!rawUrl) return PLACEHOLDER_IMG;
  if (rawUrl.startsWith('http')) return rawUrl;
  return `${API_URL}${rawUrl.startsWith('/') ? rawUrl : `/uploads/${rawUrl}`}`;
}

// ×§×™×‘×•×¥ ×œ×¤×™ ×ª×ªÖ¾×§×˜×’×•×¨×™×•×ª ×¨×’×™×œ×•×ª
function groupBySubcategory(articles) {
  return articles.reduce((acc, article) => {
    const subcategories = Array.isArray(article.subcategory)
      ? article.subcategory
      : [article.subcategory];

    subcategories.forEach((subcat) => {
      if (!acc[subcat]) acc[subcat] = [];
      acc[subcat].push(article);
    });

    return acc;
  }, {});
}

// ×§×™×‘×•×¥ ×œ×¤×™ Values (×œ×ª×ª×™Ö¾×ª×ª×™Ö¾×§×˜×’×•×¨×™×•×ª ×©×œ ××“×¨×™×›×™×)
function groupByValues(articles) {
  return articles.reduce((acc, article) => {
    const values = Array.isArray(article.Values)
      ? article.Values
      : [article.Values];

    values.forEach((val) => {
      if (!acc[val]) acc[val] = [];
      acc[val].push(article);
    });

    return acc;
  }, {});
}

export default function CategoryPage({ categoryKey = ' ', subcategoryKey = null, guideSubKey = null }) {
  const [articles, setArticles] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    async function fetchArticles() {
      try {
        let url = `${API_URL}/api/articles?populate=*`;

        // âœ… ×¡×™× ×•×Ÿ ×œ×¤×™ ×§×˜×’×•×¨×™×” ×¨××©×™×ª
        if (categoryKey) {
          url += `&filters[category][$eq]=${categoryKey}`;
        }

        const res = await fetch(url);
        const json = await res.json();
        let data = json.data || [];

        // âœ… ×¡×™× ×•×Ÿ ×‘×¦×“ ×”×œ×§×•×— ×œ×¤×™ ×ª×ªÖ¾×§×˜×’×•×¨×™×”
        if (subcategoryKey) {
          data = data.filter((a) => {
            const sub = a.subcategory;
            if (!sub) return false;
            if (Array.isArray(sub)) return sub.includes(subcategoryKey);
            if (typeof sub === 'string') return sub.includes(subcategoryKey);
            return false;
          });
        }

        // âœ… ×¡×™× ×•×Ÿ ×œ×¤×™ Values
        if (guideSubKey) {
          data = data.filter((a) => {
            const vals = a.Values;
            if (!vals) return false;
            if (Array.isArray(vals)) return vals.includes(guideSubKey);
            if (typeof vals === 'string') return vals.includes(guideSubKey);
            return false;
          });
        }

        // âœ… ××™×¤×•×™ ×›×ª×‘×•×ª ×¢× ×œ×•×’×™×§×ª ×ª××•× ×” ××—×™×“×”
        const mapped = data.map((a) => {
          let mainImage = PLACEHOLDER_IMG;
          let mainImageAlt = a.title || '×ª××•× ×” ×¨××©×™×ª';

          // 1ï¸âƒ£ ×’×œ×¨×™×”
          const galleryItem = a.gallery?.[0];
          if (galleryItem?.url) {
            mainImage = resolveImageUrl(galleryItem.url);
            mainImageAlt = galleryItem.alternativeText || mainImageAlt;
          }
          // 2ï¸âƒ£ ×ª××•× ×” ×¨××©×™×ª
          else if (a.image?.url) {
            mainImage = resolveImageUrl(a.image.url);
            mainImageAlt = a.image.alternativeText || mainImageAlt;
          }
          // 3ï¸âƒ£ external_media_links
          else if (Array.isArray(a.external_media_links) && a.external_media_links.length > 0) {
            const validLinks = a.external_media_links.filter(
              (l) => typeof l === 'string' && l.startsWith('http')
            );
            if (validLinks.length > 1) {
              mainImage = validLinks[1].trim(); // ×”×©× ×™
            } else if (validLinks.length > 0) {
              mainImage = validLinks[0].trim(); // ×”×¨××©×•×Ÿ
            }
            mainImageAlt = '×ª××•× ×” ×¨××©×™×ª ××”××“×™×” ×”×—×™×¦×•× ×™×ª';
          }

          return {
            id: a.id,
            title: a.title,
            slug: a.slug,
            image: mainImage,
            imageAlt: mainImageAlt,
            category: a.category || 'general',
            subcategory: Array.isArray(a.subcategory)
              ? a.subcategory
              : [a.subcategory ?? 'general'],
            Values: Array.isArray(a.Values)
              ? a.Values
              : [a.Values ?? null],
            description: a.description,
            headline: a.headline || a.title,
            subdescription: a.subdescription,
            href: `/articles/${a.slug}`,
            tags: a.tags || [],
            date: a.date || '',
            time: a.time || '00:00',
          };
        });

        // âœ… ××™×•×Ÿ ××”×—×“×© ×œ×™×©×Ÿ
        const sorted = mapped.sort((a, b) => {
          const aDateTime = new Date(`${a.date}T${a.time}`);
          const bDateTime = new Date(`${b.date}T${b.time}`);
          return bDateTime - aDateTime;
        });

        setArticles(sorted);
      } catch (err) {
        console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ×›×ª×‘×•×ª:', err);
      } finally {
        setLoading(false);
      }
    }

    fetchArticles();
  }, [categoryKey, subcategoryKey, guideSubKey]);

  if (loading) {
    return <p className="text-center text-gray-500">×˜×•×¢×Ÿ ×›×ª×‘×•×ª...</p>;
  }

  if (articles.length === 0) {
    return <p className="text-center text-gray-500">××™×Ÿ ×¢×“×™×™×Ÿ ×›×ª×‘×•×ª ×‘×§×˜×’×•×¨×™×” ×–×•</p>;
  }

  // âœ… ×œ×•×’×™×§×ª ×§×™×‘×•×¥
  const grouped =
    guideSubKey
      ? { [guideSubKey]: articles }
      : subcategoryKey === 'guides'
        ? groupByValues(articles)
        : subcategoryKey
          ? { [subcategoryKey]: articles }
          : groupBySubcategory(articles);

  const hebTitle = guideSubKey
    ? `${labelMap['guides']} - ${labelMap[guideSubKey] || guideSubKey}`
    : subcategoryKey
      ? labelMap[subcategoryKey] || subcategoryKey
      : labelMap[categoryKey] || categoryKey;

  const shouldShowMainTitle =
    subcategoryKey !== null || guideSubKey !== null || Object.keys(grouped).length === 1;

  return (
    <div className="max-w-screen-xl mx-auto px-0">
      <div className="flex flex-col gap-0" dir="rtl">
        {!subcategoryKey && !guideSubKey && shouldShowMainTitle && (
          <SectionWithHeader
            title={hebTitle}
            href={`/${categoryKey}`}
            variant="main"
          />
        )}

        {Object.entries(grouped).map(([subKey, subArticles]) => (
          <div key={subKey} className="bg-white shadow">
            {!guideSubKey && Object.keys(grouped).length > 1 && (
              <SectionWithHeader
                title={labelMap[subKey] || subKey}
                href={
                  subcategoryKey === 'guides'
                    ? `/${categoryKey}/${subcategoryKey}/${subKey}`
                    : `/${categoryKey}/${subKey}`
                }
                variant="category"
              />
            )}

            <LimitedArticles articles={subArticles} initialCount={2} />
          </div>
        ))}
      </div>
    </div>
  );
}


//app/page.js
export const dynamic = "force-dynamic"; // â— ×—×™×™×‘ ×œ×”×™×©××¨

import React from "react";
import MainGridContentDesktop from "@/components/MainGridContentDesktop";
import PageContainer from "@/components/PageContainer";

/* -----------------------------------------------------------
   âš™ï¸ ×˜×¢×™× ×ª ×›×ª×‘×•×ª ×Ö¾Strapi (Server Component)
   - ×“×™× ×××™ ×›×“×™ ×œ×× ×•×¢ × ×¤×™×œ×ª build
   - ×¢× revalidate ×›×“×™ ×œ×—×¡×•×š Edge Requests
----------------------------------------------------------- */
async function fetchArticles() {
  const base = process.env.STRAPI_API_URL;

  if (!base) {
    console.error("âŒ STRAPI_API_URL ×œ× ×”×•×’×“×¨");
    return [];
  }

  const url = `${base}/api/articles?populate=*`;

  try {
    // â³ ×”×’×‘×œ×ª ×–××Ÿ ×›×“×™ ×œ× ×œ×”×ª×§×¢ ×× Strapi ×œ× ××’×™×‘
    const controller = new AbortController();
    const timeout = setTimeout(() => controller.abort(), 7000); // 7 ×©× ×™×•×ª

    const res = await fetch(url, {
      next: { revalidate: 60 }, // Cache ×œÖ¾60 ×©× ×™×•×ª
      signal: controller.signal,
    });

    clearTimeout(timeout);

    if (!res.ok) {
      console.error("âŒ ×©×’×™××ª API:", res.status);
      return [];
    }

    const json = await res.json();

    return json.data.map((item) => ({
      id: item.id,
      ...item.attributes,
    }));
  } catch (err) {
    console.error("âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×›×ª×‘×•×ª:", err.message);
    return []; // fallback ×‘×˜×•×— ×›×“×™ ×œ× ×œ×”×¤×™×œ ××ª ×”××ª×¨
  }
}

/* -----------------------------------------------------------
   ğŸ  ×¢××•×“ ×”×‘×™×ª
----------------------------------------------------------- */
export default async function HomePage() {
  const articles = await fetchArticles();

  return (
    <PageContainer title="×“×£ ×”×‘×™×ª" breadcrumbs={[]}>
      <MainGridContentDesktop articles={articles} />

      <h1 className="text-2xl font-bold text-[#e60000] px-4 mt-4">
        OnMotor Media - ××’×–×™×Ÿ ××•×¤× ×•×¢×™× ×™×©×¨××œ×™
      </h1>

      <p className="px-4 mt-2 mb-4 text-gray-700">
        ××’×–×™×Ÿ ××•×¤× ×•×¢×™× ×‘×™×©×¨××œ - ×—×“×©×•×ª, ×¡×§×™×¨×•×ª, ××‘×—× ×™ ×“×¨×›×™×, ×¦×™×•×“, ×˜×™×¤×™×
        ×œ×§×”×™×œ×ª ×”×¨×•×›×‘×™× ×”×ª×•×¡×¡×ª ×‘×™×©×¨××œ.
      </p>
    </PageContainer>
  );
}


// components/MainGridContentDesktop.jsx
'use client';
import React, { useEffect, useState } from 'react';
import ArticleCard from './ArticleCards/ArticleCard';
import SectionWithHeader from './SectionWithHeader';

const API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL || process.env.STRAPI_API_URL;
const PLACEHOLDER_IMG = '/default-image.jpg';

/* ============================
   ×¤×•× ×§×¦×™×•×ª ×ª××•× ×” (×œ×œ× ×©×™× ×•×™)
===============================*/
function resolveImageUrl(rawUrl) {
  if (!rawUrl) return PLACEHOLDER_IMG;
  if (rawUrl.startsWith('http')) return rawUrl;
  return `${API_URL}${rawUrl.startsWith('/') ? rawUrl : `/uploads/${rawUrl}`}`;
}

function getMainImage(attrs) {
  let mainImage = PLACEHOLDER_IMG;
  let mainImageAlt = attrs.title || '×ª××•× ×” ×¨××©×™×ª';

  if (attrs.image?.data?.attributes?.url) {
    mainImage = resolveImageUrl(attrs.image.data.attributes.url);
    mainImageAlt = attrs.image.data.attributes.alternativeText || mainImageAlt;
  } else if (attrs.image?.url) {
    mainImage = resolveImageUrl(attrs.image.url);
    mainImageAlt = attrs.image.alternativeText || mainImageAlt;
  } else if (attrs.gallery?.[0]?.url) {
    mainImage = resolveImageUrl(attrs.gallery[0].url);
    mainImageAlt = attrs.gallery[0].alternativeText || mainImageAlt;
  } else if (
    Array.isArray(attrs.external_media_links) &&
    attrs.external_media_links.length > 0
  ) {
    const valid = attrs.external_media_links.filter((l) => typeof l === 'string' && l.startsWith('http'));
    if (valid.length > 1) mainImage = valid[1].trim();
    else if (valid.length > 0) mainImage = valid[0].trim();
    mainImageAlt = '×ª××•× ×” ×¨××©×™×ª ××”××“×™×” ×”×—×™×¦×•× ×™×ª';
  }

  return { mainImage, mainImageAlt };
}

export default function MainGridContentDesktop() {
  const [articles, setArticles] = useState([]);
  const [loading, setLoading] = useState(true);

  /* ================
     ×˜×¢×™× ×ª ×›×ª×‘×•×ª
  ===================*/
  useEffect(() => {
    async function fetchArticles() {
      try {
        const res = await fetch(`${API_URL}/api/articles?populate=*`, { cache: 'no-store' });
        const json = await res.json();

        const mapped = json.data?.map((a) => {
          const attrs = a.attributes || a;
          const { mainImage, mainImageAlt } = getMainImage(attrs);

          return {
            id: a.id,
            title: attrs.title,
            slug: attrs.slug,
            image: mainImage,
            imageAlt: mainImageAlt,
            category: attrs.category || 'general',
            date: attrs.date,
            subcategory: Array.isArray(attrs.subcategory)
              ? attrs.subcategory
              : [attrs.subcategory ?? 'general'],
            description: attrs.description,
            headline: attrs.headline || attrs.title,
            subdescription: attrs.subdescription,
            href: `/articles/${attrs.slug}`,
            tags: attrs.tags || [],
          };
        }) || [];

        setArticles(mapped);
      } catch (err) {
        console.error('âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×›×ª×‘×•×ª:', err);
      } finally {
        setLoading(false);
      }
    }

    fetchArticles();
  }, []);

  /* ===============================
     ×¡×“×¨ ×§×‘×•×¢ ×©×œ ×§×˜×’×•×¨×™×•×ª
  ================================*/
  const desiredOrder = ['news', 'reviews', 'blog', 'gear'];

  const categories = [...new Set(articles.map((a) => a.category))].sort(
    (a, b) => desiredOrder.indexOf(a) - desiredOrder.indexOf(b)
  );

  if (loading) return <p className="text-center text-gray-500">×˜×•×¢×Ÿ ×›×ª×‘×•×ª...</p>;

  return (
    <div className="bg-white p-0 shadow space-y-0">
      {categories.map((category) => {
        const articlesInCategory = articles
          .filter((a) => a.category === category && a.slug)
          .sort((a, b) => new Date(b.date) - new Date(a.date)) // ×”×—×“×© ×‘×™×•×ª×¨ ×¨××©×•×Ÿ
          .slice(0, 5);

        if (articlesInCategory.length < 5) return null;

        const [first, second, third, fourth, fifth] = articlesInCategory;

        return (
          <div key={category} className="space-y-0">
            <SectionWithHeader title={category} href={`/${category}`} />

            {/* ğŸ”µ ×“×¡×§×˜×•×¤ â€” ×œ×œ× ×©×™× ×•×™ */}
            <div className="hidden md:grid grid-cols-3 gap-0 w-full">
              <div className="col-span-1">
                <ArticleCard article={first} size="medium" />
              </div>
              <div className="col-span-2">
                <ArticleCard article={second} size="large" />
              </div>
              <div className="col-span-1">
                <ArticleCard article={third} size="small" />
              </div>
              <div className="col-span-1">
                <ArticleCard article={fourth} size="small" />
              </div>
              <div className="col-span-1">
                <ArticleCard article={fifth} size="small" />
              </div>
            </div>

            {/* ğŸŸ¢ ××•×‘×™×™×œ â€” ×¤×¨×™×¡×” ×—×“×©×” */}
            <div className="md:hidden w-full space-y-0">
              {/* ×©×•×¨×” 1 */}
              <ArticleCard article={first} size="large" />

              {/* ×©×•×¨×” 2 */}
              <div className="grid grid-cols-2 gap-0">
                <ArticleCard article={second} size="small" />
                <ArticleCard article={third} size="small" />
              </div>

              {/* ×©×•×¨×” 3 */}
              <div className="grid grid-cols-2 gap-0">
                <ArticleCard article={fourth} size="small" />
                <ArticleCard article={fifth} size="small" />
              </div>
            </div>

          </div>
        );
      })}
    </div>
  );
}


//app/layout.js

import './globals.css';
import { AuthModalProvider } from '@/contexts/AuthModalProvider';
import ClientLayout from '@/components/ClientLayout';
import ScrollToTopButton from '@/components/ScrollToTopButton';
import Script from 'next/script';
import { Heebo } from 'next/font/google';

const heebo = Heebo({
Â  subsets: ['hebrew', 'latin'],
Â  weight: ['400', '500', '700'],
Â  display: 'swap',
});

//  ========= â¬‡ï¸ ×”×ª×™×§×•×Ÿ ×›××Ÿ â¬‡ï¸ =========
// ×”×—×–×¨× ×• ××ª ××•×‘×™×™×§×˜ ×”××˜×-×“××˜×” ×”×¨××©×™.
// ×–×” ×™×©××© ×›×‘×¨×™×¨×ª ××—×“×œ, ×•×”×›×ª×‘×•×ª ×™×“×¨×¡×• ××•×ª×• × ×§×•×“×ª×™×ª.
export const metadata = {
  metadataBase: new URL("https://www.onmotormedia.com"),

  title: {
    default: "OnMotor Media â€“ ××’×–×™×Ÿ ××•×¤× ×•×¢×™× ×™×©×¨××œ×™ | ×—×“×©×•×ª, ×¡×§×™×¨×•×ª ×•×§×”×™×œ×”",
    template: "%s | OnMotor Media",
  },
  description:
    "××’×–×™×Ÿ ××•×¤× ×•×¢×™× ×™×©×¨××œ×™ ××•×‘×™×œ â€“ ×—×“×©×•×ª ××•×¤× ×•×¢×™×, ×¡×§×™×¨×•×ª ×“×’××™×, ×¡×§×™×¨×ª ×¦×™×•×“ ×•××‘×—× ×™ ×“×¨×š. ×›×œ ××” ×©×¨×•×›×‘ ×‘×™×©×¨××œ ×¦×¨×™×š ×œ×“×¢×ª.",

  openGraph: {
    title: "OnMotor Media â€“ ××’×–×™×Ÿ ××•×¤× ×•×¢×™× ×™×©×¨××œ×™",
    description:
      "×—×“×©×•×ª ××•×¤× ×•×¢×™×, ×¡×§×™×¨×•×ª, ×¦×™×•×“ ×•× ×™×¡×™×•×Ÿ ××”×©×˜×— â€“ ××’×–×™×Ÿ ×”××•×¤× ×•×¢×™× ×œ×¨×•×›×‘ ×‘×™×©×¨××œ.",
    url: "https://www.onmotormedia.com",
    siteName: "OnMotor Media",
    images: [
      {
        url: "https://www.onmotormedia.com/full_Logo.jpg",
        width: 1200,
        height: 630,
        alt: "OnMotor Media Logo",
      },
    ],
    locale: "he_IL",
    type: "website",
  },

  twitter: {
    card: "summary_large_image",
    title: "OnMotor Media â€“ ××’×–×™×Ÿ ××•×¤× ×•×¢×™× ×™×©×¨××œ×™",
    description:
      "×—×“×©×•×ª ××•×¤× ×•×¢×™×, ×¡×§×™×¨×•×ª ×“×’××™× ×œ×§×”×™×œ×ª ×”×¨×•×›×‘×™× ×©×œ ×™×©×¨××œ.",
    images: ["https://www.onmotormedia.com/full_Logo.jpg"],
  },
};

//  ========= â¬†ï¸ ×”×ª×™×§×•×Ÿ ×›××Ÿ â¬†ï¸ =========


export default function RootLayout({ children }) {
Â  return (
Â  Â  <html lang="he" dir="rtl" className={heebo.className}>
Â  Â  Â  <head>
Â  Â  Â  Â  {/* Structured Data - ×¢×•×–×¨ ×œ×’×•×’×œ ×œ×–×”×•×ª ××ª ×”×œ×•×’×• ×©×œ×š */}
Â  Â  Â  Â  <script
Â  Â  Â  Â  Â  type="application/ld+json"
Â  Â  Â  Â  Â  dangerouslySetInnerHTML={{
Â  Â  Â  Â  Â  Â  __html: JSON.stringify({
Â  Â  Â  Â  Â  Â  Â  "@context": "https://schema.org",
Â  Â  Â  Â  Â  Â  Â  "@type": "Organization",
Â  Â  Â  Â  Â  Â  Â  "name": "OnMotor Media",
Â  Â  Â  Â  Â  Â  Â  "url": "https://www.onmotormedia.com",
Â  Â  Â  Â  Â  Â  Â  "logo": "https://www.onmotormedia.com/OnMotorLogonoback.png",
Â  Â  Â  Â  Â  Â  }),
Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  />
Â  Â  Â  </head>

Â  Â  Â  <body className="flex flex-col min-h-screen">
    Â  Â   Â  {/* ×˜×•×¢×Ÿ ××ª Facebook SDK ×’×œ×•×‘×œ×™ */}
Â  Â  Â  Â  <AuthModalProvider>
Â  Â  Â  Â  Â  <ScrollToTopButton />
Â  Â  Â  Â  Â  <ClientLayout>{children}</ClientLayout>
Â  Â  Â  Â  </AuthModalProvider>

Â  Â  Â  Â  {/* ×ª×•×¡×£ ×”× ×’×™×©×•×ª */}
Â  Â  Â  Â  <Script src="https://cdn.enable.co.il/licenses/enable-L491236ornf8p4x2-1025-75004/init.js" />
        {/* Facebook SDK â€“ × ×˜×¢×Ÿ ×¨×§ ××—×¨×™ Hydration */}
        <Script
          src="https://connect.facebook.net/he_IL/sdk.js#xfbml=1&version=v23.0"
          strategy="lazyOnload"
        />
Â  Â  Â  </body>
Â  Â  </html>
Â  );
}

// /components/ContactForAdBox.jsx
'use client';
import { useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';

export default function ContactForAdBox() {
  const [open, setOpen] = useState(false);
  const [form, setForm] = useState({ name: '', phone: '', email: '', notes: '' });
  const [status, setStatus] = useState(null);
  const [errorMsg, setErrorMsg] = useState('');

  const handleChange = (e) => {
    setForm({ ...form, [e.target.name]: e.target.value });
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setStatus('loading');
    setErrorMsg('');

    try {
      const res = await fetch('/api/contact-for-ad', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(form),
      });

      const data = await res.json();

      if (!res.ok || !data.success) {
        throw new Error(data?.error || 'Server error');
      }

      setStatus('success');
      setForm({ name: '', phone: '', email: '', notes: '' });

      setTimeout(() => setOpen(false), 2000);
    } catch (err) {
      console.error('âŒ ×©×’×™××” ×‘×©×œ×™×—×”:', err);
      setStatus('error');
      setErrorMsg(err?.message || '×©×’×™××” ×œ× ×™×“×•×¢×”');
    }
  };

  return (
    <div
      dir="rtl"
      className="mt-0.8 mb-2 border-[3px] border-[#e60000] rounded-xl bg-gray-900 text-white p-4 text-center shadow-md relative overflow-hidden transition-all duration-300"
    >
      <h3 className="text-xl font-bold mb-2 text-[#e60000]">
        ×¨×•×¦×” ×œ×¤×¨×¡× ×‘××ª×¨?
      </h3>
      <p className="text-base text-gray-300 mb-3">
        ×”×©××™×¨×• ×¤×¨×˜×™× ×•× ×¦×™×’ ×™×—×–×•×¨ ××œ×™×›× ×‘×”×§×“×.
      </p>

      <button
        onClick={() => setOpen(!open)}
        className="bg-[#e60000] hover:bg-[#b50000] text-white font-bold px-4 py-2 rounded-md transition"
      >
        {open ? '×¡×’×•×¨' : '×”×©××™×¨×• ×¤×¨×˜×™×'}
      </button>

      <AnimatePresence>
        {open && (
          <motion.div
            initial={{ height: 0, opacity: 0 }}
            animate={{ height: 'auto', opacity: 1 }}
            exit={{ height: 0, opacity: 0 }}
            transition={{ duration: 0.35 }}
            className="mt-4 bg-gray-800 text-white p-4 rounded-md border-t-2 border-[#e60000] text-right"
          >
            <form onSubmit={handleSubmit} className="flex flex-col gap-3">
              <input
                type="text"
                name="name"
                value={form.name}
                onChange={handleChange}
                placeholder="×©× / ×©× ×”×¢×¡×§"
                required
                className="p-2 rounded bg-gray-700 text-white w-full placeholder-gray-400"
              />
              <input
                type="tel"
                name="phone"
                value={form.phone}
                onChange={handleChange}
                placeholder="××¡×¤×¨ × ×™×™×“"
                required
                className="p-2 rounded bg-gray-700 text-white w-full placeholder-gray-400"
              />
              <input
                type="email"
                name="email"
                value={form.email}
                onChange={handleChange}
                placeholder="××™××™×™×œ"
                required
                className="p-2 rounded bg-gray-700 text-white w-full placeholder-gray-400"
              />

              {/* ğŸŸ¢ ×©×“×” ×”×¢×¨×•×ª ××•×¤×¦×™×•× ×œ×™ ×‘×œ×‘×“ */}
              <textarea
                name="notes"
                value={form.notes}
                onChange={handleChange}
                placeholder="×¤×™×¨×•×˜ × ×•×¡×£ (×œ× ×—×•×‘×”)"
                rows={3}
                className="p-2 rounded bg-gray-700 text-white w-full placeholder-gray-400 resize-none"
              />

              <button
                type="submit"
                className="bg-[#e60000] hover:bg-[#b50000] px-4 py-2 rounded-md mt-2 font-bold"
              >
                ×”×’×©
              </button>
            </form>

            {status === 'loading' && (
              <p className="text-yellow-400 mt-2 text-sm">×©×•×œ×—...</p>
            )}
            {status === 'success' && (
              <p className="text-green-400 mt-2 text-sm">
                âœ… × ×©×œ×— ×‘×”×¦×œ×—×”! × ×¦×™×’ ×™×—×–×•×¨ ××œ×™×š ×‘×§×¨×•×‘.
              </p>
            )}
            {status === 'error' && (
              <p className="text-red-400 mt-2 text-sm">
                âš ï¸ ××™×¨×¢×” ×©×’×™××” ×‘×©×œ×™×—×”: {errorMsg}
              </p>
            )}
          </motion.div>
        )}
      </AnimatePresence>
    </div>
  );
}


// components/SidebarFixed.jsx
'use client';
import { useEffect, useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import ResponsiveBoxGrid from './ResponsiveBoxGrid';
import BoxWrapper from './BoxWrapper';

const API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL;

/* âœ… ×¤×•× ×§×¦×™×” ×××•×—×“×ª ×œ×–×™×”×•×™ ×›×ª×•×‘×ª ××“×™×” (Cloudinary / Strapi / ×—×™×¦×•× ×™) */
function resolveMediaUrl(rawUrl) {
  if (!rawUrl) return null;
  if (rawUrl.startsWith('http')) return rawUrl;
  return `${API_URL}${rawUrl.startsWith('/') ? rawUrl : `/uploads/${rawUrl}`}`;
}

/* âœ… ×¤×•× ×§×¦×™×” ×œ× ×¨××•×œ ×œ×™× ×§×™× ×-Google Drive */
function normalizeDriveUrl(url) {
  if (!url) return url;

  // ×× ×–×” ID ×‘×œ×‘×“
  if (/^[a-zA-Z0-9_-]{20,}$/.test(url)) {
    return `/api/drive-proxy?id=${url}`;
  }

  // ×× ×–×” ×œ×™× ×§ ×¨×’×™×œ ×©×œ ×“×¨×™×™×‘
  if (url.includes('drive.google.com/file/d/')) {
    const match = url.match(/\/d\/([^/]+)/);
    if (match && match[1]) {
      return `/api/drive-proxy?id=${match[1]}`;
    }
  }

  return url;
}

export default function SidebarFixed() {
  const [ads, setAds] = useState([]);
  const [currentIndex, setCurrentIndex] = useState(0);

  /* âœ… ×˜×¢×™× ×ª ××•×“×¢×•×ª ×-Strapi */
  useEffect(() => {
    async function fetchAds() {
      try {
        const res = await fetch(
          `${API_URL}/api/sidebar-middles?populate=image&populate=video`
        );
        const json = await res.json();
        setAds(json.data || []);
      } catch (err) {
        console.error('×©×’×™××” ×‘×˜×¢×™× ×ª sidebar-middle:', err);
      }
    }
    fetchAds();
  }, []);

  /* âœ… ×§×¨×•×¡×œ×” ××ª×—×œ×¤×ª ×›×œ 5 ×©× ×™×•×ª */
  useEffect(() => {
    if (ads.length > 2) {
      const interval = setInterval(() => {
        setCurrentIndex((prev) => (prev + 2) % ads.length);
      }, 5000);
      return () => clearInterval(interval);
    }
  }, [ads]);

  /* âœ… ×”×—×–×¨×ª ××•×“×¢×” ×œ×¤×™ ××™× ×“×§×¡ */
  const getAdAt = (index) => {
    if (!ads.length) return null;
    return ads[index % ads.length];
  };

  /* âœ… ×›×¨×˜×™×¡ ××•×“×¢×” ×¢× ×œ×•×’×™×§×ª ×ª××•× ×” ×—×“×©×” */
  const AdCard = ({ ad }) => {
    if (!ad) return null;

    const attrs = ad; // ×”× ×ª×•× ×™× ××’×™×¢×™× ×-Strapi

    // × ×•×¨××œ×™×–×¦×™×” ×©×œ ×›×œ ×”× ×ª×™×‘×™×
    const driveUrl = normalizeDriveUrl(attrs.mediaUrl || null);

    // ×ª××•× ×” ×-Strapi (Cloudinary ××• ×™×—×¡×™×ª)
    const imageUrl = Array.isArray(attrs.image) && attrs.image.length > 0
      ? resolveMediaUrl(attrs.image[0].url)
      : resolveMediaUrl(attrs.image?.url);

    // ×•×™×“××• ×-Strapi
    const videoUrl = Array.isArray(attrs.video) && attrs.video.length > 0
      ? resolveMediaUrl(attrs.video[0].url)
      : resolveMediaUrl(attrs.video?.url);

    // âœ… ×¡×“×¨ ×¢×“×™×¤×•×™×•×ª: mediaUrl (×“×¨×™×™×‘/×—×™×¦×•× ×™) > video > image
    let finalUrl = driveUrl || videoUrl || imageUrl;
    let isVideo =
      (finalUrl && finalUrl.endsWith('.mp4')) ||
      finalUrl?.includes('youtube') ||
      finalUrl?.includes('vimeo');

    let content = null;

    if (!finalUrl) {
      content = (
        <div className="w-full h-full bg-gray-800 flex items-center justify-center text-white">
          ××™×Ÿ ××“×™×” ×–××™× ×”
        </div>
      );
    } else if (isVideo) {
      content = (
        <video
          src={finalUrl}
          autoPlay
          loop
          muted
          playsInline
          className="w-full h-full object-cover"
        />
      );
    } else {
      content = (
        <img
          src={finalUrl}
          alt={attrs.title || 'ad'}
          className="w-full h-full object-cover"
          loading="lazy"
        />
      );
    }

    return (
      <div className="border-[3px] border-[#e60000] rounded-xl overflow-hidden shadow-xl bg-black transition-all hover:shadow-[#e60000]/50">
        <div className="w-full aspect-[16/8]">{content}</div>

        {/* ×›×¤×ª×•×¨×™× */}
        <div className="flex justify-center gap-2 p-3">
          {attrs.link && (
            <a
              href={attrs.link}
              target="_blank"
              rel="noopener noreferrer"
              className="relative bg-gradient-to-r from-[#1f1f1f] to-[#3a3a3a] text-white font-bold px-4 py-2 rounded-lg text-center text-sm transition-all duration-300 hover:scale-105 hover:from-[#e60000] hover:to-[#b50000]"
            >
              {attrs.title ? attrs.title : '×œ××ª×¨ ×”××¤×¨×¡×'}
            </a>
          )}
          {attrs.slug && (
            <a
              href={`/articles/${attrs.slug}`}
              className="bg-[#e60000] text-white px-3 py-2 rounded-md hover:bg-[#b50000] text-sm transition-all duration-300"
            >
              ×œ×›×ª×‘×”
            </a>
          )}
        </div>

      </div>
    );
  };

  return (
    <div className="relative bg-gray-900 py-4 sticky top-25">
      <ResponsiveBoxGrid>
        <BoxWrapper>
          <div className="overflow-hidden flex flex-col gap-4">
            <AnimatePresence mode="wait">
              <motion.div
                key={currentIndex}
                initial={{ y: 50, opacity: 0 }}
                animate={{ y: 0, opacity: 1 }}
                exit={{ y: -50, opacity: 0 }}
                transition={{ duration: 1 }}
              >
                <AdCard ad={getAdAt(currentIndex)} />
              </motion.div>
              <motion.div
                key={currentIndex + 1}
                initial={{ y: 50, opacity: 0 }}
                animate={{ y: 0, opacity: 1 }}
                exit={{ y: -50, opacity: 0 }}
                transition={{ duration: 1, delay: 0.1 }}
              >
                <AdCard ad={getAdAt(currentIndex + 1)} />
              </motion.div>
            </AnimatePresence>
          </div>
        </BoxWrapper>
      </ResponsiveBoxGrid>
    </div>
  );
}

// components/SidebarMiddleLayer.jsx
'use client';
import SidebarFixed from './SidebarFixed';
import ContactForAdBox from './ContactForAdBox';

export default function SidebarMiddleLayer() {
  return (
    <div className="sidebar-middle-layer sticky top-7 flex flex-col gap-0 w-full flex-1">
      {/* ×ª×•×›×Ÿ ×”×¡×™×™×“×¨ ×©××ª×¢×“×›×Ÿ */}
      <div className="flex-1">
        <SidebarFixed />
      </div>

      {/* ×©×›×‘×ª ×™×¦×™×¨×ª ×§×©×¨ ×§×‘×•×¢×” */}
      <div className=" bottom-0 bg-gray-900">
        <ContactForAdBox />
      </div>
    </div>
  );
}


// components/NavigationMenu.jsx
'use client';
import React, { useState, useRef, useEffect } from "react";
import Link from "next/link";
import { useRouter } from "next/navigation";
import { scrollToBottomOfElement } from "./utils/scrollUtils";

const API_URL =
  process.env.NEXT_PUBLIC_STRAPI_API_URL ||
  "https://onmotor-strapi.onrender.com";

export default function NavigationMenu({ mobile = false, onClose = () => {} }) {
  const [openIndex, setOpenIndex] = useState(null);
  const [subOpenIndex, setSubOpenIndex] = useState(null);
  const [forumLinks, setForumLinks] = useState([]); // âœ… ×§×˜×’×•×¨×™×•×ª ×¤×•×¨×•× ×“×™× ××™×•×ª
  const menuRefs = useRef([]);
  const router = useRouter();

  const toggleMenu = (index) => {
    const newIndex = openIndex === index ? null : index;
    setOpenIndex(newIndex);
    setSubOpenIndex(null);
  };

  // ğŸŸ© ×©×œ×‘ 1 â€” ×˜×¢×™× ×ª ×§×˜×’×•×¨×™×•×ª ×¤×•×¨×•× ×Ö¾Strapi
  useEffect(() => {
    async function loadForumCategories() {
      try {
        const res = await fetch(`${API_URL}/api/forum-categories?populate=*`, { cache: "no-store" });
        const json = await res.json();
        const formatted = json.data?.map((cat) => {
          const name =
            cat?.attributes?.name?.trim() ||
            cat?.name?.trim() ||
            "×œ×œ× ×©×";
          const slug =
            cat?.attributes?.slug?.trim() ||
            cat?.slug?.trim() ||
            "";
          return {
            title: name,
            path: slug ? `/forum/${slug}` : "/forum",
          };
        }) || [];
        setForumLinks(formatted);
      } catch (err) {
        console.error("âš ï¸ ×©×’×™××” ×‘×˜×¢×™× ×ª ×§×˜×’×•×¨×™×•×ª ×¤×•×¨×•×:", err);
      }
    }
    loadForumCategories();
  }, []);

  useEffect(() => {
    if (openIndex !== null && menuRefs.current[openIndex]) {
      scrollToBottomOfElement(menuRefs.current[openIndex]);
    }
  }, [openIndex]);

  // ğŸŸ¨ ×©×œ×‘ 2 â€” ××‘× ×” ×ª×¤×¨×™×˜
  const menus = [
    { title: 'OnMotor Parts', path: '/shop', links: [] },
    {
      title: '×¡×§×™×¨×•×ª', path: '/reviews', links: [
        { title: '××‘×—× ×™ ×“×¨×›×™×', path: '/reviews/motorcycles' },
        { title: '×¡×§×™×¨×•×ª ×¦×™×•×“', path: '/reviews/gear' },
        { title: '×¡×§×™×¨×•×ª ×•×™×“××•', path: '/reviews/video' },
      ]
    },
    {
      title: '×¦×™×•×“', path: '/gear', links: [
        { title: '×©×˜×—', path: '/gear/offroad' },
        { title: '×›×‘×™×©', path: '/gear/road' },
        { title: '××“×•×•× ×¦×³×¨', path: '/gear/adventure' },
        { title: '×§×¡×˜×•×', path: '/gear/custom' },
      ]
    },
    { title: '×¨×œ×‘"×“', path: '/law-book', links: [{ title: '×©××œ ××ª ×”×¨×œ×‘"×“', path: '/law-book/ask-question' }] },
    {
      title: '×¤×•×¨×•×', path: '/forum', links: forumLinks // âœ… ×“×™× ××™ ×Ö¾Strapi
    },
    {
      title: '×‘×œ×•×’', path: '/blog', links: [
        { title: '××—×“ ×¢×œ ××—×“ (×¤×•×“×§××¡×˜)', path: '/blog/podcast' },
        { title: '×‘×§×¡×“×”', path: '/blog/in-helmet' },
        { title: '×¢×œ ×”× ×™×™×¨', path: '/blog/paper' },
        { title: '×˜×™×¤×™×', path: '/blog/tips' },
        {
          title: '××“×¨×™×›×™×', path: '/blog/guides', links: [
            { title: '××“×¨×™×š ×˜×›× ×™ ×•×ª×—×–×•×§×”', path: '/blog/guides/guide-tech' },
            { title: '××“×¨×™×š ×œ×¨×•×›×‘ ×”××ª×—×™×œ', path: '/blog/guides/guide-beginner' },
            { title: '××“×¨×™×š ×œ×¨×•×›×‘ ×”××ª×§×“×', path: '/blog/guides/guide-advanced' },
          ]
        }
      ]
    },
    {
      title: '×—×“×©×•×ª', path: '/news', links: [
        { title: '×—×“×©×•×ª ××§×•××™×•×ª', path: '/news/local' },
        { title: '×—×“×©×•×ª ××”×¢×•×œ×', path: '/news/global' },
        { title: '××›×•× ×•×ª ×—×“×©×•×ª', path: '/news/machine' },
      ]
    },
    {
      title: '×¦×•×¨ ×§×©×¨', path: '/contact', links: [
        { title: '×•×•××˜×¡××¤', path: 'https://wa.me/972522304604' },
        { title: '×©×œ×— ××™×™×œ', path: 'mailto:onmotormedia@gmail.com' },
      ]
    }
  ];

  // ğŸŸ¥ ×©×œ×‘ 3 â€” ×¨×™× ×“×•×¨ ×ª×¤×¨×™×˜
  return (
    <div className={mobile ? "max-h-[100vh] overflow-y-0 pr-8" : ""}>
      <nav className={mobile ? "flex flex-col gap-2 text-2xl text-right" : "flex gap-2 text-lm font-semibold"}>
        {menus.map((menu, index) => {
          const hasLinks = menu.links && menu.links.length > 0;
          const isOnMotorParts = menu.title === 'OnMotor Parts';

          const handleClick = () => {
            if (mobile && hasLinks && !isOnMotorParts) {
              toggleMenu(index);
            } else {
              onClose();
              router.push(menu.path);
            }
          };

          return (
            <div
              key={index}
              className={`relative ${!mobile ? "group" : ""}`}
              ref={(el) => (menuRefs.current[index] = el)}
            >
              <button
                onClick={handleClick}
                className={`flex items-center gap-1 w-full px-2 py-1 text-lm font-semibold text-right
                  ${isOnMotorParts ? 'text-[#e60000] font-bold animate-parts-bounce' : 'hover:text-[#e60000]'}`}
              >
                <span className="flex-1">{menu.title}</span>
                {hasLinks && (!mobile || !isOnMotorParts) && (
                  <span className="text-xl">
                    {mobile ? (openIndex === index ? "â–²" : "â–¼") : "â–¼"}
                  </span>
                )}
              </button>

              {/* dropdown */}
              {hasLinks && (
                mobile ? (
                  !isOnMotorParts && (
                    <div
                      className={`flex flex-col gap-1 mt-4 pr-4 text-lm ${openIndex === index ? "block" : "hidden"}`}
                    >
                      {menu.links.map((link, idx) => {
                        const hasSubLinks = link.links && link.links.length > 0;
                        const subOpen = subOpenIndex === `${index}-${idx}`;

                        return (
                          <div key={idx} className="flex flex-col">
                            <button
                              onClick={() => {
                                if (hasSubLinks) {
                                  setSubOpenIndex(subOpen ? null : `${index}-${idx}`);
                                } else {
                                  onClose();
                                  router.push(link.path);
                                }
                              }}
                              className="flex justify-between items-center py-1 hover:text-[#e60000]"
                            >
                              <span>{link.title}</span>
                              {hasSubLinks && <span>{subOpen ? "â–²" : "â–¼"}</span>}
                            </button>

                            {hasSubLinks && (
                              <div className={`flex flex-col pr-4 ${subOpen ? "block" : "hidden"}`}>
                                {link.links.map((sublink, sIdx) => (
                                  <Link
                                    key={sIdx}
                                    href={sublink.path}
                                    onClick={onClose}
                                    className="block py-1 hover:text-[#e60000] text-right"
                                  >
                                    {sublink.title}
                                  </Link>
                                ))}
                              </div>
                            )}
                          </div>
                        );
                      })}
                    </div>
                  )
                ) : (
                  <div className="absolute right-0 w-56 bg-black shadow-lg rounded p-2 z-[9999] text-right hidden group-hover:flex flex-col">
                    {menu.links.map((link, idx) => {
                      const hasSubLinks = link.links && link.links.length > 0;
                      return (
                        <div key={idx} className="relative group/sub">
                          <Link
                            href={link.path}
                            className="block px-4 py-2 text-sm text-white hover:text-[#e60000] whitespace-nowrap text-right relative"
                          >
                            <span>{link.title}</span>
                            {link.title === "××“×¨×™×›×™×" && (
                              <span className="absolute left-2 top-1/2 -translate-y-1/2 text-xs">â–¼</span>
                            )}
                          </Link>

                          {hasSubLinks && (
                            <div className="absolute top-full right-0 w-54 bg-black shadow-lg rounded p-2 z-[9999] text-right hidden group-hover/sub:flex flex-col">
                              {link.links.map((sublink, sIdx) => (
                                <Link
                                  key={sIdx}
                                  href={sublink.path}
                                  className="block px-4 py-2 text-sm text-white hover:text-[#e60000] whitespace-nowrap text-right"
                                >
                                  {sublink.title}
                                </Link>
                              ))}
                            </div>
                          )}
                        </div>
                      );
                    })}
                  </div>
                )
              )}
            </div>
          );
        })}
      </nav>
    </div>
  );
}



// /components/ManufacturerGrid.jsx
'use client';

import { useEffect, useState, useRef } from 'react';
import Image from 'next/image';
import Link from 'next/link';
import ScrollSearchBar from './ScrollSearchBar';

export default function ManufacturerGrid() {
  const [manufacturers, setManufacturers] = useState([]);
  const [loading, setLoading] = useState(true);
  const containerRef = useRef(null);
  const animationRef = useRef(null);
  const [hasScrolled, setHasScrolled] = useState(false);

  useEffect(() => {
    async function fetchManufacturers() {
      try {
        const res = await fetch('/api/shopify/collections?limit=50');
        const data = await res.json();
        const items = data.items || [];

        // âœ… ××™×•×Ÿ ××œ×¤×‘×™×ª×™
        items.sort((a, b) => a.title.localeCompare(b.title, 'en', { sensitivity: 'base' }));

        setManufacturers(items);
      } catch (err) {
        console.error('Failed to fetch manufacturers:', err);
      } finally {
        setLoading(false);
      }
    }
    fetchManufacturers();
  }, []);

  // ğŸ¬ ×× ×™××¦×™×™×ª "×¨××– ×’×œ×™×œ×”"
  useEffect(() => {
    const el = containerRef.current;
    if (!el) return;

    let start = null;
    const maxOffset = 60; // ×›××” ×¤×™×§×¡×œ×™× ×œ×–×•×–
    const duration = 1000; // ×›××” ×–××Ÿ ×”×× ×™××¦×™×”

    const animate = (timestamp) => {
      if (!start) start = timestamp;
      const progress = timestamp - start;
      const offset = Math.sin((progress / duration) * Math.PI) * maxOffset;
      el.scrollLeft = offset;

      if (!hasScrolled && progress < duration * 2) {
        animationRef.current = requestAnimationFrame(animate);
      } else {
        cancelAnimationFrame(animationRef.current);
      }
    };

    const handleUserScroll = () => {
      setHasScrolled(true);
      cancelAnimationFrame(animationRef.current);
    };

    el.addEventListener('scroll', handleUserScroll, { once: true });
    animationRef.current = requestAnimationFrame(animate);

    return () => {
      el.removeEventListener('scroll', handleUserScroll);
      cancelAnimationFrame(animationRef.current);
    };
  }, [hasScrolled]);

  if (loading) return <p className="text-center py-8">×˜×•×¢×Ÿ ×™×¦×¨× ×™×...</p>;
  if (!manufacturers.length) return <p className="text-center py-8">×œ× × ××¦××• ×™×¦×¨× ×™×</p>;

  return (
    <div>
      <ScrollSearchBar placeholder="×—×¤×© ×™×¦×¨×Ÿ ××• ×”×—×œ×§ ×©×××œ×”" containerRef={containerRef} />

      <div
        ref={containerRef}
        className="scroll-container flex overflow-x-scroll space-x-4 pb-4 px-2 snap-x snap-mandatory scroll-smooth"
      >
        {manufacturers.map((m) => (
          <Link
            key={m.id}
            href={`/shop/vendor/${m.handle}`}
            data-name={m.title}
            className="min-w-[160px] flex-shrink-0 border rounded-lg p-4 shadow hover:shadow-lg transition snap-start bg-white"
          >
            {m.image?.url && (
              <div className="relative w-full h-24 mb-2">
                <Image
                  src={m.image.url}
                  alt={m.image.altText || m.title}
                  fill
                  style={{ objectFit: 'contain' }}
                />
              </div>
            )}
            <p className="text-center font-semibold text-gray-900 hover:text-[#e60000] transition-colors duration-200">
              {m.title}
            </p>
          </Link>
        ))}
      </div>
    </div>
  );
}

// /app/api/shopify/search/route.js
const domain = process.env.NEXT_PUBLIC_SHOPIFY_STORE_DOMAIN;
const token = process.env.SHOPIFY_STOREFRONT_API_TOKEN;
const apiVersion = process.env.SHOPIFY_API_VERSION || '2024-04';

async function sfFetch(query, variables = {}) {
  if (!domain || !token) {
    return {
      error: 'Missing Shopify env vars',
      status: 500,
      data: null,
    };
  }
  const res = await fetch(`https://${domain}/api/${apiVersion}/graphql.json`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-Shopify-Storefront-Access-Token': token,
    },
    body: JSON.stringify({ query, variables }),
    cache: 'no-store',
  });
  const json = await res.json();
  if (!res.ok || json.errors) {
    return { error: json.errors || 'Shopify error', status: res.status, data: json };
  }
  return { error: null, status: 200, data: json };
}

function normalize(str) {
  if (!str) return '';
  const norm = str.trim().toLowerCase().replace(/\s+/g, ' ');
  const noSpace = norm.replace(/\s+/g, '');
  return { norm, noSpace };
}

function buildQueryString({ q, vendor, model, year, tag, sku, category, type }) {
  const parts = [];

  if (q) {
    const { norm, noSpace } = normalize(q);
    parts.push(`${norm} OR title:${JSON.stringify(noSpace)} OR tag:${JSON.stringify(noSpace)}`);
  }

  if (sku) {
    const { norm, noSpace } = normalize(sku);
    parts.push(
      `sku:${JSON.stringify(norm)} OR barcode:${JSON.stringify(
        norm
      )} OR title:${JSON.stringify(norm)} OR sku:${JSON.stringify(noSpace)} OR barcode:${JSON.stringify(noSpace)} OR title:${JSON.stringify(noSpace)}`
    );
  }

  if (vendor) {
    const { norm, noSpace } = normalize(vendor);
    parts.push(`vendor:${JSON.stringify(norm)} OR tag:${JSON.stringify(noSpace)}`);
  }

  if (model) {
    const { norm, noSpace } = normalize(model);
    parts.push(
      `tag:${JSON.stringify('model:' + norm)} OR title:${JSON.stringify(norm)} OR tag:${JSON.stringify(norm)} OR tag:${JSON.stringify('model:' + noSpace)} OR title:${JSON.stringify(noSpace)} OR tag:${JSON.stringify(noSpace)}`
    );
  }

  if (year) {
    const { norm, noSpace } = normalize(year);
    parts.push(
      `tag:${JSON.stringify('year:' + norm)} OR title:${JSON.stringify(norm)} OR tag:${JSON.stringify(norm)} OR tag:${JSON.stringify('year:' + noSpace)} OR title:${JSON.stringify(noSpace)} OR tag:${JSON.stringify(noSpace)}`
    );
  }

  if (category) {
    const { norm, noSpace } = normalize(category);
    parts.push(
      `tag:${JSON.stringify('cat:' + norm)} OR product_type:${JSON.stringify(norm)} OR tag:${JSON.stringify(norm)} OR product_type:${JSON.stringify(noSpace)} OR tag:${JSON.stringify(noSpace)}`
    );
  }

  if (type) {
    const { norm, noSpace } = normalize(type);
    parts.push(`product_type:${JSON.stringify(norm)} OR product_type:${JSON.stringify(noSpace)}`);
  }

  if (tag) {
    const { norm, noSpace } = normalize(tag);
    parts.push(`tag:${JSON.stringify(norm)} OR tag:${JSON.stringify(noSpace)}`);
  }

  return parts.join(' ');
}

export { sfFetch, buildQueryString };

export async function GET(req) {
  const { searchParams } = new URL(req.url);
  const q = searchParams.get('q') || '';
  const vendor = searchParams.get('vendor') || '';
  const model = searchParams.get('model') || '';
  const year = searchParams.get('year') || '';
  const yearFrom = parseInt(searchParams.get('yearFrom') || '0', 10);
  const yearTo = parseInt(searchParams.get('yearTo') || '9999', 10);
  const category = searchParams.get('category') || '';
  const tag = searchParams.get('tag') || '';
  const sku = searchParams.get('sku') || '';
  const type = searchParams.get('type') || '';
  const first = parseInt(searchParams.get('limit') || '24', 10);
  const after = searchParams.get('cursor');

  const queryStr = buildQueryString({
    q,
    vendor,
    model,
    year,
    tag,
    sku,
    category,
    type,
  });

  const query = `#graphql
    query Products($first: Int!, $after: String, $query: String) {
      products(first: $first, after: $after, query: $query, sortKey: RELEVANCE) {
        pageInfo { hasNextPage endCursor }
        edges {
          cursor
          node {
            id
            title
            handle
            productType
            vendor
            tags
            images(first: 1) { edges { node { url altText } } }
            metafields(identifiers: [
              { namespace: "compatibility", key: "year_from" }
              { namespace: "compatibility", key: "year_to" }
            ]) {
              key
              value
            }
            variants(first: 5) {
              edges {
                node {
                  id
                  title
                  sku
                  barcode
                  availableForSale
                  price { amount currencyCode }
                  quantityAvailable
                }
              }
            }
          }
        }
      }
    }
  `;

  const { error, status, data } = await sfFetch(query, {
    first,
    after,
    query: queryStr || undefined,
  });

  if (error) return Response.json({ error, items: [], pageInfo: {} }, { status });

  // âœ… ×¡×™× ×•×Ÿ ×œ×¤×™ year_from / year_to ××”Ö¾metafields
  const items = (data?.data?.products?.edges || [])
    .map((e) => ({ cursor: e.cursor, ...e.node }))
    .filter((prod) => {
      const mf = {};
      (prod.metafields || []).forEach((m) => {
        mf[m.key] = parseInt(m.value, 10);
      });
      const from = mf.year_from || 0;
      const to = mf.year_to || 9999;
      return from <= yearTo && to >= yearFrom;
    });

  return Response.json({
    items,
    pageInfo: data?.data?.products?.pageInfo || {},
  });
}


//app\sitemap.xml\route.js
export const dynamic = 'force-dynamic';

export async function GET() {
  const SITE_URL = "https://www.onmotormedia.com";
  const API_URL = process.env.STRAPI_URL;

  let articles = [];

  try {
    const res = await fetch(
      `${API_URL}/api/articles?fields=slug,updatedAt&pagination[pageSize]=500`,
      { cache: "no-store" }
    );

    const json = await res.json();

    articles = json.data?.map(item => ({
      url: `${SITE_URL}/articles/${item.slug}`,     // â¬…ï¸ ×ª×™×§×•×Ÿ: ×’×™×©×” ×™×©×™×¨×”
      lastmod: item.updatedAt,                   // â¬…ï¸ ×ª×™×§×•×Ÿ: ×’×™×©×” ×™×©×™×¨×”
    })) || [];

  } catch (err) {
    console.error("Sitemap fetch error:", err);
  }

  const staticUrls = [
    { url: SITE_URL, lastmod: new Date().toISOString() },
    { url: `${SITE_URL}/contact`, lastmod: new Date().toISOString() },
    { url: `${SITE_URL}/about`, lastmod: new Date().toISOString() },
  ];

  const urls = [...staticUrls, ...articles];

  const xml = `<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
${urls
  .map(
    u => `<url>
  <loc>${u.url}</loc>
  <lastmod>${u.lastmod}</lastmod>
</url>`
  )
  .join("\n")}
</urlset>`;

  return new Response(xml, {
    headers: { "Content-Type": "application/xml" },
  });
}


// app\shop\vendor\[vendor]\[model]\ModelPageInner.jsx
'use client';
import { useParams, useSearchParams } from 'next/navigation';
import { useState, useEffect, useRef } from 'react';
import ShopLayoutInternal from '@/components/ShopLayoutInternal';
import ProductGrid from '@/components/ProductGrid';
import ScrollSearchBar from '@/components/ScrollSearchBar';

export default function ModelPage() {
  const { vendor: vendorParam, model: modelParam } = useParams();
  const searchParams = useSearchParams();
  const filters = Object.fromEntries(searchParams.entries());

  const [items, setItems] = useState([]);
  const [loading, setLoading] = useState(true);
  const [visibleCount, setVisibleCount] = useState(0);

  const containerRef = useRef(null);

  const vendor = filters.vendor || vendorParam;
  const model = filters.model || modelParam;

  const getInitialCount = () => {
    if (typeof window !== 'undefined') {
      return window.innerWidth < 768 ? 6 : 12; 
    }
    return 12;
  };

  useEffect(() => {
    const fetchModel = async () => {
      setLoading(true);
      const params = new URLSearchParams({ vendor, model, ...filters, limit: '100' });
      const res = await fetch(`/api/shopify/search?${params.toString()}`);
      const json = await res.json();

      // âœ… ××™×•×Ÿ ××œ×¤×‘×™×ª×™
      const sorted = (json.items || []).sort((a, b) =>
        a.title.localeCompare(b.title, 'he', { sensitivity: 'base' })
      );

      setItems(sorted);
      setVisibleCount(getInitialCount());
      setLoading(false);
    };

    fetchModel();
  }, [vendor, model, JSON.stringify(filters)]);

  const handleLoadMore = () => {
    if (typeof window !== 'undefined') {
      const increment = window.innerWidth < 768 ? 6 : 12;
      setVisibleCount((prev) => prev + increment);
    }
  };

  return (
    <ShopLayoutInternal>
      {loading && <div className="text-center py-6">×˜×•×¢×Ÿ...</div>}

      {!loading && (
        <div>
          {/* ğŸ” ×—×™×¤×•×© ××•×¦×¨ */}
          <ScrollSearchBar
            placeholder={`×—×¤×© ×—×œ×§ ×‘×“×’× ${vendor} ${model}`}
            containerRef={containerRef}
          />

          {/* ×’×¨×™×“ ××•×¦×¨×™× ×¢× ×›×¤×ª×•×¨ "×˜×¢×Ÿ ×¢×•×“" */}
          <div ref={containerRef}>
            <ProductGrid products={items.slice(0, visibleCount)} />
          </div>

          {visibleCount < items.length && (
            <div className="flex justify-center mt-6">
              <button
                onClick={handleLoadMore}
                className="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition"
              >
                ×˜×¢×Ÿ ×¢×•×“
              </button>
            </div>
          )}
        </div>
      )}
    </ShopLayoutInternal>
  );
}


//app\shop\vendor\[vendor]\[model]\page.jsx

'use client';
export const dynamic = 'force-dynamic';
import { Suspense } from 'react';
import ModelPageInner from './ModelPageInner';

export default function ModelPage() {
  return (
    <Suspense fallback={<div className="text-center py-6">×˜×•×¢×Ÿ ××•×¦×¨×™×...</div>}>
      <ModelPageInner />
    </Suspense>
  );
}


//app\shop\vendor\[vendor]\VendorPageInner.jsx
'use client';
import { useParams, useSearchParams } from 'next/navigation';
import { useState, useEffect, useRef } from 'react';
import ShopLayoutInternal from '@/components/ShopLayoutInternal';
import Image from 'next/image';
import Link from 'next/link';
import ScrollSearchBar from '@/components/ScrollSearchBar';

export default function VendorPage() {
  const { vendor: vendorParam } = useParams();
  const searchParams = useSearchParams();
  const filters = Object.fromEntries(searchParams.entries());

  const [models, setModels] = useState([]);
  const [loading, setLoading] = useState(true);
  const vendor = filters.vendor || vendorParam;

  const containerRef = useRef(null);
  const animationRef = useRef(null);
  const [hasScrolled, setHasScrolled] = useState(false);

  // âš™ï¸ ×©×œ×™×¤×ª ×“×’××™× ××”-API
  useEffect(() => {
    const fetchVendorModels = async () => {
      setLoading(true);

      const cleanFilters = { ...filters };
      ['year', 'yearFrom', 'yearTo'].forEach((key) => {
        if (cleanFilters[key] === '0' || cleanFilters[key] === 0) delete cleanFilters[key];
      });

      const params = new URLSearchParams({ vendor, ...cleanFilters, limit: '100' });
      const res = await fetch(`/api/shopify/search?${params.toString()}`);
      const json = await res.json();

      const items = json.items || [];
      const modelMap = {};

      items.forEach((p) => {
        const modelTag = p.tags.find((t) => t.startsWith('model:'));
        if (modelTag) {
          const modelName = modelTag.replace('model:', '').trim();
          if (!modelMap[modelName]) {
            modelMap[modelName] = {
              name: modelName,
              image: p.images?.edges?.[0]?.node?.url || null,
              handle: modelName.toLowerCase().replace(/\s+/g, '-'),
            };
          }
        }
      });

      const modelsArray = Object.values(modelMap);
      modelsArray.sort((a, b) => a.name.localeCompare(b.name, 'en', { sensitivity: 'base' }));

      setModels(modelsArray);
      setLoading(false);
    };

    fetchVendorModels();
  }, [vendor, JSON.stringify(filters)]);

  // ğŸ¬ ×× ×™××¦×™×™×ª "×¨××– ×’×œ×™×œ×”" â€” ×›××• ××¦×œ ×”×™×¦×¨× ×™×
  useEffect(() => {
    const el = containerRef.current;
    if (!el) return;

    let start = null;
    const maxOffset = 60;
    const duration = 1000;

    const animate = (timestamp) => {
      if (!start) start = timestamp;
      const progress = timestamp - start;
      const offset = Math.sin((progress / duration) * Math.PI) * maxOffset;
      el.scrollLeft = offset;

      if (!hasScrolled && progress < duration * 2) {
        animationRef.current = requestAnimationFrame(animate);
      } else {
        cancelAnimationFrame(animationRef.current);
      }
    };

    const handleUserScroll = () => {
      setHasScrolled(true);
      cancelAnimationFrame(animationRef.current);
    };

    el.addEventListener('scroll', handleUserScroll, { once: true });
    animationRef.current = requestAnimationFrame(animate);

    return () => {
      el.removeEventListener('scroll', handleUserScroll);
      cancelAnimationFrame(animationRef.current);
    };
  }, [hasScrolled]);

  return (
    <ShopLayoutInternal>
      {loading && <div className="text-center py-6">×˜×•×¢×Ÿ...</div>}

      {!loading && (
        <div>
          <ScrollSearchBar placeholder={`×”×—×œ×§ ×©×××œ×” ××• ×—×¤×© ×“×’× ${vendor}`} containerRef={containerRef} />

          <div
            ref={containerRef}
            className="scroll-container flex overflow-x-scroll space-x-4 pb-4 px-2 snap-x snap-mandatory scroll-smooth"
          >
            {models.map((m) => (
              <Link
                key={m.name}
                href={`/shop/vendor/${vendor}/${m.handle}`}
                data-name={m.name}
                className="min-w-[160px] flex-shrink-0 border rounded-lg p-4 shadow hover:shadow-lg transition snap-start bg-white"
              >
                {m.image && (
                  <div className="relative w-full h-24 mb-2">
                    <Image
                      src={m.image}
                      alt={m.name}
                      fill
                      style={{ objectFit: 'contain' }}
                    />
                  </div>
                )}
                <p className="text-center font-semibold text-gray-900 hover:text-[#e60000] transition-colors duration-200">
                  {m.name}
                </p>
              </Link>
            ))}
          </div>
        </div>
      )}
    </ShopLayoutInternal>
  );
}


//app\shop\vendor\[vendor]\page.jsx

'use client';
export const dynamic = 'force-dynamic';
import { Suspense } from 'react';
import VendorPageInner from './VendorPageInner';

export default function VendorPage() {
  return (
    <Suspense fallback={<div className="text-center py-6">×˜×•×¢×Ÿ ×“×’××™×...</div>}>
      <VendorPageInner />
    </Suspense>
  );
}

//app\shop\[handle]\ProductPageInner.jsx
'use client';
import { useEffect, useState } from 'react';
import { useParams, useSearchParams } from 'next/navigation';
import RelatedProducts from '@/components/RelatedProducts';
import RelatedArticles from '@/components/RelatedArticles';
import ShopLayoutInternal from '@/components/ShopLayoutInternal';
import ProductGrid from '@/components/ProductGrid';
import WhatsAppButton from '@/components/WhatsAppButton';
import ProductGallery from '@/components/ProductGallery';
import { getProductYearRange, formatYearRange } from '@/lib/productYears';

export default function ProductPage() {
  const { handle } = useParams();
  const searchParams = useSearchParams();
  const filters = Object.fromEntries(searchParams.entries());

  const [product, setProduct] = useState(null);
  const [loading, setLoading] = useState(true);
  const [adding, setAdding] = useState(false);

  const [items, setItems] = useState([]);
  const [loadingSearch, setLoadingSearch] = useState(false);

  useEffect(() => {
    if (Object.keys(filters).length > 0) {
      setProduct(null);
      return;
    }
    (async () => {
      setLoading(true);
      const res = await fetch(`/api/shopify/product/${handle}`);
      const json = await res.json();
      setProduct(json.item || null);
      setLoading(false);
    })();
  }, [handle, JSON.stringify(filters)]);

  useEffect(() => {
    if (Object.keys(filters).length === 0) return;
    const fetchSearch = async () => {
      setLoadingSearch(true);
      const params = new URLSearchParams({ ...filters, limit: '24' });
      const res = await fetch(`/api/shopify/search?${params.toString()}`);
      const json = await res.json();
      setItems(json.items || []);
      setLoadingSearch(false);
    };
    fetchSearch();
  }, [JSON.stringify(filters)]);

  if (Object.keys(filters).length > 0) {
    return (
      <ShopLayoutInternal>
        {loadingSearch && <div className="py-6 text-center">×˜×•×¢×Ÿ ×—×™×¤×•×©...</div>}
        {!loadingSearch && <ProductGrid products={items} />}
      </ShopLayoutInternal>
    );
  }

  if (loading) return <div dir="rtl">×˜×•×¢×Ÿ...</div>;
  if (!product) return <div dir="rtl">××•×¦×¨ ×œ× × ××¦×</div>;

  const firstVariant = product.variants?.edges?.[0]?.node;
  const tags = product.tags || [];

  // âœ… ××•×“×œ ××”×ª×’×™×
  let modelTag = null;
  const modelFromTag = tags.find((t) => t.toLowerCase().startsWith('model:'));
  if (modelFromTag) modelTag = modelFromTag.replace('model:', '');

  // âœ… ×˜×•×•×— ×©× ×™× ××š ×•×¨×§ ××”Ö¾metafields
  const yr = getProductYearRange(product);
  const yrText = formatYearRange(yr);

  const addToCart = async () => {
    if (!firstVariant) return;
    setAdding(true);
    const res = await fetch('/api/shopify/cart/add', {
      method: 'POST',
      body: JSON.stringify({
        variantId: firstVariant.id,
        quantity: 1,
      }),
    });
    const json = await res.json();
    setAdding(false);
    if (json.cart) {
      window.dispatchEvent(new Event('cartUpdated'));
    } else {
      alert('×©×’×™××” ×‘×”×•×¡×¤×ª ×”××•×¦×¨ ×œ×¢×’×œ×”');
    }
  };

  const whatsappMessage =
    `×©×œ×•×,\n` +
    `×× ×™ ××¢×•× ×™×™×Ÿ ×‘×—×œ×§ "${product.title}" ×¢×‘×•×¨ ×“×’× "${modelTag || firstVariant?.title}".\n` +
    `××¡×¤×¨ ××§×´×˜: ${firstVariant?.sku || 'N/A'}\n` +
    (yrText ? `×©× ×™×: ${yrText}` : '');

  return (
    <ShopLayoutInternal product={product}>
      <div className="grid md:grid-cols-2 gap-6">
        <ProductGallery images={product.images?.edges} title={product.title} />

        <div className="space-y-3 text-gray-900">
          <h1 className="text-2xl font-bold text-gray-900">{product.title}</h1>
          <div
            className="prose max-w-none text-gray-900"
            dangerouslySetInnerHTML={{ __html: product.descriptionHtml }}
          />

          {firstVariant && (
            <div className="text-sm space-y-1 border-t pt-2 text-gray-900">
              <div>
                <span className="font-bold text-gray-900">××—×™×¨: </span>
                {firstVariant.price.amount} {firstVariant.price.currencyCode}
              </div>
              <div>
                <span className="font-bold text-gray-900">××§×´×˜: </span>
                {firstVariant.sku || 'N/A'}
              </div>
              <div>
                <span className="font-bold text-gray-900">××œ××™: </span>
                {firstVariant.quantityAvailable}
              </div>
              <div>
                <span className="font-bold text-gray-900">×“×’×: </span>
                {modelTag ? (
                  <a
                    href={`/shop/vendor/${product.vendor}/${encodeURIComponent(modelTag)}`}
                    className="text-blue-600 underline"
                  >
                    {modelTag}
                  </a>
                ) : (
                  'â€”'
                )}
              </div>
              {yrText && (
                <div>
                  <span className="font-bold text-gray-900">×©× ×™×: </span>
                  {yrText}
                </div>
              )}
            </div>
          )}

          {firstVariant?.availableForSale && firstVariant?.quantityAvailable > 0 ? (
            <button
              onClick={addToCart}
              disabled={adding || !firstVariant}
              className="bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition disabled:opacity-50"
            >
              {adding ? '××•×¡×™×£...' : '×”×•×¡×£ ×œ×¢×’×œ×”'}
            </button>
          ) : (
            <WhatsAppButton message={whatsappMessage} label="× ×’××¨ ×”××œ××™ â€“ ×¦×•×¨ ×§×©×¨" />
          )}
        </div>
      </div>

      <RelatedProducts
        vendor={product.vendor}
        productType={product.productType}
        model={modelTag}
        excludeHandle={product.handle}
      />

      <RelatedArticles
        tags={[
          product.vendor,
          modelTag,
          modelTag ? modelTag.charAt(0).toUpperCase() + modelTag.slice(1) : null,
        ].filter(Boolean)}
      />
    </ShopLayoutInternal>
  );
}


//app\shop\[handle]\page.jsx

'use client';
export const dynamic = 'force-dynamic';
import { Suspense } from 'react';
import ProductPageInner from './ProductPageInner';

export default function ProductPage() {
  return (
    <Suspense fallback={<div className="text-center py-6">×˜×•×¢×Ÿ ××•×¦×¨...</div>}>
      <ProductPageInner />
    </Suspense>
  );
}

// app\shop\ShopPageInner.jsx
'use client';
import ShopLayoutInternal from '@/components/ShopLayoutInternal';
import ManufacturerGrid from '@/components/ManufacturerGrid';

export default function ShopHome() {
  return (
    <ShopLayoutInternal>
      <div className="w-full px-2 md:px-4 mt-4">
        <ManufacturerGrid />
      </div>
    </ShopLayoutInternal>
  );
}


//app\shop\page.jsx
'use client';
export const dynamic = 'force-dynamic';
import { Suspense } from 'react';
import ShopLayoutInternal from '@/components/ShopLayoutInternal';
import ManufacturerGrid from '@/components/ManufacturerGrid';

export default function ShopPage() {
  return (
    <Suspense fallback={<div className="text-center py-6">×˜×•×¢×Ÿ ×—× ×•×ª...</div>}>
      <ShopLayoutInternal>
        <Suspense fallback={<div className="text-center py-4">×˜×•×¢×Ÿ ×§×˜×’×•×¨×™×•×ª...</div>}>
          <div className="w-full px-2 md:px-4 mt-4">
            <ManufacturerGrid />
          </div>
        </Suspense>
      </ShopLayoutInternal>
    </Suspense>
  );
}



//app/page.js
export const dynamic = "force-dynamic"; // â— ×—×™×™×‘ ×œ×”×™×©××¨

import React from "react";
import MainGridContentDesktop from "@/components/MainGridContentDesktop";
import PageContainer from "@/components/PageContainer";

/* -----------------------------------------------------------
   âš™ï¸ ×˜×¢×™× ×ª ×›×ª×‘×•×ª ×Ö¾Strapi (Server Component)
   - ×“×™× ×××™ ×›×“×™ ×œ×× ×•×¢ × ×¤×™×œ×ª build
   - ×¢× revalidate ×›×“×™ ×œ×—×¡×•×š Edge Requests
----------------------------------------------------------- */
async function fetchArticles() {
  const base = process.env.STRAPI_API_URL;

  if (!base) {
    console.error("âŒ STRAPI_API_URL ×œ× ×”×•×’×“×¨");
    return [];
  }

  const url = `${base}/api/articles?populate=*`;

  try {
    // â³ ×”×’×‘×œ×ª ×–××Ÿ ×›×“×™ ×œ× ×œ×”×ª×§×¢ ×× Strapi ×œ× ××’×™×‘
    const controller = new AbortController();
    const timeout = setTimeout(() => controller.abort(), 7000); // 7 ×©× ×™×•×ª

    const res = await fetch(url, {
      next: { revalidate: 60 }, // Cache ×œÖ¾60 ×©× ×™×•×ª
      signal: controller.signal,
    });

    clearTimeout(timeout);

    if (!res.ok) {
      console.error("âŒ ×©×’×™××ª API:", res.status);
      return [];
    }

    const json = await res.json();

    return json.data.map((item) => ({
      id: item.id,
      ...item.attributes,
    }));
  } catch (err) {
    console.error("âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×›×ª×‘×•×ª:", err.message);
    return []; // fallback ×‘×˜×•×— ×›×“×™ ×œ× ×œ×”×¤×™×œ ××ª ×”××ª×¨
  }
}

/* -----------------------------------------------------------
   ğŸ  ×¢××•×“ ×”×‘×™×ª
----------------------------------------------------------- */
export default async function HomePage() {
  const articles = await fetchArticles();

  return (
    <PageContainer title="×“×£ ×”×‘×™×ª" breadcrumbs={[]}>
      <MainGridContentDesktop articles={articles} />

      <h1 className="text-2xl font-bold text-[#e60000] px-4 mt-4">
        OnMotor Media - ××’×–×™×Ÿ ××•×¤× ×•×¢×™× ×™×©×¨××œ×™
      </h1>

      <p className="px-4 mt-2 mb-4 text-gray-700">
        ××’×–×™×Ÿ ××•×¤× ×•×¢×™× ×‘×™×©×¨××œ - ×—×“×©×•×ª, ×¡×§×™×¨×•×ª, ××‘×—× ×™ ×“×¨×›×™×, ×¦×™×•×“, ×˜×™×¤×™×
        ×œ×§×”×™×œ×ª ×”×¨×•×›×‘×™× ×”×ª×•×¡×¡×ª ×‘×™×©×¨××œ.
      </p>
    </PageContainer>
  );
}

// /app/api/contact-for-ad/route.js
export const runtime = 'nodejs';
export const dynamic = 'force-dynamic';

import { NextResponse } from 'next/server';
import { sendMail } from '@/lib/mailer';
import { buildEmailTemplate } from '@/components/utils/emailTemplate';

export async function POST(req) {
  try {
    const { name, phone, email, notes } = await req.json();

    // ×‘×“×™×§×” ×‘×¡×™×¡×™×ª ×©×œ ×©×“×•×ª ×—×•×‘×”
    if (!name || !phone || !email) {
      console.error('âŒ ×—×¡×¨×™× ×©×“×•×ª');
      return NextResponse.json({ success: false, error: 'Missing fields' }, { status: 400 });
    }

    // --- ××™×™×œ ×œ×× ×”×œ ×”××ª×¨ ---
    const adminHtml = buildEmailTemplate(
      '×¦×•×•×ª OnMotor Media',
      '×¤× ×™×™×” ×—×“×©×” ×œ×¤×¨×¡×•× ×‘××ª×¨',
      `
      <div dir="rtl" style="direction:rtl;text-align:right;">
        <p>× ×©×œ×—×” ×¤× ×™×™×” ×—×“×©×” ×œ×¤×¨×¡×•× ×‘××ª×¨:</p>
        <ul style="list-style:none;padding:0;">
          <li><strong>×©×:</strong> ${name}</li>
          <li><strong>×˜×œ×¤×•×Ÿ:</strong> ${phone}</li>
          <li><strong>××™××™×™×œ:</strong> ${email}</li>
          ${notes ? `<li><strong>×¤×™×¨×•×˜ × ×•×¡×£:</strong> ${notes}</li>` : ''}
        </ul>
      </div>
      `
    );

    await sendMail({
      to: process.env.SITE_ADMIN_EMAIL || 'onmotormedia@gmail.com',
      subject: '×¤× ×™×™×” ×—×“×©×” ×œ×¤×¨×¡×•× ×‘××ª×¨',
      html: adminHtml,
    });
    console.log('ğŸ“¤ × ×©×œ×— ××™×™×œ ×œ×× ×”×œ ×”××ª×¨ ×‘×”×¦×œ×—×”.');

    // --- ××™×™×œ ×—×–×¨×” ×œ××©×ª××© ---
    const userHtml = buildEmailTemplate(
      name,
      '×¤× ×™×™×ª×š ×”×ª×§×‘×œ×”',
      `
      <div dir="rtl" style="direction:rtl;text-align:right;">
        <p>× ×¦×™×’ ×¤×¨×¡×•× ×™×¦×•×¨ ××™×ª×š ×§×©×¨ ×‘×”×§×“×.</p>
        ${notes ? `<p><strong>×¤×™×¨×•×˜ × ×•×¡×£:</strong> ${notes}</p>` : ''}
        <p>×‘×‘×¨×›×”,<br/>OnMotor Media</p>
      </div>
      `
    );

    await sendMail({
      to: email,
      subject: '×¤× ×™×™×ª×š ×”×ª×§×‘×œ×” - OnMotor Media',
      html: userHtml,
    });
    console.log('ğŸ“¤ × ×©×œ×— ××™×™×œ ×œ××©×ª××© ×‘×”×¦×œ×—×”.');

    return NextResponse.json({ success: true });
  } catch (err) {
    console.error('âŒ ×©×’×™××” ×‘×©×œ×™×—×ª ××™×™×œ:', err.message);
    return NextResponse.json(
      { success: false, error: err.message || 'Internal Server Error' },
      { status: 500 }
    );
  }
}

//11:05 23.11.2025
// âœ… app/articles/[slug]/page.jsx

export const revalidate = 180; // â¬…ï¸ ×”×©×™× ×•×™ ×”×™×—×™×“ ×©×‘×•×¦×¢
import Script from "next/script";
import PageContainer from "@/components/PageContainer";
import ArticleHeader from "@/components/ArticleHeader";
import SimpleKeyValueTable from "@/components/SimpleKeyValueTable";
import Tags from "@/components/Tags";
import SimilarArticles from "@/components/SimilarArticles";
import { notFound } from "next/navigation";
import CommentsSection from "@/components/CommentsSection";
import Gallery from "@/components/Gallery";
import { labelMap } from "@/utils/labelMap";
import InlineImage from "@/components/InlineImage";
import EmbedContent from "@/components/EmbedContent";
import ScrollToTableButton from "@/components/ScrollToTableButton";
import ScrollToGalleryButton from "@/components/ScrollToGalleryButton";
import ScrollToCommentsButton from "@/components/ScrollToCommentsButton";
import { fixRelativeImages, resolveImageUrl, wrapHondaProxy } from "@/lib/fixArticleImages";
import { getArticleImage } from "@/lib/getArticleImage";
import ArticleShareBottom from "@/components/ArticleShareBottom";




const API_URL = process.env.STRAPI_API_URL;
const PUBLIC_API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL || API_URL;
const SITE_URL = "https://www.onmotormedia.com";
const PLACEHOLDER_IMG = "/default-image.jpg";

// âœ… ×¤×•× ×§×¦×™×•×ª ×¢×–×¨ ×œ×§×™×©×•×¨×™× ×‘Ö¾Rich Text
function normalizeHref(href) {
  if (!href) return '#';
  if (/^https?:\/\//i.test(href) || href.startsWith('mailto:') || href.startsWith('tel:')) return href;
  return href.startsWith('/') ? href : `/${href}`;
}

function isExternal(href) {
  return /^https?:\/\//i.test(href);
}

function renderMarks(text, node) {
  let t = text ?? '';
  if (node?.bold) t = `<strong>${t}</strong>`;
  if (node?.italic) t = `<em>${t}</em>`;
  if (node?.underline) t = `<u>${t}</u>`;
  return t;
}

function toHtmlFromStrapiChildren(children) {
  if (!Array.isArray(children)) return '';
  return children.map((node) => {
    if (node?.type === 'link' || node?.url) {
      const href = normalizeHref(node.url || '#');
      const inner = node.children?.length
        ? toHtmlFromStrapiChildren(node.children)
        : renderMarks(node.text || '', node);
      const target = isExternal(href) ? '_blank' : '_self';
      const rel = isExternal(href) ? 'noopener noreferrer' : '';
      return `<a href="${href}" target="${target}" rel="${rel}" class="text-blue-600 underline hover:text-blue-800">${inner}</a>`;
    }
    if (typeof node?.text === 'string') return renderMarks(node.text, node);
    if (node?.children?.length) return toHtmlFromStrapiChildren(node.children);
    return '';
  }).join('');
}

export async function generateMetadata({ params }) {
  const API_URL = process.env.STRAPI_API_URL;
  const SITE_URL = "https://www.onmotormedia.com";

  try {
    const res = await fetch(
      `${API_URL}/api/articles?filters[slug][$eq]=${params.slug}&populate=*`,
      { cache: "no-store" }
    );

    if (!res.ok) throw new Error(`API fetch failed with status ${res.status}`);
    const json = await res.json();
    const article = json.data?.[0];
    if (!article) return {};

    const title = article.title || "OnMotor Media";
    const description =
      article.headline ||
      article.description ||
      article.subdescription ||
      "×›×ª×‘×” ××ª×•×š ××’×–×™×Ÿ OnMotor Media";

    // ğŸ§  ×§×¨×™××” ×œ×¤×•× ×§×¦×™×” ×”× ×¤×¨×“×ª
    const imageUrl = getArticleImage(article);

    return {
      title: `${title} | OnMotor Media`,
      description,
      alternates: { canonical: `${SITE_URL}/articles/${params.slug}` },
      openGraph: {
        title,
        description,
        type: "article",
        locale: "he_IL",
        url: `${SITE_URL}/articles/${params.slug}`,
        siteName: "OnMotor Media",
        images: [{ url: imageUrl, width: 1200, height: 630, alt: title }],
      },
      twitter: {
        card: "summary_large_image",
        title,
        description,
        images: [imageUrl],
      },
    };
  } catch (err) {
    console.error("âš ï¸ Metadata generation error:", err);
    return {};
  }
}

// ===================================================================
//                       ArticlePage Component
// ===================================================================
export default async function ArticlePage({ params, setPageTitle, setPageBreadcrumbs }) {
  const res = await fetch(
    `${API_URL}/api/articles?filters[slug][$eq]=${params.slug}&populate=*`,
    { next: { revalidate: 0 } }
  );

  const json = await res.json();
  const rawArticle = json.data?.[0];
  if (!rawArticle) return notFound();
  const data = rawArticle;

  const galleryItems = data.gallery?.data
    ? data.gallery.data.map((item) => item.attributes)
    : data.gallery || [];

  const gallery = galleryItems.map((img) => ({
    src: resolveImageUrl(img.url),
    alt: img.alternativeText || "×ª××•× ×” ××”×’×œ×¨×™×”",
  }));

  const externalImageUrls = Array.isArray(data.externalImageUrls)
    ? data.externalImageUrls
    : data.externalImageUrls
    ? [data.externalImageUrls]
    : [];

  const externalMediaUrl = data.externalMediaUrl || null;

  let mainImage = PLACEHOLDER_IMG;
  let mainImageAlt = "×ª××•× ×” ×¨××©×™×ª";

  if (galleryItems?.length > 0 && galleryItems[0]?.url) {
    mainImage = resolveImageUrl(galleryItems[0].url);
    mainImageAlt = galleryItems[0].alternativeText || "×ª××•× ×” ×¨××©×™×ª";
  } else if (data.image?.data?.attributes?.url) {
    mainImage = resolveImageUrl(data.image.data.attributes.url);
    mainImageAlt = data.image.data.attributes.alternativeText || "×ª××•× ×” ×¨××©×™×ª";
  } else if (
    Array.isArray(data.external_media_links) &&
    data.external_media_links.length > 1 &&
    typeof data.external_media_links[1] === "string" &&
    data.external_media_links[1].startsWith("http")
  ) {
    mainImage = resolveImageUrl(data.external_media_links[1].trim());
    mainImageAlt = "×ª××•× ×” ×¨××©×™×ª ××”××“×™×” ×”×—×™×¦×•× ×™×ª";
  } else if (
    Array.isArray(data.external_media_links) &&
    data.external_media_links.length > 0 &&
    typeof data.external_media_links[0] === "string" &&
    data.external_media_links[0].startsWith("http")
  ) {
    // fallback ×× ×™×© ×¨×§ ××—×“
    mainImage = resolveImageUrl(data.external_media_links[0].trim());
    mainImageAlt = "×ª××•× ×” ×¨××©×™×ª ××”××“×™×” ×”×—×™×¦×•× ×™×ª";
  }


  const article = {
    title: data.title || "×›×ª×‘×” ×œ×œ× ×›×•×ª×¨×ª",
    description: data.description || "",
    image: mainImage,
    imageAlt: mainImageAlt,
    author: data.author || "××¢×¨×›×ª OnMotor",
    date: data.date || "2025-06-22",
    time: data.time || "10:00",
    tags: data.tags || [],
    content: data.content || "",
    tableData: data.tableData || {},
    href: `/articles/${params.slug}`,
    category: data.category || "general",
    subcategory: Array.isArray(data.subcategory)
      ? data.subcategory[0]
      : data.subcategory,
    values: Array.isArray(data.Values)
      ? data.Values
      : data.Values
      ? [data.Values]
      : [],
    headline: data.headline || data.title,
    subdescription: data.subdescription || "",
    slug: params.slug,
    gallery,
    externalImageUrls,
    externalMediaUrl,
    external_media_links: data.external_media_links || [],
    font_family: data.font_family || "Heebo, sans-serif",
  };

    // ===============================
  // ğŸ“Œ Structured Data (JSON-LD)
  // ===============================
  const jsonLd = {
    "@context": "https://schema.org",
    "@type": "NewsArticle",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": `https://www.onmotormedia.com/articles/${article.slug}`
    },
    "headline": article.title,
    "description": article.description || article.subdescription || "",
    "image": [article.image],
    "author": {
      "@type": "Person",
      "name": article.author || "×¦×•×•×ª OnMotor"
    },
    "publisher": {
      "@type": "Organization",
      "name": "OnMotor Media",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.onmotormedia.com/OnMotorLogonoback.png"
      }
    },
    "datePublished": article.date,
    "dateModified": article.date,
    "inLanguage": "he-IL",
    "articleSection": article.category,
    "keywords": (article.tags || []).join(", "),
    "articleBody": typeof article.content === "string"
      ? article.content.substring(0, 500)
      : ""
  };


  const breadcrumbs = [{ label: "×“×£ ×”×‘×™×ª", href: "/" }];
  if (article.category)
    breadcrumbs.push({
      label: labelMap[article.category] || article.category,
      href: `/${article.category}`,
    });
  if (article.subcategory)
    breadcrumbs.push({
      label: labelMap[article.subcategory] || article.subcategory,
      href: `/${article.category}/${article.subcategory}`,
    });
  if (article.values?.length > 0) {
    const valueKey = article.values[0];
    breadcrumbs.push({
      label: labelMap[valueKey] || valueKey,
      href: `/${article.category}/${article.subcategory}/${valueKey}`,
    });
  }
  breadcrumbs.push({ label: article.title });
  
  


  // âœ… ×¨×™× ×“×•×¨ ×¤×¡×§××•×ª (×›×•×œ×œ Honda + YouTube)
  const renderParagraph = (block, i) => {
    if (typeof block === "string") {
      const cleanText = fixRelativeImages(block.trim());
      const hasHTMLTags = /<\/?[a-z][\s\S]*>/i.test(cleanText);

      if (hasHTMLTags) {
        return (
          <div
            key={i}
            className="article-text text-gray-800 text-[18px] leading-relaxed"
            dangerouslySetInnerHTML={{
              __html: cleanText.replace(
                /(https:\/\/hondanews\.eu[^\s"'<>]+)/gi,
                (match) => wrapHondaProxy(match)
              ),
            }}
          />
        );
      }

      const urlMatch = cleanText.match(/https?:\/\/[^\s]+/);
      if (urlMatch) {
        let url = urlMatch[0].trim();
        if (url.includes("hondanews.eu")) url = wrapHondaProxy(url);
        // âœ… ×ª××™×›×” ×‘×§×™×©×•×¨×™ Kawasaki
        else if (url.includes("content2.kawasaki.com")) {
          // ×× ×§×” ×¤×¨××˜×¨×™× ×›××• ?w=400 ××”×›×ª×•×‘×ª
          url = url.split("?")[0];
        }


        if (
          /\.(jpg|jpeg|png|gif|webp)$/i.test(url) ||
          url.includes("hondanews.eu/image/") ||
          url.includes("/api/proxy-honda?")
        ) {
          return (
            <InlineImage
              key={i}
              src={url}
              alt="×ª××•× ×” ××ª×•×š ×”×›×ª×‘×”"
              caption=""
            />
          );
        }

        if (
          /(youtube\.com|youtu\.be|facebook\.com|instagram\.com|tiktok\.com|x\.com|twitter\.com)/i.test(
            url
          )
        ) {
          return <EmbedContent key={i} url={url} />;
        }

        return (
          <p key={i} className="article-text text-blue-600 underline">
            <a href={url} target="_blank" rel="noopener noreferrer">
              {url}
            </a>
          </p>
        );
      }

      return (
        <p
          key={i}
          className="article-text text-gray-800 text-[18px] leading-relaxed"
          dangerouslySetInnerHTML={{
            __html: cleanText.replace(/\n/g, "<br/>"),
          }}
        />
      );
    }

    if (block.type === "paragraph" && block.children) {
      let html = toHtmlFromStrapiChildren(block.children);
      html = fixRelativeImages(html);

      const urlMatch = html.match(/https?:\/\/[^\s"']+/);
      if (urlMatch) {
        let url = urlMatch[0];
        if (url.includes("hondanews.eu")) url = wrapHondaProxy(url);
        // âœ… ×ª××™×›×” ×‘×§×™×©×•×¨×™ Kawasaki
        else if (url.includes("content2.kawasaki.com")) {
          // ×× ×§×” ×¤×¨××˜×¨×™× ×›××• ?w=400 ××”×›×ª×•×‘×ª
          url = url.split("?")[0];
        }


        if (
          /\.(jpg|jpeg|png|gif|webp)$/i.test(url) ||
          url.includes("hondanews.eu/image/") ||
          url.includes("/api/proxy-honda?") ||
          url.includes("content2.kawasaki.com/ContentStorage/")


        ) {
          return (
            <InlineImage
              key={i}
              src={url}
              alt="×ª××•× ×” ××ª×•×š ×”×›×ª×‘×”"
              caption=""
            />
          );
        }

        if (
          /(youtube\.com|youtu\.be|facebook\.com|instagram\.com|tiktok\.com|x\.com|twitter\.com)/i.test(
            url
          )
        ) {
          return <EmbedContent key={i} url={url} />;
        }
      }

      return (
        <p
          key={i}
          className="article-text text-gray-800 text-[18px] leading-relaxed"
          dangerouslySetInnerHTML={{
            __html: html.replace(
              /(https:\/\/hondanews\.eu[^\s"'<>]+)/gi,
              (match) => wrapHondaProxy(match)
            ),
          }}
        />
      );
    }

        // âœ… ×˜×™×¤×•×œ ×‘×¨×©×™××•×ª (×××•×¡×¤×¨×•×ª ××• × ×§×•×“×ª×™×•×ª)
    if (block.type === "list") {
      const isOrdered = block.format === "ordered";
      const Tag = isOrdered ? "ol" : "ul";
      return (
        <Tag
          key={i}
          dir="rtl"
          className={`my-3 pr-6 space-y-1 text-[18px] text-gray-800 leading-relaxed ${
            isOrdered ? "list-decimal" : "list-disc"
          }`}
        >
          {block.children?.map((item, idx) => {
            const html = toHtmlFromStrapiChildren(item.children || []);
            return (
              <li
                key={idx}
                dangerouslySetInnerHTML={{
                  __html: fixRelativeImages(html),
                }}
              />
            );
          })}
        </Tag>
      );
    }




    if (block.type === "heading") {
      const level = block.level || 2;
      const Tag = `h${Math.min(level, 3)}`;
      const text = block.children?.map((c) => c.text).join("") || "";
      return (
        <Tag
          key={i}
          className="font-bold text-2xl text-gray-900 mt-4 mb-2"
          dangerouslySetInnerHTML={{ __html: fixRelativeImages(text) }}
        />
      );
    }

    if (block.type === "image") {
      const imageData =
        block.image?.data?.attributes || block.image?.attributes || block.image;
      if (!imageData?.url) return null;
      const alt = imageData.alternativeText || "×ª××•× ×” ××ª×•×š ×”×›×ª×‘×”";
      const caption = imageData.caption || "";
      const src = resolveImageUrl(imageData.url);
      return (
        <InlineImage key={i} src={src} alt={alt} caption={caption} />
      );
    }

    return null;
  };


  const paragraphs = Array.isArray(article.content)
    ? article.content
    : article.content.split("\n\n");

  return (
    <>
      <Script
            id="structured-data"
            type="application/ld+json"
            dangerouslySetInnerHTML={{ __html: JSON.stringify(jsonLd) }}
      />


      <PageContainer title={article.title} breadcrumbs={breadcrumbs}>
        <div
          className="mx-auto max-w-[740px] space-y-2 text-right leading-relaxed text-base text-gray-800 px-2"
          style={{ fontFamily: article.font_family }}
        >
          <ArticleHeader
            author={article.author}
            date={article.date}
            time={article.time}
            image={article.image}
            imageAlt={article.imageAlt}
            title={article.headline}
            subdescription={article.subdescription}
            tags={article.tags}
          />

          {article.description && (
            <p className="font-bold text-2xl text-gray-600">{article.description}</p>
          )}
          
          <div className="article-content">
            {paragraphs.map(renderParagraph)}
          </div>
          {article.tableData && (
            <div className="article-table-section">
              <SimpleKeyValueTable data={article.tableData} />
            </div>
          )}

          <div className="article-gallery-section">
            <Gallery
              images={article.gallery}
              externalImageUrls={article.externalImageUrls}
              externalMediaUrl={article.externalMediaUrl}
              external_media_links={article.external_media_links}
            />
          </div>
          <ArticleShareBottom />
          <div className="comments-section">
            <CommentsSection articleUrl={`${SITE_URL}${article.href}`} />
          </div>

          <Tags tags={article.tags} />
          <div className="similar-articles-section">
            <SimilarArticles currentSlug={article.slug} category={article.category} />
          </div>

          
          
          
        </div>
      </PageContainer>
      <ScrollToTableButton />
      <ScrollToGalleryButton />
      <ScrollToCommentsButton />
    </>
  );
}



// components/SimilarArticles.jsx
'use client';
import React, { useEffect, useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import ArticleCard from '@/components/ArticleCards/ArticleCard';

const API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL || process.env.STRAPI_API_URL;
const PLACEHOLDER_IMG = '/default-image.jpg';

// ×¤×•× ×§×¦×™×” ×œ×ª×™×§×•×Ÿ ×›×ª×•×‘×ª ×ª××•× ×”
function resolveImageUrl(rawUrl) {
  if (!rawUrl) return PLACEHOLDER_IMG;
  if (rawUrl.startsWith('http')) return rawUrl;
  return `${API_URL}${rawUrl.startsWith('/') ? rawUrl : `/uploads/${rawUrl}`}`;
}

export default function SimilarArticles({ currentSlug, category }) {
  const [similar, setSimilar] = useState([]);
  const [currentGroup, setCurrentGroup] = useState(0);
  const [isMobile, setIsMobile] = useState(false);

  // ğŸ‘‰ Swipe states
  const [touchStartX, setTouchStartX] = useState(null);
  const [touchEndX, setTouchEndX] = useState(null);
  const handleSwipe = () => {
    if (!isMobile) return;
    const dx = touchEndX - touchStartX;
    // ×‘Ö¾RTL: ×”×—×œ×§×” ×©×××œ×” â†’ prev
    if (dx < -50) {
      prevGroup(); 
    }
    // ×‘Ö¾RTL: ×”×—×œ×§×” ×™××™× ×” â†’ next
    if (dx > 50) {
      prevGroup();
    }
  };

  // ×–×™×”×•×™ ××•×‘×™×™×œ
  useEffect(() => {
    const handleResize = () => setIsMobile(window.innerWidth < 768);
    handleResize();
    window.addEventListener('resize', handleResize);
    return () => window.removeEventListener('resize', handleResize);
  }, []);

  // ×©×œ×™×¤×ª ×›×ª×‘×•×ª ×“×•××•×ª
  useEffect(() => {
    async function fetchSimilarArticles() {
      try {
        const res = await fetch(
          `${API_URL}/api/articles?populate=*&filters[slug][$ne]=${currentSlug}&filters[category][$eq]=${category}`,
          { cache: 'no-store' }
        );
        const json = await res.json();
        const data = json.data || [];

        const mapped = data.map((a) => {
          let mainImage = PLACEHOLDER_IMG;
          let mainImageAlt = a.title || '×ª××•× ×” ×¨××©×™×ª';

          const galleryItem = a.gallery?.[0];
          if (galleryItem?.url) {
            mainImage = resolveImageUrl(galleryItem.url);
            mainImageAlt = galleryItem.alternativeText || mainImageAlt;
          } else if (a.image?.url) {
            mainImage = resolveImageUrl(a.image.url);
            mainImageAlt = a.image.alternativeText || mainImageAlt;
          } else if (
            Array.isArray(a.external_media_links) &&
            a.external_media_links.length > 0
          ) {
            const validLinks = a.external_media_links.filter(
              (l) => typeof l === 'string' && l.startsWith('http')
            );

            if (validLinks.length > 1) {
              mainImage = validLinks[1].trim();
            } else if (validLinks.length > 0) {
              mainImage = validLinks[0].trim();
            }

            mainImageAlt = '×ª××•× ×” ×¨××©×™×ª ××”××“×™×” ×”×—×™×¦×•× ×™×ª';
          }

          return {
            id: a.id,
            title: a.title,
            slug: a.slug,
            href: `/articles/${a.slug}`,
            headline: a.headline || a.title,
            description: a.description || '',
            date: a.date,
            image: mainImage,
            imageAlt: mainImageAlt,
          };
        });

        setSimilar(mapped);
      } catch (err) {
        console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ×›×ª×‘×•×ª ×“×•××•×ª:', err);
      }
    }

    fetchSimilarArticles();
  }, [currentSlug, category]);

  // ×—×œ×•×§×” ×œ×§×‘×•×¦×•×ª (3 ×œ×“×¡×§×˜×•×¤, 2 ×œ××•×‘×™×™×œ)
  const groupSize = isMobile ? 2 : 3;
  const groups = [];
  for (let i = 0; i < similar.length; i += groupSize) {
    groups.push(similar.slice(i, i + groupSize));
  }

  // ××¢×‘×¨ ××•×˜×•××˜×™ â€” ×¨×§ ×‘××—×©×‘
  useEffect(() => {
    if (isMobile) return;
    if (groups.length <= 1) return;

    const interval = setInterval(() => {
      setCurrentGroup((prev) => (prev + 1) % groups.length);
    }, 6000);

    return () => clearInterval(interval);
  }, [groups.length, isMobile]);

  if (!similar.length) return null;

  const nextGroup = () =>
    setCurrentGroup((prev) => (prev + 1) % groups.length);

  const prevGroup = () =>
    setCurrentGroup((prev) => (prev - 1 + groups.length) % groups.length);

  return (
    <div className="mt-10 relative bg-white p-4 rounded-md shadow-md">
      <h4 className="text-xl font-semibold mb-4 border-b border-gray-300 pb-2">
        ×›×ª×‘×•×ª ×“×•××•×ª
      </h4>

      <div className="overflow-hidden relative">
        <AnimatePresence mode="wait">
          <motion.div
            key={currentGroup}
            initial={{ x: 200, opacity: 0 }}
            animate={{ x: 0, opacity: 1 }}
            exit={{ x: -200, opacity: 0 }}
            transition={{ duration: 0.6 }}
            className={`grid ${
              isMobile ? 'grid-cols-2' : 'grid-cols-3'
            } gap-4`}
            
            // ğŸ‘‰ ×ª××™×›×” ×‘×”×—×œ×§×” ×‘××•×‘×™×™×œ
            onTouchStart={(e) => setTouchStartX(e.touches[0].clientX)}
            onTouchMove={(e) => setTouchEndX(e.touches[0].clientX)}
            onTouchEnd={handleSwipe}
          >
            {groups[currentGroup].map((article) => (
              <ArticleCard
                key={article.slug || article.id}
                article={article}
              />
            ))}
          </motion.div>
        </AnimatePresence>

        {groups.length > 1 && (
          <>
            <button
              onClick={nextGroup}
              className="absolute left-2 top-1/2 transform -translate-y-1/2
              bg-red-600/90 hover:bg-red-600/60 text-white p-3 rounded-full text-2xl transition"
              aria-label="×”×§×•×“×"
            >
              â€º
            </button>
            <button
              onClick={prevGroup}
              className="absolute right-2 top-1/2 transform -translate-y-1/2
              bg-red-600/90 hover:bg-red-600/60 text-white p-3 rounded-full text-2xl transition"
              aria-label="×”×‘×"
            >
              â€¹
            </button>
          </>
        )}
      </div>

      {groups.length > 1 && (
        <div className="flex justify-center space-x-2 mt-3">
          {groups.map((_, idx) => (
            <button
              key={idx}
              onClick={() => setCurrentGroup(idx)}
              className={`w-3 h-3 rounded-full transition ${
                idx === currentGroup ? 'bg-red-600' : 'bg-gray-400'
              }`}
            />
          ))}
        </div>
      )}
    </div>
  );
}


// components/TabLeftSidebar.jsx
'use client';
import React, { useState, useEffect, useRef } from 'react';
import Image from 'next/image';
import useIsMobile from '@/hooks/useIsMobile';
import { getMainImage, resolveImageUrl } from '@/utils/resolveMainImage';

const tabs = ['××—×¨×•× ×™×', '×‘×“×¨×›×™×', '×¤×•×¤×•×œ×¨×™'];
const API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL;

/* ğŸ‘‡ ×¤×•× ×§×¦×™×” ×©××•×¦×™××” ×©× ××ª×¨ × ×§×™ ××ª×•×š ×›×ª×•×‘×ª */
function extractDomainName(url) {
  try {
    const host = new URL(url).hostname.replace('www.', '');
    const parts = host.split('.');
    let base = '';
    if (parts.length >= 3 && ['co', 'org', 'net'].includes(parts[parts.length - 2])) {
      base = parts[parts.length - 3];
    } else {
      base = parts[0];
    }
    return base.charAt(0).toUpperCase() + base.slice(1);
  } catch {
    return 'Website';
  }
}

export default function TabLeftSidebar() {
  const isMobile = useIsMobile();
  const [hasInteracted, setHasInteracted] = useState(false);
  const scrollContainerRef = useRef(null);
  const sidebarRef = useRef(null);

  const [activeTab, setActiveTab] = useState('××—×¨×•× ×™×');
  const [latestArticles, setLatestArticles] = useState([]);
  const [onRoadArticles, setOnRoadArticles] = useState([]);
  const [popularContent, setPopularContent] = useState([]);
  const [isPaused, setIsPaused] = useState(false);

  /* âœ… normalizeItem â€“ ×¢×›×©×™×• ×¢× getMainImage() */
  const normalizeItem = (obj, type = 'article') => {
    const a = obj.attributes || obj;

    // ×§×‘×™×¢×ª ××§×•×¨ (YouTube, TikTok ×•×›×•â€™)
    let autoSource = '';
    if (a.url) {
      if (a.url.includes('youtube.com') || a.url.includes('youtu.be')) autoSource = 'YouTube';
      else if (a.url.includes('tiktok.com')) autoSource = 'TikTok';
      else if (a.url.includes('instagram.com')) autoSource = 'Instagram';
      else if (a.url.includes('facebook.com')) autoSource = 'Facebook';
      else autoSource = extractDomainName(a.url);
    }

    // âœ… ×©×™××•×© ×‘×¤×•× ×§×¦×™×” ×”××¨×›×–×™×ª ×œ×‘×—×™×¨×ª ×ª××•× ×”
    const { mainImage } = getMainImage(a);

    return {
      id: obj.id,
      title: a.title || a.name || '',
      slug: a.slug || '',
      description: a.description || '',
      image: mainImage,
      date: a.date?.split('T')[0] || a.publishedAt?.split('T')[0] || '',
      url: a.url || '',
      views: a.views ?? null,
      source: a.source || autoSource,
    };
  };

  /* âœ… ×©×œ×™×¤×•×ª ××”Ö¾API */
  useEffect(() => {
    const fetchLatest = async () => {
      try {
        const res = await fetch(`${API_URL}/api/articles?sort=date:desc&populate=*`);
        const data = (await res.json()).data || [];
        setLatestArticles(data.map((a) => normalizeItem(a, 'latest-article')));
      } catch (err) {
        console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ××—×¨×•× ×™×:', err);
      }
    };

    const fetchOnRoad = async () => {
      try {
        const res = await fetch(`${API_URL}/api/articles?filters[tags_txt][$contains]=iroads&sort=date:desc&populate=*`);
        const data = (await res.json()).data || [];
        setOnRoadArticles(data.map((a) => normalizeItem(a, 'onroad-article')));
      } catch (err) {
        console.error("×©×’×™××” ×‘×˜×¢×™× ×ª '×‘×“×¨×›×™×':", err);
      }
    };

    const fetchPopular = async () => {
      try {
        const res = await fetch(`${API_URL}/api/populars?sort=date:desc&populate=*`);
        const data = (await res.json()).data || [];

        const withPreview = await Promise.all(
          data.map(async (item) => {
            const norm = normalizeItem(item, 'popular');

            if (norm.image && norm.image !== '/default-image.jpg') return norm;

            // × ×¡×” ×œ×”×‘×™× ×ª×¦×•×’×” ××§×“×™××” (metadata) ×× ××™×Ÿ ×ª××•× ×”
            if (norm.url) {
              try {
                const previewRes = await fetch(`/api/preview?url=${encodeURIComponent(norm.url)}`);
                const previewJson = await previewRes.json();
                if (previewJson?.image) norm.image = previewJson.image;
              } catch (err) {
                console.error('Preview fetch error:', err);
              }
            }

            if (!norm.image) norm.image = '/default-image.jpg';
            return norm;
          })
        );

        setPopularContent(withPreview);
      } catch (err) {
        console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ×¤×•×¤×•×œ×¨×™:', err);
      }
    };

  

    

    fetchLatest();
    fetchOnRoad();
    fetchPopular();
  }, []);

  /* âœ… ×’×œ×™×œ×” ×× ×›×™×ª ××ª××©×›×ª */
  useEffect(() => {
    if (isMobile) return;
    const container = scrollContainerRef.current;
    if (!container) return;

    const speed = 1;
    let frame;
    const step = () => {
      if (!isPaused) {
        container.scrollTop += speed;
        if (container.scrollTop >= container.scrollHeight - container.clientHeight) {
          container.scrollTop = 0;
        }
      }
      frame = requestAnimationFrame(step);
    };
    frame = requestAnimationFrame(step);
    return () => cancelAnimationFrame(frame);
  }, [activeTab, isPaused, isMobile]);

  useEffect(() => {
    if (!isMobile || !sidebarRef.current || !hasInteracted) return;
    setTimeout(() => {
      const y = sidebarRef.current.getBoundingClientRect().top + window.scrollY - 100;
      window.scrollTo({ top: y, behavior: 'smooth' });
    }, 0);
  }, [activeTab, isMobile, hasInteracted]);

  /* âœ… ×¨×™× ×“×•×¨ ×”×¤×¨×™×˜×™× ×œ×¤×™ ×˜××‘ */
  const getStyledContent = (items) => {
    return items.map((item, i) => {
      const even = i % 2 === 0;
      const bg = even ? 'bg-red-50 text-black' : 'bg-neutral-900 text-white';
      return (
        <a
          key={item.id}
          href={item.url || (item.slug ? `/articles/${item.slug}` : '#')}
          target={item.url ? '_blank' : '_self'}
          rel={item.url ? 'noopener noreferrer' : ''}
          className={`flex gap-2 items-start p-1 rounded transition-transform duration-200 ${bg} hover:scale-[1.03] hover:shadow-sm`}
        >
          <div className="w-20 h-14 relative rounded overflow-hidden flex-shrink-0">
            <Image
              src={item.image || '/default-image.jpg'}
              alt={item.title}
              fill
              style={{ objectFit: 'cover' }}
              className="rounded"
            />
          </div>
          <div className="flex flex-col text-right">
            <p className="font-bold text-sm line-clamp-1">{item.title}</p>
            <p className={`text-xs ${even ? 'text-gray-700' : 'text-gray-300'} line-clamp-2`}>
              {item.description}
            </p>
            {item.date && (
              <span className={`text-xs ${even ? 'text-gray-500' : 'text-gray-400'} mt-1`}>
                {item.date}
              </span>
            )}
            {(item.views || item.source) && (
              <span className="text-xs text-gray-400 mt-1">
                {item.views ? `${item.views} ×¦×¤×™×•×ª` : ''}
                {item.views && item.source ? ' Â· ' : ''}
                {item.source || ''}
              </span>
            )}
          </div>
        </a>
      );
    });
  };

  let content = [];
  if (activeTab === '××—×¨×•× ×™×') content = getStyledContent(latestArticles);
  else if (activeTab === '×‘×“×¨×›×™×') content = getStyledContent(onRoadArticles);
  else if (activeTab === '×¤×•×¤×•×œ×¨×™') content = getStyledContent(popularContent);
  else content = getStyledContent(viralContent);

  return (
    <div
      ref={sidebarRef}
      className={`flex flex-col min-h-0 bg-white shadow-md w-full text-sm ${isMobile ? 'w-screen rounded-none' : ''}`}
    >
      <div
        className="flex border-b text-sm font-semibold bg-white sticky top-0 z-10 shadow-sm"
        dir="rtl"
      >
        {tabs.map((tab) => (
          <button
            key={tab}
            onClick={() => {
              setActiveTab(tab);
              setHasInteracted(true);
            }}
            className={`w-1/3 text-center py-2 ${
              activeTab === tab
                ? 'text-black border-b-2 border-red-500 bg-white'
                : 'text-gray-500 bg-gray-100'
            }`}
          >
            {tab}
          </button>
        ))}
      </div>

      <div
        ref={scrollContainerRef}
        onMouseEnter={() => setIsPaused(true)}
        onMouseLeave={() => setIsPaused(false)}
        className="custom-scrollbar overflow-x-hidden p-1 space-y-1 flex-1 overflow-y-auto max-h-[380px]"
        dir="rtl"
      >
        {content}
      </div>
    </div>
  );
}


// components/IroadsBox.jsx
'use client';
import { useEffect, useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import Image from 'next/image';
import Link from 'next/link';
import { getMainImage, resolveImageUrl } from '@/utils/resolveMainImage';

const API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL || process.env.STRAPI_API_URL;
const PLACEHOLDER_IMG = '/default-image.jpg';

export default function IroadsBox() {
  const [articles, setArticles] = useState([]);
  const [currentIndex, setCurrentIndex] = useState(0);

  /* âœ… ×©×œ×™×¤×ª ×›×ª×‘×•×ª ×¢× ×ª×’×™×ª iroads */
  useEffect(() => {
    async function fetchArticles() {
      try {
        const res = await fetch(
          `${API_URL}/api/articles?filters[tags_txt][$contains]=iroads&populate=*`,
          { cache: 'no-store' }
        );
        const json = await res.json();
        setArticles(json.data || []);
      } catch (err) {
        console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ×›×ª×‘×•×ª × ×ª×™×‘×™ ×™×©×¨××œ:', err);
      }
    }
    fetchArticles();
  }, []);

  /* âœ… ××¢×‘×¨ ××•×˜×•××˜×™ ×‘×™×Ÿ ×©×§×•×¤×™×•×ª */
  useEffect(() => {
    if (articles.length === 0) return;
    const interval = setInterval(() => {
      setCurrentIndex((prev) => (prev + 1) % (articles.length + 1)); // +1 ×¢×‘×•×¨ ×”×œ×•×’×•
    }, 5000);
    return () => clearInterval(interval);
  }, [articles]);

  if (articles.length === 0) {
    return (
      <div className="bg-white shadow-md rounded-md overflow-hidden relative mb-4 p-4 text-center">
        <p className="text-gray-600 text-sm">
          ×œ× × ××¦××• ×›×ª×‘×•×ª ×¢× ×ª×’ "× ×ª×™×‘×™ ×™×©×¨××œ"
        </p>
      </div>
    );
  }

  const rawArticles = articles.map((a) => (a.attributes ? a.attributes : a));
  const slides = [{ type: 'logo' }, ...rawArticles];
  const current = slides[currentIndex];

  return (
    <div className="bg-white shadow-md rounded-md overflow-hidden relative mb-4">
      {/* âœ… ×›×•×ª×¨×ª ×¢×œ×™×•× ×” */}
      <Link href="https://www.iroads.co.il/" target="_blank">
        <h3 className="bg-red-600 text-white font-bold text-lg px-3 py-2 cursor-pointer hover:bg-red-700 transition text-right">
          ×‘×›×‘×™×©×™ ×”××¨×¥
        </h3>
      </Link>

      {/* âœ… ×§×¨×•×¡×œ×” */}
      <div className="relative h-72">
        <AnimatePresence mode="wait">
          <motion.div
            key={current.type === 'logo' ? 'logo' : current.id}
            initial={{ x: 300, opacity: 0 }}
            animate={{ x: 0, opacity: 1 }}
            exit={{ x: -300, opacity: 0 }}
            transition={{ duration: 0.6 }}
            className="absolute inset-0"
          >
            {current.type === 'logo' ? (
              <div className="relative w-full h-full">
                {/* âœ… ×›×¤×ª×•×¨ ×ª×œ×•× ×” */}
                <a
                  href="https://www.iroads.co.il/support-form/"
                  target="_blank"
                  rel="noopener noreferrer"
                  className="absolute top-3 left-1/2 -translate-x-1/2 px-6 py-2 bg-red-600 text-white text-sm rounded-md shadow hover:bg-red-700 transition z-10"
                >
                  ×œ×—×¦×• ×œ×”×’×©×ª ×ª×œ×•× ×”
                </a>

                {/* âœ… ×•×™×“××• ×¨×§×¢ */}
                <a
                  href="https://www.iroads.co.il/"
                  target="_blank"
                  rel="noopener noreferrer"
                  className="block w-full h-full"
                >
                  <video
                    src="https://www.iroads.co.il/media/fgpprdnd/%D7%95%D7%99%D7%93%D7%90%D7%95-%D7%A2%D7%9E%D7%95%D7%93-%D7%94%D7%91%D7%99%D7%AA-%D7%9C%D7%9C%D7%90-%D7%A1%D7%90%D7%95%D7%A0%D7%931.mp4"
                    autoPlay
                    loop
                    muted
                    playsInline
                    className="w-full h-full object-cover"
                  />
                </a>
              </div>
            ) : (
              // âœ… ×©×§×•×¤×™×ª ×›×ª×‘×”
              (() => {
                const attrs = current;
                const { mainImage, mainImageAlt } = getMainImage(attrs);

                return (
                  <Link href={attrs.slug ? `/articles/${attrs.slug}` : '#'}>
                    <div className="relative w-full h-full cursor-pointer">
                      <Image
                        src={mainImage || PLACEHOLDER_IMG}
                        alt={mainImageAlt || '×ª××•× ×”'}
                        fill
                        className="object-cover"
                        loading="lazy"
                      />
                      <div className="absolute bottom-0 w-full bg-black/50 text-white p-2 text-sm font-semibold">
                        {attrs.title || '×œ×œ× ×›×•×ª×¨×ª'}
                      </div>
                    </div>
                  </Link>
                );
              })()
            )}
          </motion.div>
        </AnimatePresence>
      </div>

      {/* âœ… ×—×™×¦×™× */}
      <button
        onClick={() =>
          setCurrentIndex((prev) => (prev - 1 + slides.length) % slides.length)
        }
        className="absolute left-2 top-1/2 transform -translate-y-1/2 bg-red-600 text-white p-2 rounded-full"
      >
        â€º
      </button>
      <button
        onClick={() => setCurrentIndex((prev) => (prev + 1) % slides.length)}
        className="absolute right-2 top-1/2 transform -translate-y-1/2 bg-red-600 text-white p-2 rounded-full"
      >
        â€¹
      </button>

      {/* âœ… × ×§×•×“×•×ª ××™× ×“×™×§×¦×™×” */}
      <div className="flex justify-center space-x-2 py-2">
        {slides.map((_, idx) => (
          <button
            key={idx}
            onClick={() => setCurrentIndex(idx)}
            className={`w-2 h-2 rounded-full ${
              idx === currentIndex ? 'bg-red-600' : 'bg-gray-400'
            }`}
          />
        ))}
      </div>
    </div>
  );
}


// components/GuideBox.jsx
'use client';
import { useEffect, useState } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import Image from 'next/image';
import Link from 'next/link';
import { labelMap } from '@/utils/labelMap';
import { getMainImage } from '@/utils/resolveMainImage';

const API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL;

export default function GuideBox() {
  const [articles, setArticles] = useState([]);
  const [currentIndex, setCurrentIndex] = useState(0);

  /* âœ… ×©×œ×™×¤×ª ×›×ª×‘×•×ª ×¢× ×¢×¨×š ×‘××©×ª× ×” Values */
  useEffect(() => {
    async function fetchArticles() {
      try {
        const res = await fetch(
          `${API_URL}/api/articles?filters[Values][$null]=false&populate=*`,
          { cache: 'no-store' }
        );
        const json = await res.json();
        setArticles(json.data || []);
      } catch (err) {
        console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ××“×¨×™×›×™×:', err);
      }
    }
    fetchArticles();
  }, []);

  /* âœ… ××¢×‘×¨ ××•×˜×•××˜×™ ×‘×™×Ÿ ×›×ª×‘×•×ª */
  useEffect(() => {
    if (articles.length === 0) return;
    const interval = setInterval(() => {
      setCurrentIndex((prev) => (prev + 1) % articles.length);
    }, 5000);
    return () => clearInterval(interval);
  }, [articles]);

  if (articles.length === 0) return null;

  const current = articles[currentIndex].attributes || articles[currentIndex];
  const values = Array.isArray(current.Values) ? current.Values : [current.Values];

  // âœ… ×©×™××•×© ×‘×¤×•× ×§×¦×™×” ×”××—×™×“×” ×œ×‘×—×™×¨×ª ×ª××•× ×”
  const { mainImage, mainImageAlt } = getMainImage(current);

  return (
    <div className="bg-white shadow-md rounded-md overflow-hidden relative mb-4">
      {/* ×›×•×ª×¨×ª ×¢× ×œ×™× ×§ ×œ×“×£ ××“×¨×™×›×™× */}
      <Link href="/blog/guides">
        <h3 className="bg-red-600 text-white font-bold text-lg px-3 py-2 cursor-pointer hover:bg-red-700 transition">
          ××“×¨×™×›×™×
        </h3>
      </Link>

      {/* âœ… ×§×¨×•×¡×œ×ª ××“×¨×™×›×™× */}
      <div className="relative h-56">
        <AnimatePresence mode="wait">
          <motion.div
            key={current.id}
            initial={{ x: 300, opacity: 0 }}
            animate={{ x: 0, opacity: 1 }}
            exit={{ x: -300, opacity: 0 }}
            transition={{ duration: 0.6 }}
            className="absolute inset-0"
          >
            <Link href={`/articles/${current.slug}`}>
              <div className="w-full h-full cursor-pointer">
                <Image
                  src={mainImage}
                  alt={mainImageAlt || current.title || '×ª××•× ×ª ××“×¨×™×š'}
                  width={400}
                  height={250}
                  className="w-full h-40 object-cover"
                />
                <p className="p-2 text-sm font-semibold text-gray-800">
                  {current.title}
                </p>
                {values.map((val, idx) => (
                  <p key={idx} className="px-2 text-xs text-gray-500">
                    {labelMap[val] || val}
                  </p>
                ))}
              </div>
            </Link>
          </motion.div>
        </AnimatePresence>
      </div>

      {/* âœ… ×—×™×¦×™ × ×™×•×•×˜ */}
      <button
        onClick={() =>
          setCurrentIndex((prev) => (prev - 1 + articles.length) % articles.length)
        }
        className="absolute left-2 top-1/2 transform -translate-y-1/2 bg-red-600 text-white p-2 rounded-full"
      >
        â€º
      </button>
      <button
        onClick={() => setCurrentIndex((prev) => (prev + 1) % articles.length)}
        className="absolute right-2 top-1/2 transform -translate-y-1/2 bg-red-600 text-white p-2 rounded-full"
      >
        â€¹
      </button>

      {/* âœ… × ×§×•×“×•×ª ××™× ×“×™×§×¦×™×” */}
      <div className="flex justify-center space-x-2 py-2">
        {articles.map((_, idx) => (
          <button
            key={idx}
            onClick={() => setCurrentIndex(idx)}
            className={`w-2 h-2 rounded-full ${
              idx === currentIndex ? 'bg-red-600' : 'bg-gray-400'
            }`}
          />
        ))}
      </div>
    </div>
  );
}


//onmotor-frontend\next.config.mjs
/** @type {import('next').NextConfig} */
const nextConfig = {
Â  images: {
Â  Â  unoptimized: true, // âœ… ×‘×™×˜×•×œ ××•×—×œ×˜ ×©×œ Next.js Image Optimization
Â  Â  domains: [
Â  Â  Â  "localhost",
Â  Â  Â  "cdn.shopify.com",
      "www.onmotormedia.com",
Â  Â  Â  "i.ytimg.com",
Â  Â  Â  "img.youtube.com",
Â  Â  Â  "*.tiktokcdn.com",
Â  Â  Â  "*.tiktokcdn-us.com",
Â  Â  Â  "*.tiktokcdn-va.com",
Â  Â  Â  "*.cdninstagram.com",
Â  Â  Â  "*.fbcdn.net",
Â  Â  Â  "pbs.twimg.com",
Â  Â  Â  "*.twimg.com",
Â  Â  Â  "*.googleusercontent.com",
Â  Â  Â  "lh3.googleusercontent.com",
Â  Â  Â  "fullgaz.co.il",
Â  Â  Â  "www.fullgaz.co.il",
Â  Â  Â  "press.ktm.com",
Â  Â  Â  "res.cloudinary.com",
Â  Â  Â  "onmotormedia.com",
Â  Â  Â  "husqvarna-motorcycles.com",
Â  Â  Â  "gasgas.com",
Â  Â  Â  "ducati.com",
      "global.yamaha-motor.com", // âœ… ×›×‘×¨ ×›××Ÿ ××”×¤×¢× ×”×§×•×“××ª
Â  Â  Â  "hondanews.eu", // âœ… ×”×•×¡×¤× ×• ××ª ×”×•× ×“×”
Â  Â  Â  "yamaha-motor.eu",
Â  Â  Â  "honda.com",
Â  Â  Â  "bmw-motorrad.com",
Â  Â  ],
Â  },
};

export default nextConfig;


// âœ… app/articles/[slug]/page.jsx

export const revalidate = 180; // â¬…ï¸ ×”×©×™× ×•×™ ×”×™×—×™×“ ×©×‘×•×¦×¢
import Script from "next/script";
import PageContainer from "@/components/PageContainer";
import ArticleHeader from "@/components/ArticleHeader";
import SimpleKeyValueTable from "@/components/SimpleKeyValueTable";
import Tags from "@/components/Tags";
import SimilarArticles from "@/components/SimilarArticles";
import { notFound } from "next/navigation";
import CommentsSection from "@/components/CommentsSection";
import Gallery from "@/components/Gallery";
import { labelMap } from "@/utils/labelMap";
import InlineImage from "@/components/InlineImage";
import EmbedContent from "@/components/EmbedContent";
import ScrollToTableButton from "@/components/ScrollToTableButton";
import ScrollToGalleryButton from "@/components/ScrollToGalleryButton";
import ScrollToCommentsButton from "@/components/ScrollToCommentsButton";
import { fixRelativeImages, resolveImageUrl, wrapHondaProxy } from "@/lib/fixArticleImages";
import { getArticleImage } from "@/lib/getArticleImage";
import ArticleShareBottom from "@/components/ArticleShareBottom";



const API_URL = process.env.STRAPI_API_URL;
const PUBLIC_API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL || API_URL;
const SITE_URL = "https://www.onmotormedia.com";
const PLACEHOLDER_IMG = "/default-image.jpg";

// âœ… ×¤×•× ×§×¦×™×•×ª ×¢×–×¨ ×œ×§×™×©×•×¨×™× ×‘Ö¾Rich Text
function normalizeHref(href) {
  if (!href) return '#';
  if (/^https?:\/\//i.test(href) || href.startsWith('mailto:') || href.startsWith('tel:')) return href;
  return href.startsWith('/') ? href : `/${href}`;
}

function isExternal(href) {
  return /^https?:\/\//i.test(href);
}

function renderMarks(text, node) {
  let t = text ?? '';
  if (node?.bold) t = `<strong>${t}</strong>`;
  if (node?.italic) t = `<em>${t}</em>`;
  if (node?.underline) t = `<u>${t}</u>`;
  return t;
}

function toHtmlFromStrapiChildren(children) {
  if (!Array.isArray(children)) return '';
  return children.map((node) => {
    if (node?.type === 'link' || node?.url) {
      const href = normalizeHref(node.url || '#');
      const inner = node.children?.length
        ? toHtmlFromStrapiChildren(node.children)
        : renderMarks(node.text || '', node);
      const target = isExternal(href) ? '_blank' : '_self';
      const rel = isExternal(href) ? 'noopener noreferrer' : '';
      return `<a href="${href}" target="${target}" rel="${rel}" class="text-blue-600 underline hover:text-blue-800">${inner}</a>`;
    }
    if (typeof node?.text === 'string') return renderMarks(node.text, node);
    if (node?.children?.length) return toHtmlFromStrapiChildren(node.children);
    return '';
  }).join('');
}

export async function generateMetadata({ params }) {
  const API_URL = process.env.STRAPI_API_URL;
  const SITE_URL = "https://www.onmotormedia.com";

  try {
    const res = await fetch(
      `${API_URL}/api/articles?filters[slug][$eq]=${params.slug}&populate=*`,
      { cache: "no-store" }
    );

    if (!res.ok) throw new Error(`API fetch failed with status ${res.status}`);
    const json = await res.json();
    const article = json.data?.[0];
    if (!article) return {};

    const title = article.title || "OnMotor Media";
    const description =
      article.headline ||
      article.description ||
      article.subdescription ||
      "×›×ª×‘×” ××ª×•×š ××’×–×™×Ÿ OnMotor Media";

    // ğŸ§  ×§×¨×™××” ×œ×¤×•× ×§×¦×™×” ×”× ×¤×¨×“×ª
    const imageUrl = getArticleImage(article);

    return {
      title: `${title} | OnMotor Media`,
      description,
      alternates: { canonical: `${SITE_URL}/articles/${params.slug}` },
      openGraph: {
        title,
        description,
        type: "article",
        locale: "he_IL",
        url: `${SITE_URL}/articles/${params.slug}`,
        siteName: "OnMotor Media",
        images: [{ url: imageUrl, width: 1200, height: 630, alt: title }],
      },
      twitter: {
        card: "summary_large_image",
        title,
        description,
        images: [imageUrl],
      },
    };
  } catch (err) {
    console.error("âš ï¸ Metadata generation error:", err);
    return {};
  }
}

// ===================================================================
//                       ArticlePage Component
// ===================================================================
export default async function ArticlePage({ params, setPageTitle, setPageBreadcrumbs }) {
  const res = await fetch(
    `${API_URL}/api/articles?filters[slug][$eq]=${params.slug}&populate=*`,
    { next: { revalidate: 0 } }
  );

  const json = await res.json();
  const rawArticle = json.data?.[0];
  if (!rawArticle) return notFound();
  const data = rawArticle;

  const galleryItems = data.gallery?.data
    ? data.gallery.data.map((item) => item.attributes)
    : data.gallery || [];

  const gallery = galleryItems.map((img) => ({
    src: resolveImageUrl(img.url),
    alt: img.alternativeText || "×ª××•× ×” ××”×’×œ×¨×™×”",
  }));

  const externalImageUrls = Array.isArray(data.externalImageUrls)
    ? data.externalImageUrls
    : data.externalImageUrls
    ? [data.externalImageUrls]
    : [];

  const externalMediaUrl = data.externalMediaUrl || null;

  let mainImage = PLACEHOLDER_IMG;
  let mainImageAlt = "×ª××•× ×” ×¨××©×™×ª";

  if (galleryItems?.length > 0 && galleryItems[0]?.url) {
    mainImage = resolveImageUrl(galleryItems[0].url);
    mainImageAlt = galleryItems[0].alternativeText || "×ª××•× ×” ×¨××©×™×ª";
  } else if (data.image?.data?.attributes?.url) {
    mainImage = resolveImageUrl(data.image.data.attributes.url);
    mainImageAlt = data.image.data.attributes.alternativeText || "×ª××•× ×” ×¨××©×™×ª";
  } else if (
    Array.isArray(data.external_media_links) &&
    data.external_media_links.length > 1 &&
    typeof data.external_media_links[1] === "string" &&
    data.external_media_links[1].startsWith("http")
  ) {
    mainImage = data.external_media_links[1].trim();
    mainImageAlt = "×ª××•× ×” ×¨××©×™×ª ××”××“×™×” ×”×—×™×¦×•× ×™×ª";
  }

  const article = {
    title: data.title || "×›×ª×‘×” ×œ×œ× ×›×•×ª×¨×ª",
    description: data.description || "",
    image: mainImage,
    imageAlt: mainImageAlt,
    author: data.author || "××¢×¨×›×ª OnMotor",
    date: data.date || "2025-06-22",
    time: data.time || "10:00",
    tags: data.tags || [],
    content: data.content || "",
    tableData: data.tableData || {},
    href: `/articles/${params.slug}`,
    category: data.category || "general",
    subcategory: Array.isArray(data.subcategory)
      ? data.subcategory[0]
      : data.subcategory,
    values: Array.isArray(data.Values)
      ? data.Values
      : data.Values
      ? [data.Values]
      : [],
    headline: data.headline || data.title,
    subdescription: data.subdescription || "",
    slug: params.slug,
    gallery,
    externalImageUrls,
    externalMediaUrl,
    external_media_links: data.external_media_links || [],
    font_family: data.font_family || "Heebo, sans-serif",
  };

    // ===============================
  // ğŸ“Œ Structured Data (JSON-LD)
  // ===============================
  const jsonLd = {
    "@context": "https://schema.org",
    "@type": "NewsArticle",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": `https://www.onmotormedia.com/articles/${article.slug}`
    },
    "headline": article.title,
    "description": article.description || article.subdescription || "",
    "image": [article.image],
    "author": {
      "@type": "Person",
      "name": article.author || "×¦×•×•×ª OnMotor"
    },
    "publisher": {
      "@type": "Organization",
      "name": "OnMotor Media",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.onmotormedia.com/OnMotorLogonoback.png"
      }
    },
    "datePublished": article.date,
    "dateModified": article.date,
    "inLanguage": "he-IL",
    "articleSection": article.category,
    "keywords": (article.tags || []).join(", "),
    "articleBody": typeof article.content === "string"
      ? article.content.substring(0, 500)
      : ""
  };


  const breadcrumbs = [{ label: "×“×£ ×”×‘×™×ª", href: "/" }];
  if (article.category)
    breadcrumbs.push({
      label: labelMap[article.category] || article.category,
      href: `/${article.category}`,
    });
  if (article.subcategory)
    breadcrumbs.push({
      label: labelMap[article.subcategory] || article.subcategory,
      href: `/${article.category}/${article.subcategory}`,
    });
  if (article.values?.length > 0) {
    const valueKey = article.values[0];
    breadcrumbs.push({
      label: labelMap[valueKey] || valueKey,
      href: `/${article.category}/${article.subcategory}/${valueKey}`,
    });
  }
  breadcrumbs.push({ label: article.title });
  
  


  // âœ… ×¨×™× ×“×•×¨ ×¤×¡×§××•×ª (×›×•×œ×œ Honda + YouTube)
  const renderParagraph = (block, i) => {
    if (typeof block === "string") {
      const cleanText = fixRelativeImages(block.trim());
      const hasHTMLTags = /<\/?[a-z][\s\S]*>/i.test(cleanText);

      if (hasHTMLTags) {
        return (
          <div
            key={i}
            className="article-text text-gray-800 text-[18px] leading-relaxed"
            dangerouslySetInnerHTML={{
              __html: cleanText.replace(
                /(https:\/\/hondanews\.eu[^\s"'<>]+)/gi,
                (match) => wrapHondaProxy(match)
              ),
            }}
          />
        );
      }

      const urlMatch = cleanText.match(/https?:\/\/[^\s]+/);
      if (urlMatch) {
        let url = urlMatch[0].trim();
        if (url.includes("hondanews.eu")) url = wrapHondaProxy(url);
        // âœ… ×ª××™×›×” ×‘×§×™×©×•×¨×™ Kawasaki
        else if (url.includes("content2.kawasaki.com")) {
          // ×× ×§×” ×¤×¨××˜×¨×™× ×›××• ?w=400 ××”×›×ª×•×‘×ª
          url = url.split("?")[0];
        }


        if (
          /\.(jpg|jpeg|png|gif|webp)$/i.test(url) ||
          url.includes("hondanews.eu/image/") ||
          url.includes("/api/proxy-honda?")
        ) {
          return (
            <InlineImage
              key={i}
              src={url}
              alt="×ª××•× ×” ××ª×•×š ×”×›×ª×‘×”"
              caption=""
            />
          );
        }

        if (
          /(youtube\.com|youtu\.be|facebook\.com|instagram\.com|tiktok\.com|x\.com|twitter\.com)/i.test(
            url
          )
        ) {
          return <EmbedContent key={i} url={url} />;
        }

        return (
          <p key={i} className="article-text text-blue-600 underline">
            <a href={url} target="_blank" rel="noopener noreferrer">
              {url}
            </a>
          </p>
        );
      }

      return (
        <p
          key={i}
          className="article-text text-gray-800 text-[18px] leading-relaxed"
          dangerouslySetInnerHTML={{
            __html: cleanText.replace(/\n/g, "<br/>"),
          }}
        />
      );
    }

    if (block.type === "paragraph" && block.children) {
      let html = toHtmlFromStrapiChildren(block.children);
      html = fixRelativeImages(html);

      const urlMatch = html.match(/https?:\/\/[^\s"']+/);
      if (urlMatch) {
        let url = urlMatch[0];
        if (url.includes("hondanews.eu")) url = wrapHondaProxy(url);
        // âœ… ×ª××™×›×” ×‘×§×™×©×•×¨×™ Kawasaki
        else if (url.includes("content2.kawasaki.com")) {
          // ×× ×§×” ×¤×¨××˜×¨×™× ×›××• ?w=400 ××”×›×ª×•×‘×ª
          url = url.split("?")[0];
        }


        if (
          /\.(jpg|jpeg|png|gif|webp)$/i.test(url) ||
          url.includes("hondanews.eu/image/") ||
          url.includes("/api/proxy-honda?") ||
          url.includes("content2.kawasaki.com/ContentStorage/")


        ) {
          return (
            <InlineImage
              key={i}
              src={url}
              alt="×ª××•× ×” ××ª×•×š ×”×›×ª×‘×”"
              caption=""
            />
          );
        }

        if (
          /(youtube\.com|youtu\.be|facebook\.com|instagram\.com|tiktok\.com|x\.com|twitter\.com)/i.test(
            url
          )
        ) {
          return <EmbedContent key={i} url={url} />;
        }
      }

      return (
        <p
          key={i}
          className="article-text text-gray-800 text-[18px] leading-relaxed"
          dangerouslySetInnerHTML={{
            __html: html.replace(
              /(https:\/\/hondanews\.eu[^\s"'<>]+)/gi,
              (match) => wrapHondaProxy(match)
            ),
          }}
        />
      );
    }

        // âœ… ×˜×™×¤×•×œ ×‘×¨×©×™××•×ª (×××•×¡×¤×¨×•×ª ××• × ×§×•×“×ª×™×•×ª)
    if (block.type === "list") {
      const isOrdered = block.format === "ordered";
      const Tag = isOrdered ? "ol" : "ul";
      return (
        <Tag
          key={i}
          dir="rtl"
          className={`my-3 pr-6 space-y-1 text-[18px] text-gray-800 leading-relaxed ${
            isOrdered ? "list-decimal" : "list-disc"
          }`}
        >
          {block.children?.map((item, idx) => {
            const html = toHtmlFromStrapiChildren(item.children || []);
            return (
              <li
                key={idx}
                dangerouslySetInnerHTML={{
                  __html: fixRelativeImages(html),
                }}
              />
            );
          })}
        </Tag>
      );
    }




    if (block.type === "heading") {
      const level = block.level || 2;
      const Tag = `h${Math.min(level, 3)}`;
      const text = block.children?.map((c) => c.text).join("") || "";
      return (
        <Tag
          key={i}
          className="font-bold text-2xl text-gray-900 mt-4 mb-2"
          dangerouslySetInnerHTML={{ __html: fixRelativeImages(text) }}
        />
      );
    }

    if (block.type === "image") {
      const imageData =
        block.image?.data?.attributes || block.image?.attributes || block.image;
      if (!imageData?.url) return null;
      const alt = imageData.alternativeText || "×ª××•× ×” ××ª×•×š ×”×›×ª×‘×”";
      const caption = imageData.caption || "";
      const src = resolveImageUrl(imageData.url);
      return (
        <InlineImage key={i} src={src} alt={alt} caption={caption} />
      );
    }

    return null;
  };


  const paragraphs = Array.isArray(article.content)
    ? article.content
    : article.content.split("\n\n");

  return (
    <>
      <Script
            id="structured-data"
            type="application/ld+json"
            dangerouslySetInnerHTML={{ __html: JSON.stringify(jsonLd) }}
      />


      <PageContainer title={article.title} breadcrumbs={breadcrumbs}>
        <div
          className="mx-auto max-w-[740px] space-y-2 text-right leading-relaxed text-base text-gray-800 px-2"
          style={{ fontFamily: article.font_family }}
        >
          <ArticleHeader
            author={article.author}
            date={article.date}
            time={article.time}
            image={article.image}
            imageAlt={article.imageAlt}
            title={article.headline}
            subdescription={article.subdescription}
            tags={article.tags}
          />

          {article.description && (
            <p className="font-bold text-2xl text-gray-600">{article.description}</p>
          )}
          
          <div className="article-content">
            {paragraphs.map(renderParagraph)}
          </div>
          {article.tableData && (
            <div className="article-table-section">
              <SimpleKeyValueTable data={article.tableData} />
            </div>
          )}

          <div className="article-gallery-section">
            <Gallery
              images={article.gallery}
              externalImageUrls={article.externalImageUrls}
              externalMediaUrl={article.externalMediaUrl}
              external_media_links={article.external_media_links}
            />
          </div>
          <ArticleShareBottom />
          <div className="comments-section">
            <CommentsSection articleUrl={`${SITE_URL}${article.href}`} />
          </div>

          <Tags tags={article.tags} />
          <div className="similar-articles-section">
            <SimilarArticles currentSlug={article.slug} category={article.category} />
          </div>

          
          
          
        </div>
      </PageContainer>
      <ScrollToTableButton />
      <ScrollToGalleryButton />
      <ScrollToCommentsButton />
    </>
  );
}


// âœ… components/InlineImage.jsx
'use client';
import React from 'react';

export default function InlineImage({ src, alt = '', caption = '', maxWidth = '100%' }) {
  if (!src) return null;

  return (
    <div className="my-6 flex flex-col items-center gap-2">
      <img
        src={src}
        alt={alt}
        style={{ maxWidth }}
        className="rounded-md border border-gray-300 shadow-sm"
      />
      {caption && (
        <p className="text-sm text-gray-500 text-center max-w-[90%]">{caption}</p>
      )}
    </div>
  );
}


// app/api/fetch-external-images/route.js
import { fetchExternalImages } from '@/lib/fetchExternalImages';

export async function GET(req) {
  const { searchParams } = new URL(req.url);
  const url = searchParams.get('url');

  if (!url)
    return new Response(JSON.stringify({ error: 'Missing URL' }), { status: 400 });

  try {
    const images = await fetchExternalImages(url);
    return new Response(JSON.stringify({ images }), { status: 200 });
  } catch (err) {
    console.error('âŒ fetch-external-images error:', err);
    return new Response(JSON.stringify({ error: 'Failed to fetch images' }), {
      status: 500,
    });
  }
}



//lib\fetchExternalImages.js
import * as cheerio from 'cheerio';

/**
 * âœ… Universal version:
 * - Yamaha Media (release-overview, ×›×•×œ×œ ×—×™×¤×•×© ×™×©×™×¨ ×‘Ö¾CDN)
 * - Yamaha PDP (api/product-assets)
 * - KTM press
 * - Honda News (×›×•×œ×œ ×¢×˜×™×¤×ª proxy ××•×˜×•××˜×™×ª)
 * - fallback ×œ×›×œ ××ª×¨ ××—×¨
 */
export async function fetchExternalImages(pageUrl) {
  try {
    console.log(`ğŸ” Fetching images from ${pageUrl}`);
    const found = new Set();
    const proxyBase = process.env.NEXT_PUBLIC_SITE_URL || 'https://www.onmotormedia.com';

    // ğŸ–¼ï¸ ×˜×™×¤×•×œ ×‘×§×™×©×•×¨×™ ×ª××•× ×” ×™×©×™×¨×™× (×›×•×œ×œ Honda News ×œ×œ× ×¡×™×•××ª)
    if (
      pageUrl.match(/\.(jpg|jpeg|png|webp|gif|avif)(\?|$)/i) ||
      pageUrl.match(/hondanews\.eu\/image\/motorcycles\/(low|high|original)\/\d+/i)
    ) {
      console.log('ğŸ–¼ï¸ Direct Honda image URL detected');

      // âœ… ×¢×˜×™×¤×” ××•×˜×•××˜×™×ª ×‘×§×™×“×•××ª proxy ×× ××“×•×‘×¨ ×‘-Honda
      if (pageUrl.includes('hondanews.eu')) {
        const proxyUrl = `${proxyBase}/api/proxy-honda?url=${encodeURIComponent(pageUrl)}`;
        console.log(`ğŸ”„ Wrapped in proxy: ${proxyUrl}`);
        return [{ src: proxyUrl, alt: '', title: '' }];
      }

      // ××—×¨×ª â€“ × ×‘×“×•×§ ××ª ×›×œ ×”×•×•×¨×™××¦×™×•×ª
      const candidates = [
        pageUrl.replace('/low/', '/original/'),
        pageUrl.replace('/low/', '/high/'),
        pageUrl,
      ];

      const validImages = [];
      for (const url of candidates) {
        try {
          const res = await fetch(url, {
            method: 'HEAD',
            headers: {
              'User-Agent':
                'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128 Safari/537.36',
              'Accept':
                'image/avif,image/webp,image/apng,image/*,*/*;q=0.8',
              'Referer': 'https://hondanews.eu/',
            },
            redirect: 'follow',
          });
          const type = res.headers.get('content-type') || '';
          if (type.startsWith('image/')) {
            console.log(`âœ… Found valid image: ${url}`);
            validImages.push({ src: url, alt: '', title: '' });
          } else {
            console.warn(`âš ï¸ Skipped non-image (maybe logo): ${url}`);
          }
        } catch (err) {
          console.warn(`âŒ Failed to fetch: ${url}`);
        }
      }

      if (validImages.length > 0) return validImages;
    }

    // ğŸŸ£ ×˜×™×¤×•×œ ×‘×§×™×©×•×¨×™× ×©×œ Yamaha Media Library (inriver_preview)
    if (pageUrl.includes('medialibrary.yamaha-motor.eu/plugins/inriver_preview/asset/')) {
      console.log('âš™ï¸ Yamaha Media Library asset detected');

      // ×—×™×œ×•×¥ ××–×”×” ×”× ×›×¡
      const match = pageUrl.match(/asset\/([^/]+)\//);
      if (match) {
        const assetId = match[1];
        const cdnUrl = `https://medialibrary.yamaha-motor.eu/api/asset/${assetId}/download?size=original`;
        console.log(`âœ… Reconstructed Yamaha CDN URL: ${cdnUrl}`);
        return [{ src: cdnUrl, alt: '', title: '' }];
      }

      // fallback ×× ×œ× ×”×¦×œ×™×—
      return [{ src: pageUrl, alt: '', title: '' }];
    }


    // ğŸŸ£ 1. Yamaha Media (release-overview)
    if (pageUrl.includes('media.yamaha-motor.eu')) {
      console.log('âš™ï¸ Yamaha Media site detected â€” direct CDN scan');

      try {
        const response = await fetch(pageUrl, {
          headers: {
            'User-Agent':
              'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128 Safari/537.36',
          },
        });

        if (!response.ok)
          throw new Error(`HTTP ${response.status} when fetching ${pageUrl}`);

        const html = await response.text();

        // ğŸ¯ ×—×™×œ×•×¥ ×™×©×™×¨ ×©×œ ×§×™×©×•×¨×™× ×œ×ª××•× ×•×ª Yamaha CDN (×’× ×× ××•×¡×ª×¨×™× ×‘×¡×§×¨×™×¤×˜×™×)
        const yamahaMatches = html.match(
          /(https:\/\/cdn2\.yamaha-motor\.eu\/[^\s"'<>]+\.(?:jpg|jpeg|png|webp|gif|avif))/gi
        );

        if (yamahaMatches?.length) {
          yamahaMatches.forEach((src) => found.add(src));
          console.log(`âœ… Found ${found.size} Yamaha CDN images`);
        } else {
          console.warn('âš ï¸ No Yamaha CDN images found directly in HTML');
        }
      } catch (err) {
        console.error('âŒ Yamaha Media fetch error:', err);
      }
    }

    // ğŸŸ¢ 2. Yamaha PDP
    if (pageUrl.includes('yamaha-motor.eu') && pageUrl.includes('/pdp/')) {
      console.log('âš™ï¸ Yamaha PDP mode activated');
      const yamahaMatch = pageUrl.match(/pdp\/([^/]+)-(\d{4})/i);

      if (yamahaMatch) {
        const model = yamahaMatch[1].toUpperCase().replace(/-/g, '');
        const year = yamahaMatch[2];
        const apiUrl = `https://www.yamaha-motor.eu/api/product-assets/${year}/${model}`;
        console.log(`ğŸ“¦ Fetching Yamaha PDP assets from ${apiUrl}`);

        try {
          const res = await fetch(apiUrl, {
            headers: {
              'User-Agent':
                'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127 Safari/537.36',
            },
          });

          if (res.ok) {
            const json = await res.json();

            const extractFromJson = (obj) => {
              if (!obj) return;
              if (
                typeof obj === 'string' &&
                obj.includes('cdn2.yamaha-motor.eu')
              ) {
                found.add(obj);
              } else if (typeof obj === 'object') {
                Object.values(obj).forEach(extractFromJson);
              }
            };

            extractFromJson(json);
            console.log(`âœ… Yamaha PDP API returned ${found.size} images`);
          }
        } catch (err) {
          console.error('âŒ Yamaha PDP API fetch error:', err);
        }
      }
    }

    // ğŸŸ  3. KTM press fallback
    if (pageUrl.includes('press.ktm.com')) {
      console.log('âš™ï¸ KTM press site detected');
      const response = await fetch(pageUrl, {
        headers: {
          'User-Agent':
            'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127 Safari/537.36',
        },
      });

      if (!response.ok)
        throw new Error(`HTTP ${response.status} when fetching ${pageUrl}`);

      const html = await response.text();

      const matches = html.match(
        /(https:\/\/press\.ktm\.com\/Content\/[A-Za-z0-9/_-]+\/(?:1200|2400)\.jpg)/gi
      );

      if (matches?.length) {
        matches.forEach((src) => found.add(src));
        console.log(`âœ… Found ${matches.length} KTM images`);
      }
    }

    // ğŸ”´ 4. Honda News (Europe)
    if (pageUrl.includes('hondanews.eu')) {
      console.log('âš™ï¸ Honda News site detected');

      // ×× ××“×•×‘×¨ ×‘×¢××•×“ ××“×™×” (×œ× ×§×•×‘×¥ ×ª××•× ×” ×™×©×™×¨)
      if (pageUrl.includes('/media/photos/')) {
        console.log('ğŸ§­ Honda media photo page detected, parsing HTML to extract image...');
        try {
          const response = await fetch(pageUrl, {
            headers: {
              'User-Agent':
                'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128 Safari/537.36',
              'Referer': 'https://hondanews.eu/',
            },
          });

          if (response.ok) {
            const html = await response.text();
            const match = html.match(/https:\/\/hondanews\.eu\/image\/motorcycles\/[^\s"'<>]+/i);
            if (match) {
              const imageUrl = match[0];
              console.log(`âœ… Found direct Honda image: ${imageUrl}`);
              const proxyUrl = `${proxyBase}/api/proxy-honda?url=${encodeURIComponent(imageUrl)}`;
              return [{ src: proxyUrl, alt: '', title: '' }];
            } else {
              console.warn('âš ï¸ No image URL found inside Honda media page');
            }
          } else {
            console.warn(`âš ï¸ Failed to fetch Honda media page: ${response.status}`);
          }
        } catch (err) {
          console.error('âŒ Error parsing Honda media page:', err);
        }
      }

      // ××—×¨×ª â€“ ×¢×˜×™×¤×” ××•×˜×•××˜×™×ª
      const proxyUrl = `${proxyBase}/api/proxy-honda?url=${encodeURIComponent(pageUrl)}`;
      console.log(`ğŸ–¼ï¸ Direct Honda image URL, wrapped with proxy: ${proxyUrl}`);
      return [{ src: proxyUrl, alt: '', title: '' }];
    }

    // ğŸ§© 5. fallback ×›×œ×œ×™
    if (found.size === 0) {
      const response = await fetch(pageUrl, {
        headers: {
          'User-Agent':
            'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127 Safari/537.36',
        },
      });

      if (response.ok) {
        const html = await response.text();
        const $ = cheerio.load(html);
        const baseUrl = new URL(pageUrl).origin;

        const normalizeUrl = (src) => {
          if (!src) return null;
          if (src.startsWith('http')) return src;
          if (src.startsWith('//')) return `https:${src}`;
          if (src.startsWith('data:')) return null;
          return `${baseUrl}/${src.replace(/^\/+/, '')}`;
        };

        $('img,[data-src],[data-lazy],[data-bg],[data-original]').each((_, el) => {
          const src =
            $(el).attr('src') ||
            $(el).attr('data-src') ||
            $(el).attr('data-lazy') ||
            $(el).attr('data-bg') ||
            $(el).attr('data-original');
          const full = normalizeUrl(src);
          if (full) found.add(full);
        });

        $('meta[property="og:image"], meta[name="twitter:image"]').each((_, el) => {
          const content = $(el).attr('content');
          const full = normalizeUrl(content);
          if (full) found.add(full);
        });
      }
    }

    // âœ… × ×™×§×•×™ ×¡×•×¤×™ ×¢× ×›×œ ×”××¡× × ×™× ×©×œ×š
    const images = Array.from(found)
      .filter((src) =>
        /\.(jpg|jpeg|png|gif|webp|avif)$/i.test(src.toLowerCase()) ||
        src.includes("/api/proxy-honda")
      )
      .filter((src) => !src.toLowerCase().includes('loading.gif'))
      .filter((src) => !src.toLowerCase().includes('/assets/img/0.gif'))
      .filter((src) => !src.toLowerCase().includes('/assets/img/logo.png'))
      .filter((src) => !src.toLowerCase().includes('/assets/img/icon_pdf.png'))
      .filter((src) => !src.toLowerCase().includes('placeholder'))
      .map((src) => ({ src, alt: '', title: '' }));

    console.log(`âœ… Found ${images.length} total images from ${pageUrl}`);
    return images;
  } catch (err) {
    console.error('âŒ fetchExternalImages error:', err);
    return [];
  }
}


// lib/fixArticleImages.js
const API_URL = process.env.STRAPI_API_URL;
const PUBLIC_API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL || API_URL;
const SITE_URL = process.env.NEXT_PUBLIC_SITE_URL || "https://www.onmotormedia.com";
const PLACEHOLDER_IMG = "/default-image.jpg";

/**
 * âœ… ××–×”×” ×× ×§×™×©×•×¨ ×©×™×™×š ×œ-Honda ×•××—×–×™×¨ ×¢×˜×™×¤×” ×‘×¤×¨×•×§×¡×™
 */
export function wrapHondaProxy(url) {
  if (!url) return null;
  if (url.includes("hondanews.eu")) {
    return `${SITE_URL}/api/proxy-honda?url=${encodeURIComponent(url)}`;
  }
  return url;
}

/**
 * âœ… ××ª×§× ×ª × ×ª×™×‘×™ ×ª××•× ×•×ª ×™×—×¡×™×™× ×‘×ª×•×š HTML
 * ×›×•×œ×œ ×¢×˜×™×¤×” ×©×œ ×§×™×©×•×¨×™ Honda ×“×¨×š ×”×¤×¨×•×§×¡×™.
 */
export function fixRelativeImages(html) {
  if (!html) return html;

  return html.replace(
    /<img\s+[^>]*src=["']([^"']+)["']/g,
    (match, src) => {
      let fullSrc = src;

      // ğŸŸ¢ ×¢×˜×™×¤×” ××•×˜×•××˜×™×ª ×œ×ª××•× ×•×ª Honda
      if (src.includes("hondanews.eu")) {
        fullSrc = `${SITE_URL}/api/proxy-honda?url=${encodeURIComponent(src)}`;
      }
      // âœ… ×ª××™×›×” ×‘×§×™×©×•×¨×™ Kawasaki
      else if (src.includes("content2.kawasaki.com")) {
        // ×”×¡×¨ ×¤×¨××˜×¨×™× ×›××• ?w=400
        fullSrc = src.split("?")[0];
    }   

      // ğŸŸ  × ×ª×™×‘ ×™×—×¡×™
      else if (!src.startsWith("http")) {
        fullSrc = src.startsWith("/")
          ? `${PUBLIC_API_URL}${src}`
          : `${PUBLIC_API_URL}/uploads/${src}`;
      }

      return match.replace(src, fullSrc);
    }
  );
}

/**
 * âœ… ×××™×¨×” ×›×ª×•×‘×ª ×ª××•× ×” ×œ× ×ª×™×‘ ××œ×
 * ×›×•×œ×œ ×¢×˜×™×¤×” ×‘×¤×¨×•×§×¡×™ ×œ×”×•× ×“×”.
 */
export function resolveImageUrl(rawUrl) {
  if (!rawUrl) return PLACEHOLDER_IMG;

  if (rawUrl.includes("hondanews.eu")) {
    return `${SITE_URL}/api/proxy-honda?url=${encodeURIComponent(rawUrl)}`;
  }

  if (rawUrl.startsWith("http")) return rawUrl;

  return `${PUBLIC_API_URL}${rawUrl.startsWith("/") ? rawUrl : `/uploads/${rawUrl}`}`;
}




// components/Gallery.jsx
'use client';
import React, { useState, useEffect, useMemo } from 'react';

const PUBLIC_API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL;

// âœ… ××—×œ×¥ ×›×ª×•×‘×•×ª URL ×ª×§× ×™×•×ª ××›×œ ××—×¨×•×–×ª ××• ××¢×¨×š
function extractUrls(input) {
  if (!input) return [];
  if (Array.isArray(input)) {
    return input.map((s) => (typeof s === 'string' ? s.trim() : '')).filter(Boolean);
  }
  if (typeof input === 'string') {
    const matches = input.match(/https?:\/\/[^\s]+/g);
    return matches ? matches.map((m) => m.trim()) : [];
  }
  return [];
}

export default function Gallery({
  images = [],
  externalImageUrls = [],
  external_media_links = [], // ğŸ”¹ × ×•×¡×™×£ ×ª××™×›×” ×‘×©×“×” ×”×—×“×© ×-Strapi
}) {
  const [current, setCurrent] = useState(0);
  const [externalMediaImages, setExternalMediaImages] = useState([]);
  const [loading, setLoading] = useState(true);

  // ğŸ§  ××™×—×•×“ ×©×œ ×©× ×™ ×”×©×“×•×ª ×”××¤×©×¨×™×™× â€” ×”×—×“×© ×•×”×™×©×Ÿ
  const mergedExternal = useMemo(() => {
    // ×× ×”×©×“×” ×”×—×“×© ×”×•× ××¢×¨×š ×××™×ª×™ (JSON)
    if (Array.isArray(external_media_links) && external_media_links.length > 0) {
      return external_media_links;
    }
    // ××—×¨×ª × ×©×ª××© ×‘×©×“×” ×”×™×©×Ÿ (×˜×§×¡×˜)
    return externalImageUrls;
  }, [external_media_links, externalImageUrls]);

  const urls = useMemo(() => extractUrls(mergedExternal), [mergedExternal]);
  const imageExtensions = /\.(jpg|jpeg|png|gif|webp)$/i;
  const directLinks = urls.filter((url) => imageExtensions.test(url));
  const pagesToScrape = urls.filter((url) => !imageExtensions.test(url) && url.startsWith('http'));

  // âœ… ×‘×¨×’×¢ ×©×–×•×”×• ×¨×§ ×ª××•× ×•×ª ×™×©×™×¨×•×ª, × ×‘×˜×œ ××™×“ ××ª ×”×˜×¢×™× ×”
  useEffect(() => {
    if (directLinks.length > 0 && pagesToScrape.length === 0) {
      setLoading(false);
    }
  }, [directLinks, pagesToScrape]);

  // âœ… ×˜×•×¢×Ÿ ×“×¤×™ ××“×™×” ×¨×§ ×× ×‘×××ª ×§×™×™××™× ×›××œ×”
  useEffect(() => {
    let active = true;

    async function fetchAllExternalMedia() {
      if (pagesToScrape.length === 0) {
        return; // ××™×Ÿ ×“×¤×™× ×œ×˜×¢×•×Ÿ
      }

      try {
        setLoading(true);
        const allResults = await Promise.all(
          pagesToScrape.map((url) =>
            fetch(`/api/fetch-external-images?url=${encodeURIComponent(url)}`).then((res) =>
              res.json()
            )
          )
        );

        if (active) {
          const combinedImages = allResults
            .flatMap((data) => data.images || [])
            .map((img) => ({ src: img?.src?.trim(), alt: img?.alt || '' }))
            .filter((img) => img.src && img.src.startsWith('http'));

          setExternalMediaImages(combinedImages);
          setLoading(false);
        }
      } catch (e) {
        console.error('âŒ fetchAllExternalMedia error:', e);
        if (active) setLoading(false);
      }
    }

    fetchAllExternalMedia();
    return () => {
      active = false;
    };
  }, [pagesToScrape]);

  // ğŸ§© ×××—×“ ××ª ×›×œ ×”×ª××•× ×•×ª ××›×œ ×”××§×•×¨×•×ª
  const allImages = useMemo(() => {
    const strapiImages = (images || [])
      .map((img) => ({
        src: img?.url || img?.src,
        alt: img?.alternativeText || img?.alt || '',
      }))
      .filter((img) => !!img.src);

    const externalLinks = directLinks.map((url) => ({ src: url, alt: '' }));
    const combined = [...strapiImages, ...externalLinks, ...externalMediaImages];

    return combined.filter(
      (img, i, arr) => img.src && arr.findIndex((x) => x.src === img.src) === i
    );
  }, [images, directLinks, externalMediaImages]);

  // âœ… × ×•×•×“× ×©×‘×¨×’×¢ ×©×›×œ ×”× ×ª×•× ×™× ××•×›× ×™× â€” loading false
  useEffect(() => {
    if (allImages.length > 0) setLoading(false);
  }, [allImages]);

  if (loading) {
    return <div className="text-center text-gray-500 py-8">×˜×•×¢×Ÿ ××ª ×”×’×œ×¨×™×”...</div>;
  }

  if (!allImages.length) {
    return <div className="text-center text-gray-500 py-8">×œ× × ××¦××• ×ª××•× ×•×ª ×‘×’×œ×¨×™×”.</div>;
  }

  const next = () => setCurrent((prev) => (prev + 1) % allImages.length);
  const prev = () => setCurrent((prev) => (prev - 1 + allImages.length) % allImages.length);

  const getImageUrl = (src) => {
    if (!src || typeof src !== 'string') return '';
    const s = src.trim();
    if (s.startsWith('http')) return s;
    return `${PUBLIC_API_URL}${s.startsWith('/') ? s : `/uploads/${s}`}`;
  };

  const setInlineFallback = (e) => {
    e.currentTarget.onerror = null;
    e.currentTarget.src =
      'data:image/svg+xml;charset=UTF-8,' +
      encodeURIComponent(`
        <svg xmlns="http://www.w3.org/2000/svg" width="1200" height="1000">
          <rect width="100%" height="100%" fill="#e5e7eb"/>
          <text x="50%" y="50%" font-size="42" fill="#6b7280" text-anchor="middle" dominant-baseline="middle">
            ××™×Ÿ ×ª××•× ×”
          </text>
        </svg>
      `);
  };

  return (
    <div className="mt-8 w-full flex flex-col items-center gap-0">
      {/* ×ª××•× ×” ×¨××©×™×ª */}
      <div className="relative w-full max-w-3xl aspect-[3/2] overflow-hidden rounded shadow-lg bg-gray-100">
        <img
          key={current}
          src={getImageUrl(allImages[current].src)}
          alt={allImages[current].alt || `×ª××•× ×” ${current + 1}`}
          loading="eager"
          className="w-full h-full object-contain transition-opacity duration-500 bg-white p-2"
          onError={setInlineFallback}
        />
      </div>

      {/* ×ª××•× ×•×ª ×××•×–×¢×¨×•×ª */}
      <div className="flex gap-2 mt-3 overflow-x-auto px-2 scrollbar-hide">
        {allImages.map((img, i) => (
          <img
            key={i}
            src={getImageUrl(img.src)}
            alt={img.alt || `×ª××•× ×” ${i + 1}`}
            loading="lazy"
            className={`w-20 h-16 object-cover rounded cursor-pointer transition ring-offset-2 ${
              i === current ? 'ring-2 ring-blue-500' : ''
            }`}
            onClick={() => setCurrent(i)}
            onError={setInlineFallback}
          />
        ))}
      </div>
    </div>
  );
}


// components/EmbedContent.jsx
"use client";
import React, { useEffect } from "react";

export default function EmbedContent({ url }) {
  useEffect(() => {
    const loadScript = (id, src) => {
      if (!document.getElementById(id)) {
        const s = document.createElement("script");
        s.id = id;
        s.src = src;
        s.async = true;
        document.body.appendChild(s);
      }
    };

    loadScript("instagram-embed", "https://www.instagram.com/embed.js");
    loadScript("tiktok-embed", "https://www.tiktok.com/embed.js");
    loadScript("twitter-embed", "https://platform.twitter.com/widgets.js");

    const processAll = () => {
      window.instgrm?.Embeds?.process?.();
      window.FB?.XFBML?.parse?.();
      window.twttr?.widgets?.load?.();
    };
    const t = setTimeout(processAll, 800);
    return () => clearTimeout(t);
  }, [url]);

  const wrapperClass =
    "embed-box flex justify-center items-center mt-0 sm:mt-0 mb-0 w-full max-w-full text-center";

  // === YouTube ===
  if (url.includes("youtube.com") || url.includes("youtu.be")) {
    let videoId = "";
    if (url.includes("shorts/")) videoId = url.split("shorts/")[1]?.split("?")[0];
    else if (url.includes("watch?v=")) videoId = url.split("v=")[1]?.split("&")[0];
    else videoId = url.split("/").pop()?.split("?")[0];
    return (
      <div className={wrapperClass}>
        <div className="w-full max-w-[720px] aspect-video">
          <iframe
            src={`https://www.youtube.com/embed/${videoId}`}
            allowFullScreen
            title="YouTube Video"
            className="w-full h-full rounded-xl"
          />
        </div>
      </div>
    );
  }

  // === TikTok ===
  if (url.includes("tiktok.com")) {
    const videoId = url.split("/video/")[1]?.split("?")[0];
    return (
      <div className={wrapperClass}>
        <blockquote
          className="tiktok-embed"
          cite={url}
          data-video-id={videoId}
          style={{ maxWidth: "360px", minWidth: "320px", margin: 0 }}
        >
          <a href={url}></a>
        </blockquote>
      </div>
    );
  }

  // === Instagram ===
  if (url.includes("instagram.com")) {
    return (
      <div className={wrapperClass}>
        <blockquote
          className="instagram-media"
          data-instgrm-permalink={url}
          data-instgrm-version="14"
          style={{ maxWidth: "400px", margin: "0 auto" }}
        />
      </div>
    );
  }


  // === Twitter / X ===
  if (url.includes("twitter.com") || url.includes("x.com")) {
    const fixedUrl = url.replace("x.com", "twitter.com");
    return (
      <div className={wrapperClass}>
        <blockquote className="twitter-tweet">
          <a href={fixedUrl}></a>
        </blockquote>
      </div>
    );
  }

  // === Default ===
  return (
    <div className={wrapperClass}>
      <a
        href={url}
        target="_blank"
        rel="noopener noreferrer"
        className="text-blue-600 underline break-words"
      >
        {url}
      </a>
    </div>
  );
}


// lib/getArticleImage.js
import { resolveImageUrl } from "@/lib/fixArticleImages";

/**
 * ××—×œ×¥ ×ª××•× ×” ×¨××©×™×ª ×œÖ¾OG / Metadata
 * ×¢×œ ×‘×¡×™×¡ ×›×œ ×”×©×“×•×ª ×‘×›×ª×‘×” â€” ×œ×œ× ×¡×™× ×•×Ÿ ×•×œ×œ× ×—×¡×™××”.
 * ×× ×™×© ×ª××•× ×” â€” × ×‘×—×¨×ª.
 * ×× ××™×Ÿ â€” fallback.
 */

export function getArticleImage(article) {
  const API_URL = process.env.STRAPI_API_URL;
  const PUBLIC_API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL || API_URL;

  const FALLBACK = "https://www.onmotormedia.com/default-og.jpg";

  // --------------------------------------------------------
  // ğŸŸ¦ 1. ×’×œ×¨×™×” â€“ ×ª×•××š ×‘×©× ×™ ××§×¨×™×: ×¢×/×‘×œ×™ gallery.data
  // --------------------------------------------------------

  // gallery.data (Strapi format)
  if (Array.isArray(article.gallery?.data) && article.gallery.data.length > 0) {
    for (const item of article.gallery.data) {
      const img = item?.attributes?.url || item?.url;
      if (img) {
        return img.startsWith("http") ? img : `${PUBLIC_API_URL}${img}`;
      }
    }
  }

  // gallery without .data (in case of manual JSON)
  if (Array.isArray(article.gallery) && article.gallery.length > 0) {
    const first = article.gallery.find((img) => img?.url || typeof img === "string");
    if (first) {
      const url = first.url || first;
      return url.startsWith("http") ? url : `${PUBLIC_API_URL}${url}`;
    }
  }

  // --------------------------------------------------------
  // ğŸŸ¦ 2. ×ª××•× ×” ××ª×•×š image.data.attributes
  // --------------------------------------------------------
  const mainImage =
    article?.image?.data?.attributes?.formats?.large?.url ||
    article?.image?.data?.attributes?.formats?.medium?.url ||
    article?.image?.data?.attributes?.formats?.small?.url ||
    article?.image?.data?.attributes?.url;

  if (mainImage) {
    return mainImage.startsWith("http")
      ? mainImage
      : `${PUBLIC_API_URL}${mainImage}`;
  }

  // --------------------------------------------------------
  // ğŸŸ¦ 3. ×ª××•× ×” ××ª×•×š image.url
  // --------------------------------------------------------
  if (article.image?.url) {
    return resolveImageUrl(article.image.url);
  }

  // --------------------------------------------------------
  // ğŸŸ¦ 4. external_media_links (×ª×•××š ×‘××¢×¨×š ××• ××—×¨×•×–×ª)
  // --------------------------------------------------------
  if (Array.isArray(article.external_media_links)) {
    for (const link of article.external_media_links) {
      if (typeof link === "string" && link.startsWith("http")) {
        return link.trim();
      }
    }
  }

  if (typeof article.external_media_links === "string" &&
      article.external_media_links.startsWith("http")) {
    return article.external_media_links.trim();
  }

  // --------------------------------------------------------
  // ğŸŸ¦ 5. externalImageUrls
  // --------------------------------------------------------
  if (Array.isArray(article.externalImageUrls)) {
    for (const link of article.externalImageUrls) {
      if (typeof link === "string" && link.startsWith("http")) {
        return link.trim();
      }
    }
  }

  // --------------------------------------------------------
  // ğŸŸ¦ 6. inline images ××ª×•×š ×”×ª×•×›×Ÿ (rich text / string)
  // --------------------------------------------------------
  const content =
    Array.isArray(article.content)
      ? JSON.stringify(article.content)
      : String(article.content || "");

  const inlineMatch = content.match(
    /(https?:\/\/[^\s"'<>]+\.(jpg|jpeg|png|webp|gif))/i
  );

  if (inlineMatch) return inlineMatch[1];

  // --------------------------------------------------------
  // ğŸŸ¦ 7. fallback â€“ ×ª××™×“ ×§×™×™×
  // --------------------------------------------------------
  return FALLBACK;
}



// utils/resolveMainImage.js
const API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL || process.env.STRAPI_API_URL;
const PLACEHOLDER_IMG = '/default-image.jpg';

/* âœ… ×××™×¨×” ×›×œ URL ×œ×ª××•× ×” ×ª×§×™× ×” (Strapi / Cloudinary / ×§×™×©×•×¨ ×—×™×¦×•× ×™) */
export function resolveImageUrl(rawUrl) {
  if (!rawUrl) return PLACEHOLDER_IMG;
  if (rawUrl.startsWith('http')) return rawUrl;
  return `${API_URL}${rawUrl.startsWith('/') ? rawUrl : `/uploads/${rawUrl}`}`;
}

/**
 * âœ… ×‘×—×™×¨×ª ×ª××•× ×” ×¢×™×§×¨×™×ª ××›×œ ×¡×•×’ ×©×“×” ×œ×¤×™ ×¡×“×¨ ×¢×“×™×¤×•×ª:
 * 1ï¸âƒ£ ×ª××•× ×” ×©×œ×™×©×™×ª ×‘×’×œ×¨×™×” (gallery[2])
 * 2ï¸âƒ£ ×ª××•× ×” ×¨××©×•× ×” ×‘×’×œ×¨×™×” (gallery[0])
 * 3ï¸âƒ£ ×ª××•× ×” ××©×“×” image (image.url ××• image.data.attributes.url)
 * 4ï¸âƒ£ ×ª××•× ×” ××ª×•×š external_media_links (×¢×“×™×¤×•×ª ×œ×©× ×™ [1], ××—×¨×ª ×¨××©×•×Ÿ [0])
 * 5ï¸âƒ£ ×‘×¨×™×¨×ª ××—×“×œ: /default-image.jpg
 */
export function getMainImage(attrs = {}) {
  let mainImage = PLACEHOLDER_IMG;
  let mainImageAlt = attrs.title || '×ª××•× ×” ×¨××©×™×ª';

  // 1ï¸âƒ£ × ×™×¡×™×•×Ÿ: ×ª××•× ×” ×©×œ×™×©×™×ª ×‘×’×œ×¨×™×”
  if (attrs.gallery?.[2]?.url) {
    mainImage = resolveImageUrl(attrs.gallery[2].url);
    mainImageAlt = attrs.gallery[2].alternativeText || mainImageAlt;
  }
  // 2ï¸âƒ£ × ×™×¡×™×•×Ÿ: ×ª××•× ×” ×¨××©×•× ×” ×‘×’×œ×¨×™×”
  else if (attrs.gallery?.[0]?.url) {
    mainImage = resolveImageUrl(attrs.gallery[0].url);
    mainImageAlt = attrs.gallery[0].alternativeText || mainImageAlt;
  }
  // 3ï¸âƒ£ × ×™×¡×™×•×Ÿ: ×ª××•× ×” ××”×©×“×” image
  else if (attrs.image?.data?.attributes?.url) {
    mainImage = resolveImageUrl(attrs.image.data.attributes.url);
    mainImageAlt = attrs.image.data.attributes.alternativeText || mainImageAlt;
  } else if (attrs.image?.url) {
    mainImage = resolveImageUrl(attrs.image.url);
    mainImageAlt = attrs.image.alternativeText || mainImageAlt;
  }
  // 4ï¸âƒ£ × ×™×¡×™×•×Ÿ: ×§×™×©×•×¨ ×—×™×¦×•× ×™ ××ª×•×š external_media_links
  else if (Array.isArray(attrs.external_media_links) && attrs.external_media_links.length > 0) {
    const validLinks = attrs.external_media_links.filter(
      (l) => typeof l === 'string' && l.startsWith('http')
    );
    if (validLinks.length > 1) {
      mainImage = validLinks[1].trim(); // ×”×©× ×™
    } else if (validLinks.length > 0) {
      mainImage = validLinks[0].trim(); // ×”×¨××©×•×Ÿ
    }
    mainImageAlt = '×ª××•× ×” ××”××“×™×” ×”×—×™×¦×•× ×™×ª';
  }
  // 5ï¸âƒ£ ×‘×¨×™×¨×ª ××—×“×œ
  else {
    mainImage = PLACEHOLDER_IMG;
    mainImageAlt = '×ª××•× ×” ×—×¡×¨×”';
  }

  return { mainImage, mainImageAlt };
}


// app/blog/guides/page.jsx
export const dynamic = 'force-dynamic';

import PageContainer from '@/components/PageContainer';
import CategoryPage from '@/components/CategoryPage';

export default function GuidesPage() {
  return (
    <PageContainer
      title="×‘×œ×•×’ - ××“×¨×™×›×™×"
      breadcrumbs={[
        { label: '×“×£ ×”×‘×™×ª', href: '/' },
        { label: '×‘×œ×•×’', href: '/blog' },
        { label: '××“×¨×™×›×™×' },
      ]}
    >
      {/* ×™×¦×™×’ ××ª ×›×œ ×”××“×¨×™×›×™×; ××ª×” ×™×›×•×œ ×‘×ª×•×š CategoryPage ×œ×§×‘×¥/×œ×¡× ×Ÿ/×œ×”×¦×™×’ ×œ×¤×™ ×ª×ª×™Ö¾×ª×ª */}
      <CategoryPage categoryKey="blog" subcategoryKey="guides" />
    </PageContainer>
  );
}
///

//app\blog\[subcategory]\page.jsx
export const dynamic = 'force-dynamic'; // â¬…ï¸ ××•×¡×™×£ ×§×•×“ ×¨× ×“×•×¨ ×“×™× ××™ (×œ×× ×•×¢ ×‘×¢×™×•×ª)

import PageContainer from '@/components/PageContainer';
import CategoryPage from '@/components/CategoryPage';

const labelMap = {
  podcast: '××—×“ ×¢×œ ××—×“ (×¤×•×“×§××¡×˜)',
  'in-helmet': '×‘×§×¡×“×”',
  paper: '×¢×œ ×”× ×™×™×¨',
  tips: '×˜×™×¤×™×',
  guides: '××“×¨×™×›×™×',
  'guide-tech': '××“×¨×™×š ×˜×›× ×™ ×•×ª×—×–×•×§×”',
  'guide-beginner': '××“×¨×™×š ×œ×¨×•×›×‘ ×”××ª×—×™×œ',
  'guide-advanced': '××“×¨×™×š ×œ×¨×•×›×‘ ×”××ª×§×“×',
};

export default async function BlogSubcategoryPage({ params }) {
  const subcategory = params.subcategory;
  const subcategoryLabel = labelMap[subcategory] || subcategory;

  return (
    <PageContainer
      title={`×‘×œ×•×’ - ${subcategoryLabel}`}
      breadcrumbs={[
        { label: '×“×£ ×”×‘×™×ª', href: '/' },
        { label: '×‘×œ×•×’', href: '/blog' },
        { label: subcategoryLabel },
      ]}
    >
      <CategoryPage categoryKey="blog" subcategoryKey={subcategory} />
    </PageContainer>
  );
}
///




// âœ… app/articles/[slug]/page.jsx

export const dynamic = 'force-dynamic';
import Script from "next/script";
import PageContainer from "@/components/PageContainer";
import ArticleHeader from "@/components/ArticleHeader";
import SimpleKeyValueTable from "@/components/SimpleKeyValueTable";
import Tags from "@/components/Tags";
import SimilarArticles from "@/components/SimilarArticles";
import { notFound } from "next/navigation";
import CommentsSection from "@/components/CommentsSection";
import Gallery from "@/components/Gallery";
import { labelMap } from "@/utils/labelMap";
import InlineImage from "@/components/InlineImage";
import EmbedContent from "@/components/EmbedContent";
import ScrollToTableButton from "@/components/ScrollToTableButton";
import ScrollToGalleryButton from "@/components/ScrollToGalleryButton";
import ScrollToCommentsButton from "@/components/ScrollToCommentsButton";
import { fixRelativeImages, resolveImageUrl, wrapHondaProxy } from "@/lib/fixArticleImages";
import { getArticleImage } from "@/lib/getArticleImage";
import ArticleShareBottom from "@/components/ArticleShareBottom";



const API_URL = process.env.STRAPI_API_URL;
const PUBLIC_API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL || API_URL;
const SITE_URL = "https://www.onmotormedia.com";
const PLACEHOLDER_IMG = "/default-image.jpg";

// âœ… ×¤×•× ×§×¦×™×•×ª ×¢×–×¨ ×œ×§×™×©×•×¨×™× ×‘Ö¾Rich Text
function normalizeHref(href) {
  if (!href) return '#';
  if (/^https?:\/\//i.test(href) || href.startsWith('mailto:') || href.startsWith('tel:')) return href;
  return href.startsWith('/') ? href : `/${href}`;
}

function isExternal(href) {
  return /^https?:\/\//i.test(href);
}

function renderMarks(text, node) {
  let t = text ?? '';
  if (node?.bold) t = `<strong>${t}</strong>`;
  if (node?.italic) t = `<em>${t}</em>`;
  if (node?.underline) t = `<u>${t}</u>`;
  return t;
}

function toHtmlFromStrapiChildren(children) {
  if (!Array.isArray(children)) return '';
  return children.map((node) => {
    if (node?.type === 'link' || node?.url) {
      const href = normalizeHref(node.url || '#');
      const inner = node.children?.length
        ? toHtmlFromStrapiChildren(node.children)
        : renderMarks(node.text || '', node);
      const target = isExternal(href) ? '_blank' : '_self';
      const rel = isExternal(href) ? 'noopener noreferrer' : '';
      return `<a href="${href}" target="${target}" rel="${rel}" class="text-blue-600 underline hover:text-blue-800">${inner}</a>`;
    }
    if (typeof node?.text === 'string') return renderMarks(node.text, node);
    if (node?.children?.length) return toHtmlFromStrapiChildren(node.children);
    return '';
  }).join('');
}

export async function generateMetadata({ params }) {
  const API_URL = process.env.STRAPI_API_URL;
  const SITE_URL = "https://www.onmotormedia.com";

  try {
    const res = await fetch(
      `${API_URL}/api/articles?filters[slug][$eq]=${params.slug}&populate=*`,
      { cache: "no-store" }
    );

    if (!res.ok) throw new Error(`API fetch failed with status ${res.status}`);
    const json = await res.json();
    const article = json.data?.[0];
    if (!article) return {};

    const title = article.title || "OnMotor Media";
    const description =
      article.headline ||
      article.description ||
      article.subdescription ||
      "×›×ª×‘×” ××ª×•×š ××’×–×™×Ÿ OnMotor Media";

    // ğŸ§  ×§×¨×™××” ×œ×¤×•× ×§×¦×™×” ×”× ×¤×¨×“×ª
    const imageUrl = getArticleImage(article);

    return {
      title: `${title} | OnMotor Media`,
      description,
      alternates: { canonical: `${SITE_URL}/articles/${params.slug}` },
      openGraph: {
        title,
        description,
        type: "article",
        locale: "he_IL",
        url: `${SITE_URL}/articles/${params.slug}`,
        siteName: "OnMotor Media",
        images: [{ url: imageUrl, width: 1200, height: 630, alt: title }],
      },
      twitter: {
        card: "summary_large_image",
        title,
        description,
        images: [imageUrl],
      },
    };
  } catch (err) {
    console.error("âš ï¸ Metadata generation error:", err);
    return {};
  }
}

// ===================================================================
//                       ArticlePage Component
// ===================================================================
export default async function ArticlePage({ params, setPageTitle, setPageBreadcrumbs }) {
  const res = await fetch(
    `${API_URL}/api/articles?filters[slug][$eq]=${params.slug}&populate=*`,
    { next: { revalidate: 0 } }
  );

  const json = await res.json();
  const rawArticle = json.data?.[0];
  if (!rawArticle) return notFound();
  const data = rawArticle;

  const galleryItems = data.gallery?.data
    ? data.gallery.data.map((item) => item.attributes)
    : data.gallery || [];

  const gallery = galleryItems.map((img) => ({
    src: resolveImageUrl(img.url),
    alt: img.alternativeText || "×ª××•× ×” ××”×’×œ×¨×™×”",
  }));

  const externalImageUrls = Array.isArray(data.externalImageUrls)
    ? data.externalImageUrls
    : data.externalImageUrls
    ? [data.externalImageUrls]
    : [];

  const externalMediaUrl = data.externalMediaUrl || null;

  let mainImage = PLACEHOLDER_IMG;
  let mainImageAlt = "×ª××•× ×” ×¨××©×™×ª";

  if (galleryItems?.length > 0 && galleryItems[0]?.url) {
    mainImage = resolveImageUrl(galleryItems[0].url);
    mainImageAlt = galleryItems[0].alternativeText || "×ª××•× ×” ×¨××©×™×ª";
  } else if (data.image?.data?.attributes?.url) {
    mainImage = resolveImageUrl(data.image.data.attributes.url);
    mainImageAlt = data.image.data.attributes.alternativeText || "×ª××•× ×” ×¨××©×™×ª";
  } else if (
    Array.isArray(data.external_media_links) &&
    data.external_media_links.length > 1 &&
    typeof data.external_media_links[1] === "string" &&
    data.external_media_links[1].startsWith("http")
  ) {
    mainImage = data.external_media_links[1].trim();
    mainImageAlt = "×ª××•× ×” ×¨××©×™×ª ××”××“×™×” ×”×—×™×¦×•× ×™×ª";
  }

  const article = {
    title: data.title || "×›×ª×‘×” ×œ×œ× ×›×•×ª×¨×ª",
    description: data.description || "",
    image: mainImage,
    imageAlt: mainImageAlt,
    author: data.author || "××¢×¨×›×ª OnMotor",
    date: data.date || "2025-06-22",
    time: data.time || "10:00",
    tags: data.tags || [],
    content: data.content || "",
    tableData: data.tableData || {},
    href: `/articles/${params.slug}`,
    category: data.category || "general",
    subcategory: Array.isArray(data.subcategory)
      ? data.subcategory[0]
      : data.subcategory,
    values: Array.isArray(data.Values)
      ? data.Values
      : data.Values
      ? [data.Values]
      : [],
    headline: data.headline || data.title,
    subdescription: data.subdescription || "",
    slug: params.slug,
    gallery,
    externalImageUrls,
    externalMediaUrl,
    external_media_links: data.external_media_links || [],
    font_family: data.font_family || "Heebo, sans-serif",
  };

    // ===============================
  // ğŸ“Œ Structured Data (JSON-LD)
  // ===============================
  const jsonLd = {
    "@context": "https://schema.org",
    "@type": "NewsArticle",
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": `https://www.onmotormedia.com/articles/${article.slug}`
    },
    "headline": article.title,
    "description": article.description || article.subdescription || "",
    "image": [article.image],
    "author": {
      "@type": "Person",
      "name": article.author || "×¦×•×•×ª OnMotor"
    },
    "publisher": {
      "@type": "Organization",
      "name": "OnMotor Media",
      "logo": {
        "@type": "ImageObject",
        "url": "https://www.onmotormedia.com/OnMotorLogonoback.png"
      }
    },
    "datePublished": article.date,
    "dateModified": article.date,
    "inLanguage": "he-IL",
    "articleSection": article.category,
    "keywords": (article.tags || []).join(", "),
    "articleBody": typeof article.content === "string"
      ? article.content.substring(0, 500)
      : ""
  };


  const breadcrumbs = [{ label: "×“×£ ×”×‘×™×ª", href: "/" }];
  if (article.category)
    breadcrumbs.push({
      label: labelMap[article.category] || article.category,
      href: `/${article.category}`,
    });
  if (article.subcategory)
    breadcrumbs.push({
      label: labelMap[article.subcategory] || article.subcategory,
      href: `/${article.category}/${article.subcategory}`,
    });
  if (article.values?.length > 0) {
    const valueKey = article.values[0];
    breadcrumbs.push({
      label: labelMap[valueKey] || valueKey,
      href: `/${article.category}/${article.subcategory}/${valueKey}`,
    });
  }
  breadcrumbs.push({ label: article.title });
  
  


  // âœ… ×¨×™× ×“×•×¨ ×¤×¡×§××•×ª (×›×•×œ×œ Honda + YouTube)
  const renderParagraph = (block, i) => {
    if (typeof block === "string") {
      const cleanText = fixRelativeImages(block.trim());
      const hasHTMLTags = /<\/?[a-z][\s\S]*>/i.test(cleanText);

      if (hasHTMLTags) {
        return (
          <div
            key={i}
            className="article-text text-gray-800 text-[18px] leading-relaxed"
            dangerouslySetInnerHTML={{
              __html: cleanText.replace(
                /(https:\/\/hondanews\.eu[^\s"'<>]+)/gi,
                (match) => wrapHondaProxy(match)
              ),
            }}
          />
        );
      }

      const urlMatch = cleanText.match(/https?:\/\/[^\s]+/);
      if (urlMatch) {
        let url = urlMatch[0].trim();
        if (url.includes("hondanews.eu")) url = wrapHondaProxy(url);
        // âœ… ×ª××™×›×” ×‘×§×™×©×•×¨×™ Kawasaki
        else if (url.includes("content2.kawasaki.com")) {
          // ×× ×§×” ×¤×¨××˜×¨×™× ×›××• ?w=400 ××”×›×ª×•×‘×ª
          url = url.split("?")[0];
        }


        if (
          /\.(jpg|jpeg|png|gif|webp)$/i.test(url) ||
          url.includes("hondanews.eu/image/") ||
          url.includes("/api/proxy-honda?")
        ) {
          return (
            <InlineImage
              key={i}
              src={url}
              alt="×ª××•× ×” ××ª×•×š ×”×›×ª×‘×”"
              caption=""
            />
          );
        }

        if (
          /(youtube\.com|youtu\.be|facebook\.com|instagram\.com|tiktok\.com|x\.com|twitter\.com)/i.test(
            url
          )
        ) {
          return <EmbedContent key={i} url={url} />;
        }

        return (
          <p key={i} className="article-text text-blue-600 underline">
            <a href={url} target="_blank" rel="noopener noreferrer">
              {url}
            </a>
          </p>
        );
      }

      return (
        <p
          key={i}
          className="article-text text-gray-800 text-[18px] leading-relaxed"
          dangerouslySetInnerHTML={{
            __html: cleanText.replace(/\n/g, "<br/>"),
          }}
        />
      );
    }

    if (block.type === "paragraph" && block.children) {
      let html = toHtmlFromStrapiChildren(block.children);
      html = fixRelativeImages(html);

      const urlMatch = html.match(/https?:\/\/[^\s"']+/);
      if (urlMatch) {
        let url = urlMatch[0];
        if (url.includes("hondanews.eu")) url = wrapHondaProxy(url);
        // âœ… ×ª××™×›×” ×‘×§×™×©×•×¨×™ Kawasaki
        else if (url.includes("content2.kawasaki.com")) {
          // ×× ×§×” ×¤×¨××˜×¨×™× ×›××• ?w=400 ××”×›×ª×•×‘×ª
          url = url.split("?")[0];
        }


        if (
          /\.(jpg|jpeg|png|gif|webp)$/i.test(url) ||
          url.includes("hondanews.eu/image/") ||
          url.includes("/api/proxy-honda?") ||
          url.includes("content2.kawasaki.com/ContentStorage/")


        ) {
          return (
            <InlineImage
              key={i}
              src={url}
              alt="×ª××•× ×” ××ª×•×š ×”×›×ª×‘×”"
              caption=""
            />
          );
        }

        if (
          /(youtube\.com|youtu\.be|facebook\.com|instagram\.com|tiktok\.com|x\.com|twitter\.com)/i.test(
            url
          )
        ) {
          return <EmbedContent key={i} url={url} />;
        }
      }

      return (
        <p
          key={i}
          className="article-text text-gray-800 text-[18px] leading-relaxed"
          dangerouslySetInnerHTML={{
            __html: html.replace(
              /(https:\/\/hondanews\.eu[^\s"'<>]+)/gi,
              (match) => wrapHondaProxy(match)
            ),
          }}
        />
      );
    }

        // âœ… ×˜×™×¤×•×œ ×‘×¨×©×™××•×ª (×××•×¡×¤×¨×•×ª ××• × ×§×•×“×ª×™×•×ª)
    if (block.type === "list") {
      const isOrdered = block.format === "ordered";
      const Tag = isOrdered ? "ol" : "ul";
      return (
        <Tag
          key={i}
          dir="rtl"
          className={`my-3 pr-6 space-y-1 text-[18px] text-gray-800 leading-relaxed ${
            isOrdered ? "list-decimal" : "list-disc"
          }`}
        >
          {block.children?.map((item, idx) => {
            const html = toHtmlFromStrapiChildren(item.children || []);
            return (
              <li
                key={idx}
                dangerouslySetInnerHTML={{
                  __html: fixRelativeImages(html),
                }}
              />
            );
          })}
        </Tag>
      );
    }




    if (block.type === "heading") {
      const level = block.level || 2;
      const Tag = `h${Math.min(level, 3)}`;
      const text = block.children?.map((c) => c.text).join("") || "";
      return (
        <Tag
          key={i}
          className="font-bold text-2xl text-gray-900 mt-4 mb-2"
          dangerouslySetInnerHTML={{ __html: fixRelativeImages(text) }}
        />
      );
    }

    if (block.type === "image") {
      const imageData =
        block.image?.data?.attributes || block.image?.attributes || block.image;
      if (!imageData?.url) return null;
      const alt = imageData.alternativeText || "×ª××•× ×” ××ª×•×š ×”×›×ª×‘×”";
      const caption = imageData.caption || "";
      const src = resolveImageUrl(imageData.url);
      return (
        <InlineImage key={i} src={src} alt={alt} caption={caption} />
      );
    }

    return null;
  };


  const paragraphs = Array.isArray(article.content)
    ? article.content
    : article.content.split("\n\n");

  return (
    <>
      <Script
            id="structured-data"
            type="application/ld+json"
            dangerouslySetInnerHTML={{ __html: JSON.stringify(jsonLd) }}
      />


      <PageContainer title={article.title} breadcrumbs={breadcrumbs}>
        <div
          className="mx-auto max-w-[740px] space-y-2 text-right leading-relaxed text-base text-gray-800 px-2"
          style={{ fontFamily: article.font_family }}
        >
          <ArticleHeader
            author={article.author}
            date={article.date}
            time={article.time}
            image={article.image}
            imageAlt={article.imageAlt}
            title={article.headline}
            subdescription={article.subdescription}
            tags={article.tags}
          />

          {article.description && (
            <p className="font-bold text-2xl text-gray-600">{article.description}</p>
          )}
          
          <div className="article-content">
            {paragraphs.map(renderParagraph)}
          </div>
          {article.tableData && (
            <div className="article-table-section">
              <SimpleKeyValueTable data={article.tableData} />
            </div>
          )}

          <div className="article-gallery-section">
            <Gallery
              images={article.gallery}
              externalImageUrls={article.externalImageUrls}
              externalMediaUrl={article.externalMediaUrl}
              external_media_links={article.external_media_links}
            />
          </div>
          <ArticleShareBottom />
          <div className="comments-section">
            <CommentsSection articleUrl={`${SITE_URL}${article.href}`} />
          </div>

          <Tags tags={article.tags} />
          <div className="similar-articles-section">
            <SimilarArticles currentSlug={article.slug} category={article.category} />
          </div>

          
          
          
        </div>
      </PageContainer>
      <ScrollToTableButton />
      <ScrollToGalleryButton />
      <ScrollToCommentsButton />
    </>
  );
}


// /app/api/contact-for-ad/route.js
export const runtime = 'nodejs';
export const dynamic = 'force-dynamic';

import { NextResponse } from 'next/server';
import { sendMail } from '@/lib/mailer';
import { buildEmailTemplate } from '@/components/utils/emailTemplate';

export async function POST(req) {
  try {
    const { name, phone, email, notes } = await req.json();

    // ×‘×“×™×§×” ×‘×¡×™×¡×™×ª ×©×œ ×©×“×•×ª ×—×•×‘×”
    if (!name || !phone || !email) {
      console.error('âŒ ×—×¡×¨×™× ×©×“×•×ª');
      return NextResponse.json({ success: false, error: 'Missing fields' }, { status: 400 });
    }

    // --- ××™×™×œ ×œ×× ×”×œ ×”××ª×¨ ---
    const adminHtml = buildEmailTemplate(
      '×¦×•×•×ª OnMotor Media',
      '×¤× ×™×™×” ×—×“×©×” ×œ×¤×¨×¡×•× ×‘××ª×¨',
      `
      <div dir="rtl" style="direction:rtl;text-align:right;">
        <p>× ×©×œ×—×” ×¤× ×™×™×” ×—×“×©×” ×œ×¤×¨×¡×•× ×‘××ª×¨:</p>
        <ul style="list-style:none;padding:0;">
          <li><strong>×©×:</strong> ${name}</li>
          <li><strong>×˜×œ×¤×•×Ÿ:</strong> ${phone}</li>
          <li><strong>××™××™×™×œ:</strong> ${email}</li>
          ${notes ? `<li><strong>×¤×™×¨×•×˜ × ×•×¡×£:</strong> ${notes}</li>` : ''}
        </ul>
      </div>
      `
    );

    await sendMail({
      to: process.env.SITE_ADMIN_EMAIL || 'onmotormedia@gmail.com',
      subject: '×¤× ×™×™×” ×—×“×©×” ×œ×¤×¨×¡×•× ×‘××ª×¨',
      html: adminHtml,
    });
    console.log('ğŸ“¤ × ×©×œ×— ××™×™×œ ×œ×× ×”×œ ×”××ª×¨ ×‘×”×¦×œ×—×”.');

    // --- ××™×™×œ ×—×–×¨×” ×œ××©×ª××© ---
    const userHtml = buildEmailTemplate(
      name,
      '×¤× ×™×™×ª×š ×”×ª×§×‘×œ×”',
      `
      <div dir="rtl" style="direction:rtl;text-align:right;">
        <p>× ×¦×™×’ ×¤×¨×¡×•× ×™×¦×•×¨ ××™×ª×š ×§×©×¨ ×‘×”×§×“×.</p>
        ${notes ? `<p><strong>×¤×™×¨×•×˜ × ×•×¡×£:</strong> ${notes}</p>` : ''}
        <p>×‘×‘×¨×›×”,<br/>OnMotor Media</p>
      </div>
      `
    );

    await sendMail({
      to: email,
      subject: '×¤× ×™×™×ª×š ×”×ª×§×‘×œ×” - OnMotor Media',
      html: userHtml,
    });
    console.log('ğŸ“¤ × ×©×œ×— ××™×™×œ ×œ××©×ª××© ×‘×”×¦×œ×—×”.');

    return NextResponse.json({ success: true });
  } catch (err) {
    console.error('âŒ ×©×’×™××” ×‘×©×œ×™×—×ª ××™×™×œ:', err.message);
    return NextResponse.json(
      { success: false, error: err.message || 'Internal Server Error' },
      { status: 500 }
    );
  }
}


//app\page.js
export const dynamic = "force-dynamic";
import React from 'react';
import MainGridContentDesktop from '@/components/MainGridContentDesktop';
import PageContainer from '@/components/PageContainer';

/* -----------------------------------------------------------
   âš™ï¸ ×©×œ×‘ 1: ×˜×¢×™× ×ª ×›×ª×‘×•×ª ×Ö¾Strapi (Server Component)
   - ×”×§×¨×™××” × ×¢×©×™×ª ×‘×¦×“ ×”×©×¨×ª ×›×“×™ ×œ×©×¤×¨ ×‘×™×¦×•×¢×™× (SSR)
   - ×”×ª×•×¦××” × ×©××¨×ª ×‘×§××© ×œÖ¾60 ×©× ×™×•×ª (revalidate)
----------------------------------------------------------- */
async function fetchArticles() {
  const base = process.env.STRAPI_API_URL;

  if (!base) {
    throw new Error('âŒ STRAPI_API_URL ×œ× ×”×•×’×“×¨ ×‘×§×•×‘×¥ ×”×¡×‘×™×‘×”');
  }

  const url = `${base}/api/articles?populate=*`;

  try {
    const res = await fetch(url, { next: { revalidate: 60 } }); // âœ… ×§××© 60 ×©× ×™×•×ª
    if (!res.ok) {
      throw new Error(`×©×’×™××” ×‘×˜×¢×™× ×” ××”Ö¾API (${res.status})`);
    }

    const json = await res.json();
    return json.data.map(item => ({
      id: item.id,
      ...item.attributes,
    }));
  } catch (err) {
    console.error('âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×›×ª×‘×•×ª ××”×©×¨×ª:', err);
    return [];
  }
}

/* -----------------------------------------------------------
   ğŸ  ×©×œ×‘ 2: ×¢××•×“ ×”×‘×™×ª
   - ×¢×˜×•×£ ×‘×ª×•×š PageContainer ×›×“×™ ×œ×©××•×¨ ×¢×œ ××‘× ×” ××—×™×“
   - ××‘×˜×™×— ×©×”×¡×™×™×“×¨×™× ×™×’×œ×œ×• ×‘××•×¤×Ÿ ×™×—×¡×™ (sticky ×ª×§×™×Ÿ)
   - ×©×•××¨ ×¢×œ ×¨×§×¢ ××—×™×“, RTL ××œ× ×•Ö¾SEO ×ª×§×™×Ÿ
----------------------------------------------------------- */
export default async function HomePage() {
  const articles = await fetchArticles();

  return (
    <PageContainer
      title="×“×£ ×”×‘×™×ª"
      breadcrumbs={[]}
    >
      

      <MainGridContentDesktop articles={articles} />

      <h1 className="text-2xl font-bold text-[#e60000] px-4 mt-4">
        OnMotor Media - ××’×–×™×Ÿ ××•×¤× ×•×¢×™× ×™×©×¨××œ×™
      </h1>

      <p className="px-4 mt-2 mb-4 text-gray-700">
         .××’×–×™×Ÿ ××•×¤× ×•×¢×™× ×‘×™×©×¨××œ - ×—×“×©×•×ª, ×¡×§×™×¨×•×ª, ××‘×—× ×™ ×“×¨×›×™×, ×¦×™×•×“, ×˜×™×¤×™× ×œ×§×”×™×œ×ª ×”×¨×•×›×‘×™× ×”×ª×•×¡×¡×ª ×‘×™×©×¨××œ
      </p>

    </PageContainer>
  );
}



// /components/DropdownSimple.jsx
"use client";
import { useState, useRef, useEffect } from "react";

export default function DropdownSimple({ label, value, onChange, options = [], disabled = false }) {
  const [open, setOpen] = useState(false);
  const [search, setSearch] = useState(""); // ×˜×§×¡×˜ ×©××•×§×œ×“
  const dropdownRef = useRef(null);

  useEffect(() => {
    const handleClickOutside = (event) => {
      if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {
        setOpen(false);
      }
    };
    document.addEventListener("mousedown", handleClickOutside);
    return () => document.removeEventListener("mousedown", handleClickOutside);
  }, []);

  const getLabel = (opt) => (typeof opt === "string" ? opt : opt.label);
  const getValue = (opt) => (typeof opt === "string" ? opt : opt.value);

  // ×¡×™× ×•×Ÿ ××•×¤×¦×™×•×ª ×œ×¤×™ ××” ×©×”××©×ª××© ×”×§×œ×™×“
  const filteredOptions = options.filter((opt) =>
    getLabel(opt).toLowerCase().includes(search.toLowerCase())
  );

  // ×‘×—×™×¨×” + ×”×¤×¢×œ×ª applyFilters ×“×¨×š CustomEvent
  const handleSelect = (val) => {
    onChange(val);
    setSearch("");
    setOpen(false);
    // ×©×œ×™×—×ª ××™×¨×•×¢ ×’×œ×•×‘×œ×™ ×œ×”×¤×¢×œ×ª applyFilters
    document.dispatchEvent(new Event("dropdownFilterApplied"));
  };

  // ×œ×—×™×¦×” ×¢×œ Enter ×‘×ª×•×š ×”Ö¾input
  const handleKeyDown = (e) => {
    if (e.key === "Enter") {
      e.preventDefault();
      if (search.trim() !== "") {
        const match = options.find(
          (opt) => getLabel(opt).toLowerCase() === search.toLowerCase()
        );
        if (match) {
          handleSelect(getValue(match));
        } else {
          handleSelect(search.trim());
        }
      }
    }
  };

  return (
    <div className="w-full relative mb-3" ref={dropdownRef}>
      <label className="block text-sm mb-1">{label}</label>

      {/* ×›×¤×ª×•×¨ ×œ×¤×ª×™×—×” */}
      <button
        type="button"
        onClick={() => !disabled && setOpen(!open)}
        className={`w-full border px-2 py-1 rounded flex justify-between items-center ${
          disabled ? "bg-gray-100 cursor-not-allowed" : "bg-white"
        }`}
      >
        <span>
          {(() => {
            const selected = options.find((opt) => getValue(opt) === value);
            return selected ? getLabel(selected) : "×‘×—×¨";
          })()}
        </span>
        <span className="text-xs">{open ? "â–²" : "â–¼"}</span>
      </button>

      {/* ×”×¨×©×™××” ×¢× ×©×“×” ×—×™×¤×•×© */}
      {open && !disabled && (
        <div className="absolute z-20 mt-1 w-full bg-white border rounded shadow 
                        max-h-40 overflow-y-auto overscroll-contain left-0 right-0 p-2 space-y-1">
          {/* ×©×“×” ×”×§×œ×“×” */}
          <input
            type="text"
            value={search}
            onChange={(e) => setSearch(e.target.value)}
            onKeyDown={handleKeyDown}
            placeholder="×”×§×œ×“ ×œ×—×™×¤×•×©..."
            className="w-full border rounded px-2 py-1 mb-2 text-sm"
            autoFocus
          />

          {/* ×ª×•×¦××•×ª */}
          {filteredOptions.length === 0 && (
            <div className="px-3 py-2 text-sm text-gray-500">××™×Ÿ ××¤×©×¨×•×™×•×ª</div>
          )}
          {filteredOptions.map((opt, idx) => {
            const optLabel = getLabel(opt);
            const optValue = getValue(opt);
            return (
              <div
                key={idx}
                className={`px-3 py-2 cursor-pointer hover:bg-red-100 ${
                  value === optValue ? "bg-red-200 font-bold" : ""
                }`}
                onClick={() => handleSelect(optValue)}
              >
                {optLabel}
              </div>
            );
          })}
        </div>
      )}
    </div>
  );
}



///
//lib\fetchExternalImages.js
import * as cheerio from 'cheerio';

/**
 * âœ… Universal version:
 * - Yamaha Media (release-overview, ×›×•×œ×œ ×—×™×¤×•×© ×™×©×™×¨ ×‘Ö¾CDN)
 * - Yamaha PDP (api/product-assets)
 * - KTM press
 * - Honda News (×›×•×œ×œ ×¢×˜×™×¤×ª proxy ××•×˜×•××˜×™×ª)
 * - fallback ×œ×›×œ ××ª×¨ ××—×¨
 */
export async function fetchExternalImages(pageUrl) {
  try {
    console.log(`ğŸ” Fetching images from ${pageUrl}`);
    const found = new Set();
    const proxyBase = process.env.NEXT_PUBLIC_SITE_URL || 'https://www.onmotormedia.com';

    // ğŸ–¼ï¸ ×˜×™×¤×•×œ ×‘×§×™×©×•×¨×™ ×ª××•× ×” ×™×©×™×¨×™× (×›×•×œ×œ Honda News ×œ×œ× ×¡×™×•××ª)
    if (
      pageUrl.match(/\.(jpg|jpeg|png|webp|gif|avif)(\?|$)/i) ||
      pageUrl.match(/hondanews\.eu\/image\/motorcycles\/(low|high|original)\/\d+/i)
    ) {
      console.log('ğŸ–¼ï¸ Direct Honda image URL detected');

      // âœ… ×¢×˜×™×¤×” ××•×˜×•××˜×™×ª ×‘×§×™×“×•××ª proxy ×× ××“×•×‘×¨ ×‘-Honda
      if (pageUrl.includes('hondanews.eu')) {
        const proxyUrl = `${proxyBase}/api/proxy-honda?url=${encodeURIComponent(pageUrl)}`;
        console.log(`ğŸ”„ Wrapped in proxy: ${proxyUrl}`);
        return [{ src: proxyUrl, alt: '', title: '' }];
      }

      // ××—×¨×ª â€“ × ×‘×“×•×§ ××ª ×›×œ ×”×•×•×¨×™××¦×™×•×ª
      const candidates = [
        pageUrl.replace('/low/', '/original/'),
        pageUrl.replace('/low/', '/high/'),
        pageUrl,
      ];

      const validImages = [];
      for (const url of candidates) {
        try {
          const res = await fetch(url, {
            method: 'HEAD',
            headers: {
              'User-Agent':
                'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128 Safari/537.36',
              'Accept':
                'image/avif,image/webp,image/apng,image/*,*/*;q=0.8',
              'Referer': 'https://hondanews.eu/',
            },
            redirect: 'follow',
          });
          const type = res.headers.get('content-type') || '';
          if (type.startsWith('image/')) {
            console.log(`âœ… Found valid image: ${url}`);
            validImages.push({ src: url, alt: '', title: '' });
          } else {
            console.warn(`âš ï¸ Skipped non-image (maybe logo): ${url}`);
          }
        } catch (err) {
          console.warn(`âŒ Failed to fetch: ${url}`);
        }
      }

      if (validImages.length > 0) return validImages;
    }

    // ğŸŸ£ ×˜×™×¤×•×œ ×‘×§×™×©×•×¨×™× ×©×œ Yamaha Media Library (inriver_preview)
    if (pageUrl.includes('medialibrary.yamaha-motor.eu/plugins/inriver_preview/asset/')) {
      console.log('âš™ï¸ Yamaha Media Library asset detected');

      // ×—×™×œ×•×¥ ××–×”×” ×”× ×›×¡
      const match = pageUrl.match(/asset\/([^/]+)\//);
      if (match) {
        const assetId = match[1];
        const cdnUrl = `https://medialibrary.yamaha-motor.eu/api/asset/${assetId}/download?size=original`;
        console.log(`âœ… Reconstructed Yamaha CDN URL: ${cdnUrl}`);
        return [{ src: cdnUrl, alt: '', title: '' }];
      }

      // fallback ×× ×œ× ×”×¦×œ×™×—
      return [{ src: pageUrl, alt: '', title: '' }];
    }


    // ğŸŸ£ 1. Yamaha Media (release-overview)
    if (pageUrl.includes('media.yamaha-motor.eu')) {
      console.log('âš™ï¸ Yamaha Media site detected â€” direct CDN scan');

      try {
        const response = await fetch(pageUrl, {
          headers: {
            'User-Agent':
              'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128 Safari/537.36',
          },
        });

        if (!response.ok)
          throw new Error(`HTTP ${response.status} when fetching ${pageUrl}`);

        const html = await response.text();

        // ğŸ¯ ×—×™×œ×•×¥ ×™×©×™×¨ ×©×œ ×§×™×©×•×¨×™× ×œ×ª××•× ×•×ª Yamaha CDN (×’× ×× ××•×¡×ª×¨×™× ×‘×¡×§×¨×™×¤×˜×™×)
        const yamahaMatches = html.match(
          /(https:\/\/cdn2\.yamaha-motor\.eu\/[^\s"'<>]+\.(?:jpg|jpeg|png|webp|gif|avif))/gi
        );

        if (yamahaMatches?.length) {
          yamahaMatches.forEach((src) => found.add(src));
          console.log(`âœ… Found ${found.size} Yamaha CDN images`);
        } else {
          console.warn('âš ï¸ No Yamaha CDN images found directly in HTML');
        }
      } catch (err) {
        console.error('âŒ Yamaha Media fetch error:', err);
      }
    }

    // ğŸŸ¢ 2. Yamaha PDP
    if (pageUrl.includes('yamaha-motor.eu') && pageUrl.includes('/pdp/')) {
      console.log('âš™ï¸ Yamaha PDP mode activated');
      const yamahaMatch = pageUrl.match(/pdp\/([^/]+)-(\d{4})/i);

      if (yamahaMatch) {
        const model = yamahaMatch[1].toUpperCase().replace(/-/g, '');
        const year = yamahaMatch[2];
        const apiUrl = `https://www.yamaha-motor.eu/api/product-assets/${year}/${model}`;
        console.log(`ğŸ“¦ Fetching Yamaha PDP assets from ${apiUrl}`);

        try {
          const res = await fetch(apiUrl, {
            headers: {
              'User-Agent':
                'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127 Safari/537.36',
            },
          });

          if (res.ok) {
            const json = await res.json();

            const extractFromJson = (obj) => {
              if (!obj) return;
              if (
                typeof obj === 'string' &&
                obj.includes('cdn2.yamaha-motor.eu')
              ) {
                found.add(obj);
              } else if (typeof obj === 'object') {
                Object.values(obj).forEach(extractFromJson);
              }
            };

            extractFromJson(json);
            console.log(`âœ… Yamaha PDP API returned ${found.size} images`);
          }
        } catch (err) {
          console.error('âŒ Yamaha PDP API fetch error:', err);
        }
      }
    }

    // ğŸŸ  3. KTM press fallback
    if (pageUrl.includes('press.ktm.com')) {
      console.log('âš™ï¸ KTM press site detected');
      const response = await fetch(pageUrl, {
        headers: {
          'User-Agent':
            'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127 Safari/537.36',
        },
      });

      if (!response.ok)
        throw new Error(`HTTP ${response.status} when fetching ${pageUrl}`);

      const html = await response.text();

      const matches = html.match(
        /(https:\/\/press\.ktm\.com\/Content\/[A-Za-z0-9/_-]+\/(?:1200|2400)\.jpg)/gi
      );

      if (matches?.length) {
        matches.forEach((src) => found.add(src));
        console.log(`âœ… Found ${matches.length} KTM images`);
      }
    }

    // ğŸ”´ 4. Honda News (Europe)
    if (pageUrl.includes('hondanews.eu')) {
      console.log('âš™ï¸ Honda News site detected');

      // ×× ××“×•×‘×¨ ×‘×¢××•×“ ××“×™×” (×œ× ×§×•×‘×¥ ×ª××•× ×” ×™×©×™×¨)
      if (pageUrl.includes('/media/photos/')) {
        console.log('ğŸ§­ Honda media photo page detected, parsing HTML to extract image...');
        try {
          const response = await fetch(pageUrl, {
            headers: {
              'User-Agent':
                'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128 Safari/537.36',
              'Referer': 'https://hondanews.eu/',
            },
          });

          if (response.ok) {
            const html = await response.text();
            const match = html.match(/https:\/\/hondanews\.eu\/image\/motorcycles\/[^\s"'<>]+/i);
            if (match) {
              const imageUrl = match[0];
              console.log(`âœ… Found direct Honda image: ${imageUrl}`);
              const proxyUrl = `${proxyBase}/api/proxy-honda?url=${encodeURIComponent(imageUrl)}`;
              return [{ src: proxyUrl, alt: '', title: '' }];
            } else {
              console.warn('âš ï¸ No image URL found inside Honda media page');
            }
          } else {
            console.warn(`âš ï¸ Failed to fetch Honda media page: ${response.status}`);
          }
        } catch (err) {
          console.error('âŒ Error parsing Honda media page:', err);
        }
      }

      // ××—×¨×ª â€“ ×¢×˜×™×¤×” ××•×˜×•××˜×™×ª
      const proxyUrl = `${proxyBase}/api/proxy-honda?url=${encodeURIComponent(pageUrl)}`;
      console.log(`ğŸ–¼ï¸ Direct Honda image URL, wrapped with proxy: ${proxyUrl}`);
      return [{ src: proxyUrl, alt: '', title: '' }];
    }

    // ğŸ§© 5. fallback ×›×œ×œ×™
    if (found.size === 0) {
      const response = await fetch(pageUrl, {
        headers: {
          'User-Agent':
            'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127 Safari/537.36',
        },
      });

      if (response.ok) {
        const html = await response.text();
        const $ = cheerio.load(html);
        const baseUrl = new URL(pageUrl).origin;

        const normalizeUrl = (src) => {
          if (!src) return null;
          if (src.startsWith('http')) return src;
          if (src.startsWith('//')) return `https:${src}`;
          if (src.startsWith('data:')) return null;
          return `${baseUrl}/${src.replace(/^\/+/, '')}`;
        };

        $('img,[data-src],[data-lazy],[data-bg],[data-original]').each((_, el) => {
          const src =
            $(el).attr('src') ||
            $(el).attr('data-src') ||
            $(el).attr('data-lazy') ||
            $(el).attr('data-bg') ||
            $(el).attr('data-original');
          const full = normalizeUrl(src);
          if (full) found.add(full);
        });

        $('meta[property="og:image"], meta[name="twitter:image"]').each((_, el) => {
          const content = $(el).attr('content');
          const full = normalizeUrl(content);
          if (full) found.add(full);
        });
      }
    }

    // âœ… × ×™×§×•×™ ×¡×•×¤×™ ×¢× ×›×œ ×”××¡× × ×™× ×©×œ×š
    const images = Array.from(found)
      .filter((src) =>
        /\.(jpg|jpeg|png|gif|webp|avif)$/i.test(src.toLowerCase()) ||
        src.includes("/api/proxy-honda")
      )
      .filter((src) => !src.toLowerCase().includes('loading.gif'))
      .filter((src) => !src.toLowerCase().includes('/assets/img/0.gif'))
      .filter((src) => !src.toLowerCase().includes('/assets/img/logo.png'))
      .filter((src) => !src.toLowerCase().includes('/assets/img/icon_pdf.png'))
      .filter((src) => !src.toLowerCase().includes('placeholder'))
      .map((src) => ({ src, alt: '', title: '' }));

    console.log(`âœ… Found ${images.length} total images from ${pageUrl}`);
    return images;
  } catch (err) {
    console.error('âŒ fetchExternalImages error:', err);
    return [];
  }
}
////

// /components/MobileShopFilterBar.jsx
"use client";
import { useState } from "react";
import { useRouter, usePathname } from "next/navigation";
import ShopSidebar from "./ShopSidebar";
import { buildUrlFromFilters } from "@/utils/buildUrlFromFilters";

export default function MobileShopFilterBar({ onFilterChange = () => {}, product = null }) {
  const [open, setOpen] = useState(false);
  const [filters, setFilters] = useState({});
  const router = useRouter();
  const pathname = usePathname();

  const applyFilters = (f) => {
    setFilters(f);
    onFilterChange(f);

    const url = buildUrlFromFilters(f, pathname, product);
    router.push(url, { scroll: false });

    setOpen(false);
  };

  return (
    <>
      <button
        onClick={() => setOpen(!open)}
        className={`fixed top-50 z-50 px-4 py-1 rounded-md shadow-lg md:hidden transition-all duration-300 
          ${open ? "left-10 bg-gray-800" : "left-0 bg-red-600"} text-white animate-parts-bounce`}
      >
        {open ? "âœ•" : "×¡×™× ×•×Ÿ"}
      </button>

      {open && (
        <div className="fixed inset-0 bg-black/60 flex justify-center items-start pt-16 z-50">
          <div className="bg-white rounded-lg px-4 pt-6 pb-2 w-11/12 h-[90vh] overflow-y-auto">
            <div className="flex justify-between items-center mb-4">
              <h2 className="font-bold text-red-600">×× ×•×¢ ×¡×™× ×•×Ÿ ××•×¦×¨×™×</h2>
              <button onClick={() => setOpen(false)} className="text-red-600 font-bold">
                âœ•
              </button>
            </div>

            <ShopSidebar onFilterChange={applyFilters} />
          </div>
        </div>
      )}
    </>
  );
}
///


// components/ArticleShare.jsx
'use client';
import React, { useState, useRef, useEffect } from 'react';
import { FiShare2, FiCopy, FiX } from 'react-icons/fi';
import { FaWhatsapp, FaTwitter, FaFacebook, FaInstagram, FaTiktok } from 'react-icons/fa';
import { MdMoreHoriz } from 'react-icons/md';
import { gsap } from 'gsap';

export default function ArticleShare() {
  const [open, setOpen] = useState(false);
  const [position, setPosition] = useState('bottom'); // ğŸ‘ˆ ××¦×‘ ×¤×ª×™×—×” ×“×™× ××™
  const [interacting, setInteracting] = useState(false);
  const buttonRef = useRef(null);
  const dropRef = useRef(null);
  const url = typeof window !== 'undefined' ? window.location.href : '';
  const scrollTimeout = useRef(null);

  // ğŸ¯ ×§×•×‘×¢ ×›×™×•×•×Ÿ ×¤×ª×™×—×” ×œ×¤×™ ××™×§×•× ×”×›×¤×ª×•×¨ ×¢×œ ×”××¡×š
  useEffect(() => {
    if (!open && buttonRef.current) {
      const rect = buttonRef.current.getBoundingClientRect();
      const screenWidth = window.innerWidth;

      if (rect.left < screenWidth / 3) setPosition('left'); // ×§×¨×•×‘ ×œ×¦×“ ×©×××œ
      else if (rect.right > (screenWidth / 3) * 2) setPosition('right'); // ×§×¨×•×‘ ×œ×¦×“ ×™××™×Ÿ
      else setPosition('bottom'); // ×‘×××¦×¢
    }
  }, [open]);

  // âœ… ×× ×™××¦×™×™×ª ×¤×ª×™×—×”/×¡×’×™×¨×”
  useEffect(() => {
    if (open && dropRef.current) {
      gsap.fromTo(
        dropRef.current,
        { scale: 0.8, opacity: 0 },
        { scale: 1, opacity: 1, duration: 0.25, ease: 'power1.out' }
      );
    } else if (!open && dropRef.current) {
      gsap.to(dropRef.current, { opacity: 0, duration: 0.15 });
    }
  }, [open]);

  // âœ… ×¡×’×™×¨×” ××—×¨×™ ×’×œ×™×œ×”
  useEffect(() => {
    const handleScroll = () => {
      if (open && !interacting) {
        clearTimeout(scrollTimeout.current);
        scrollTimeout.current = setTimeout(() => setOpen(false), 500);
      }
    };
    window.addEventListener('scroll', handleScroll, { passive: true });
    return () => {
      window.removeEventListener('scroll', handleScroll);
      clearTimeout(scrollTimeout.current);
    };
  }, [open, interacting]);

  const handleCopy = () => navigator.clipboard.writeText(url);
  const handleShareAPI = async () => {
    if (navigator.share) {
      try {
        await navigator.share({ title: document.title, url });
      } catch (err) {
        console.error(err);
      }
    } else handleCopy();
  };

  // ğŸ§­ ××—×œ×§×•×ª ×¤×ª×™×—×” ×œ×¤×™ ××™×§×•×
  const positionClass = {
    left: 'absolute left-0 origin-top-left mt-2',
    right: 'absolute right-0 origin-top-right mt-2',
    bottom: 'absolute left-1/2 -translate-x-1/2 origin-top mt-2',
  }[position];

  return (
    <div className="relative inline-block text-left">
      <button
        ref={buttonRef}
        onClick={() => setOpen(o => !o)}
        className="flex items-center gap-1 px-3 py-2 bg-red-600 hover:bg-red-700 text-white rounded"
      >
        <FiShare2 className="w-5 h-5 text-white" />
        <span>×©×ª×£</span>
      </button>

      {open && (
        <div
          ref={dropRef}
          onPointerEnter={() => setInteracting(true)}
          onPointerLeave={() => setInteracting(false)}
          onTouchStart={() => setInteracting(true)}
          onTouchEnd={() => setInteracting(false)}
          className={`${positionClass} w-40 bg-white text-black rounded shadow-lg z-50`}
        >
          <div className="flex justify-end p-2">
            <button onClick={() => setOpen(false)} className="focus:outline-none">
              <FiX className="w-5 h-5 text-gray-600" />
            </button>
          </div>

          <button
            onClick={handleCopy}
            className="flex items-center w-full px-4 py-2 hover:bg-gray-100"
          >
            <FiCopy className="w-5 h-5 ml-2 text-gray-700" />
            <span className="flex-grow text-right">×”×¢×ª×§ ×›×ª×•×‘×ª</span>
          </button>

          <a
            href={`https://api.whatsapp.com/send?text=${encodeURIComponent(url)}`}
            target="_blank"
            rel="noopener noreferrer"
            className="flex items-center w-full px-4 py-2 hover:bg-gray-100"
          >
            <FaWhatsapp className="w-5 h-5 ml-2 text-green-500" />
            <span className="flex-grow text-right">×•×•××˜×¡××¤</span>
          </a>

          <a
            href={`https://twitter.com/intent/tweet?url=${encodeURIComponent(url)}&text=${encodeURIComponent(document.title)}`}
            target="_blank"
            rel="noopener noreferrer"
            className="flex items-center w-full px-4 py-2 hover:bg-gray-100"
          >
            <FaTwitter className="w-5 h-5 ml-2 text-blue-400" />
            <span className="flex-grow text-right">×˜×•×•×™×˜×¨</span>
          </a>

          <a
            href={`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`}
            target="_blank"
            rel="noopener noreferrer"
            className="flex items-center w-full px-4 py-2 hover:bg-gray-100"
          >
            <FaFacebook className="w-5 h-5 ml-2 text-blue-600" />
            <span className="flex-grow text-right">×¤×™×™×¡×‘×•×§</span>
          </a>

          <a
            href={`https://www.instagram.com/?url=${encodeURIComponent(url)}`}
            target="_blank"
            rel="noopener noreferrer"
            className="flex items-center w-full px-4 py-2 hover:bg-gray-100"
          >
            <FaInstagram className="w-5 h-5 ml-2 text-pink-500" />
            <span className="flex-grow text-right">××™× ×¡×˜×’×¨×</span>
          </a>

          <a
            href={`https://www.tiktok.com/share?url=${encodeURIComponent(url)}`}
            target="_blank"
            rel="noopener noreferrer"
            className="flex items-center w-full px-4 py-2 hover:bg-gray-100"
          >
            <FaTiktok className="w-5 h-5 ml-2 text-black" />
            <span className="flex-grow text-right">×˜×™×§×˜×•×§</span>
          </a>

          <button
            onClick={handleShareAPI}
            className="flex items-center w-full px-4 py-2 hover:bg-gray-100"
          >
            <MdMoreHoriz className="w-5 h-5 ml-2 text-gray-700" />
            <span className="flex-grow text-right">××¤×œ×™×§×¦×™×•×ª × ×•×¡×¤×•×ª</span>
          </button>
        </div>
      )}
    </div>
  );
}


//
// components/ArticleShareBottom.jsx
'use client';
import React, { useState, useEffect, useRef } from 'react';
import { FiShare2, FiCopy, FiX } from 'react-icons/fi';
import { FaWhatsapp, FaTwitter, FaFacebook, FaInstagram, FaTiktok } from 'react-icons/fa';
import { MdMoreHoriz } from 'react-icons/md';
import { gsap } from 'gsap';

export default function ArticleShareBottom() {
  const [open, setOpen] = useState(false);
  const [visible, setVisible] = useState(false);
  const [collapsed, setCollapsed] = useState(false);
  const buttonRef = useRef(null);
  const dropRef = useRef(null);
  const url = typeof window !== 'undefined' ? window.location.href : '';

  const [isDesktop, setIsDesktop] = useState(false);
  const [desktopLeft, setDesktopLeft] = useState(null);

  /* ğŸ–¥ ×–×™×”×•×™ ×“×¡×§×˜×•×¤ */
  useEffect(() => {
    const checkDevice = () => setIsDesktop(window.innerWidth > 1024);
    checkDevice();
    window.addEventListener('resize', checkDevice);
    return () => window.removeEventListener('resize', checkDevice);
  }, []);

  /* ğŸ“Œ ×—×™×©×•×‘ ×¦×“ ×©×××œ ×©×œ ×¢××•×“ ×”×›×ª×‘×” */
  useEffect(() => {
    if (!isDesktop) return;

    const calcPosition = () => {
      const article = document.querySelector('.article-content-wrapper');
      if (!article) return;

      const rect = article.getBoundingClientRect();
      const fromLeft = rect.left;

      // ×›×¤×ª×•×¨ ××©×××œ ×œ×¢××•×“ ×”×›×ª×‘×” (×¢× ×¨×™×•×•×— ×§×˜×Ÿ)
      setDesktopLeft(fromLeft - 70);
    };

    calcPosition();
    window.addEventListener('resize', calcPosition);
    return () => window.removeEventListener('resize', calcPosition);
  }, [isDesktop]);

  /* ğŸ¯ ×”×›×¤×ª×•×¨ ×™×•×¦×’ ×‘×™×Ÿ ×”×’×œ×¨×™×” ×œ×ª×’×•×‘×•×ª */
  useEffect(() => {
    const handleScroll = () => {
      const gallery = document.querySelector('.article-gallery-section');
      const comments = document.querySelector('.comments-section');
      if (!gallery || !comments) return;

      const galleryRect = gallery.getBoundingClientRect();
      const commentsRect = comments.getBoundingClientRect();

      const shouldShow =
        galleryRect.bottom < window.innerHeight * 0.8 &&
        commentsRect.top > window.innerHeight * 0.2;

      setVisible(shouldShow);
    };

    window.addEventListener('scroll', handleScroll, { passive: true });
    handleScroll();
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);

  /* ğŸ¬ ×× ×™××¦×™×” */
  useEffect(() => {
    if (open && dropRef.current) {
      gsap.fromTo(
        dropRef.current,
        { y: 10, opacity: 0 },
        { y: 0, opacity: 1, duration: 0.25, ease: 'power1.out' }
      );
    } else if (!open && dropRef.current) {
      gsap.to(dropRef.current, { opacity: 0, duration: 0.15 });
    }
  }, [open]);

  const handleCopy = () => navigator.clipboard.writeText(url);

  const handleShareAPI = async () => {
    if (navigator.share) {
      try {
        await navigator.share({ title: document.title, url });
      } catch (err) {
        console.error(err);
      }
    } else handleCopy();
  };

  if (!visible) return null;

  return (
    <div
      className="fixed  z-[5000] transition-all duration-300"
      style={{
        bottom: isDesktop ? '150px' : '40px',
        left: isDesktop ? `${desktopLeft}px` : '10px',
      }}
    >
      <button
        ref={buttonRef}
        onClick={() => {
          if (collapsed) setCollapsed(false);
          else setOpen((o) => !o);
        }}
        className={`flex items-center gap-2 px-4 py-2 rounded-full shadow-lg transition-all duration-300
          bg-red-600 hover:bg-red-700 text-white
          ${collapsed ? 'p-3 w-12 h-12 justify-center' : ''}
        `}
      >
        <FiShare2 className="w-5 h-5 text-white" />
        {!collapsed && <span>×©×ª×£ ×›×ª×‘×”</span>}
      </button>

      {/* ×ª×¤×¨×™×˜ ×”×©×™×ª×•×£ */}
      {open && !collapsed && (
        <div
          ref={dropRef}
          className="absolute bottom-14 left-0 w-52 bg-white text-black rounded-lg shadow-xl border border-gray-200"
        >
          <div className="flex justify-between items-center p-2 border-b border-gray-100">
            <span className="text-sm font-medium">×©×ª×£ ×‘×××¦×¢×•×ª</span>
            <button
              onClick={() => setCollapsed(true)}
              className="text-gray-500 hover:text-red-500"
            >
              <FiX className="w-4 h-4" />
            </button>
          </div>

          <button
            onClick={handleCopy}
            className="flex items-center w-full px-4 py-2 hover:bg-gray-100"
          >
            <FiCopy className="w-5 h-5 ml-2 text-gray-700" />
            <span className="flex-grow text-right">×”×¢×ª×§ ×§×™×©×•×¨</span>
          </button>

          <a
            href={`https://api.whatsapp.com/send?text=${encodeURIComponent(url)}`}
            target="_blank"
            rel="noopener noreferrer"
            className="flex items-center w-full px-4 py-2 hover:bg-gray-100"
          >
            <FaWhatsapp className="w-5 h-5 ml-2 text-green-500" />
            <span className="flex-grow text-right">×•×•××˜×¡××¤</span>
          </a>

          <a
            href={`https://twitter.com/intent/tweet?url=${encodeURIComponent(url)}&text=${encodeURIComponent(document.title)}`}
            target="_blank"
            rel="noopener noreferrer"
            className="flex items-center w-full px-4 py-2 hover:bg-gray-100"
          >
            <FaTwitter className="w-5 h-5 ml-2 text-blue-400" />
            <span className="flex-grow text-right">×˜×•×•×™×˜×¨</span>
          </a>

          <a
            href={`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`}
            target="_blank"
            rel="noopener noreferrer"
            className="flex items-center w-full px-4 py-2 hover:bg-gray-100"
          >
            <FaFacebook className="w-5 h-5 ml-2 text-blue-600" />
            <span className="flex-grow text-right">×¤×™×™×¡×‘×•×§</span>
          </a>

          <a
            href={`https://www.tiktok.com/share?url=${encodeURIComponent(url)}`}
            target="_blank"
            rel="noopener noreferrer"
            className="flex items-center w-full px-4 py-2 hover:bg-gray-100"
          >
            <FaTiktok className="w-5 h-5 ml-2 text-black" />
            <span className="flex-grow text-right">×˜×™×§×˜×•×§</span>
          </a>

          <button
            onClick={handleShareAPI}
            className="flex items-center w-full px-4 py-2 hover:bg-gray-100 border-t border-gray-100"
          >
            <MdMoreHoriz className="w-5 h-5 ml-2 text-gray-700" />
            <span className="flex-grow text-right">××¤×œ×™×§×¦×™×•×ª × ×•×¡×¤×•×ª</span>
          </button>
        </div>
      )}
    </div>
  );
}
///


//

//hooks\useIsMobile.js
'use client';
import { useEffect, useState } from 'react';

export default function useIsMobile(breakpoint = 1225) {
  const [isMobile, setIsMobile] = useState(false);

  useEffect(() => {
    const check = () => setIsMobile(window.innerWidth < breakpoint);
    check();
    window.addEventListener("resize", check);
    return () => window.removeEventListener("resize", check);
  }, [breakpoint]);

  return isMobile;
}


///
// lib/forumApi.js
const API_URL =
  process.env.NEXT_PUBLIC_STRAPI_API_URL ||
  "https://onmotor-strapi.onrender.com";

/* ğŸŸ© ×§×‘×œ×ª ×›×œ ×”×§×˜×’×•×¨×™×•×ª */
export async function fetchForumCategories() {
  const res = await fetch(`${API_URL}/api/forum-categories?populate=*`, {
    cache: "no-store",
  });
  if (!res.ok) throw new Error("×©×’×™××” ×‘×˜×¢×™× ×ª ×§×˜×’×•×¨×™×•×ª");
  const json = await res.json();

  console.log("ğŸ“ ×§×˜×’×•×¨×™×•×ª ×©×”×ª×§×‘×œ×•:", json.data);

  return (
    json.data?.map((item) => {
      const attrs = item.attributes || {};
      return {
        id: item.id,
        documentId: item.documentId,
        name: attrs.name || item.name || "×œ×œ× ×©×",
        slug: attrs.slug || item.slug || "",
        description: attrs.description || item.description || "",
      };
    }) || []
  );
}

/* ğŸŸ¦ ×§×‘×œ×ª ×›×œ ×”×©×¨×©×•×¨×™× ×œ×¤×™ slug ×§×˜×’×•×¨×™×” */
export async function fetchThreadsByCategorySlug(slug) {
  const decodedSlug = decodeURIComponent(slug || "").trim();

  const res = await fetch(
    `${API_URL}/api/forum-threads?filters[category][slug][$eq]=${decodedSlug}&sort=pinned:desc,lastActivity:desc&populate=comments`,
    { cache: "no-store" }
  );

  if (!res.ok) throw new Error("×©×’×™××” ×‘×˜×¢×™× ×ª ×“×™×•× ×™× ×œ×¤×™ ×§×˜×’×•×¨×™×”");
  const json = await res.json();

  console.log("ğŸ“¦ forum threads:", json.data);

  return (
    json.data?.map((item) => {
      const attrs = item.attributes || {};
      const commentsRelation = attrs.comments;

      // âœ… ×§×•×‘×¢ ××¡×¤×¨ ×ª×’×•×‘×•×ª *××”×§×©×¨ ×¢×¦××•* ×›×¤×™ ×©×—×•×–×¨ ××”-API
      const commentsCount =
        commentsRelation?.data?.length ??
        (Array.isArray(commentsRelation) ? commentsRelation.length : 0) ??
        0;

      return {
        id: item.id,
        documentId: item.documentId,
        title: attrs.title || item.title,
        slug: attrs.slug || item.slug,
        content: extractText(attrs.content || item.content),
        author: attrs.author || item.author,
        date: attrs.date || item.date,
        pinned: attrs.pinned,
        locked: attrs.locked,
        views: attrs.views || 0,
        lastActivity:
          attrs.lastActivity || attrs.updatedAt || attrs.createdAt || null,

        // ğŸ’¬ ×ª××™×“ ××¡×¤×¨ ×ª×’×•×‘×•×ª ××—×•×©×‘ ××”×§×©×¨
        commentsCount,

        category:
          attrs.category?.data?.attributes?.name ||
          item.category?.name ||
          null,
      };
    }) || []
  );
}


/* ğŸ”¹ ×—×™×œ×•×¥ ×˜×§×¡×˜ ×Ö¾Rich Text Blocks */
function extractText(blocks) {
  if (!blocks) return "";
  if (typeof blocks === "string") return blocks;
  if (Array.isArray(blocks)) {
    return blocks
      .map((b) => b.children?.map((child) => child.text).join(" "))
      .join("\n");
  }
  return "";
}
/* ğŸŸ§ ×§×‘×œ×ª ×“×™×•×Ÿ ×œ×¤×™ slug */
export async function fetchThreadBySlug(threadSlug) {
  try {
    const decodedSlug = decodeURIComponent(threadSlug || "").trim();
    console.log("ğŸ“ ×˜×•×¢×Ÿ ×“×™×•×Ÿ ×œ×¤×™ slug:", decodedSlug);

    const SITE_URL =
      process.env.NEXT_PUBLIC_SITE_URL || "https://www.onmotormedia.com";
    const proxyUrl = `/api/forum-thread?slug=${encodeURIComponent(
      decodedSlug
    )}`;

    console.log("ğŸŒ ×§×¨×™××” ×“×¨×š proxy:", proxyUrl);
    const res = await fetch(proxyUrl, { cache: "no-store" });

    if (!res.ok) {
      console.error("âŒ ×©×’×™××” ×‘×§×¨×™××” ×“×¨×š proxy:", res.status, res.statusText);
      throw new Error("×©×’×™××” ×‘×˜×¢×™× ×ª ×“×™×•×Ÿ ×“×¨×š proxy");
    }

    const json = await res.json();
    console.log("ğŸ“¦ ×ª×’×•×‘×ª Proxy:", json);

    const item = json.data?.[0];
    if (!item) {
      console.warn("âš ï¸ ×œ× × ××¦× ×“×™×•×Ÿ ×¢× slug:", decodedSlug);
      throw new Error("×“×™×•×Ÿ ×œ× × ××¦×");
    }

    const attrs = item.attributes ? item.attributes : item;

    // âœ… ×©×œ×™×—×” ×œÖ¾Strapi ×œ×¢×“×›×•×Ÿ views (×”×¤×¢×œ×ª afterFindOne)
    try {
      await fetch(
        `${API_URL}/api/forum-threads?filters[slug][$eq]=${decodedSlug}`,
        { cache: "no-store" }
      );
    } catch (err) {
      console.warn("âš ï¸ ×¢×“×›×•×Ÿ views × ×›×©×œ:", err);
    }

    // ğŸŸ¢ ×ª×’×•×‘×•×ª ××œ××•×ª
    const comments =
      (attrs.comments?.data || []).map((c) => {
        const ca = c.attributes || {};
        const rawAuthor =
          ca.author ??
          ca.name ??
          ca.username ??
          ca.user?.username ??
          ca.user?.name ??
          "";
        return {
          id: c.id,
          text: ca.text || ca.content || "",
          author: rawAuthor || "×× ×•× ×™××™",
          date: ca.date || ca.createdAt || ca.updatedAt || null,
          reply_to: ca.reply_to?.data?.id || null,
        };
      }) || [];

    // ğŸŸ© ×—×™×©×•×‘ ×ª××¨×™×š ×ª×’×•×‘×” ××—×¨×•× ×” ×××™×ª×™
    let latestCommentDate = null;
    if (attrs.comments?.data?.length) {
      const allDates = attrs.comments.data
        .map((c) =>
          new Date(
            c.attributes?.createdAt ||
              c.attributes?.updatedAt ||
              c.attributes?.date ||
              0
          )
        )
        .filter((d) => !isNaN(d));
      if (allDates.length) {
        latestCommentDate = new Date(Math.max(...allDates));
      }
    }

    return {
      id: item.id,
      documentId: item.documentId,
      title: attrs.title || "×œ×œ× ×›×•×ª×¨×ª",
      slug: attrs.slug || "",
      content: Array.isArray(attrs.content)
        ? attrs.content
            .map((block) =>
              block.children?.map((c) => c.text || "").join(" ")
            )
            .join("\n\n")
        : attrs.content || "",
      author: attrs.author || "×œ× ×¦×•×™×Ÿ",
      date: attrs.date || null,
      pinned: attrs.pinned || false,
      locked: attrs.locked || false,
      views: attrs.views || 0,
      lastActivity:
        latestCommentDate?.toISOString() ||
        attrs.lastActivity ||
        attrs.updatedAt ||
        attrs.date ||
        null,
      category:
        attrs.category?.data?.attributes?.name ||
        attrs.category?.name ||
        null,
      comments:
        (attrs.comments?.data || []).map((c) => {
          const ca = c.attributes || {};
          return {
            id: c.id,
            text: ca.text || ca.content || "",
            author:
              ca.author ??
              ca.name ??
              ca.username ??
              ca.user?.username ??
              ca.user?.name ??
              "×× ×•× ×™××™",
            createdAt: ca.createdAt,
            updatedAt: ca.updatedAt,
            reply_to: ca.reply_to?.data?.id || null,
          };
        }) || [],
    };
  } catch (err) {
    console.error("âŒ fetchThreadBySlug (proxy) error:", err);
    throw err;
  }
}


// lib/forumApi.js
export async function fetchCommentsByThreadSlug(threadSlug) {
  try {
    const decodedSlug = decodeURIComponent(threadSlug).trim();
    console.log("ğŸ’¬ ×˜×•×¢×Ÿ ×ª×’×•×‘×•×ª ×œ×¤×™ slug:", decodedSlug);

    const query = new URLSearchParams({
      "filters[forum_thread][slug][$eq]": decodedSlug,
      "populate": "*",
      "sort[0]": "createdAt:asc",
      "pagination[pageSize]": "100",
    });

    const res = await fetch(
      `${API_URL}/api/forum-comments?${query.toString()}`,
      { cache: "no-store" }
    );

    if (!res.ok)
      throw new Error(`×©×’×™××” ×‘×˜×¢×™× ×ª ×ª×’×•×‘×•×ª (${res.status})`);

    const json = await res.json();

    const comments = (json.data || []).map((item) => {
      // âš™ï¸ ×× ××™×Ÿ attributes â€“ × ×©×ª××© ×™×©×™×¨×•×ª ×‘×¤×¨×•×¤×¡ ×”×¨××©×™×™×
      const a = item.attributes || item;

      return {
        id: item.id,
        author: a.author || a.user?.username || "×× ×•× ×™××™",
        text: a.text || a.content || "â€” ××™×Ÿ ×ª×•×›×Ÿ â€”",
        date: a.date || a.createdAt || a.updatedAt || null,
        createdAt: a.createdAt || null,
        reply_to: a.reply_to?.id || a.reply_to?.data?.id || null,
      };
    });

    console.log("ğŸ’¬ ×ª×’×•×‘×•×ª ×©×”×ª×§×‘×œ×• ×-Strapi:", comments);
    return comments;
  } catch (err) {
    console.error("âŒ fetchCommentsByThreadSlug error:", err);
    return [];
  }
}

/* ğŸŸ¥ ×”×•×¡×¤×ª ×ª×’×•×‘×” ×œ×¤×™ slug ×©×œ ×“×™×•×Ÿ */
export async function addCommentByThreadSlug({
  threadSlug,
  text,
  author,
  reply_to,
}) {
  try {
    console.log("ğŸ“¨ ×©×œ×™×—×ª ×ª×’×•×‘×” ×—×“×©×”...");
    console.log("ğŸ§© slug ×©×”×ª×§×‘×œ:", threadSlug);

    const decodedSlug = decodeURIComponent(threadSlug).trim();

    // ğŸŸ¢ ×©×œ×™×¤×ª ××–×”×” ×”×“×™×•×Ÿ ×œ×¤×™ slug
    const threadRes = await fetch(
      `${API_URL}/api/forum-threads?filters[slug][$eq]=${decodedSlug}`
    );
    const threadJson = await threadRes.json();
    const thread = threadJson?.data?.[0];

    if (!thread) {
      console.error("âŒ ×œ× × ××¦× ×“×™×•×Ÿ ×ª×•×× ×œ-slug:", decodedSlug);
      throw new Error("×œ× × ××¦× ×“×™×•×Ÿ ×ª×•×× ×œ-slug");
    }

    const threadId = thread.id;
    console.log("ğŸ§© ××–×”×” ×“×™×•×Ÿ ×©× ××¦×:", threadId);

    // ğŸ§± ×’×•×£ ×”×‘×§×©×” â€” ×™×¦×™×¨×ª ×ª×’×•×‘×” ×—×“×©×”
    const body = {
      data: {
        text,
        author,
        forum_thread: threadId, // âœ… ×§×©×¨ ×™×©×™×¨ ×œ×¤×™ ID ×¤× ×™××™
        reply_to: reply_to || null,
        date: new Date().toISOString(),
        publishedAt: new Date().toISOString(),
      },
    };

    console.log("ğŸ“¦ ×’×•×£ ×©× ×©×œ×— ×œ-Strapi:", JSON.stringify(body, null, 2));

    const res = await fetch(`${API_URL}/api/forum-comments`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(body),
    });

    const responseText = await res.text();
    console.log("ğŸ“© ×ª×’×•×‘×ª Strapi (×ª×’×•×‘×”):", responseText);

    if (!res.ok) {
      console.error("âŒ ×©×’×™××” ×‘×©×œ×™×—×ª ×ª×’×•×‘×”:", res.status, res.statusText);
      throw new Error(`×©×’×™××” ×‘×©×œ×™×—×ª ×ª×’×•×‘×” (${res.status})`);
    }

    let json = null;
    try {
      json = JSON.parse(responseText);
    } catch {
      console.log("ğŸ“© ×ª×’×•×‘×” ×œ× ×‘×¤×•×¨××˜ JSON:", responseText);
    }

    // ğŸ•“ ×”×©×”×™×” ×§×¦×¨×” ×œ×•×•×“× ×©×”×ª×’×•×‘×” × ×©××¨×” ×‘××¡×“
    await new Promise((r) => setTimeout(r, 400));

    // ğŸ”¢ ×¢×“×›×•×Ÿ ×¡×¤×™×¨×ª ×ª×’×•×‘×•×ª ×œ×“×™×•×Ÿ
    try {
      // ××©×™×›×ª ×›×œ ×”×ª×’×•×‘×•×ª ×”×§×©×•×¨×•×ª ×œ×“×™×•×Ÿ
      const commentsRes = await fetch(
        `${API_URL}/api/forum-comments?filters[forum_thread][id][$eq]=${threadId}`
      );
      const commentsJson = await commentsRes.json();
      const currentCount = commentsJson?.data?.length || 0;

      // âœ… ×¢×“×›×•×Ÿ ×”×©×“×” commentsCount ×‘-Strapi ×’× ×× ×”×•× null
      await fetch(`${API_URL}/api/forum-threads/${threadId}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          data: {
            commentsCount: currentCount,
          },
        }),
      });

      console.log(`ğŸ”¢ commentsCount ×¢×•×“×›×Ÿ ×œÖ¾${currentCount}`);
    } catch (err) {
      console.error("âš ï¸ ×¢×“×›×•×Ÿ commentsCount × ×›×©×œ:", err);
    }


    // ğŸŸ¡ ×¢×“×›×•×Ÿ ×ª××¨×™×š ×¤×¢×™×œ×•×ª ××—×¨×•×Ÿ
    await updateLastActivity(threadId, new Date().toISOString());


    console.log("âœ… ×ª×’×•×‘×” × ×•×¦×¨×” ×‘×”×¦×œ×—×” ×‘-Strapi");
    return json?.data;
  } catch (err) {
    console.error("âŒ addCommentByThreadSlug error:", err);
    throw err;
  }
}

/* ğŸŸ¨ ×¤×ª×™×—×ª ×©×¨×©×•×¨ ×—×“×© */
export async function addThread({ title, content, author, categorySlug }) {
  try {
    const catRes = await fetch(
      `${API_URL}/api/forum-categories?filters[slug][$eq]=${categorySlug}`
    );
    const catJson = await catRes.json();
    const categoryId = catJson?.data?.[0]?.id;

    if (!categoryId) throw new Error("×œ× × ××¦××” ×§×˜×’×•×¨×™×” ××ª××™××” ×œ-slug");

    const normalizeSlug = (text) => {
      return text
        .normalize("NFD")
        .replace(/[\u0590-\u05FF]/g, "")
        .replace(/[^\w\s-]/g, "")
        .trim()
        .replace(/\s+/g, "-")
        .toLowerCase();
    };

    const threadSlug = normalizeSlug(title) || `thread-${Date.now()}`;

    const contentBlocks = [
      {
        type: "paragraph",
        children: [{ type: "text", text: content }],
      },
    ];

    const body = {
      data: {
        title,
        slug: threadSlug,
        content: contentBlocks,
        author,
        category: { connect: [{ id: categoryId }] },
        pinned: false,
        locked: false,
        views: 0,
        date: new Date().toISOString(),
        lastActivity: new Date().toISOString(),
        publishedAt: new Date().toISOString(),
      },
    };

    console.log("ğŸ“¦ BODY ×©× ×©×œ×— ×œÖ¾Strapi:", JSON.stringify(body, null, 2));

    const res = await fetch(`${API_URL}/api/forum-threads`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(body),
    });

    const responseText = await res.text();
    let json = null;

    try {
      json = JSON.parse(responseText);
    } catch {
      console.log("ğŸ“© ×ª×’×•×‘×” ×œ× ×‘×¤×•×¨××˜ JSON:", responseText);
    }

    if (!res.ok) {
      console.error("âŒ ×©×’×™××” ×‘×™×¦×™×¨×ª ×“×™×•×Ÿ ×—×“×©:", res.status, res.statusText);
      console.log("ğŸ“© ×ª×’×•×‘×ª ×©×¨×ª ××œ××”:", responseText);
      throw new Error(`×©×’×™××” ×‘×™×¦×™×¨×ª ×“×™×•×Ÿ ×—×“×© (${res.status})`);
    }

    console.log("âœ… × ×•×¦×¨ ×“×™×•×Ÿ:", json);
    return json?.data;
  } catch (err) {
    console.error("âš ï¸ addThread error:", err);
    throw err;
  }
}

/* ğŸŸ¦ ×”×¢×œ××ª views */
export async function incrementThreadViews(threadId, currentViews = 0) {
  try {
    await fetch(`${API_URL}/api/forum-threads/${threadId}`, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        data: { views: currentViews + 1 },
      }),
    });
  } catch (err) {
    console.error("âš ï¸ incrementThreadViews:", err);
  }
}

/* ğŸŸª ×¢×“×›×•×Ÿ ×ª××¨×™×š ×¤×¢×™×œ×•×ª ××—×¨×•×Ÿ */
export async function updateLastActivity(threadId, date = new Date().toISOString()) {
  try {
    await fetch(`${API_URL}/api/forum-threads/${threadId}`, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        data: { lastActivity: date },
      }),
    });
  } catch (err) {
    console.error("âš ï¸ updateLastActivity:", err);
  }
}




////
// app/forum/[slug]/[threadSlug]/CommentsSection.jsx
'use client';

import { useEffect, useState } from 'react';
import {
  fetchCommentsByThreadSlug,
  addCommentByThreadSlug,
} from '@/lib/forumApi';
import CommentItem from './CommentItem';

export default function CommentsSection({ threadSlug, threadLocked }) {
  const [comments, setComments] = useState([]);
  const [replyTo, setReplyTo] = useState(null);
  const [newComment, setNewComment] = useState({ author: '', text: '' });
  const [submitting, setSubmitting] = useState(false);

  useEffect(() => {
    loadComments();
  }, [threadSlug]);

  async function loadComments() {
    try {
      const data = await fetchCommentsByThreadSlug(threadSlug);
      console.log('ğŸ§© ×ª×’×•×‘×•×ª × ×˜×¢× ×• (××§×•×¨):', data);

      // ğŸ§  × × ×§×” ×•× ×—×–×™×¨ ×¢×¨×›×™× ×‘×˜×•×—×™×
      const sanitized = data.map((c) => ({
        ...c,
        author: c.author?.trim() || '×× ×•× ×™××™',
        text: c.text?.trim() || 'â€” ××™×Ÿ ×ª×•×›×Ÿ â€”',
      }));

      console.log('âœ… ×ª×’×•×‘×•×ª ×œ××—×¨ × ×™×§×•×™:', sanitized);
      setComments(sanitized);
    } catch (err) {
      console.error('âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×ª×’×•×‘×•×ª:', err);
    }
  }

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!newComment.text.trim()) return;
    setSubmitting(true);
    try {
      await addCommentByThreadSlug({
        threadSlug,
        text: newComment.text,
        author: newComment.author?.trim() || '×× ×•× ×™××™',
        reply_to: replyTo,
      });
      setNewComment({ author: '', text: '' });
      setReplyTo(null);
      await loadComments();
    } catch (err) {
      console.error('âŒ ×©×’×™××” ×‘×©×œ×™×—×ª ×ª×’×•×‘×”:', err);
    } finally {
      setSubmitting(false);
    }
  };

  return (
    <div>
      <h3 className="text-2xl font-bold text-[#e60000] mb-6 text-right border-b-2 border-[#e60000] pb-2">
        ×ª×’×•×‘×•×ª ({comments.length})
      </h3>

      <div className="space-y-4">
        {comments.length === 0 ? (
          <p className="text-center text-gray-700">××™×Ÿ ×ª×’×•×‘×•×ª ×¢×“×™×™×Ÿ.</p>
        ) : (
          comments.map((c) => (
            <CommentItem
              key={c.id}
              comment={c}
              comments={comments}
              setReplyTo={setReplyTo}
            />
          ))
        )}
      </div>

      {!threadLocked ? (
        <form
          onSubmit={handleSubmit}
          className="mt-10 border-2 border-[#e60000] rounded-xl bg-white shadow-md p-6 text-black"
        >
          {replyTo && (
            <div className="text-sm text-gray-600 mb-3">
              ××’×™×‘ ×œÖ¾×ª×’×•×‘×” #{replyTo}{' '}
              <button
                type="button"
                onClick={() => setReplyTo(null)}
                className="text-[#e60000] hover:underline"
              >
                ×‘×™×˜×•×œ
              </button>
            </div>
          )}

          <label className="block mb-2 text-sm text-right font-semibold">
            ×©×
          </label>
          <input
            type="text"
            value={newComment.author}
            onChange={(e) =>
              setNewComment({ ...newComment, author: e.target.value })
            }
            className="w-full bg-[#fad2d2] border-2 border-[#e60000] rounded px-3 py-2 mb-4 text-black focus:outline-none focus:border-[#ff3333]"
            placeholder="×œ×“×•×’××”: ×™××™×¨ ADV1290"
          />

          <label className="block mb-2 text-sm text-right font-semibold">
            ×ª×’×•×‘×”
          </label>
          <textarea
            value={newComment.text}
            onChange={(e) =>
              setNewComment({ ...newComment, text: e.target.value })
            }
            className="w-full bg-[#fad2d2] border-2 border-[#e60000] rounded px-3 py-2 h-32 mb-4 text-black resize-none focus:outline-none focus:border-[#ff3333]"
            placeholder="×›×ª×•×‘ ×›××Ÿ ××ª ×ª×’×•×‘×ª×š..."
          />

          <button
            type="submit"
            disabled={submitting}
            className={`w-full py-2 rounded font-semibold text-white transition ${
              submitting
                ? 'bg-gray-500 cursor-not-allowed'
                : 'bg-[#e60000] hover:bg-[#ff3333]'
            }`}
          >
            {submitting ? '×©×•×œ×—...' : '×¤×¨×¡× ×ª×’×•×‘×”'}
          </button>
        </form>
      ) : (
        <p className="text-center text-[#e60000] mt-6 font-semibold">
          ğŸ”’ ×”×“×™×•×Ÿ × ×¢×•×œ. ×œ× × ×™×ª×Ÿ ×œ×”×•×¡×™×£ ×ª×’×•×‘×•×ª.
        </p>
      )}
    </div>
  );
}



//
//app\forum\[slug]\[threadSlug]\CommentItem.jsx
'use client';
import { useEffect, useRef } from 'react';

export default function CommentItem({ comment, comments, setReplyTo }) {
  const ref = useRef(null);

  // ××–×”×” ×™×™×—×•×“×™ ×œ×›×œ ×ª×’×•×‘×” (×œ×’×œ×™×œ×”)
  useEffect(() => {
    if (ref.current) {
      ref.current.id = `comment-${comment.id}`;
    }
  }, [comment.id]);

  // ××¦×™××ª ×©× ×”××’×™×‘ ×©××œ×™×• ××’×™×‘×™×
  const repliedTo = comment.reply_to
    ? comments.find((c) => c.id === comment.reply_to)
    : null;

  const handleScrollToReplied = () => {
    if (!repliedTo) return;
    const el = document.getElementById(`comment-${repliedTo.id}`);
    if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
  };

  // ×ª××¨×™×š ×ª×§×™×Ÿ
  const dateString = comment.date
    ? new Date(comment.date).toLocaleString('he-IL')
    : comment.createdAt
    ? new Date(comment.createdAt).toLocaleString('he-IL')
    : 'â€”';

  // ×ª×•×›×Ÿ ×”×ª×’×•×‘×” â€“ ×©×“×” text ××• content
  const commentText = comment.text || comment.content || '';

  return (
    <div
      ref={ref}
      className="border-2 border-[#e60000] bg-white rounded-xl shadow-md p-4 scroll-mt-24"
    >
      <div className="flex justify-between items-center mb-2">
        <p className="font-semibold text-[#e60000]">{comment.author || '×× ×•× ×™××™'}</p>
        <p className="text-xs text-gray-600">{dateString}</p>
      </div>

      {/* ×ª×’×•×‘×” ×œ××™×©×”×• */}
      {repliedTo && (
        <p className="text-xs text-gray-600 mb-2">
          ×‘×ª×’×•×‘×” ×œÖ¾{' '}
          <button
            onClick={handleScrollToReplied}
            className="text-[#e60000] font-semibold hover:underline"
          >
            {repliedTo.author || '×× ×•× ×™××™'}
          </button>
        </p>
      )}

      {/* ×ª×•×›×Ÿ ×××™×ª×™ */}
      <p className="whitespace-pre-line leading-relaxed text-black mb-3">
        {commentText.trim() ? commentText : 'â€” ××™×Ÿ ×ª×•×›×Ÿ â€”'}
      </p>

      <button
        onClick={() => setReplyTo(comment.id)}
        className="text-sm text-[#e60000] hover:underline"
      >
        ×”×©×‘
      </button>
    </div>
  );
}


// app/forum/[slug]/[threadSlug]/CommentItem.jsx
'use client';
import { useEffect, useRef } from 'react';

export default function CommentItem({ comment, comments, setReplyTo }) {
  const ref = useRef(null);

  useEffect(() => {
    if (ref.current) {
      ref.current.id = `comment-${comment.id}`;
    }
  }, [comment.id]);

  // ×ª×’×•×‘×•×ª-××©× ×” (×ª×’×•×‘×•×ª ×œ×ª×’×•×‘×” ×–×•)
  const childComments = comments.filter((c) => c.reply_to === comment.id);

  const repliedTo = comment.reply_to
    ? comments.find((c) => c.id === comment.reply_to)
    : null;

  const handleScrollToReplied = () => {
    if (!repliedTo) return;
    const el = document.getElementById(`comment-${repliedTo.id}`);
    if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
  };

  const dateString = comment.date
    ? new Date(comment.date).toLocaleString('he-IL')
    : comment.createdAt
    ? new Date(comment.createdAt).toLocaleString('he-IL')
    : 'â€”';

  const commentText = comment.text || comment.content || '';

  return (
    <div
      ref={ref}
      className="border-2 border-[#e60000] bg-white rounded-xl shadow-md p-4 scroll-mt-24 text-right"
    >
      <div className="flex justify-between items-center mb-2">
        <p className="font-semibold text-[#e60000]">{comment.author || '×× ×•× ×™××™'}</p>
        <p className="text-xs text-gray-600">{dateString}</p>
      </div>

      {repliedTo && (
        <p className="text-xs text-gray-600 mb-2">
          ×‘×ª×’×•×‘×” ×œÖ¾{' '}
          <button
            onClick={handleScrollToReplied}
            className="text-[#e60000] font-semibold hover:underline"
          >
            {repliedTo.author || '×× ×•× ×™××™'}
          </button>
        </p>
      )}

      <p className="whitespace-pre-line leading-relaxed text-black mb-3">
        {commentText.trim() ? commentText : 'â€” ××™×Ÿ ×ª×•×›×Ÿ â€”'}
      </p>

      <button
        onClick={() => setReplyTo(comment.id)}
        className="text-sm text-[#e60000] hover:underline"
      >
        ×”×©×‘
      </button>

      {/* ğŸŸ¢ ×ª×’×•×‘×•×ª ××©× ×” (××•×¤×™×¢×•×ª ×‘×¤× ×™×) */}
      {childComments.length > 0 && (
        <div className="mt-4 pl-4 border-r-2 border-[#e60000]/40 space-y-3">
          {childComments.map((child) => (
            <CommentItem
              key={child.id}
              comment={child}
              comments={comments}
              setReplyTo={setReplyTo}
            />
          ))}
        </div>
      )}
    </div>
  );
}

// app/forum/[slug]/page.jsx
'use client';

import { useEffect, useState } from 'react';
import { useParams } from 'next/navigation';
import Link from 'next/link';
import PageContainer from '@/components/PageContainer';
import { fetchThreadsByCategorySlug } from '@/lib/forumApi';
import { getForumLabel } from '@/utils/labelMap';
import NewPostForm from '../NewPostForm';

export default function ForumCategoryPage() {
  const params = useParams();
  const slug = params?.slug ? decodeURIComponent(params.slug) : '';
  const [threads, setThreads] = useState([]);
  const [loading, setLoading] = useState(true);
  const [showForm, setShowForm] = useState(false);

  const categoryLabel = getForumLabel(slug);

  const loadThreads = async () => {
    try {
      const data = await fetchThreadsByCategorySlug(slug);
      setThreads(data);
    } catch (err) {
      console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ×“×™×•× ×™×:', err);
    } finally {
      setLoading(false);
    }
  };

    // ğŸ§© ×˜×¢×™× ×ª ×“×™×•× ×™× ×›×•×œ×œ ×¡×¤×™×¨×ª ×ª×’×•×‘×•×ª ×××™×ª×™×ª ×œ×¤×™ fetchCommentsByThreadSlug
  useEffect(() => {
    async function load() {
      try {
        const threadsData = await fetchThreadsByCategorySlug(slug);

        // ğŸ§® × ×—×©×‘ ×œ×›×œ ×“×™×•×Ÿ ××ª ××¡×¤×¨ ×”×ª×’×•×‘×•×ª ×“×¨×š ××•×ª×• API ×©×‘×• ××©×ª××© ×¢××•×“ ×”×“×™×•×Ÿ ×¢×¦××•
        const withCounts = await Promise.all(
          threadsData.map(async (t) => {
            try {
              // × ×©×ª××© ×‘×“×™×•×§ ×‘××•×ª×” ×¤×•× ×§×¦×™×” ×©××©××©×ª ××ª CommentsSection
              const comments = await fetchCommentsByThreadSlug(t.slug);
              return { ...t, commentsCount: comments.length };
            } catch (err) {
              console.error(`âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×ª×’×•×‘×•×ª ×œ×“×™×•×Ÿ ${t.slug}:`, err);
              return { ...t, commentsCount: 0 };
            }
          })
        );

        setThreads(withCounts);
      } catch (err) {
        console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ×“×™×•× ×™×:', err);
      } finally {
        setLoading(false);
      }
    }

    load();
  }, [slug]);


  return (
    <PageContainer
      title={categoryLabel}
      breadcrumbs={[
        { label: '×“×£ ×”×‘×™×ª', href: '/' },
        { label: '×¤×•×¨×•×', href: '/forum' },
        { label: categoryLabel, href: `/forum/${slug}` },
      ]}
    >
      <div className="bg-[#faafaf] text-black min-h-screen py-8 px-2 sm:px-4 transition-colors duration-500">
        {/* ğŸŸ¥ ×§×•×¤×¡×” ×›×•×œ×œ×ª */}
        <div className="border-2 border-[#e60000] rounded-xl bg-white shadow-md mb-8">
          {/* ğŸ”´ ×›×¤×ª×•×¨ ×¤×ª×™×—×” */}
          <div className="flex justify-end items-center p-4 bg-[#fff5f5] rounded-t-xl">
            <button
              onClick={() => setShowForm(!showForm)}
              className="px-5 py-2 bg-[#e60000] text-white rounded-lg hover:bg-[#ff3333] transition font-semibold"
            >
              {showForm ? '×¡×’×•×¨ ×˜×•×¤×¡' : '×¤×ª×— ×“×™×•×Ÿ ×—×“×©'}
            </button>
          </div>

          {/* ğŸ§¾ ×˜×•×¤×¡ ×¤×ª×™×—×ª ×“×™×•×Ÿ */}
          {showForm && (
            <div className="p-6 border-t-2 border-[#e60000] bg-[#ffeaea] rounded-b-xl">
              <NewPostForm
                categorySlug={slug}
                onCreated={loadThreads}
                onClose={() => setShowForm(false)}
              />
            </div>
          )}
        </div>

        {/* ğŸ—‚ï¸ ×¨×©×™××ª ×“×™×•× ×™× */}
        {loading ? (
          <p className="text-center text-gray-700">×˜×•×¢×Ÿ ×“×™×•× ×™×...</p>
        ) : threads.length === 0 ? (
          <p className="text-center text-gray-700">××™×Ÿ ×“×™×•× ×™× ×‘×§×˜×’×•×¨×™×” ×–×•.</p>
        ) : (
          <ul className="space-y-6">
            {threads.map((t) => (
              <li
                key={t.id}
                className="border-2 border-[#e60000] rounded-xl bg-white shadow-md transition hover:shadow-lg hover:-translate-y-1 duration-200"
              >
                <Link href={`/forum/${slug}/${t.slug}`} className="block p-5">
                  {/* ğŸ§­ ×›×•×ª×¨×ª ×•×¤×¨×˜×™ ×™×•×¦×¨ â€” ×”×™×¤×•×š ×¦×“×“×™× */}
                  <div className="flex justify-between items-start border-b-2 border-[#e60000] pb-3 mb-3">
                    {/* ×›×•×ª×¨×ª ××™××™×Ÿ */}
                    <h3 className="text-xl font-bold text-[#e60000] text-right">
                      {t.title}
                    </h3>

                    {/* ×¤×¨×˜×™ ×™×•×¦×¨ ××©×××œ */}
                    <div className="text-left">
                      <p className="text-sm">
                        × ×›×ª×‘ ×¢×œ ×™×“×™{' '}
                        <span className="font-semibold text-[#e60000]">
                          {t.author || '×× ×•× ×™××™'}
                        </span>
                      </p>
                      <p className="text-sm text-gray-700 mt-1">
                        ×¦×¤×™×•×ª: {t.views || 0}â€¢ ×ª×’×•×‘×•×ª: {t.commentsCount || 0}
                      </p>
                    </div>
                  </div>

                  {/* ğŸ’¬ ×ª×•×›×Ÿ ×”×“×™×•×Ÿ */}
                  <p className="text-sm leading-relaxed whitespace-pre-line mb-4 text-[#181818]">
                    {t.content?.length > 250
                      ? t.content.slice(0, 250) + '...'
                      : t.content}
                  </p>

                  {/* ğŸ•“ ×ª××¨×™×›×™× */}
                  <div className="text-xs text-gray-700 border-t-2 border-[#e60000] pt-2 flex justify-between">
                    <span>
                      × ×•×¦×¨ ×‘×ª××¨×™×š:{' '}
                      {t.date
                        ? new Date(t.date).toLocaleString('he-IL')
                        : 'â€”'}
                    </span>
                    <span>
                      ×¢×•×“×›×Ÿ ×œ××—×¨×•× ×”:{' '}
                      {t.lastActivity
                        ? new Date(t.lastActivity).toLocaleString('he-IL')
                        : 'â€”'}
                    </span>
                  </div>
                </Link>
              </li>
            ))}
          </ul>
        )}
      </div>
    </PageContainer>
  );
}

///
//


// app/forum/[slug]/[threadSlug]/page.jsx
'use client';

import { useEffect, useState } from 'react';
import { useParams } from 'next/navigation';
import PageContainer from '@/components/PageContainer';
import {
  fetchThreadBySlug,
  fetchCommentsByThreadSlug,
  addCommentByThreadSlug,
  incrementThreadViews,
} from '@/lib/forumApi';
import { labelMap } from '@/utils/labelMap';

export default function ForumThreadPage() {
  const { slug, threadSlug } = useParams();
  const decodedThreadSlug = decodeURIComponent(threadSlug || ""); // âœ… ×¤×¢× ×•×— ××œ× ×©×œ ×”×¡×œ××’

  const [thread, setThread] = useState(null);
  const [comments, setComments] = useState([]);
  const [replyTo, setReplyTo] = useState(null);
  const [loading, setLoading] = useState(true);
  const [newComment, setNewComment] = useState({ author: '', text: '' });
  const [submitting, setSubmitting] = useState(false);
  const [statusMessage, setStatusMessage] = useState(null);

  useEffect(() => {
    async function load() {
      try {
        console.log("ğŸ“¥ ×˜×•×¢×Ÿ ×“×™×•×Ÿ ×œ×¤×™ slug:", decodedThreadSlug);
        const t = await fetchThreadBySlug(decodedThreadSlug); // âœ… ×©×™××•×© ×‘×¢×¨×š ×”××¤×•×¢× ×—
        console.log("ğŸ§© ×ª×•×¦××” ×Ö¾fetchThreadBySlug:", t);

        setThread(t);
        if (t?.id) await incrementThreadViews(t.id, t.views);
        const c = await fetchCommentsByThreadSlug(decodedThreadSlug);
        setComments(c);
      } catch (err) {
        console.error('âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×“×™×•×Ÿ:', err);
        setStatusMessage({ text: '×©×’×™××” ×‘×˜×¢×™× ×ª ×”×“×™×•×Ÿ', type: 'error' });
      } finally {
        setLoading(false);
      }
    }
    load();
  }, [decodedThreadSlug]); // âœ… ×××–×™×Ÿ ×œ×’×¨×¡×” ×”××¤×•×¢× ×—×ª

  // ğŸŸ¢ ×˜×•×¤×¡ ×ª×’×•×‘×”
  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!newComment.text.trim()) {
      setStatusMessage({ text: '× × ×œ××œ× ×ª×•×›×Ÿ ×ª×’×•×‘×”', type: 'error' });
      return;
    }

    setSubmitting(true);
    try {
      await addCommentByThreadSlug({
        threadSlug: decodedThreadSlug, // âœ… ×©×™××•×© ×‘××•×ª×• ×¢×¨×š
        text: newComment.text,
        author: newComment.author || '×× ×•× ×™××™',
        reply_to: replyTo,
      });

      setNewComment({ author: '', text: '' });
      setReplyTo(null);
      const updatedComments = await fetchCommentsByThreadSlug(decodedThreadSlug);
      setComments(updatedComments);

      setStatusMessage({ text: '×”×ª×’×•×‘×” ×¤×•×¨×¡××” ×‘×”×¦×œ×—×” ğŸ‰', type: 'success' });
      setTimeout(() => setStatusMessage(null), 3000);
    } catch (err) {
      console.error('âŒ ×©×’×™××” ×‘×©×œ×™×—×ª ×ª×’×•×‘×”:', err);
      setStatusMessage({ text: '×©×’×™××” ×‘×©×œ×™×—×ª ×ª×’×•×‘×”', type: 'error' });
    } finally {
      setSubmitting(false);
    }
  };

  const categoryLabel = labelMap[slug] || slug;


  return (
    <PageContainer
      title={thread ? thread.title : '×˜×•×¢×Ÿ...'}
      breadcrumbs={[
        { label: '×“×£ ×”×‘×™×ª', href: '/' },
        { label: '×¤×•×¨×•×', href: '/forum' },
        { label: categoryLabel, href: `/forum/${slug}` },
        { label: thread?.title || '×“×™×•×Ÿ', href: `/forum/${slug}/${threadSlug}` },
      ]}
    >
      <div className="bg-[#111111] text-gray-200 min-h-screen py-8 px-2 sm:px-4">
        {loading ? (
          <p className="text-center text-gray-400">×˜×•×¢×Ÿ ×“×™×•×Ÿ...</p>
        ) : !thread ? (
          <p className="text-center text-red-500">âŒ ×“×™×•×Ÿ ×œ× × ××¦×</p>
        ) : (
          <>
            {/* ğŸŸ¥ ×¤×•×¡×˜ ×¤×ª×™×—×” */}
            <div className="border border-gray-700 rounded-lg bg-[#1a1a1a] shadow-md mb-8">
              <div className="p-4 border-b border-gray-700 flex justify-between items-center">
                <div className="flex items-center gap-2">
                  {thread.pinned && (
                    <span className="text-[#e60000] font-bold text-sm">ğŸ“Œ × ×¢×•×¥</span>
                  )}
                  {thread.locked && (
                    <span className="text-[#ff3333] font-bold text-sm">ğŸ”’ × ×¢×•×œ</span>
                  )}
                  <h2 className="text-xl sm:text-2xl font-semibold text-white">
                    {thread.title}
                  </h2>
                </div>
                <p className="text-sm text-gray-400 text-right">
                  × ×›×ª×‘ ×¢×œ ×™×“×™ {thread.author}
                  <br />
                  ×¦×¤×™×•×ª: {thread.views || 0}
                </p>
              </div>
              <div className="p-6 text-gray-100 whitespace-pre-line leading-relaxed">
                {thread.content}
              </div>
              <div className="px-6 pb-4 text-xs text-gray-500 border-t border-gray-700">
                ×¢×•×“×›×Ÿ ×œ××—×¨×•× ×”:{" "}
                {thread.lastActivity
                  ? new Date(thread.lastActivity).toLocaleString("he-IL")
                  : "â€”"}
              </div>
            </div>

            {/* ğŸŸ¦ ×¨×©×™××ª ×ª×’×•×‘×•×ª */}
            <div className="space-y-6">
              {comments.length === 0 ? (
                <p className="text-gray-400 text-center">××™×Ÿ ×ª×’×•×‘×•×ª ×¢×“×™×™×Ÿ.</p>
              ) : (
                comments.map((c, i) => (
                  <div
                    key={c.id}
                    className="flex flex-col md:flex-row border border-gray-700 bg-[#1a1a1a] rounded-lg shadow-md"
                  >
                    <div className="md:w-1/4 bg-[#151515] border-b md:border-b-0 md:border-l border-gray-700 text-center p-4">
                      <img
                        src="/default-avatar.png"
                        alt="avatar"
                        className="w-16 h-16 mx-auto rounded-full mb-2 border border-gray-700"
                      />
                      <p className="font-semibold text-gray-100">{c.author || "×× ×•× ×™××™"}</p>
                      <p className="text-xs text-gray-500 mt-1">
                        ×ª×’×•×‘×” #{i + 1}
                        <br />
                        {new Date(c.date).toLocaleString("he-IL")}
                      </p>
                      <button
                        onClick={() => setReplyTo(c.id)}
                        className="text-[#e60000] hover:text-[#ff3333] text-xs mt-3 underline"
                      >
                        ×”×©×‘
                      </button>
                    </div>

                    <div className="flex-1 p-4 text-gray-100">
                      {c.reply_to && (
                        <p className="text-xs text-gray-500 mb-1">
                          ×‘×ª×’×•×‘×” ×œ×”×•×“×¢×” #{c.reply_to}
                        </p>
                      )}
                      <p className="whitespace-pre-line leading-relaxed">{c.text}</p>
                    </div>
                  </div>
                ))
              )}
            </div>

            {/* ğŸŸ¢ ×˜×•×¤×¡ ×ª×’×•×‘×” */}
            {!thread.locked && (
              <form
                onSubmit={handleSubmit}
                className="mt-10 border border-gray-700 rounded-lg bg-[#1a1a1a] shadow-md p-6 text-gray-200"
              >
                {replyTo && (
                  <div className="text-sm text-gray-400 mb-3">
                    ××’×™×‘ ×œÖ¾×ª×’×•×‘×” #{replyTo}{" "}
                    <button
                      type="button"
                      onClick={() => setReplyTo(null)}
                      className="text-[#e60000] hover:text-[#ff3333]"
                    >
                      ×‘×™×˜×•×œ
                    </button>
                  </div>
                )}

                <h3 className="text-lg font-semibold text-white mb-4 text-right">
                  ×”×©××¨ ×ª×’×•×‘×”
                </h3>

                <label className="block mb-2 text-sm font-medium text-gray-400 text-right">
                  ×©×
                </label>
                <input
                  type="text"
                  value={newComment.author}
                  onChange={(e) =>
                    setNewComment({ ...newComment, author: e.target.value })
                  }
                  className="w-full bg-[#2a2a2a] border border-gray-600 rounded px-3 py-2 mb-4 text-gray-100 focus:outline-none focus:border-[#e60000]"
                  placeholder="×œ×“×•×’××”: ×¨×•×›×‘ ×-TMAX..."
                />

                <label className="block mb-2 text-sm font-medium text-gray-400 text-right">
                  ×ª×’×•×‘×”
                </label>
                <textarea
                  value={newComment.text}
                  onChange={(e) =>
                    setNewComment({ ...newComment, text: e.target.value })
                  }
                  className="w-full bg-[#2a2a2a] border border-gray-600 rounded px-3 py-2 h-32 mb-4 text-gray-100 resize-none focus:outline-none focus:border-[#e60000]"
                  placeholder="×›×ª×•×‘ ×›××Ÿ ××ª ×ª×’×•×‘×ª×š..."
                />

                <button
                  type="submit"
                  disabled={submitting}
                  className={`w-full px-6 py-2 rounded font-semibold text-white transition ${
                    submitting
                      ? "bg-gray-500 cursor-not-allowed"
                      : "bg-[#e60000] hover:bg-[#ff3333]"
                  }`}
                >
                  {submitting ? "×©×•×œ×—..." : "×¤×¨×¡× ×ª×’×•×‘×”"}
                </button>

                {statusMessage && (
                  <p
                    className={`mt-4 text-center font-medium ${
                      statusMessage.type === "success"
                        ? "text-green-500"
                        : "text-red-500"
                    }`}
                  >
                    {statusMessage.text}
                  </p>
                )}
              </form>
            )}

            {thread.locked && (
              <p className="text-center text-red-500 mt-6">
                ğŸ”’ ×”×“×™×•×Ÿ × ×¢×•×œ. ×œ× × ×™×ª×Ÿ ×œ×”×•×¡×™×£ ×ª×’×•×‘×•×ª.
              </p>
            )}
          </>
        )}
      </div>
    </PageContainer>
  );
}


///
// app/forum/[slug]/page.jsx
'use client';

import { useEffect, useState } from 'react';
import { useParams } from 'next/navigation';
import Link from 'next/link';
import PageContainer from '@/components/PageContainer';
import { fetchThreadsByCategorySlug, addThread } from '@/lib/forumApi';
import { getForumLabel } from '@/utils/labelMap';

export default function ForumCategoryPage() {
  const params = useParams();
  const slug = params?.slug ? decodeURIComponent(params.slug) : '';
  const [threads, setThreads] = useState([]);
  const [loading, setLoading] = useState(true);
  const [newThread, setNewThread] = useState({ title: '', content: '', author: '' });
  const [submitting, setSubmitting] = useState(false);
  const [statusMessage, setStatusMessage] = useState(null);

  // âœ… ×©× ×”×§×˜×’×•×¨×™×” ×‘×¢×‘×¨×™×ª ×œ×¤×™ ×”×¡×œ××’
  const categoryLabel = getForumLabel(slug);

  const loadThreads = async () => {
    try {
      const data = await fetchThreadsByCategorySlug(slug);
      setThreads(data);
    } catch (err) {
      console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ×“×™×•× ×™×:', err);
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    loadThreads();
  }, [slug]);

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!newThread.title.trim() || !newThread.content.trim()) {
      alert('× × ×œ××œ× ×›×•×ª×¨×ª ×•×ª×•×›×Ÿ');
      return;
    }

    setSubmitting(true);
    try {
      await addThread({
        title: newThread.title,
        content: newThread.content,
        author: newThread.author || '×× ×•× ×™××™',
        categorySlug: slug,
      });
      setNewThread({ title: '', content: '', author: '' });
      await loadThreads();
      setStatusMessage({ text: 'âœ… ×”×“×™×•×Ÿ × ×•×¡×£ ×‘×”×¦×œ×—×”!', type: 'success' });
      setTimeout(() => setStatusMessage(null), 2500);
    } catch (err) {
      setStatusMessage({ text: 'âŒ ×©×’×™××” ×‘×™×¦×™×¨×ª ×“×™×•×Ÿ', type: 'error' });
    } finally {
      setSubmitting(false);
    }
  };

  return (
    <PageContainer
      title={`${categoryLabel}`}
      breadcrumbs={[
        { label: '×“×£ ×”×‘×™×ª', href: '/' },
        { label: '×¤×•×¨×•×', href: '/forum' },
        { label: categoryLabel, href: `/forum/${slug}` },
      ]}
    >
      <div className="bg-[#111111] text-gray-200 min-h-screen py-8 px-2 sm:px-4">
        {loading ? (
          <p className="text-center text-gray-400">×˜×•×¢×Ÿ ×“×™×•× ×™×...</p>
        ) : threads.length === 0 ? (
          <p className="text-center text-gray-400">××™×Ÿ ×“×™×•× ×™× ×‘×§×˜×’×•×¨×™×” ×–×•.</p>
        ) : (
          <ul className="divide-y divide-gray-800 border border-gray-700 rounded-lg overflow-hidden bg-[#1a1a1a] shadow-md">
            {threads.map((t) => (
              <li
                key={t.id}
                className="hover:bg-[#2a0a0a] transition cursor-pointer group"
              >
                <Link href={`/forum/${slug}/${t.slug}`} className="block p-5">
                  <div className="flex flex-col sm:flex-row sm:justify-between sm:items-center">
                    <div className="flex items-center gap-2 mb-2 sm:mb-0">
                      {t.pinned && (
                        <span className="text-[#e60000] font-bold text-xs bg-[#300] px-2 py-1 rounded">
                          ğŸ“Œ × ×¢×•×¥
                        </span>
                      )}
                      {t.locked && (
                        <span className="text-[#ff3333] font-bold text-xs bg-[#400] px-2 py-1 rounded">
                          ğŸ”’ × ×¢×•×œ
                        </span>
                      )}
                      <h3 className="text-lg font-semibold text-white group-hover:text-[#e60000] transition">
                        {t.title}
                      </h3>
                    </div>
                    <div className="text-sm text-gray-400 text-left sm:text-right">
                      <p>
                        × ×›×ª×‘ ×¢×œ ×™×“×™{' '}
                        <span className="text-gray-300">{t.author}</span>
                      </p>
                      <p className="text-xs text-gray-500 mt-1">
                        ×¦×¤×™×•×ª: {t.views || 0} â€¢{' '}
                        {t.lastActivity
                          ? `×¢×“×›×•×Ÿ ××—×¨×•×Ÿ: ${new Date(
                              t.lastActivity
                            ).toLocaleDateString('he-IL')}`
                          : 'â€”'}
                      </p>
                    </div>
                  </div>

                  <p className="text-gray-400 text-sm mt-2 line-clamp-2 whitespace-pre-line">
                    {t.content.length > 300
                      ? t.content.slice(0, 300) + '...'
                      : t.content}
                  </p>
                </Link>
              </li>
            ))}
          </ul>
        )}

        {/* ğŸ”» ×˜×•×¤×¡ ×¤×ª×™×—×ª ×“×™×•×Ÿ ×—×“×© */}
        <form
          onSubmit={handleSubmit}
          className="mt-8 border border-gray-700 rounded-lg bg-[#1a1a1a] shadow-md p-6 text-gray-200"
        >
          <h3 className="text-xl font-semibold text-white mb-4 text-right border-b border-gray-700 pb-2">
            ×¤×ª×— ×“×™×•×Ÿ ×—×“×©
          </h3>

          <label className="block mb-2 text-sm font-medium text-gray-400 text-right">
            ×©×
          </label>
          <input
            type="text"
            value={newThread.author}
            onChange={(e) =>
              setNewThread({ ...newThread, author: e.target.value })
            }
            className="w-full bg-[#2a2a2a] border border-gray-600 rounded px-3 py-2 mb-4 text-gray-100 focus:outline-none focus:border-[#e60000]"
            placeholder="×œ×“×•×’××”: ×¨×•×›×‘ ×-TMAX..."
          />

          <label className="block mb-2 text-sm font-medium text-gray-400 text-right">
            ×›×•×ª×¨×ª
          </label>
          <input
            type="text"
            value={newThread.title}
            onChange={(e) =>
              setNewThread({ ...newThread, title: e.target.value })
            }
            className="w-full bg-[#2a2a2a] border border-gray-600 rounded px-3 py-2 mb-4 text-gray-100 focus:outline-none focus:border-[#e60000]"
            placeholder="×œ×“×•×’××”: ×‘×¢×™×” ×‘××¢×¨×›×ª ×‘×œ×™××” ×©×œ GSX..."
          />

          <label className="block mb-2 text-sm font-medium text-gray-400 text-right">
            ×ª×•×›×Ÿ
          </label>
          <textarea
            value={newThread.content}
            onChange={(e) =>
              setNewThread({ ...newThread, content: e.target.value })
            }
            className="w-full bg-[#2a2a2a] border border-gray-600 rounded px-3 py-2 h-32 mb-4 text-gray-100 resize-none focus:outline-none focus:border-[#e60000]"
            placeholder="×›×ª×•×‘ ×›××Ÿ ××ª ×ª×•×›×Ÿ ×”×“×™×•×Ÿ..."
          />

          <button
            type="submit"
            disabled={submitting}
            className={`w-full px-6 py-2 rounded font-semibold text-white transition ${
              submitting
                ? 'bg-gray-500 cursor-not-allowed'
                : 'bg-[#e60000] hover:bg-[#ff3333]'
            }`}
          >
            {submitting ? '×©×•×œ×—...' : '×¤×¨×¡× ×“×™×•×Ÿ'}
          </button>

          {statusMessage && (
            <p
              className={`mt-4 text-center font-medium ${
                statusMessage.type === 'success'
                  ? 'text-green-500'
                  : 'text-red-500'
              }`}
            >
              {statusMessage.text}
            </p>
          )}
        </form>
      </div>
    </PageContainer>
  );
}


////

// components/PageContainer.jsx
'use client';
import React from 'react';
import Breadcrumbs from './Breadcrumbs';
import SidebarMiddleLayer from './SidebarMiddleLayer';
import SidebarLeftLayer from './SidebarLeftLayer';
import useIsMobile from '@/hooks/useIsMobile';

export default function PageContainer({ title, breadcrumbs = [], children }) {
  const isMobile = useIsMobile();

  return (
    <div className="w-screen sm:w-full overflow-x-hidden sm:overflow-visible bg-[#f9f9f9]">
      <main
        dir="rtl"
        className="min-h-screen flex-1 mb-0 px-0 sm:px-0 pt-[1px] pb-[2px] text-right"
      >
        {/* ğŸ”´ ×‘×¨×“×§×¨××‘×¡ */}
        {breadcrumbs.length > 0 && (
          <div className="mb-1">
            <Breadcrumbs items={breadcrumbs} />
          </div>
        )}

        {/* ğŸ”¶ ×›×•×ª×¨×ª ×¨××©×™×ª */}
        {title && (
          <h1 className="text-2xl sm:text-3xl font-bold text-black mb-2 border-b-2 border-[#e60000] pb-1">
            {title}
          </h1>
        )}

        {/* ğŸ”µ ×©×œ×•×©×ª ×”×‘×œ×•×§×™× */}
        <div className="w-full flex flex-col lg:flex-row min-h-screen bg-gray-100">
          
          {/* âœ… ×ª×•×›×Ÿ ×¨××©×™ â€“ Sticky */}
          <div className="w-full lg:w-1/2 flex-shrink-0 px-0 py-0 lg:border-l border-[#e60000]">
            <div className="sticky top-[70px]"> 
              {children}
            </div>
          </div>

          {/* ×¡×™×™×“×¨ ×××¦×¢×™ */}
          <div
            className={`w-full lg:w-1/4 flex-shrink-0 px-0 py-0 ${
              !isMobile ? 'border-l border-[#e60000]' : ''
            }`}
          >
            <SidebarMiddleLayer />
          </div>

          {/* ×¡×™×™×“×¨ ×©×××œ×™ */}
          <div
            className={`w-full lg:w-1/4 flex-shrink-0 px-0 py-0 ${
              !isMobile ? 'border-r border-[#e60000]' : ''
            }`}
          >
            <SidebarLeftLayer />
          </div>
        </div>
      </main>
    </div>
  );
}
///
// app/articles/[slug]/page.jsx
export const dynamic = 'force-dynamic';

import PageContainer from "@/components/PageContainer";
import ArticleHeader from "@/components/ArticleHeader";
import SimpleKeyValueTable from "@/components/SimpleKeyValueTable";
import Tags from "@/components/Tags";
import SimilarArticles from "@/components/SimilarArticles";
import { notFound } from "next/navigation";
import CommentsSection from "@/components/CommentsSection";
import Gallery from "@/components/Gallery";
import { labelMap } from "@/utils/labelMap";
import InlineImage from "@/components/InlineImage";
import EmbedContent from "@/components/EmbedContent";
import ScrollToTableButton from "@/components/ScrollToTableButton";
import ScrollToGalleryButton from "@/components/ScrollToGalleryButton";




const API_URL = process.env.STRAPI_API_URL;
const PUBLIC_API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL || API_URL;
const SITE_URL = "https://www.onmotormedia.com";
const PLACEHOLDER_IMG = "/default-image.jpg";

// âœ… ××ª×§× ×ª × ×ª×™×‘×™ ×ª××•× ×•×ª ×™×—×¡×™×™× ×‘×ª×•×š HTML
function fixRelativeImages(html) {
Â  if (!html) return html;
Â  return html.replace(
Â  Â  /<img\s+[^>]*src=["'](?!https?:\/\/)([^"']+)["']/g,
Â  Â  (match, src) => {
Â  Â  Â  const fullSrc = src.startsWith("/")
Â  Â  Â  Â  ? `${PUBLIC_API_URL}${src}`
Â  Â  Â  Â  : `${PUBLIC_API_URL}/uploads/${src}`;
Â  Â  Â  return match.replace(src, fullSrc);
Â  Â  }
Â  );
}

// âœ… ×¤×•× ×§×¦×™×” ×¤×©×•×˜×” ×œ×ª×™×§×•×Ÿ ×§×™×©×•×¨×™ ××“×™×”
function resolveImageUrl(rawUrl) {
Â  if (!rawUrl) return PLACEHOLDER_IMG;
Â  if (rawUrl.startsWith("http")) return rawUrl;
Â  return `${PUBLIC_API_URL}${rawUrl.startsWith("/") ? rawUrl : `/uploads/${rawUrl}`}`;
}

// âœ… ×¤×•× ×§×¦×™×•×ª ×¢×–×¨ ×œ×§×™×©×•×¨×™× ×‘Ö¾Rich Text
function normalizeHref(href) {
Â  if (!href) return '#';
Â  if (/^https?:\/\//i.test(href) || href.startsWith('mailto:') || href.startsWith('tel:')) return href;
Â  return href.startsWith('/') ? href : `/${href}`;
}

function isExternal(href) {
Â  return /^https?:\/\//i.test(href);
}

function renderMarks(text, node) {
Â  let t = text ?? '';
Â  if (node?.bold) t = `<strong>${t}</strong>`;
Â  if (node?.italic) t = `<em>${t}</em>`;
Â  if (node?.underline) t = `<u>${t}</u>`;
Â  return t;
}

function toHtmlFromStrapiChildren(children) {
Â  if (!Array.isArray(children)) return '';
Â  return children.map((node) => {
Â  Â  // ×¦×•××ª ×§×™×©×•×¨
Â  Â  if (node?.type === 'link' || node?.url) {
Â  Â  Â  const href = normalizeHref(node.url || '#');
Â  Â  Â  const inner = node.children?.length
Â  Â  Â  Â  ? toHtmlFromStrapiChildren(node.children)
Â  Â  Â  Â  : renderMarks(node.text || '', node);
Â  Â  Â  const target = isExternal(href) ? '_blank' : '_self';
Â  Â  Â  const rel = isExternal(href) ? 'noopener noreferrer' : '';
Â  Â  Â  return `<a href="${href}" target="${target}" rel="${rel}" class="text-blue-600 underline hover:text-blue-800">${inner}</a>`;
Â  Â  }

Â  Â  // ×˜×§×¡×˜ ×¨×’×™×œ
Â  Â  if (typeof node?.text === 'string') {
Â  Â  Â  return renderMarks(node.text, node);
Â  Â  }

Â  Â  // ×× ×™×© ×™×œ×“×™× × ×•×¡×¤×™×
Â  Â  if (node?.children?.length) {
Â  Â  Â  return toHtmlFromStrapiChildren(node.children);
Â  Â  }

Â  Â  return '';
Â  }).join('');
}

export async function generateMetadata({ params }) {
Â  const API_URL = process.env.STRAPI_API_URL;
Â  const SITE_URL = "https://www.onmotormedia.com";

Â  try {
Â  Â  // ========= â¬‡ï¸ ×”×ª×™×§×•×Ÿ ×”×’×“×•×œ ×›××Ÿ â¬‡ï¸ =========
Â  Â  // ×× ×• ××©×ª××©×™× ×‘-populate=* ×‘×“×™×•×§ ×›××• ×‘×¤×•× ×§×¦×™×” ArticlePage
Â  Â  // ×›×“×™ ×œ×”×‘×˜×™×— ×©×× ×• ××§×‘×œ×™× ××ª ××•×ª×• ××‘× ×” × ×ª×•× ×™× "×©×˜×•×—"
Â  Â  const res = await fetch(
Â  Â  Â  `${API_URL}/api/articles?filters[slug][$eq]=${params.slug}&populate=*`,
Â  Â  Â  { cache: "no-store" }
Â  Â  );

Â  Â  if (!res.ok) {
Â  Â  Â  throw new Error(`API fetch failed with status ${res.status}`);
Â  Â  }

Â  Â  const json = await res.json();
Â  Â  
Â  Â  //  ========= â¬‡ï¸ ×”×ª×™×§×•×Ÿ ×”×©× ×™ â¬‡ï¸ =========
Â  Â  //  ×”×¡×¨× ×• ××ª .attributes ×›×“×™ ×œ×”×ª××™× ×œ××‘× ×” ×”"×©×˜×•×—"
Â  Â  const article = json.data?.[0]; 

Â  Â  if (!article) {
Â  Â  Â  return {}; // ×—×–×¨×” ×œ×‘×¨×™×¨×ª ××—×“×œ
Â  Â  }

Â  Â  const title = article.title || "OnMotor Media";
Â  Â  
Â  Â  // ========= â¬‡ï¸ ×”×œ×•×’×™×§×” ×©×‘×™×§×©×ª (×ª×™××•×¨) â¬‡ï¸ =========
Â  Â  const description =
Â  Â  Â  article.headline ||
Â  Â  Â  article.description ||
Â  Â  Â  article.subdescription ||
Â  Â  Â  "×›×ª×‘×” ××ª×•×š ××’×–×™×Ÿ OnMotor Media";

Â  Â  let imageUrl = "https://www.onmotormedia.com/full_Logo.jpg";
Â  Â  
Â  Â  // ========= â¬‡ï¸ ×”×œ×•×’×™×§×” ×©×‘×™×§×©×ª (×ª××•× ×”) â¬‡ï¸ =========
Â  Â  if (
Â  Â  Â  Array.isArray(article.external_media_links) &&
Â  Â  Â  article.external_media_links.length > 1 &&
Â  Â  Â  article.external_media_links[1]?.startsWith("http")
Â  Â  ) {
Â  Â  Â  imageUrl = article.external_media_links[1].trim();
Â  Â  } else if (article.image?.data?.attributes?.url) {
Â  Â  Â  // ×”×œ×•×’×™×§×” ×”××§×•×¨×™×ª ×©×œ×š ×œ-populate=* ×”× ×™×—×” ××‘× ×” ××§×•× ×Ÿ ×œ×ª××•× ×”
Â  Â  Â  imageUrl = `${API_URL}${article.image.data.attributes.url}`;
Â  Â  } else if (article.image?.url) {
Â  Â  Â  // ×œ××§×¨×” ×©×”×ª××•× ×” ×’× "×©×˜×•×—×”"
Â  Â  Â  imageUrl = resolveImageUrl(article.image.url);
Â  Â  }

Â  Â  return {
Â  Â  Â  title: `${title} | OnMotor Media`,
Â  Â  Â  description,
Â  Â  Â  alternates: { canonical: `${SITE_URL}/articles/${params.slug}` },
Â  Â  Â  openGraph: {
Â  Â  Â  Â  title,
Â  Â  Â  Â  description,
Â  Â  Â  Â  type: "article",
Â  Â  Â  Â  locale: "he_IL",
Â  Â  Â  Â  url: `${SITE_URL}/articles/${params.slug}`,
Â  Â  Â  Â  siteName: "OnMotor Media",
Â  Â  Â  Â  images: [
Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  url: imageUrl,
Â  Â  Â  Â  Â  Â  width: 1200,
Â  Â  Â  Â  Â  Â  height: 630,
Â  Â  Â  Â  Â  Â  alt: title,
Â  Â  Â  Â  Â  },
Â  Â  Â  Â  ],
Â  Â  Â  },
Â  Â  Â  twitter: {
Â  Â  Â  Â  card: "summary_large_image",
Â  Â  Â  Â  title,
Â  Â  Â  Â  description,
Â  Â  Â  Â  images: [imageUrl],
Â  Â  Â  },
Â  Â  };
Â  } catch (err) {
Â  Â  console.error("âš ï¸ Metadata generation error:", err);
Â  Â  return {}; // ×‘××§×¨×” ×©×œ ×©×’×™××”, ×—×–×•×¨ ×œ×‘×¨×™×¨×ª ×”××—×“×œ ××”-layout
Â  }
}
// ===================================================================
//      ×”×¤×•× ×§×¦×™×” ×”×¨××©×™×ª ×©×œ ×”×“×£ - ×—×–×¨×” ×œ×§×•×“ ×”××§×•×¨×™ ×©×œ×š
// ===================================================================

export default async function ArticlePage({ params }) {
Â  const res = await fetch(
Â  Â  `${API_URL}/api/articles?filters[slug][$eq]=${params.slug}&populate=*`,
Â  Â  { next: { revalidate: 0 } }
Â  );

Â  const json = await res.json();
Â  const rawArticle = json.data?.[0];
Â  if (!rawArticle) return notFound();

Â  const data = rawArticle; // <-- ×—×–×¨× ×• ×œ×§×•×“ ×”××§×•×¨×™ ×©×œ×š (×œ×œ× .attributes)

Â  // âœ… ×˜×™×¤×•×œ ×‘×’×œ×¨×™×” (×ª××•× ×•×ª ××§×•××™×•×ª)
Â  const galleryItems = data.gallery?.data
Â  Â  ? data.gallery.data.map((item) => item.attributes)
Â  Â  : data.gallery || [];

Â  // âœ… ×’×œ×¨×™×” ×¨×’×™×œ×”
Â  const gallery = galleryItems.map((img) => ({
Â  Â  src: resolveImageUrl(img.url),
Â  Â  alt: img.alternativeText || "×ª××•× ×” ××”×’×œ×¨×™×”",
Â  }));

Â  // âœ… ×§×¨×™××” ×œ×©×“×•×ª ×—×“×©×™×
Â  const externalImageUrls = Array.isArray(data.externalImageUrls)
Â  Â  ? data.externalImageUrls
Â  Â  : data.externalImageUrls
Â  Â  ? [data.externalImageUrls]
Â  Â  : [];

Â  const externalMediaUrl = data.externalMediaUrl || null;

Â  // âœ… ×ª××•× ×” ×¨××©×™×ª â€” ×›×•×œ×œ external_media_links
Â  let mainImage = PLACEHOLDER_IMG;
Â  let mainImageAlt = "×ª××•× ×” ×¨××©×™×ª";

  // ×—×–×¨×” ×œ×œ×•×’×™×§×ª ×”×ª××•× ×” ×”××§×•×¨×™×ª ×©×œ×š
Â  if (galleryItems?.length > 0 && galleryItems[0]?.url) {
Â  Â  mainImage = resolveImageUrl(galleryItems[0].url);
Â  Â  mainImageAlt = galleryItems[0].alternativeText || "×ª××•× ×” ×¨××©×™×ª";
Â  } else if (data.image?.data?.attributes?.url) { // ×”×ª×××” ×œ××‘× ×” ×©×œ populate=*
Â  Â  mainImage = resolveImageUrl(data.image.data.attributes.url);
Â  Â  mainImageAlt = data.image.data.attributes.alternativeText || "×ª××•× ×” ×¨××©×™×ª";
Â  } else if (
Â  Â  Array.isArray(data.external_media_links) &&
Â  Â  data.external_media_links.length > 1 &&
Â  Â  typeof data.external_media_links[1] === "string" &&
Â  Â  data.external_media_links[1].startsWith("http")
Â  ) {
Â  Â  mainImage = data.external_media_links[1].trim();
Â  Â  mainImageAlt = "×ª××•× ×” ×¨××©×™×ª ××”××“×™×” ×”×—×™×¦×•× ×™×ª";
Â  }

Â  const article = {
Â  Â  title: data.title || "×›×ª×‘×” ×œ×œ× ×›×•×ª×¨×ª",
Â  Â  description: data.description || "",
Â  Â  image: mainImage,
Â  Â  imageAlt: mainImageAlt,
Â  Â  author: data.author || "××¢×¨×›×ª OnMotor",
Â  Â  date: data.date || "2025-06-22",
Â  Â  time: data.time || "10:00",
Â  Â  tags: data.tags || [],
Â  Â  content: data.content || "",
Â  Â  tableData: data.tableData || {},
Â  Â  href: `/articles/${params.slug}`,
Â  Â  category: data.category || "general",
Â  Â  subcategory: Array.isArray(data.subcategory)
Â  Â  Â  ? data.subcategory[0]
Â  Â  Â  : data.subcategory,
Â  Â  values: Array.isArray(data.Values)
Â  Â  Â  ? data.Values
Â  Â  Â  : data.Values
Â  Â  Â  ? [data.Values]
Â  Â  Â  : [],
Â  Â  headline: data.headline || data.title,
Â  Â  subdescription: data.subdescription || "",
Â  Â  slug: params.slug,
Â  Â  gallery,
Â  Â  externalImageUrls,
Â  Â  externalMediaUrl,
Â  Â  external_media_links: data.external_media_links || [],
Â  	font_family: data.font_family || "Heebo, sans-serif",
Â  };

Â  // âœ… ×¤×™×¨×•×¨×™ ×œ×—×
Â  const breadcrumbs = [{ label: "×“×£ ×”×‘×™×ª", href: "/" }];
Â  if (article.category) {
Â  Â  breadcrumbs.push({
Â  Â  Â  label: labelMap[article.category] || article.category,
Â  Â  Â  href: `/${article.category}`,
Â  Â  });
Â  }
Â  if (article.subcategory) {
Â  Â  breadcrumbs.push({
Â  Â  Â  label: labelMap[article.subcategory] || article.subcategory,
Â  Â  Â  href: `/${article.category}/${article.subcategory}`,
Â  Â  });
Â  }
Â  if (article.values?.length > 0) {
Â  Â  const valueKey = article.values[0];
Â  Â  breadcrumbs.push({
Â  Â  Â  label: labelMap[valueKey] || valueKey,
Â  Â  Â  href: `/${article.category}/${article.subcategory}/${valueKey}`,
Â  Â  });
Â  }
Â  breadcrumbs.push({ label: article.title });

Â  // âœ… ×¨×™× ×“×•×¨ ×ª×•×›×Ÿ ×¢×™×§×¨×™ (×›×•×œ×œ ×§×™×©×•×¨×™×, ×ª××•× ×•×ª, Embed)
Â  const renderParagraph = (block, i) => {
Â  Â  // ×˜×§×¡×˜ ×¨×’×™×œ
Â  Â  if (typeof block === "string") {
Â  Â  Â  const cleanText = fixRelativeImages(block.trim());
Â  	Â  const hasHTMLTags = /<\/?[a-z][\s\S]*>/i.test(cleanText);

Â  	Â  if (hasHTMLTags) {
Â  	Â  Â  return (
Â  	Â  	Â  <div
Â  	Â  	Â  Â  key={i}
Â  	Â  	Â  Â  className="article-text text-gray-800 text-[18px] leading-relaxed"
Â  	Â  	Â  Â  dangerouslySetInnerHTML={{ __html: cleanText }}
Â  	Â  	Â  />
Â  	Â  Â  );
Â  	Â  }

Â  	Â  const urlMatch = cleanText.match(/https?:\/\/[^\s]+/);
Â  	Â  if (urlMatch) {
Â  	Â  Â  const url = urlMatch[0].trim();
Â  	Â  Â  if (/\.(jpg|jpeg|png|gif|webp)$/i.test(url)) {
Â  	Â  	Â  return <InlineImage key={i} src={url} alt="×ª××•× ×” ××ª×•×š ×”×›×ª×‘×”" caption="" />;
Â  	Â  Â  }
Â  	Â  Â  if (
Â  	Â  	Â  /(youtube\.com|youtu\.be|facebook\.com|instagram\.com|tiktok\.com|x\.com|twitter\.com)/i.test(
Â  	Â  	Â  Â  url
Â  	Â  	Â  )
Â  	Â  Â  ) {
Â  	Â  	Â  return <EmbedContent key={i} url={url} />;
Â  	Â  Â  }
Â  	Â  Â  return (
Â  	Â  	Â  <p key={i} className="article-text text-blue-600 underline">
Â  	Â  	Â  Â  <a href={url} target="_blank" rel="noopener noreferrer">{url}</a>
Â  	Â  	Â  </p>
Â  	Â  Â  );
Â  	Â  }

Â  	Â  return (
Â  	Â  Â  <p
Â  	Â  	Â  key={i}
Â  	Â  	Â  className="article-text text-gray-800 text-[18px] leading-relaxed"
Â  	Â  	Â  dangerouslySetInnerHTML={{ __html: cleanText.replace(/\n/g, "<br/>") }}
Â  	Â  Â  />
Â  	Â  );
Â  Â  }
    
Â  Â  // ×‘×œ×•×§ ××¡×•×’ ×¤×¡×§×” (Rich Text ×-Strapi)
Â  Â  if (block.type === "paragraph" && block.children) {
Â  Â  Â  let html = toHtmlFromStrapiChildren(block.children);
Â  Â  Â  html = fixRelativeImages(html);

Â  	Â  const urlMatch = html.match(/https?:\/\/[^\s"']+/);
Â  	Â  if (urlMatch) {
Â  	Â  Â  const url = urlMatch[0];
Â  	Â  Â  if (/\.(jpg|jpeg|png|gif|webp)$/i.test(url)) {
Â  	Â  	Â  return <InlineImage key={i} src={url} alt="×ª××•× ×”" caption="" />;
Â  	Â  Â  }
Â  	Â  Â  if (
Â  	Â  	Â  /(youtube\.com|youtu\.be|facebook\.com|instagram\.com|tiktok\.com|x\.com|twitter\.com)/i.test(
Â  	Â  	Â  Â  url
Â  	Â  	Â  )
Â  	Â  Â  ) {
Â  	Â  	Â  return <EmbedContent key={i} url={url} />;
Â  	Â  Â  }
Â  	Â  }

Â  	Â  return (
Â  	Â  Â  <p
Â  	Â  	Â  key={i}
Â  	Â  	Â  className="article-text text-gray-800 text-[18px] leading-relaxed"
Â  	Â  	Â  dangerouslySetInnerHTML={{ __html: html }}
Â  	Â  Â  />
Â  	Â  );
Â  Â  }

Â  Â  // ×›×•×ª×¨×•×ª
Â  Â  if (block.type === "heading") {
Â  Â  Â  const level = block.level || 2;
Â  Â  Â  const Tag = `h${Math.min(level, 3)}`;
Â  	Â  const text = block.children?.map((c) => c.text).join("") || "";
Â  	Â  return (
Â  	Â  Â  <Tag
Â  	Â  	Â  key={i}
Â  	Â  	Â  className="font-bold text-2xl text-gray-900 mt-4 mb-2"
Â  	Â  	Â  dangerouslySetInnerHTML={{ __html: fixRelativeImages(text) }}
Â  	Â  	Â  />
Â  	Â  );
Â  Â  }

Â  Â  // ×ª××•× ×” ××ª×•×š ×‘×œ×•×§ Strapi
Â  Â  if (block.type === "image") {
Â  Â  Â  const imageData =
Â  Â  Â  Â  block.image?.data?.attributes || block.image?.attributes || block.image;
Â  Â  Â  if (!imageData?.url) return null;
Â  Â  Â  const alt = imageData.alternativeText || "×ª××•× ×” ××ª×•×š ×”×›×ª×‘×”";
Â  Â  Â  const caption = imageData.caption || "";
Â  	Â  return (
Â  	Â  Â  <InlineImage
Â  	Â  	Â  key={i}
Â  	Â  	Â  src={
Â  	Â  	Â  Â  imageData.url.startsWith("http")
Â  	Â  	Â  Â  Â  ? imageData.url
Â  	Â  	Â  Â  Â  : `${PUBLIC_API_URL}${imageData.url}`
Â  	Â  	Â  }
Â  	Â  	Â  alt={alt}
Â  	Â  	Â  caption={caption}
Â  	Â  Â  />
Â  	Â  );
Â  Â  }

Â  Â  return null;
Â  };

Â  const paragraphs = Array.isArray(article.content)
Â  Â  ? article.content
Â  Â  : article.content.split("\n\n");

Â  return (
    <>
Â  Â  <PageContainer title={article.title} breadcrumbs={breadcrumbs}>
Â  Â  Â  <div
Â  Â  Â  Â  className="mx-auto max-w-[740px] space-y-2 text-right leading-relaxed text-base text-gray-800 px-2"
Â  	Â  Â  style={{ fontFamily: article.font_family }}
Â  Â  Â  >
Â  	Â  Â  <ArticleHeader
Â  	Â  	Â  author={article.author}
Â  	Â  	Â  date={article.date}
Â  	Â  	Â  time={article.time}
Â  	Â  	Â  image={article.image}
Â  	Â  	Â  imageAlt={article.imageAlt}
Â  	Â  	Â  title={article.headline}
Â  	Â  	Â  subdescription={article.subdescription}
Â  	Â  	Â  tags={article.tags}
Â  	Â  Â  />

Â  	Â  Â  {article.description && (
Â  	Â  Â  Â  <p className="font-bold text-2xl text-gray-600">{article.description}</p>
Â  	Â  Â  )}
        {article.subdescription && (
          <p className="second-description text-gray-700 text-[18px]">{article.subdescription}</p>
        )}
Â  	Â  Â  {paragraphs.map(renderParagraph)}

Â  	Â  Â  {article.tableData && (
          <div className="article-table-section">
            <SimpleKeyValueTable data={article.tableData} />
          </div>
        )}

Â  	Â  Â  <div className="article-gallery-section">
          <Gallery
            images={article.gallery}
            externalImageUrls={article.externalImageUrls}
            externalMediaUrl={article.externalMediaUrl}
            external_media_links={article.external_media_links}
          />
        </div>


Â  	Â  Â  <Tags tags={article.tags} />
Â  	Â  Â  <SimilarArticles currentSlug={article.slug} category={article.category} />
Â  	Â  Â  <CommentsSection articleUrl={`${SITE_URL}${article.href}`} />
Â  	Â  </div>
Â  Â  </PageContainer>
Â  Â  <ScrollToTableButton />
Â  Â  <ScrollToGalleryButton />
    </>
Â  );
}

///
"https://cdn2.yamaha-motor.eu/prod/product-assets/2026/XS850GP/2026-Yamaha-XS850GP-EU-Legend_Yellow-Action-011-03.jpg",
  "https://cdn2.yamaha-motor.eu/prod/product-assets/2026/XS850GP/2026-Yamaha-XS850GP-EU-Legend_Yellow-Static-005-03.jpg",
  "https://cdn2.yamaha-motor.eu/prod/product-assets/2026/XS850GP/2026-Yamaha-XS850GP-EU-Legend_Yellow-Static-004-03.jpg",
  "https://cdn2.yamaha-motor.eu/prod/product-assets/2026/XS850GP/2026-Yamaha-XS850GP-EU-Legend_Yellow-Action-004-03.jpg",
  "https://cdn2.yamaha-motor.eu/prod/product-assets/2026/XS850GP/2026-Yamaha-XS850GP-EU-Legend_Yellow-360-Degrees-001-03.jpg",
  "https://cdn2.yamaha-motor.eu/prod/product-assets/2026/XS850GP/2026-Yamaha-XS850GP-EU-NA-Detail-010-03.jpg",
  "https://cdn2.yamaha-motor.eu/prod/product-assets/2026/XS850GP/2026-Yamaha-XS850GP-EU-Legend_Yellow-Static-008-03.jpg",
  "https://cdn2.yamaha-motor.eu/prod/product-assets/2026/XS850GP/2026-Yamaha-XS850GP-EU-Legend_Yellow-Action-005-03.jpg",

////

//components\TabLeftSidebar.jsx
'use client';
import React, { useState, useEffect, useRef } from 'react';
import Image from 'next/image';
import useIsMobile from '@/hooks/useIsMobile';


const tabs = ['××—×¨×•× ×™×', '×‘×“×¨×›×™×', '×¤×•×¤×•×œ×¨×™'];
const API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL;


// ğŸ‘‡ ×¤×•× ×§×¦×™×” ×©××•×¦×™××” ×©× ××ª×¨ × ×§×™ ××ª×•×š ×›×ª×•×‘×ª
function extractDomainName(url) {
  try {
    const host = new URL(url).hostname.replace('www.', '');
    const parts = host.split('.');

    let base = '';
    if (parts.length >= 3 && ['co', 'org', 'net'].includes(parts[parts.length - 2])) {
      base = parts[parts.length - 3]; // ×œ×“×•×’××”: ynet.co.il â†’ ynet
    } else {
      base = parts[0]; // ×œ×“×•×’××”: example.com â†’ example
    }

    // ××•×ª ×¨××©×•× ×” ×’×“×•×œ×”
    return base.charAt(0).toUpperCase() + base.slice(1);
  } catch {
    return 'Website';
  }
}

export default function TabLeftSidebar() {
  const isMobile = useIsMobile();
  const [hasInteracted, setHasInteracted] = useState(false);
  const scrollContainerRef = useRef(null);
  const sidebarRef = useRef(null);

  const [activeTab, setActiveTab] = useState('××—×¨×•× ×™×');
  const [latestArticles, setLatestArticles] = useState([]);
  const [onRoadArticles, setOnRoadArticles] = useState([]);
  const [viralContent, setViralContent] = useState([]);
  const [popularContent, setPopularContent] = useState([]);
  const [victims, setVictims] = useState([]);
  const [isPaused, setIsPaused] = useState(false);

  // ×¤×•× ×§×¦×™×” ×œ×¢×™×‘×•×“ ××•×‘×™×™×§×˜ ×›×ª×‘×”/×¤×¨×™×˜ ××›×œ ×¡×•×’
  const normalizeItem = (obj, type = 'article') => {
    const a = obj.attributes || obj;

    // ğŸ‘‡ ×§×‘×™×¢×ª ××§×•×¨ ×œ×¤×™ ×”-URL
    let autoSource = '';
    if (a.url) {
      if (a.url.includes('youtube.com') || a.url.includes('youtu.be')) {
        autoSource = 'YouTube';
      } else if (a.url.includes('tiktok.com')) {
        autoSource = 'TikTok';
      } else if (a.url.includes(process.env.NEXT_PUBLIC_SHOPIFY_STORE_DOMAIN)) {
        autoSource = 'Shopify';
      } else if (a.url.includes('instagram.com')) {
        autoSource = 'Instagram';
      } else if (a.url.includes('facebook.com')) {
        autoSource = 'Facebook';
      } else {
        autoSource = extractDomainName(a.url);
      }
    }

    // --- â­ï¸ ×œ×•×’×™×§×ª ×ª××•× ×•×ª â­ï¸ ---
    let img = null;
    const gallery = a.gallery; // ××’×™×¢ ×-populate=*

    if (type === 'latest-article') {
      // "××—×¨×•× ×™×": × ×¡×” ×ª××•× ×” ×©× ×™×™×” (index 1), ×× ××™×Ÿ, ×—×–×•×¨ ×œ×¨××©×•× ×” (index 0)
      const imgData = gallery?.[1] || gallery?.[0];
      if (imgData?.url) {
        img = `${API_URL}${imgData.url}`;
      }
    } else if (type === 'onroad-article') {
      // "×‘×“×¨×›×™×": × ×¡×” ×ª××•× ×” ×©×œ×™×©×™×ª (index 2), ×× ××™×Ÿ, ×—×–×•×¨ ×œ×¨××©×•× ×” (index 0)
      const imgData = gallery?.[2] || gallery?.[0];
      if (imgData?.url) {
        img = `${API_URL}${imgData.url}`;
      }
    } else {
      // "×¤×•×¤×•×œ×¨×™" ×•×›×œ ×”×©××¨: ×”×©××¨ ××ª ×”×œ×•×’×™×§×” ×”××§×•×¨×™×ª (××©×™×›×” ××©×“×” image)
      if (a.image?.data?.attributes?.url) {
        img = `${API_URL}${a.image.data.attributes.url}`;
      } else if (a.image?.url) {
        img = `${API_URL}${a.image.url}`;
      }
    }

    // ×¤×•×œ×‘××§ ×›×œ×œ×™ ×× ×©×•× ×œ×•×’×™×§×” ×œ× ××¦××” ×ª××•× ×” (×¨×œ×•×•× ×˜×™ ×‘×¢×™×§×¨ ×œ×›×ª×‘×•×ª)
    if (!img && gallery?.[0]?.url) {
      img = `${API_URL}${gallery[0].url}`;
    }
    
    if (img && img.trim() === '') {
      img = null;
    }
    // --- â­ï¸ ×¡×•×£ ×”×œ×•×’×™×§×” â­ï¸ ---

    return {
      id: obj.id,
      title: a.title || a.name || '',
      slug: a.slug || '',
      description: a.description || '',
      image: img, // â­ï¸ ×”×ª××•× ×” ××¡×˜×¨××¤×™ (×× ×§×™×™××ª)
      date: a.date?.split('T')[0] || a.publishedAt?.split('T')[0] || '',
      url: a.url || '',
      views: a.views ?? null,
      source: a.source || autoSource,
    };
  };

  useEffect(() => {
    const fetchLatest = async () => {
      try {
        const res = await fetch(`${API_URL}/api/articles?sort=date:desc&populate=*`);
        const data = (await res.json()).data || [];
        setLatestArticles(data.map((a) => normalizeItem(a, 'latest-article')));
      } catch (err) {
        console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ××—×¨×•× ×™×:', err);
      }
    };

    const fetchOnRoad = async () => {
      try {
        const res = await fetch(
         `${API_URL}/api/articles?filters[tags_txt][$contains]=iroads&sort=date:desc&populate=*`
        );
        const data = (await res.json()).data || [];
        setOnRoadArticles(data.map((a) => normalizeItem(a, 'onroad-article')));
      } catch (err) {
        console.error("×©×’×™××” ×‘×˜×¢×™× ×ª '×‘×“×¨×›×™×':", err);
      }
    };

    const fetchViral = async () => {
      try {
        const res = await fetch(`${API_URL}/api/viral-contents?sort=views:desc&populate=*`);
        const data = (await res.json()).data || [];
        setViralContent(data.map((v) => normalizeItem(v, 'viral')));
      } catch (err) {
        console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ×•×™×¨××œ×™:', err);
      }
    };

    const fetchPopular = async () => {
      try {
        const res = await fetch(`${API_URL}/api/populars?sort=date:desc&populate=*`);
        const data = (await res.json()).data || [];

        const withPreview = await Promise.all(
          data.map(async (item) => {
            const norm = normalizeItem(item, 'popular'); 

            // --- â­ï¸ ×ª×™×§×•×Ÿ: "×¨×§ ×× ××™×Ÿ ×ª××•× ×” ××¡×˜×¨××¤×™, × ×¡×” ×œ××©×•×š ×-preview" â­ï¸ ---
            // ×”×—×–×¨× ×• ××ª ×”×ª× ××™ ×œ×§×“××•×ª×•
            if (!norm.image && norm.url) {
              try {
                const previewRes = await fetch(
                  `/api/preview?url=${encodeURIComponent(norm.url)}`
                );
                const previewJson = await previewRes.json();
                
                if (previewJson?.image) {
                  norm.image = previewJson.image;
                }
              } catch (err) {
                console.error('Preview fetch error:', err);
              }
            }
            // --- â­ï¸ ×¡×•×£ ×”×ª×™×§×•×Ÿ â­ï¸ ---

            // âœ… fallback ×¡×•×¤×™
            if (!norm.image) {
              norm.image = '/default-image.jpg';
            }

            return norm;
          })
        );

        setPopularContent(withPreview);
      } catch (err) {
        console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ×¤×•×¤×•×œ×¨×™:', err);
      }
    };

    const fetchVictims = async () => {
      try {
        const res = await fetch(`${API_URL}/api/victims?sort=date:desc&populate=*`);
        const data = (await res.json()).data || [];
        setVictims(data.map((v) => normalizeItem(v, 'victim')));
      } catch (err) {
        console.error('×©×’×™××” ×‘×˜×¢×™× ×ª × ×¤×’×¢×™×:', err);
      }
    };

    fetchLatest();
    fetchOnRoad();
    fetchViral();
    fetchPopular();
    fetchVictims();
  }, []);

  useEffect(() => {
    if (isMobile) return;
    const container = scrollContainerRef.current;
    if (!container) return;

    const speed = 1;
    let frame;

    const step = () => {
      if (!isPaused) {
        container.scrollTop += speed;
        if (container.scrollTop >= container.scrollHeight - container.clientHeight) {
          container.scrollTop = 0;
        }
      }
      frame = requestAnimationFrame(step);
    };
    frame = requestAnimationFrame(step);
    return () => cancelAnimationFrame(frame);
  }, [activeTab, isPaused, isMobile]);

  useEffect(() => {
    if (!isMobile || !sidebarRef.current || !hasInteracted) return;
    setTimeout(() => {
    const y = sidebarRef.current.getBoundingClientRect().top + window.scrollY - 100; // ğŸ”´ ×›××Ÿ 100px ×–×” ×”×”×¤×¨×©
    window.scrollTo({ top: y, behavior: 'smooth' });
  }, 0);
}, [activeTab, isMobile, hasInteracted]);

  const getStyledContent = (items) => {
    return items.map((item, i) => {
      const even = i % 2 === 0;
      const bg = even ? 'bg-red-50 text-black' : 'bg-neutral-900 text-white';
      return (
        <a
          key={item.id}
          href={item.url || (item.slug ? `/articles/${item.slug}` : '#')}
          target={item.url ? '_blank' : '_self'}
          rel={item.url ? 'noopener noreferrer' : ''}
          className={`flex gap-2 items-start p-1 rounded transition-transform duration-200 ${bg} hover:scale-[1.03] hover:shadow-sm`}
        >
          <div className="w-20 h-14 relative rounded overflow-hidden flex-shrink-0">
            <Image
              src={item.image || '/default-image.jpg'}
              alt={item.title}
              fill
              style={{ objectFit: 'cover' }}
              className="rounded"
            />
          </div>
          <div className="flex flex-col text-right">
            <p className="font-bold text-sm line-clamp-1">{item.title}</p>
            <p
              className={`text-xs ${even ? 'text-gray-700' : 'text-gray-300'} line-clamp-2`}
            >
              {item.description}
            </p>
            {item.date && (
              <span
                className={`text-xs ${even ? 'text-gray-500' : 'text-gray-400'} mt-1`}
              >
                {item.date}
              </span>
            )}
            {(item.views || item.source) && (
              <span className="text-xs text-gray-400 mt-1">
                {item.views ? `${item.views} ×¦×¤×™×•×ª` : ''}
                {item.views && item.source ? ' Â· ' : ''}
                {item.source || ''}
              </span>
            )}
          </div>
        </a>
      );
    });
  };
  

  let content = [];
  if (activeTab === '××—×¨×•× ×™×') {
    content = getStyledContent(latestArticles);
  } else if (activeTab === '×‘×“×¨×›×™×') {
    content = getStyledContent(onRoadArticles);
  } else if (activeTab === '×¤×•×¤×•×œ×¨×™') {
    content = getStyledContent(popularContent);
  } else {
    content = getStyledContent(viralContent);
  }

  return (
    <div
      ref={sidebarRef}
      className={`flex flex-col min-h-0 bg-white shadow-md w-full text-sm ${
        isMobile ? 'w-screen rounded-none' : ''
      }`}
    >
      <div
        className="flex border-b text-sm font-semibold bg-white sticky top-0 z-10 shadow-sm"
        dir="rtl"
      >
        {tabs.map((tab) => (
          <button
            key={tab}
            onClick={() => {
              setActiveTab(tab);
              setHasInteracted(true);
            }}
            className={`w-1/3 text-center py-2 ${
              activeTab === tab
                ? 'text-black border-b-2 border-red-500 bg-white'
                : 'text-gray-500 bg-gray-100'
            }`}
          >
            {tab}
          </button>
        ))}
      </div>
      <div
        ref={scrollContainerRef}
        onMouseEnter={() => setIsPaused(true)}
        onMouseLeave={() => setIsPaused(false)}
        className="custom-scrollbar overflow-x-hidden p-1 space-y-1 flex-1 overflow-y-auto max-h-[380px]"
        dir="rtl"
      >
        {content}
      </div>
        
      
    </div>
  );
}
///
//components\CategoryPage.jsx
'use client';
import React, { useEffect, useState } from 'react';
import SectionWithHeader from './SectionWithHeader';
import LimitedArticles from './LimitedArticles';
import { labelMap } from '@/utils/labelMap';

const API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL;

// ×§×™×‘×•×¥ ×œ×¤×™ ×ª×ª ×§×˜×’×•×¨×™×•×ª ×¨×’×™×œ×•×ª
function groupBySubcategory(articles) {
  return articles.reduce((acc, article) => {
    const subcategories = Array.isArray(article.subcategory)
      ? article.subcategory
      : [article.subcategory];

    subcategories.forEach((subcat) => {
      if (!acc[subcat]) acc[subcat] = [];
      acc[subcat].push(article);
    });

    return acc;
  }, {});
}

// ×§×™×‘×•×¥ ×œ×¤×™ Values (×œ×ª×ª×™Ö¾×ª×ª×™ ×§×˜×’×•×¨×™×•×ª ×©×œ ××“×¨×™×›×™×)
function groupByValues(articles) {
  return articles.reduce((acc, article) => {
    const values = Array.isArray(article.Values)
      ? article.Values
      : [article.Values];

    values.forEach((val) => {
      if (!acc[val]) acc[val] = [];
      acc[val].push(article);
    });

    return acc;
  }, {});
}

export default function CategoryPage({ categoryKey = ' ', subcategoryKey = null, guideSubKey = null }) {
  const [articles, setArticles] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    async function fetchArticles() {
      try {
        let url = `${API_URL}/api/articles?populate=*`;

        // âœ… ×¡×™× ×•×Ÿ ×œ×¤×™ ×§×˜×’×•×¨×™×” ×¨××©×™×ª
        if (categoryKey) {
          url += `&filters[category][$eq]=${categoryKey}`;
        }

        const res = await fetch(url);
        const json = await res.json();
        let data = json.data || [];

        // âœ… ×¡×™× ×•×Ÿ ×‘×¦×“ ×”×œ×§×•×— ×œ×¤×™ ×ª×ªÖ¾×§×˜×’×•×¨×™×” (×‘×’×œ×œ ××’×‘×œ×ª SQLite)
        if (subcategoryKey) {
          data = data.filter((a) => {
            const sub = a.subcategory;
            if (!sub) return false;
            if (Array.isArray(sub)) return sub.includes(subcategoryKey);
            if (typeof sub === 'string') return sub.includes(subcategoryKey);
            return false;
          });
        }

        // âœ… ×¡×™× ×•×Ÿ ×œ×¤×™ ×ª×ªÖ¾×ª×ª ×§×˜×’×•×¨×™×” (Values)
        if (guideSubKey) {
          data = data.filter((a) => {
            const vals = a.Values;
            if (!vals) return false;
            if (Array.isArray(vals)) return vals.includes(guideSubKey);
            if (typeof vals === 'string') return vals.includes(guideSubKey);
            return false;
          });
        }

        const mapped = data.map((a) => ({
          id: a.id,
          title: a.title,
          slug: a.slug,
          image: a.image?.url ? `${API_URL}${a.image.url}` : '/default-image.jpg',
          imageAlt: a.imageAlt || '',
          category: a.category || 'general',
          subcategory: Array.isArray(a.subcategory)
            ? a.subcategory
            : [a.subcategory ?? 'general'],
          Values: Array.isArray(a.Values)
            ? a.Values
            : [a.Values ?? null],
          description: a.description,
          headline: a.headline || a.title,
          subdescription: a.subdescription,
          href: `/articles/${a.slug}`,
          tags: a.tags || [],
          date: a.date || '',
          time: a.time || '00:00',
        }));
        // âœ… ××™×•×Ÿ ×œ×¤×™ ×ª××¨×™×š + ×©×¢×” + ×“×§×” (××”×—×“×© ×œ×™×©×Ÿ)
        const sorted = mapped.sort((a, b) => {
          const aDateTime = new Date(`${a.date}T${a.time}`);
          const bDateTime = new Date(`${b.date}T${b.time}`);
          return bDateTime - aDateTime;
        });

        setArticles(sorted);

        
      } catch (err) {
        console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ×›×ª×‘×•×ª:', err);
      } finally {
        setLoading(false);
      }
    }

    fetchArticles();
  }, [categoryKey, subcategoryKey, guideSubKey]);

  if (loading) {
    return <p className="text-center text-gray-500">×˜×•×¢×Ÿ ×›×ª×‘×•×ª...</p>;
  }

  if (articles.length === 0) {
    return <p className="text-center text-gray-500">××™×Ÿ ×¢×“×™×™×Ÿ ×›×ª×‘×•×ª ×‘×§×˜×’×•×¨×™×” ×–×•</p>;
  }

  // âœ… ×œ×•×’×™×§×ª ×§×™×‘×•×¥
  const grouped =
    guideSubKey
      ? { [guideSubKey]: articles }
      : subcategoryKey === 'guides'
        ? groupByValues(articles)
        : subcategoryKey
          ? { [subcategoryKey]: articles }
          : groupBySubcategory(articles);

  const hebTitle = guideSubKey
    ? `${labelMap['guides']} - ${labelMap[guideSubKey] || guideSubKey}`
    : subcategoryKey
      ? labelMap[subcategoryKey] || subcategoryKey
      : labelMap[categoryKey] || categoryKey;

  const shouldShowMainTitle =
    subcategoryKey !== null || guideSubKey !== null || Object.keys(grouped).length === 1;

  return (
    <div className="max-w-screen-xl mx-auto px-0">
      <div className="flex flex-col gap-0" dir="rtl">
        {!subcategoryKey && !guideSubKey && shouldShowMainTitle && (
          <SectionWithHeader
            title={hebTitle}
            href={`/${categoryKey}`}
            variant="main"
          />
        )}

        {Object.entries(grouped).map(([subKey, subArticles]) => (
          <div key={subKey} className="bg-white shadow">
            {!guideSubKey && Object.keys(grouped).length > 1 && (
              <SectionWithHeader
                title={labelMap[subKey] || subKey}
                href={
                  subcategoryKey === 'guides'
                    ? `/${categoryKey}/${subcategoryKey}/${subKey}`
                    : `/${categoryKey}/${subKey}`
                }
                variant="category"
              />
            )}

            <LimitedArticles articles={subArticles} initialCount={2} />
          </div>
        ))}
      </div>
    </div>
  );
}
///
//components\SearchBar.jsx
'use client';
import React, { useState, useEffect, useId } from "react";
import { useRouter } from 'next/navigation';
import Fuse from 'fuse.js';
import Image from 'next/image';
import { IoClose } from "react-icons/io5";
import generateSearchSuggestions from "@/lib/generateSearchSuggestions";



export default function SearchBar({ onSelect = () => {} }) {
  const router = useRouter();
  const [query, setQuery] = useState('');
  const [filtered, setFiltered] = useState([]);
  const [isFocused, setIsFocused] = useState(false);
  const [isHovered, setIsHovered] = useState(false);
  const [activeIndex, setActiveIndex] = useState(-1);
  const [suggestions, setSuggestions] = useState([]);

  // ğŸ†” useId ××‘×˜×™×— ××–×”×” ×™×™×—×•×“×™ ×œ×›×œ ××•×¤×¢ ×¨×›×™×‘
  const inputId = useId();

  useEffect(() => {
    async function fetchSuggestions() {
      const data = await generateSearchSuggestions();
      setSuggestions(data);
    }
    fetchSuggestions();
  }, []);

  const fuse = new Fuse(suggestions, {
    keys: ['title'],
    threshold: 0.3,
    includeMatches: true,
    minMatchCharLength: 1,
    ignoreLocation: true,
    useExtendedSearch: true,
  });

  const isPopular = !query.trim();
  const showResults = (isFocused || isHovered) && (isPopular ? popularSuggestions : filtered);

  const handleChange = (e) => {
    const value = e.target.value;
    setQuery(value);
    setActiveIndex(-1);

    if (!value.trim()) {
      setFiltered([]);
      return;
    }

    const results = fuse.search(value.trim());
    setFiltered(results.map(result => ({
      ...result.item,
      matches: result.matches
    })));
  };

  const handleSelect = (path) => {
    router.push(path);
    onSelect();
    closeSearch();
  };

  const closeSearch = () => {
    setQuery('');
    setFiltered([]);
    setIsFocused(false);
    setIsHovered(false);
    setActiveIndex(-1);
  };

  const highlightMatch = (text, matches) => {
    const match = matches?.find(m => m.key === 'title');
    if (!match || !match.indices.length) return text;

    const parts = [];
    let lastIndex = 0;
    match.indices.forEach(([start, end], i) => {
      parts.push(text.slice(lastIndex, start));
      parts.push(<mark key={i} className="bg-yellow-300 px-0.5">{text.slice(start, end + 1)}</mark>);
      lastIndex = end + 1;
    });
    parts.push(text.slice(lastIndex));
    return parts;
  };

  return (
    <div
      className="relative lg:w-72 text-right"
      onMouseEnter={() => setIsHovered(true)}
      onMouseLeave={() => setTimeout(() => setIsHovered(false), 150)}
    >
      <form
        autoComplete="off"
        onSubmit={(e) => e.preventDefault()}
        className="relative w-full"
      >
        {/* âœ… label ××©×•×™×š ×œ×©×“×” ×œ×¤×™ id ×™×™×—×•×“×™ */}
        <label htmlFor={inputId} className="sr-only">
          ×—×™×¤×•×© ×‘××ª×¨ OnMotor Media
        </label>

        <input
          dir="rtl"
          id={inputId}
          name={`search-input-${inputId}`}
          type="text"
          autoComplete="new-password"
          autoCorrect="off"
          spellCheck="false"
          value={query}
          onChange={handleChange}
          onFocus={() => setIsFocused(true)}
          onKeyDown={(e) => {
            if (!showResults.length) return;
            if (e.key === 'ArrowDown') {
              e.preventDefault();
              setActiveIndex((prev) => (prev + 1) % showResults.length);
            } else if (e.key === 'ArrowUp') {
              e.preventDefault();
              setActiveIndex((prev) => (prev - 1 + showResults.length) % showResults.length);
            } else if (e.key === 'Enter') {
              e.preventDefault();
              const selected = showResults[activeIndex];
              if (selected) handleSelect(selected.path);
            } else if (e.key === 'Escape') {
              e.preventDefault();
              closeSearch();
            }
          }}
          placeholder="×—×¤×© ×‘××ª×¨..."
          className="text-right text-white placeholder-white p-1 pr-1 rounded border border-red-600 w-full transition-all duration-300"
        />

        {(query.trim() || showResults.length > 0) && (
          <button
            type="button"
            onClick={closeSearch}
            className="absolute left-2 top-1/2 -translate-y-1/2 text-white hover:text-red-600 text-xl"
            aria-label="× ×§×” ×•×¡×’×•×¨ ×—×™×¤×•×©"
          >
            <IoClose />
          </button>
        )}
      </form>

      {showResults.length > 0 && (
        <ul
          dir="rtl"
          className="absolute top-full mt-0 right-0 bg-white border border-gray-300 rounded shadow-lg z-50 w-full text-sm text-black max-h-60 overflow-y-auto"
        >
          {isPopular && (
            <div className="flex justify-end p-2 border-b border-gray-200">
              <button
                type="button"
                onClick={closeSearch}
                className="text-white hover:text-red-600 transition text-xl"
                aria-label="×¡×’×•×¨ ×”×¦×¢×•×ª ×¤×•×¤×•×œ×¨×™×•×ª"
              >
                <IoClose />
              </button>
            </div>
          )}

          {showResults.map((item, idx) => (
            <li
              key={idx}
              onClick={() => handleSelect(item.path)}
              className={`flex items-center gap-2 cursor-pointer px-3 py-2
                ${idx === activeIndex ? 'bg-gray-200 font-bold' : 'hover:bg-gray-100'}`}
            >
              {item.image && (
                <div className="relative w-10 h-10 flex-shrink-0 rounded overflow-hidden">
                  <Image src={item.image} alt={item.title} fill className="object-cover" />
                </div>
              )}
              <span className="flex-1 overflow-hidden text-ellipsis whitespace-nowrap">
                {highlightMatch(item.title, item.matches || [])}
              </span>
            </li>
          ))}
        </ul>
      )}
    </div>
  );
}


///
// app/articles/[slug]/page.jsx
export const dynamic = 'force-dynamic';

import PageContainer from "@/components/PageContainer";
import ArticleHeader from "@/components/ArticleHeader";
import SimpleKeyValueTable from "@/components/SimpleKeyValueTable";
import Tags from "@/components/Tags";
import SimilarArticles from "@/components/SimilarArticles";
import { notFound } from "next/navigation";
import CommentsSection from "@/components/CommentsSection";
import Gallery from "@/components/Gallery";
import { labelMap } from "@/utils/labelMap";
import InlineImage from "@/components/InlineImage";
import EmbedContent from "@/components/EmbedContent";

const API_URL = process.env.STRAPI_API_URL;

export default async function ArticlePage({ params }) {
  const res = await fetch(
    `${API_URL}/api/articles?filters[slug][$eq]=${params.slug}&populate=*`,
    { next: { revalidate: 0 } }
  );

  const json = await res.json();
  const rawArticle = json.data?.[0];
  if (!rawArticle) return notFound();

  const data = rawArticle;

  const article = {
    title: data.title || "×›×ª×‘×” ×œ×œ× ×›×•×ª×¨×ª",
    description: data.description || "××™×Ÿ ×ª×™××•×¨ ×–××™×Ÿ",
    image: data.image?.url ? `${API_URL}${data.image.url}` : "/default-image.jpg",
    imageAlt: data.image?.alternativeText || "×ª××•× ×” ×¨××©×™×ª",
    author: data.author || "××¢×¨×›×ª OnMotor",
    date: data.date || "2025-06-22",
    time: data.time || "10:00",
    tags: data.tags || [],
    content: data.content || "",
    tableData: data.tableData || {},
    href: `/articles/${params.slug}`,
    category: data.category || "general",
    subcategory: Array.isArray(data.subcategory)
      ? data.subcategory[0]
      : data.subcategory,
    values: Array.isArray(data.Values)
      ? data.Values
      : data.Values
      ? [data.Values]
      : [],
    headline: data.headline || data.title,
    subdescription: data.subdescription || "",
    slug: params.slug,
    gallery:
      data.gallery?.map((img) => ({
        src: `${API_URL}${img.url}`,
        alt: img.alternativeText || "×ª××•× ×” ××”×’×œ×¨×™×”",
      })) || [],
    font_family: data.font_family || "Heebo, sans-serif",
  };

  // âœ… ×¤×™×¨×•×¨×™ ×œ×—×
  const breadcrumbs = [{ label: "×“×£ ×”×‘×™×ª", href: "/" }];
  if (article.category) {
    breadcrumbs.push({
      label: labelMap[article.category] || article.category,
      href: `/${article.category}`,
    });
  }
  if (article.subcategory) {
    breadcrumbs.push({
      label: labelMap[article.subcategory] || article.subcategory,
      href: `/${article.category}/${article.subcategory}`,
    });
  }
  if (article.values?.length > 0) {
    const valueKey = article.values[0];
    breadcrumbs.push({
      label: labelMap[valueKey] || valueKey,
      href: `/${article.category}/${article.subcategory}/${valueKey}`,
    });
  }
  breadcrumbs.push({ label: article.title });

  // âœ… ×¨×™× ×“×•×¨ ×‘×œ×•×§×™× ×›×•×œ×œ ×§×™×©×•×¨×™×, ×ª××•× ×•×ª ×•×”×˜××¢×•×ª
  const renderParagraph = (block, i) => {
    // ---- ×˜×§×¡×˜ ×¨×’×™×œ (string) ----
    if (typeof block === "string") {
      const cleanText = block.trim();

      if (cleanText.startsWith("[[img:") && cleanText.endsWith("]]")) {
        const parts = cleanText.slice(6, -2).split("||");
        const [src, alt = "", caption = ""] = parts;
        return <InlineImage key={i} src={src} alt={alt} caption={caption} />;
      }

      const hasHTMLTags = /<\/?[a-z][\s\S]*>/i.test(cleanText);
      if (hasHTMLTags) {
        return (
          <p
            key={i}
            className="article-text text-gray-800 text-[18px] leading-relaxed"
            dangerouslySetInnerHTML={{ __html: cleanText }}
          />
        );
      }

      const urlMatch = cleanText.match(/https?:\/\/[^\s]+/);
      if (urlMatch) return <EmbedContent key={i} url={urlMatch[0]} />;

      return (
        <p
          key={i}
          className="article-text text-gray-800 text-[18px] leading-relaxed"
          dangerouslySetInnerHTML={{ __html: cleanText.replace(/\n/g, "<br/>") }}
        />
      );
    }

    // ---- Rich Text ×-Strapi ----
    if (block.type === "paragraph" && block.children) {
      const html = block.children
        .map((child) => {
          // âœ… ×ª××™×›×” ×‘×§×™×©×•×¨ ×©××’×™×¢ ×›Ö¾block ×©×œ× ××¡×•×’ link
          if (child.type === "link" && child.url) {
            const label =
              (child.children && child.children[0]?.text) || child.url;
            const href = child.url.startsWith("http")
              ? child.url
              : `${child.url.startsWith("/") ? child.url : "/" + child.url}`;
            return `<a href="${href}" target="_blank" rel="noopener noreferrer"
              class="text-blue-600 underline hover:text-blue-800 transition-colors duration-150">${label}</a>`;
          }

          // âœ… ×˜×§×¡×˜ ×¨×’×™×œ ×¢× ×¢×™×¦×•×‘
          let text = child.text || "";
          if (child.bold) text = `<strong>${text}</strong>`;
          if (child.italic) text = `<em>${text}</em>`;
          if (child.underline) text = `<u>${text}</u>`;
          return text;
        })
        .join("");

      const cleanHtml = html.replace(/<[^>]+>/g, "").trim();
      const urlMatch = cleanHtml.match(/https?:\/\/[^\s"']+/);
      if (urlMatch && cleanHtml === urlMatch[0]) {
        return <EmbedContent key={i} url={urlMatch[0]} />;
      }

      return (
        <p
          key={i}
          className="article-text text-gray-800 text-[18px] leading-relaxed"
          dangerouslySetInnerHTML={{ __html: html }}
        />
      );
    }

    // ---- ×›×•×ª×¨×•×ª ----
    if (block.type === "heading") {
      const level = block.level || 2;
      const Tag = `h${Math.min(level, 3)}`;
      const text = block.children?.map((c) => c.text).join("") || "";
      return (
        <Tag
          key={i}
          className="font-bold text-2xl text-gray-900 mt-4 mb-2"
          dangerouslySetInnerHTML={{ __html: text }}
        />
      );
    }

    return null;
  };

  // âœ… ×‘× ×™×™×ª ×”×¤×¡×§××•×ª
  let paragraphs = [];
  if (typeof article.content === "string") {
    paragraphs = article.content.split("\n\n");
  } else if (Array.isArray(article.content)) {
    paragraphs = article.content;
  }

  return (
    <PageContainer title={article.title} breadcrumbs={breadcrumbs}>
      <div
        className="mx-auto max-w-[740px] space-y-2 text-right leading-relaxed text-base text-gray-800 px-2"
        style={{ fontFamily: article.font_family }}
      >
        <ArticleHeader
          author={article.author}
          date={article.date}
          time={article.time}
          image={article.image}
          imageAlt={article.imageAlt}
          title={article.headline}
          subdescription={article.subdescription}
        />

        {article.description && (
          <p className="font-bold text-2xl text-gray-600">{article.description}</p>
        )}

        {paragraphs.map(renderParagraph)}

        {article.tableData && <SimpleKeyValueTable data={article.tableData} />}
        <Gallery images={article.gallery} />
        <Tags tags={article.tags} />
        <SimilarArticles currentSlug={article.slug} category={article.category} />
        <CommentsSection articleUrl={`https://www.onmotormedia.com${article.href}`} />
      </div>
    </PageContainer>
  );
}
///

///
//components\Header.jsx
'use client';
import React, { useEffect, useRef, useState } from 'react';
import { gsap } from 'gsap';
import NavigationMenu from './NavigationMenu';
import SearchBar from './SearchBar';
import SocialIcons from './SocialIcons';
import { useAuthModal } from '@/contexts/AuthModalProvider';

export default function Header() {
  const { user, openModal, hydrated } = useAuthModal();
  const logoRef = useRef(null);
  const lettersRef = useRef([]);
  const containerRef = useRef(null);
  const isAnimating = useRef(false);

  useEffect(() => {
    const tl = gsap.timeline();

    tl.fromTo(
      logoRef.current,
      { rotate: -90, scale: 0.8 },
      { rotate: 0, scale: 1, duration: 1.2, ease: 'elastic.out(1, 0.5)' }
    );

    tl.fromTo(
      lettersRef.current,
      { y: 15, opacity: 0, rotate: -10 },
      {
        y: 0,
        opacity: 1,
        rotate: 0,
        duration: 0.6,
        stagger: 0.05,
        ease: 'back.out(1.7)',
      },
      '-=0.9'
    );
  }, []);

  const handleClick = () => {
    if (isAnimating.current) return;
    isAnimating.current = true;

    const tl = gsap.timeline({
      onComplete: () => {
        window.location.href = '/';
      },
    });

    tl.to(containerRef.current, {
      x: -4,
      duration: 0.05,
      repeat: 5,
      yoyo: true,
      ease: 'power1.inOut',
    });

    tl.to(
      logoRef.current,
      { rotate: '+=720', duration: 1.2, ease: 'power3.out' },
      '-=0.2'
    );

    tl.to(
      lettersRef.current,
      {
        y: -10,
        x: 5,
        rotate: 5,
        duration: 0.4,
        stagger: 0.05,
        ease: 'power1.out',
        yoyo: true,
        repeat: 1,
      },
      '-=1'
    );
  };

  const logoText = [
    { char: 'O', red: true },
    { char: 'n' },
    { char: 'M', red: true },
    { char: 'otor\u00A0' },
    { char: 'M', red: true },
    { char: 'edia' },
  ];

  return (
    <header className="sticky top-0 z-50 bg-black text-[#C0C0C0] h-[80px] fixed w-full flex flex-row-reverse items-center justify-between px-2 md:px-6 py-2 shadow-md border-b border-gray-800">
      <div
        ref={containerRef}
        className="flex flex-row-reverse items-center gap-2 min-w-0 cursor-pointer"
        onClick={handleClick}
      >
        <div className="hidden lg:block z-50" dir="rtl">
          {!hydrated ? (
            <div className="w-[80px] h-[32px]" />
          ) : user?.email ? (
            <button
              onClick={(e) => {
                e.stopPropagation();
                openModal('inline', '×”×ª× ×ª×§×•×ª');
              }}
              className="bg-green-600 text-white px-3 py-1 rounded text-sm font-bold whitespace-nowrap"
            >
              {user?.email?.charAt(0).toUpperCase()} ××—×•×‘×¨
            </button>
          ) : (
            <button
              onClick={(e) => {
                e.stopPropagation();
                openModal('inline', '×”×ª×—×‘×¨×•×ª / ×”×¨×©××”');
              }}
              className="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm font-bold whitespace-nowrap"
            >
              ×”×ª×—×‘×¨
            </button>
          )}
        </div>

        <img
          ref={logoRef}
          src="/OnMotorLogonoback.png"
          alt="OnMotor Logo"
          className="w-20 shrink-0 z-50"
          dir="rtl"
        />

        <div className="truncate overflow-visible">
          <h1 dir="ltr" className="text-2xl lg:text-4xl font-bold whitespace-nowrap z-50 flex">
            {logoText.map((part, i) => (
              <span
                key={i}
                ref={(el) => (lettersRef.current[i] = el)}
                className={`inline-block ${part.red ? 'text-[#e60000]' : ''}`}
              >
                {part.char}
              </span>
            ))}
          </h1>
          <p className="text-xs lg:text-sm font-bold text-right whitespace-nowrap truncate">
            ××™×¤×” ×©×× ×•×¢ ×•×’×œ×’×œ×™× ×¤×•×’×©×™× ××“×™×”
          </p>
        </div>
      </div>

      <div className="hidden mobileMenu:hidden lg:flex items-end flex-shrink-0 z-50 suppressHydrationWarning">
        <div dir="ltr" className="flex items-center">
          <div className="w-0 h-15 gap-2">
            <SearchBar />
          </div>

          <div className="flex flex-col items-end gap-4">
            <div className="flex items-center h-10 top-0">
              <SocialIcons size="text-3xl" />
            </div>
            <div dir="ltr" className="flex items-center h-0">
              <NavigationMenu />
            </div>
          </div>
        </div>
      </div>
    </header>
  );
}

///

///
// components/AuthBox.jsx
'use client';
import React, { useState, useEffect, useRef } from 'react';
import { FaChevronUp } from 'react-icons/fa';
import useIsMobile from '@/hooks/useIsMobile';
import { useRouter } from 'next/navigation';
import { useAuthModal } from '@/contexts/AuthModalProvider';
import { loginUser, logoutUser, getCurrentUser } from '@/utils/auth';
import PasswordField from '@/components/PasswordField';

export default function AuthBox({ mode = 'inline', boxRef }) {
  const isMobile = useIsMobile();
  const router = useRouter();
  const { user, setUser } = useAuthModal();

  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [rememberMe, setRememberMe] = useState(false);
  const [loginError, setLoginError] = useState('');
  const [statusMsg, setStatusMsg] = useState('');

  const [activeForm, setActiveForm] = useState(null); // "register" | "reset" | "change" | null
  const refs = { register: useRef(null), reset: useRef(null), change: useRef(null) };

  const [formData, setFormData] = useState({
    registerEmail: '',
    registerPassword: '',
    registerConfirm: '',
    resetEmail: '',
    currentPassword: '',
    newPassword: ''
  });

  useEffect(() => {
    const stored = localStorage.getItem('user');
    if (stored) setUser(JSON.parse(stored));
    const lastEmail = localStorage.getItem('lastEmail');
    if (lastEmail) setEmail(lastEmail);
  }, [setUser]);

  useEffect(() => {
    if (user) setActiveForm(null);
  }, [user]);

  useEffect(() => {
    if (isMobile && boxRef?.current) {
      boxRef.current.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  }, [isMobile, user, boxRef]);

  const handleLogin = async () => {
    setStatusMsg('');
    try {
      const res = await fetch('/api/user/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password }),
        credentials: 'include'
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.error);
      loginUser({ email: data.user.email, jwt: data.jwt });
      setUser(data.user);
      localStorage.setItem('user', JSON.stringify(data.user));
      if (rememberMe) localStorage.setItem('lastEmail', email);
      setStatusMsg('×”×ª×—×‘×¨×ª ×‘×”×¦×œ×—×”!');
      setLoginError('');
    } catch (err) {
      setLoginError(err.message);
    }
  };

  const handleLogout = async () => {
    await logoutUser();
    localStorage.clear();
    setUser(null);
    setEmail('');
    setPassword('');
    setStatusMsg(''); // âœ… ×× ×§×” ××ª ×”×”×•×“×¢×”
    setLoginError('');
  };

  const handleAction = async (type) => {
    setStatusMsg('');
    const body = {};
    let url = '';
    if (type === 'register') {
      const { registerEmail, registerPassword, registerConfirm } = formData;
      if (registerPassword !== registerConfirm)
        return setStatusMsg('×”×¡×™×¡×××•×ª ××™× ×Ÿ ×ª×•×××•×ª');
      body.email = registerEmail;
      body.password = registerPassword;
      url = '/api/user/register';
    } else if (type === 'reset') {
      body.email = formData.resetEmail;
      url = '/api/user/forgot-password';
    } else if (type === 'change') {
      body.currentPassword = formData.currentPassword;
      body.newPassword = formData.newPassword;
      url = '/api/user/change-password';
    }

    try {
      const res = await fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body),
        credentials: 'include'
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.error);
      setStatusMsg(
        type === 'register'
          ? '× ×¨×©××ª ×‘×”×¦×œ×—×”!'
          : type === 'reset'
          ? '× ×©×œ×—×” ×¡×™×¡××” ×—×“×©×” ×œ××™××™×™×œ ×©×œ×š'
          : '×”×¡×™×¡××” ×¢×•×“×›× ×” ×‘×”×¦×œ×—×”'
      );
    } catch (err) {
      setStatusMsg(err.message);
    }
  };

  return (
    <div dir="rtl" className="text-center" ref={boxRef}>
      {isMobile && mode === 'side' && (
        <button
          onClick={() => router.back()}
          className="text-sm bg-white text-black px-2 py-2 rounded shadow hover:bg-gray-200 transition"
        >
          ×¡×’×•×¨ <FaChevronUp className="inline" />
        </button>
      )}

      <div className="transition-all duration-500 ease-in-out mt-2 max-w-md bg-white text-black border border-gray-300 rounded p-3 text-sm shadow-md">
        <h3 className="font-semibold text-black mb-6">
          {user ? '× ×™×”×•×œ ×—×©×‘×•×Ÿ' : '×”×ª×—×‘×¨×•×ª / ×”×¨×©××”'}
        </h3>

        {/* === ××©×ª××© ××—×•×‘×¨ === */}
        {user ? (
          <>
            <p className="mb-4">×©×œ×•×, {user.email}</p>
            <button
              onClick={handleLogout}
              className="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 mb-2 w-full"
            >
              ×”×ª× ×ª×§
            </button>
            <div className="flex justify-center gap-3 text-xs">
              <button onClick={() => setActiveForm('change')} className="text-blue-600 underline">
                ×©× ×” ×¡×™×¡××”
              </button>
              <button onClick={() => setActiveForm('reset')} className="text-blue-600 underline">
                ×©×›×—×ª×™ ×¡×™×¡××”
              </button>
            </div>
          </>
        ) : (
          <>
            <input
              type="email"
              placeholder="××™××™×™×œ"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              onKeyDown={(e) => e.key === 'Enter' && handleLogin()}
              className="w-full px-3 py-2 mb-2 border border-gray-300 rounded text-right text-sm focus:outline-none focus:ring-1 focus:ring-red-500"
            />

            <PasswordField
              placeholder="×¡×™×¡××”"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              onEnter={handleLogin}
              className="w-full mb-2"
            />

            <div className="flex items-center justify-start mb-2">
              <input
                type="checkbox"
                id="rememberMe"
                checked={rememberMe}
                onChange={(e) => setRememberMe(e.target.checked)}
                className="ml-2"
              />
              <label htmlFor="rememberMe" className="text-sm text-black">
                ×”×©××¨ ××—×•×‘×¨
              </label>
            </div>

            <button
              onClick={handleLogin}
              className="bg-[#e60000] text-white px-3 py-2 rounded hover:bg-red-700 text-sm w-full"
            >
              ×”×ª×—×‘×¨
            </button>

            {loginError && <p className="text-red-600 mt-1 text-xs">{loginError}</p>}
            {statusMsg && !loginError && (
              <p className="text-green-600 mt-1 text-xs">{statusMsg}</p>
            )}

            <div className="mt-3 flex justify-center gap-3 text-xs">
              <button onClick={() => setActiveForm('register')} className="text-blue-600 underline">
                ×¦×•×¨ ×—×©×‘×•×Ÿ
              </button>
              <button onClick={() => setActiveForm('reset')} className="text-blue-600 underline">
                ×©×›×—×ª×™ ×¡×™×¡××”
              </button>
            </div>
          </>
        )}

        {/* === ×˜×¤×¡×™× ×¤× ×™××™×™× === */}
        {activeForm === 'register' && (
          <FormBox title="×¦×•×¨ ×—×©×‘×•×Ÿ" onClose={() => setActiveForm(null)} refEl={refs.register}>
            <input
              type="email"
              placeholder="××™××™×™×œ"
              value={formData.registerEmail}
              onChange={(e) =>
                setFormData((f) => ({ ...f, registerEmail: e.target.value }))
              }
              onKeyDown={(e) => e.key === 'Enter' && handleAction('register')}
              className="w-full px-3 py-2 mb-2 border border-gray-300 rounded text-right text-sm focus:ring-1 focus:ring-red-500"
            />
            <PasswordField
              placeholder="×¡×™×¡××”"
              value={formData.registerPassword}
              onChange={(e) =>
                setFormData((f) => ({ ...f, registerPassword: e.target.value }))
              }
              onEnter={() => handleAction('register')}
              className="mb-2"
            />
            <PasswordField
              placeholder="××™××•×ª ×¡×™×¡××”"
              value={formData.registerConfirm}
              onChange={(e) =>
                setFormData((f) => ({ ...f, registerConfirm: e.target.value }))
              }
              onEnter={() => handleAction('register')}
              className="mb-2"
            />
            <SubmitButton text="×”×¨×©××”" color="green" onClick={() => handleAction('register')} />
            {statusMsg && <p className="text-green-600 mt-2 text-xs">{statusMsg}</p>}
          </FormBox>
        )}

        {activeForm === 'reset' && (
          <FormBox title="×©×›×—×ª×™ ×¡×™×¡××”" onClose={() => setActiveForm(null)} refEl={refs.reset}>
            <input
              type="email"
              placeholder="××™××™×™×œ ×œ××™×¤×•×¡"
              value={formData.resetEmail}
              onChange={(e) =>
                setFormData((f) => ({ ...f, resetEmail: e.target.value }))
              }
              onKeyDown={(e) => e.key === 'Enter' && handleAction('reset')}
              className="w-full px-3 py-2 mb-2 border border-gray-300 rounded text-right text-sm focus:ring-1 focus:ring-red-500"
            />
            <SubmitButton text="×©×œ×— ×¡×™×¡××” ×—×“×©×”" color="blue" onClick={() => handleAction('reset')} />
            {statusMsg && <p className="text-green-600 mt-2 text-xs">{statusMsg}</p>}
          </FormBox>
        )}

        {activeForm === 'change' && (
          <FormBox title="×©× ×” ×¡×™×¡××”" onClose={() => setActiveForm(null)} refEl={refs.change}>
            <PasswordField
              placeholder="×¡×™×¡××” × ×•×›×—×™×ª"
              value={formData.currentPassword}
              onChange={(e) =>
                setFormData((f) => ({ ...f, currentPassword: e.target.value }))
              }
              onEnter={() => handleAction('change')}
              className="mb-2"
            />
            <PasswordField
              placeholder="×¡×™×¡××” ×—×“×©×”"
              value={formData.newPassword}
              onChange={(e) =>
                setFormData((f) => ({ ...f, newPassword: e.target.value }))
              }
              onEnter={() => handleAction('change')}
              className="mb-2"
            />
            <SubmitButton text="×¢×“×›×Ÿ ×¡×™×¡××”" color="yellow" onClick={() => handleAction('change')} />
            {statusMsg && <p className="text-green-600 mt-2 text-xs">{statusMsg}</p>}
          </FormBox>
        )}
      </div>
    </div>
  );
}

/* === ×¨×›×™×‘×™ ××©× ×” === */
function FormBox({ title, children, onClose, refEl }) {
  return (
    <div
      ref={refEl}
      className="mt-4 bg-gray-100 p-3 rounded text-right text-sm relative"
    >
      <button
        onClick={onClose}
        className="absolute top-2 left-2 text-gray-500 hover:text-black"
      >
        âœ–
      </button>
      <h4 className="font-semibold mb-2 pr-6">{title}</h4>
      {children}
    </div>
  );
}

function SubmitButton({ text, color, onClick }) {
  const colors = {
    green: 'bg-green-600 hover:bg-green-700',
    blue: 'bg-blue-600 hover:bg-blue-700',
    yellow: 'bg-yellow-600 hover:bg-yellow-700'
  };
  return (
    <button
      type="button"
      onClick={onClick}
      className={`${colors[color]} text-white px-3 py-2 rounded text-sm w-full`}
    >
      {text}
    </button>
  );
}
/////

///global.css454 ///

@import url('https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;700&display=swap');
@import "tailwindcss";
@tailwind base;
@tailwind components;
@tailwind utilities;


@keyframes parts-bounce {
  0%, 100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-5px);
  }
}

.animate-parts-bounce {
  animation: parts-bounce 1s infinite;
}


:root {
  --background: #ffffff;
  --foreground: #171717;
}

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);
}

@media (prefers-color-scheme: dark) {
  :root {
    --background: #0a0a0a;
    --foreground: #ededed;
  }
}

body {
  margin: 0;
  padding: 0;
  max-width: 100%;
  overflow-x: hidden;
  background: var(--background);
  color: var(--foreground);
  font-family: 'Heebo', sans-serif;
}

@keyframes spinEaseOut {
  0% {
    transform: rotate(0deg);
  }
  70% {
    transform: rotate(900deg);
  }
  100% {
    transform: rotate(1080deg);
  }
}

@keyframes bounceDecay {
  0% {
    transform: translateY(0);
  }
  20% {
    transform: translateY(-20px);
  }
  40% {
    transform: translateY(0);
  }
  60% {
    transform: translateY(-10px);
  }
  80% {
    transform: translateY(0);
  }
  100% {
    transform: translateY(-5px);
  }
}
@keyframes marquee {
  0% {
    transform: translateX(100%);
  }
  100% {
    transform: translateX(-100%);
  }
}

.news-ticker-line {
  position: absolute;
  white-space: nowrap;
  animation: marquee 15s linear infinite;
  direction: rtl;
  font-weight: bold;
}

.animate-spin-ease-out {
  animation: spinEaseOut 1.5s ease-out forwards;
}

.animate-bounce-decay {
  animation: bounceDecay 1s ease-out forwards;
}

select {
  max-width: 100%;
  text-overflow: ellipsis;
  white-space: nowrap;
}
@keyframes marquee-loop {
  0% {
    transform: translateX(100%);
  }
  100% {
    transform: translateX(-100%);
  }
}

.animate-marquee-loop {
  display: inline-block;
  white-space: nowrap;
  animation: marquee-loop 15s linear infinite;
}

/* ğŸ¯ ×¢×™×¦×•×‘ ×¤×¡×™ ×’×œ×™×œ×” ×‘×›×œ ×”××ª×¨ ××• ×¨×§ ×œ××œ×× ×˜×™× ×¢× overflow */
::-webkit-scrollbar {
  width: 6px; /* ×¢×•×‘×™ ×¤×¡ ×”×’×œ×™×œ×” */
}

::-webkit-scrollbar-track {
  background: transparent; /* ×¨×§×¢ ×”××¡×™×œ×” */
}

::-webkit-scrollbar-thumb {
  background-color: #a0a0a0; /* ×¦×‘×¢ ×”×™×“×™×ª */
  border-radius: 8px;        /* ×¢×™×’×•×œ ×¤×™× ×•×ª */
  border: 1px solid #555;    /* ××¡×’×¨×ª ×¢×“×™× ×” */
}

::-webkit-scrollbar-thumb:hover {
  background-color: #ff1a1a; /* ××“×•× ×‘×¢×ª ××¢×‘×¨ ×¢×›×‘×¨ */
}

/* ×¢×™×¦×•×‘ ×¤×¡ ×’×œ×™×œ×” ×¨×§ ×œ××–×•×¨ ×”×¡×™×™×“×¨ */
.custom-scrollbar::-webkit-scrollbar {
  width: 8px;
}

.custom-scrollbar::-webkit-scrollbar-thumb {
  background-color: #ff1a1a;;
  border-radius: 10px;
}

.custom-scrollbar::-webkit-scrollbar-thumb:hover {
  background-color: #ff1a1a;
}

/* ğŸ¨ ×©×œ×™×˜×” ×‘×¤×•× ×˜ ×©×œ ×”×˜×§×¡×˜×™× ×‘×œ×‘×“ */
.article-text {
  font-family: 'Heebo', sans-serif; /* ××• ×›×œ ×¤×•× ×˜ ×©×ª×’×“×™×¨ ×‘×¡×˜×¨×¤××™ */
  font-size: 18px;
  line-height: 1.8;
}

/* ğŸ›‘ ××œ ×ª×©×¤×™×¢ ×¢×œ iframes ××• embeds */
.article-text iframe,
.article-text blockquote,
.article-text .instagram-media,
.article-text .tiktok-embed,
.article-text .twitter-tweet,
.article-text .fb-post {
  all: unset; /* ××¡×™×¨ ×›×œ ×”×©×¤×¢×” ×©×œ ×”×¤×•× ×˜ ×©×œ×š */
  font-family: initial;
  font-size: initial;
  line-height: normal;
}
/* ğŸ§© ×‘×™×˜×•×œ ××¨×•×•×—×™× ××™×•×ª×¨×™× ××ª×—×ª ×œ×”×˜××¢×•×ª */
.instagram-media,
.tiktok-embed,
.twitter-tweet,
.fb-post,
iframe[src*="facebook.com"],
iframe[src*="instagram.com"],
iframe[src*="tiktok.com"],
iframe[src*="twitter.com"],
iframe[src*="x.com"] {
  margin-bottom: 0 !important;
  margin-top: 0.5rem !important;
}

/* ×”×ª×××” ×œ××•×‘×™×™×œ */
@media (max-width: 640px) {
  .instagram-media,
  .tiktok-embed,
  .twitter-tweet,
  .fb-post {
    margin-top: 0.2rem !important;
  }
}
///// components/EmbedContent.jsx 

// components/EmbedContent.jsx
"use client";
import React, { useEffect } from "react";

export default function EmbedContent({ url }) {
  useEffect(() => {
    // --- ×˜×¢×™× ×ª SDKs ×©×œ ×¤×œ×˜×¤×•×¨××•×ª ---
    const loadScript = (id, src) => {
      if (!document.getElementById(id)) {
        const s = document.createElement("script");
        s.id = id;
        s.src = src;
        s.async = true;
        document.body.appendChild(s);
      }
    };

    loadScript("instagram-embed", "https://www.instagram.com/embed.js");
    loadScript("tiktok-embed", "https://www.tiktok.com/embed.js");
    loadScript("twitter-embed", "https://platform.twitter.com/widgets.js");
    loadScript("facebook-jssdk", "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v17.0");

    // --- Instagram ×¢×™×‘×•×“ ××—×“×© ---
    if (url.includes("instagram.com")) {
      const tryProcess = () => {
        if (window.instgrm && window.instgrm.Embeds) window.instgrm.Embeds.process();
      };
      tryProcess();
      const t = setTimeout(tryProcess, 800);
      return () => clearTimeout(t);
    }

    // --- Facebook ×¨×¢× ×•×Ÿ ---
    if (url.includes("facebook.com")) {
      const tryProcessFB = () => {
        if (window.FB && window.FB.XFBML) window.FB.XFBML.parse();
      };
      tryProcessFB();
      const t = setTimeout(tryProcessFB, 800);
      return () => clearTimeout(t);
    }
  }, [url]);

  // --- ×¢×™×¦×•×‘ ××—×™×“ ---
  const wrapperClass =
    "flex justify-center items-center mt-2 sm:mt-4 mb-1 w-full max-w-full text-center";

  // âœ… YouTube
  if (url.includes("youtube.com") || url.includes("youtu.be")) {
    let videoId = "";
    if (url.includes("shorts/")) videoId = url.split("shorts/")[1]?.split("?")[0];
    else if (url.includes("watch?v=")) videoId = url.split("v=")[1]?.split("&")[0];
    else videoId = url.split("/").pop()?.split("?")[0];

    return (
      <div className={wrapperClass}>
        <div className="w-full max-w-[720px] aspect-video">
          <iframe
            src={`https://www.youtube.com/embed/${videoId}`}
            allowFullScreen
            title="YouTube Video"
            className="w-full h-full rounded-xl"
          />
        </div>
      </div>
    );
  }

  // âœ… TikTok
  if (url.includes("tiktok.com")) {
    const videoId = url.split("/video/")[1]?.split("?")[0];
    return (
      <div className={wrapperClass}>
        <blockquote
          className="tiktok-embed"
          cite={url}
          data-video-id={videoId}
          style={{ maxWidth: "360px", minWidth: "320px" }}
        >
          <a href={url}></a>
        </blockquote>
      </div>
    );
  }

  // âœ… Instagram
  if (url.includes("instagram.com")) {
    return (
      <div className={wrapperClass}>
        <blockquote
          className="instagram-media"
          data-instgrm-permalink={url}
          data-instgrm-version="14"
          style={{ maxWidth: "400px", margin: "0 auto" }}
        />
      </div>
    );
  }

  // âœ… Facebook (×¤×•×¡×˜ ××• ×¨×™×œ)
  if (url.includes("facebook.com")) {
    return (
      <div className={wrapperClass}>
        <div
          className="fb-post"
          data-href={url}
          data-width="500"
          style={{ margin: "0 auto" }}
        ></div>
      </div>
    );
  }

  // âœ… X / Twitter
  if (url.includes("twitter.com") || url.includes("x.com")) {
    const fixedUrl = url.replace("x.com", "twitter.com");
    return (
      <div className={wrapperClass}>
        <blockquote className="twitter-tweet">
          <a href={fixedUrl}></a>
        </blockquote>
      </div>
    );
  }

  // âœ… ×‘×¨×™×¨×ª ××—×“×œ â€“ ×§×™×©×•×¨ ×¨×’×™×œ
  return (
    <div className={wrapperClass}>
      <a
        href={url}
        target="_blank"
        rel="noopener noreferrer"
        className="text-blue-600 underline break-words"
      >
        {url}
      </a>
    </div>
  );
}
////
// app/articles/[slug]/page.jsx
export const dynamic = 'force-dynamic';

import PageContainer from "@/components/PageContainer";
import ArticleHeader from "@/components/ArticleHeader";
import SimpleKeyValueTable from "@/components/SimpleKeyValueTable";
import Tags from "@/components/Tags";
import SimilarArticles from "@/components/SimilarArticles";
import { notFound } from "next/navigation";
import CommentsSection from "@/components/CommentsSection";
import Gallery from "@/components/Gallery";
import { labelMap } from "@/utils/labelMap";
import InlineImage from "@/components/InlineImage";
import EmbedContent from "@/components/EmbedContent";

const API_URL = process.env.STRAPI_API_URL;

export default async function ArticlePage({ params }) {
  const res = await fetch(
    `${API_URL}/api/articles?filters[slug][$eq]=${params.slug}&populate=*`,
    { next: { revalidate: 0 } }
  );

  const json = await res.json();
  const rawArticle = json.data?.[0];
  if (!rawArticle) return notFound();

  const data = rawArticle;

  const article = {
    title: data.title || "×›×ª×‘×” ×œ×œ× ×›×•×ª×¨×ª",
    description: data.description || "××™×Ÿ ×ª×™××•×¨ ×–××™×Ÿ",
    image: data.image?.url ? `${API_URL}${data.image.url}` : "/default-image.jpg",
    imageSrc: data.image?.url ? `${API_URL}${data.image.url}` : "/default-image.jpg",
    imageAlt: data.image?.alternativeText || "×ª××•× ×” ×¨××©×™×ª",
    author: data.author || "××¢×¨×›×ª OnMotor",
    date: data.date || "2025-06-22",
    time: data.time || "10:00",
    tags: data.tags || [],
    content: data.content || "",
    tableData: data.tableData || {},
    href: `/articles/${params.slug}`,
    category: data.category || "general",
    subcategory: Array.isArray(data.subcategory)
      ? data.subcategory[0]
      : data.subcategory,
    values: Array.isArray(data.Values)
      ? data.Values
      : data.Values
      ? [data.Values]
      : [],
    headline: data.headline || data.title,
    subdescription: data.subdescription || "",
    slug: params.slug,
    gallery:
      data.gallery?.map((img) => ({
        src: `${API_URL}${img.url}`,
        alt: img.alternativeText || "×ª××•× ×” ××”×’×œ×¨×™×”",
      })) || [],
    font_family: data.font_family || "Heebo, sans-serif",
  };

  // âœ… ×‘× ×™×™×ª ×¤×™×¨×•×¨×™ ×œ×—×
  const breadcrumbs = [{ label: "×“×£ ×”×‘×™×ª", href: "/" }];
  if (article.category) {
    breadcrumbs.push({
      label: labelMap[article.category] || article.category,
      href: `/${article.category}`,
    });
  }
  if (article.subcategory) {
    breadcrumbs.push({
      label: labelMap[article.subcategory] || article.subcategory,
      href: `/${article.category}/${article.subcategory}`,
    });
  }
  if (article.values && article.values.length > 0) {
    const valueKey = article.values[0];
    breadcrumbs.push({
      label: labelMap[valueKey] || valueKey,
      href: `/${article.category}/${article.subcategory}/${valueKey}`,
    });
  }
  breadcrumbs.push({ label: article.title });

  // âœ… ×¤×•× ×§×¦×™×™×ª ×¨×™× ×“×•×¨ ×ª×•××›×ª Rich Text ×•×”×˜××¢×•×ª
  const renderParagraph = (block, i) => {
    // ××—×¨×•×–×ª ×¤×©×•×˜×”
    if (typeof block === "string") {
      const cleanText = block.trim();

      if (cleanText.startsWith("[[img:") && cleanText.endsWith("]]")) {
        const parts = cleanText.slice(6, -2).split("||");
        const [src, alt = "", caption = ""] = parts;
        return (
          <InlineImage
            key={i}
            src={src.trim()}
            alt={alt.trim()}
            caption={caption.trim()}
          />
        );
      }

      const urlMatch = cleanText.match(/https?:\/\/[^\s]+/);
      if (urlMatch) return <EmbedContent key={i} url={urlMatch[0]} />;

      return (
        <p
          key={i}
          className="article-text text-gray-800 text-[18px] leading-relaxed"
          dangerouslySetInnerHTML={{ __html: cleanText }}
        />
      );
    }

    // Rich Text ×‘×œ×•×§ ×©×œ ×¡×˜×¨×¤××™
    if (block.type === "paragraph" && block.children) {
      const html = block.children
        .map((child) => {
          let text = child.text || "";
          if (child.bold) text = `<strong>${text}</strong>`;
          if (child.italic) text = `<em>${text}</em>`;
          if (child.underline) text = `<u>${text}</u>`;
          if (child.type === "link" && child.url) {
            text = `<a href="${child.url}" target="_blank" rel="noopener noreferrer" 
            class="text-blue-600 underline hover:text-blue-800 transition-colors duration-150">
            ${text}</a>`;
          }
          return text;
        })
        .join("");

      // âœ… ×ª×™×§×•×Ÿ ×œ×–×™×”×•×™ ×§×™×©×•×¨×™× ×¢×˜×•×¤×™× ×‘×ª×’×™×•×ª (×›×•×œ×œ reels)
      const cleanHtml = html.replace(/<[^>]+>/g, "").trim(); // ××¡×™×¨ ×ª×’×™×•×ª
      const urlMatch = cleanHtml.match(/https?:\/\/[^\s"']+/);

      if (urlMatch && cleanHtml === urlMatch[0]) {
        return <EmbedContent key={i} url={urlMatch[0]} />;
      }

      return (
        <p
          key={i}
          className="article-text text-gray-800 text-[18px] leading-relaxed"
          dangerouslySetInnerHTML={{ __html: html }}
        />
      );
    }

    // ×›×•×ª×¨×•×ª
    if (block.type === "heading") {
      const level = block.level || 2;
      const Tag = `h${Math.min(level, 3)}`;
      const text = block.children?.map((c) => c.text).join("") || "";
      return (
        <Tag
          key={i}
          className="font-bold text-2xl text-gray-900 mt-4 mb-2"
          dangerouslySetInnerHTML={{ __html: text }}
        />
      );
    }

    return null;
  };

  // âœ… ×‘× ×™×™×ª ×¤×¡×§××•×ª ××ª×•×š content
  let paragraphs = [];
  if (typeof article.content === "string") {
    paragraphs = article.content.split("\n\n");
  } else if (Array.isArray(article.content)) {
    paragraphs = article.content;
  }

  return (
    <PageContainer title={article.title} breadcrumbs={breadcrumbs}>
      <div
        className="mx-auto max-w-[740px] space-y-2 text-right leading-relaxed text-base text-gray-800 px-2"
        style={{ fontFamily: article.font_family }}
      >
        <ArticleHeader
          author={article.author}
          date={article.date}
          time={article.time}
          image={article.image}
          imageSrc={article.imageSrc}
          imageAlt={article.imageAlt}
          title={article.headline}
          subdescription={article.subdescription}
        />

        {article.description && (
          <p className="font-bold text-2xl text-gray-600">{article.description}</p>
        )}

        {/* âœ… ××¦×™×’ ×˜×§×¡×˜×™×, ×ª××•× ×•×ª ×•×”×˜××¢×•×ª */}
        {paragraphs.map(renderParagraph)}

        {article.tableData && <SimpleKeyValueTable data={article.tableData} />}

        <Gallery images={article.gallery} />

        <Tags tags={article.tags} />

        <SimilarArticles
          currentSlug={article.slug}
          category={article.category}
        />

        <CommentsSection articleUrl={`https://onmotor-media.com${article.href}`} />
      </div>
    </PageContainer>
  );
}



// components/EmbedContent.jsx  234
"use client";
import React, { useEffect } from "react";

export default function EmbedContent({ url }) {
  useEffect(() => {
    // Instagram: ×œ×”×¨×™×¥ ×¢×™×‘×•×“ ×©×œ ×”Ö¾embeds ××—×¨×™ ×©×”××œ×× ×˜ × ×›× ×¡ ×œÖ¾DOM
    if (url.includes("instagram.com")) {
      const tryProcess = () => {
        if (window.instgrm && window.instgrm.Embeds) {
          window.instgrm.Embeds.process();
        }
      };
      // ××™×™×“×™×ª + ×¢×•×“ × ×™×¡×™×•×Ÿ ×§×˜×Ÿ ××—×¨×™ ×—×¦×™ ×©× ×™×”
      tryProcess();
      const t = setTimeout(tryProcess, 500);
      return () => clearTimeout(t);
    }
  }, [url]);

  // === EMBED BLOCKS ===

  // YouTube
  if (url.includes("youtube.com") || url.includes("youtu.be")) {
    let videoId = "";
    if (url.includes("shorts/")) {
      videoId = url.split("shorts/")[1]?.split("?")[0];
    } else if (url.includes("watch?v=")) {
      videoId = url.split("v=")[1]?.split("&")[0];
    } else {
      videoId = url.split("/").pop()?.split("?")[0];
    }
    return (
      <div className="my-4 aspect-video">
        <iframe
          src={`https://www.youtube.com/embed/${videoId}`}
          title="YouTube video"
          allowFullScreen
          className="w-full h-full rounded-lg"
        />
      </div>
    );
  }

  // Instagram
  if (url.includes("instagram.com")) {
    return (
      <div className="my-4">
        <blockquote
          className="instagram-media"
          data-instgrm-permalink={url}
          data-instgrm-version="14"
          style={{ maxWidth: "540px", margin: "0 auto" }}
        />
      </div>
    );
  }

  // Facebook
  if (url.includes("facebook.com")) {
    return (
      <div className="my-4">
        <div className="fb-post" data-href={url} data-width="w-full" />
      </div>
    );
  }

  // Twitter/X
  if (url.includes("twitter.com") || url.includes("x.com")) {
    return (
      <div className="my-4">
        <blockquote className="twitter-tweet">
          <a href={url}></a>
        </blockquote>
      </div>
    );
  }

  // TikTok
  if (url.includes("tiktok.com")) {
    const videoId = url.split("/video/")[1]?.split("?")[0];
    return (
      <div className="my-4">
        <blockquote
          className="tiktok-embed"
          cite={url}
          data-video-id={videoId}
          style={{ maxWidth: "605px", minWidth: "325px" }}
        >
          <a href={url}></a>
        </blockquote>
      </div>
    );
  }

  // Default â€“ link
  return (
    <a
      href={url}
      target="_blank"
      rel="noopener noreferrer"
      className="text-blue-600 underline break-words"
    >
      {url}
    </a>
  );
}






///12:08-9/21///
//components\ProductGrid.jsx
'use client';
import Link from 'next/link';

export default function ProductGrid({ products = [], loading=false, onLoadMore, hasMore=false }) {
  return (
    <div dir="rtl" className="space-y-4">
      {loading && <div>×˜×•×¢×Ÿ...</div>}
      <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
        {products.map(p => {
          const img = p.images?.edges?.[0]?.node?.url;
          const price = p.variants?.edges?.[0]?.node?.price;
          return (
            <Link key={p.id} href={`/shop/${p.handle}`} className="border rounded-lg overflow-hidden hover:shadow">
              {img && <img src={img} alt={p.title} className="w-full h-40 object-cover" />}
              <div className="p-3 space-y-1">
                <div className="font-medium">{p.title}</div>
                {price && <div className="text-sm opacity-70">{price.amount} {price.currencyCode}</div>}
              </div>
            </Link>
          );
        })}
      </div>
      {hasMore && (
        <div className="flex justify-center">
          <button onClick={onLoadMore} className="border px-4 py-2 rounded-md">×˜×¢×Ÿ ×¢×•×“</button>
        </div>
      )}
    </div>
  );
}









////9/15/16:27

// /app/shop/page.jsx
"use client";
import { useState, useEffect } from "react";
import ShopSidebar from "@/components/ShopSidebar";
import ProductGrid from "@/components/ProductGrid";
import SkuSearchBar from "@/components/SkuSearchBar";

export default function ShopPage() {
  const [filters, setFilters] = useState({});
  const [products, setProducts] = useState([]);
  const [loading, setLoading] = useState(false);

  // ×—×™×¤×•×© ×œ×¤×™ ××§×´×˜ ×™×©×™×¨
  async function handleSkuSearch(sku) {
    setLoading(true);
    const res = await fetch("/api/shopify/search", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ sku }),
    });
    const data = await res.json();
    setProducts(data);
    setLoading(false);
  }

  // ×—×™×¤×•×© ×œ×¤×™ ×¡×™× ×•×Ÿ Sidebar
  useEffect(() => {
    if (!filters) return;

    async function fetchProducts() {
      setLoading(true);
      const res = await fetch("/api/shopify/search", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(filters),
      });
      const data = await res.json();
      setProducts(data);
      setLoading(false);
    }

    // ×œ×”×¨×™×¥ ×—×™×¤×•×© ×¨×§ ×× × ×‘×—×¨ ××©×”×•
    if (
      filters.vehicleType ||
      filters.vendor ||
      filters.model ||
      filters.year ||
      filters.category
    ) {
      fetchProducts();
    }
  }, [filters]);

  return (
    <div className="flex flex-col md:flex-row gap-6 p-4">
      {/* Sidebar */}
      <div className="md:w-1/4">
        <ShopSidebar onFilterChange={setFilters} />
      </div>

      {/* Main Content */}
      <div className="flex-1">
        {/* ×—×™×¤×•×© ××§×´×˜ */}
        <SkuSearchBar onSearch={handleSkuSearch} />

        {/* Loader */}
        {loading && <p className="text-center">×˜×•×¢×Ÿ ××•×¦×¨×™×...</p>}

        {/* ××•×¦×¨×™× */}
        <ProductGrid products={products} />
      </div>
    </div>
  );
}
//////////

// /app/api/shopify/search/route.js
import { NextResponse } from "next/server";

const SHOPIFY_DOMAIN = process.env.SHOPIFY_STORE_DOMAIN;
const SHOPIFY_API_VERSION = process.env.SHOPIFY_API_VERSION || "2024-07";
const SHOPIFY_TOKEN = process.env.SHOPIFY_STOREFRONT_TOKEN;

export async function POST(req) {
  try {
    const { sku, manufacturer, model, year, category } = await req.json();

    // ×‘× ×™×™×ª query string ×œ×—×™×¤×•×©
    let queryString = "";

    if (sku) {
      queryString = `sku:${sku}`;
    } else {
      if (manufacturer) queryString += ` vendor:${manufacturer}`;
      if (model) queryString += ` product_type:${model}`;
      if (year) queryString += ` tag:year:${year}`;
      if (category) queryString += ` tag:cat:${category}`;
    }

    const query = `
      {
        products(first: 20, query: "${queryString.trim()}") {
          edges {
            node {
              id
              title
              description
              images(first: 1) {
                edges {
                  node { url }
                }
              }
              variants(first: 1) {
                edges {
                  node {
                    sku
                    price { amount currencyCode }
                  }
                }
              }
            }
          }
        }
      }
    `;

    const res = await fetch(
      `https://${SHOPIFY_DOMAIN}/api/${SHOPIFY_API_VERSION}/graphql.json`,
      {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-Shopify-Storefront-Access-Token": SHOPIFY_TOKEN,
        },
        body: JSON.stringify({ query }),
      }
    );

    const data = await res.json();
    return NextResponse.json(
      data.data.products.edges.map((edge) => edge.node)
    );
  } catch (error) {
    console.error("Shopify API error:", error);
    return NextResponse.json({ error: "Failed to fetch products" }, { status: 500 });
  }
}

////

/** @type {import('next').NextConfig} */
const nextConfig = {
  images: {
    remotePatterns: [
      {
        protocol: 'http',
        hostname: 'localhost',
        port: '1337',
        pathname: '/uploads/**',
      },
    ],
  },
};

export default nextConfig;




////9/15/16:27
// components/CommentForm.jsx
'use client';
import React, { useState, useEffect } from 'react';
import { supabase } from '../lib/supabase'; // ×•×“× ×©×”× ×ª×™×‘ × ×›×•×Ÿ ×‘×¤×¨×•×™×§×˜ ×©×œ×š

function generateAvatar(name) {
  return name?.charAt(0).toUpperCase() || '?';
}

function timeAgo(date) {
  const localDate = new Date(new Date(date).getTime() + 3 * 60 * 60 * 1000); // UTC+3
  const seconds = Math.floor((new Date() - localDate) / 1000);
  const intervals = [
    { singular: '×©× ×”', plural: '×©× ×™×', seconds: 31536000 },
    { singular: '×—×•×“×©', plural: '×—×•×“×©×™×', seconds: 2592000 },
    { singular: '×™×•×', plural: '×™××™×', seconds: 86400 },
    { singular: '×©×¢×”', plural: '×©×¢×•×ª', seconds: 3600 },
    { singular: '×“×§×”', plural: '×“×§×•×ª', seconds: 60 },
    { singular: '×©× ×™×™×”', plural: '×©× ×™×•×ª', seconds: 1 }
  ];
  for (const interval of intervals) {
    const count = Math.floor(seconds / interval.seconds);
    if (count > 0) {
      const label = count === 1 ? interval.singular : interval.plural;
      return `×œ×¤× ×™ ${count} ${label}`;
    }
  }
  return '×”×¨×’×¢';
}

export default function CommentForm({ articleId }) {
  const [name, setName] = useState('');
  const [comment, setComment] = useState('');
  const [comments, setComments] = useState([]);
  const [replyTo, setReplyTo] = useState(null);
  const [replyContent, setReplyContent] = useState('');
  const [replyName, setReplyName] = useState('');
  const [sortBy, setSortBy] = useState('new');

  useEffect(() => {
    const fetchComments = async () => {
      const { data, error } = await supabase
        .from('comments')
        .select('*')
        .eq('article_id', articleId)
        .order('date', { ascending: true });
      if (!error) setComments(data);
    };
    if (articleId) fetchComments();
  }, [articleId]);

  const submitComment = async (e) => {
    e.preventDefault();
    if (!name || !comment) return;
    const newComment = {
      article_id: articleId,
      name,
      comment,
      likes: 0,
      parent_id: null,
    };
    const { data, error } = await supabase
      .from('comments')
      .insert([newComment])
      .select();
    if (!error && data?.[0]) {
      setComments(prev => [data[0], ...prev]);
      setName('');
      setComment('');
    }
  };

  const submitReply = async (parentId) => {
    if (!replyContent || !replyName) return;
    const reply = {
      article_id: articleId,
      name: replyName,
      comment: replyContent,
      likes: 0,
      parent_id: parentId,
    };
    const { data, error } = await supabase
      .from('comments')
      .insert([reply])
      .select();
    if (!error && data?.[0]) {
      setComments(prev => [...prev, data[0]]);
      setReplyContent('');
      setReplyName('');
      setReplyTo(null);
    }
  };

  const likeComment = async (id) => {
    const comment = comments.find(c => c.id === id);
    if (!comment) return;
    const { data, error } = await supabase
      .from('comments')
      .update({ likes: comment.likes + 1 })
      .eq('id', id)
      .select();
    if (!error && data?.[0]) {
      setComments(prev => prev.map(c => c.id === id ? data[0] : c));
    }
  };

  const deleteComment = async (id) => {
    const { error } = await supabase.from('comments').delete().eq('id', id);
    if (!error) {
      setComments(prev => prev.filter(c => c.id !== id && c.parent_id !== id));
    }
  };

  const sorted = [...comments].sort((a, b) => {
    if (sortBy === 'likes') return b.likes - a.likes;
    return new Date(b.date) - new Date(a.date);
  });

  const parents = sorted.filter(c => !c.parent_id);
  const childrenMap = sorted.filter(c => c.parent_id).reduce((map, reply) => {
    (map[reply.parent_id] = map[reply.parent_id] || []).push(reply);
    return map;
  }, {});

  return (
    <div className="w-full text-right space-y-4 border-t-2 border-red-600 pt-1">
      <h3 className="text-xl font-semibold text-gray-700 mt-0">×”×©××¨ ×ª×’×•×‘×”</h3>
      <form onSubmit={submitComment} className="space-y-2">
        <div>
          <label className="block text-sm text-gray-600 mb-1">×©×:</label>
          <input
            type="text"
            value={name}
            onChange={e => setName(e.target.value)}
            className="w-1/4 bg-white px-4 py-2 border rounded"
            required
          />
        </div>
        <div>
          <label className="block text-sm text-gray-600 mb-1">×ª×’×•×‘×”:</label>
          <textarea
            value={comment}
            onChange={e => setComment(e.target.value)}
            className="w-1/2 bg-white px-4 py-2 border rounded"
            rows={4}
            required
          />
        </div>
        <button type="submit" className="bg-red-600 text-white px-6 py-2 rounded">
          ×©×œ×— ×ª×’×•×‘×”
        </button>
      </form>

      <div className="text-sm flex gap-4 items-center">
        <span>××™×•×Ÿ:</span>
        <button onClick={() => setSortBy('new')} className={sortBy === 'new' ? 'text-red-600 font-bold' : 'text-gray-600'}>×”×›×™ ×—×“×©×™×</button>
        <button onClick={() => setSortBy('likes')} className={sortBy === 'likes' ? 'text-red-600 font-bold' : 'text-gray-600'}>×”×›×™ ××”×•×‘×™×</button>
        <span className="ml-auto">×¡×”"×› ×ª×’×•×‘×•×ª: {comments.length}</span>
      </div>

      <div className="space-y-6">
        {parents.map((c) => (
          <div key={c.id} className="border rounded bg-white p-4">
            <div className="flex justify-between items-center">
              <div className="flex items-center gap-2">
                <div className="w-8 h-8 rounded-full bg-red-600 text-white flex justify-center items-center font-bold">{generateAvatar(c.name)}</div>
                <div className="text-sm font-semibold text-gray-800">{c.name}</div>
              </div>
              <div className="text-xs text-gray-500">{timeAgo(c.date)}</div>
            </div>
            <p className="mt-2 text-gray-700 text-sm whitespace-pre-line">{c.comment}</p>
            <div className="mt-2 flex gap-4 text-sm text-gray-600">
              <button onClick={() => likeComment(c.id)}>â¤ï¸ {c.likes}</button>
              <button onClick={() => setReplyTo(c.id)}>×”×©×‘</button>
              <button onClick={() => deleteComment(c.id)}>ğŸ—‘ï¸ ××—×§</button>
            </div>

            {replyTo === c.id && (
              <div className="mt-4 bg-gray-50 border p-4 rounded">
                <h4 className="text-sm font-semibold text-gray-700 mb-2">
                  âœï¸ ×›×ª×•×‘ ×ª×’×•×‘×ª ××©× ×” ×œÖ¾{c.name}
                </h4>
                <div className="flex flex-wrap gap-2 items-start">
                  <input
                    type="text"
                    placeholder="×”×©× ×©×œ×š"
                    value={replyName}
                    onChange={(e) => setReplyName(e.target.value)}
                    className="w-1/4 bg-white px-3 py-2 border rounded"
                  />
                  <textarea
                    rows={3}
                    placeholder="×ª×’×•×‘×ª ××©× ×”..."
                    value={replyContent}
                    onChange={(e) => setReplyContent(e.target.value)}
                    className="w-1/2 bg-white px-3 py-2 border rounded"
                  />
                </div>
                <div className="mt-2 flex gap-2">
                  <button
                    onClick={() => submitReply(c.id)}
                    className="bg-red-600 text-white px-4 py-1 rounded hover:bg-red-700 text-sm"
                  >
                    ×©×œ×—
                  </button>
                  <button
                    onClick={() => setReplyTo(null)}
                    className="text-gray-500 hover:text-gray-800 text-sm"
                  >
                    ×‘×™×˜×•×œ
                  </button>
                </div>
              </div>
            )}

            {(childrenMap[c.id] || []).map((r) => (
              <div key={r.id} className="mt-4 pl-4 border-r-2 border-gray-200 space-y-3">
                <div className="bg-gray-50 p-3 rounded border">
                  <div className="flex items-center justify-between">
                    <div className="flex items-center gap-2">
                      <div className="w-7 h-7 rounded-full bg-gray-600 text-white flex justify-center items-center text-sm font-bold">{generateAvatar(r.name)}</div>
                      <div className="text-sm font-semibold text-gray-700">{r.name}</div>
                    </div>
                    <div className="text-xs text-gray-500">{timeAgo(r.date)}</div>
                  </div>
                  <p className="mt-1 text-sm text-gray-700 whitespace-pre-line">{r.comment}</p>
                  <div className="mt-1 flex gap-3 text-xs text-gray-600">
                    <button onClick={() => likeComment(r.id)}>â¤ï¸ {r.likes}</button>
                    <button onClick={() => deleteComment(r.id)}>ğŸ—‘ï¸ ××—×§</button>
                  </div>
                </div>
              </div>
            ))}
          </div>
        ))}
      </div>
    </div>
  );
}

/////////////
C:\Users\yosef\Desktop\onmotor-media - Copy\components\CommentsSection.jsx
'use client';
import React from 'react';
import CommentForm from './CommentForm';
import FacebookComments from './FacebookComments';

// ×›××Ÿ ×× ×—× ×• ×× ×™×—×™× ×©Ö¾articleUrl ××©××© ×›Ö¾slug ×©×œ ×”×›×ª×‘×” ×•××©××© ×’× ×›Ö¾articleId
export default function CommentsSection({ articleUrl }) {
  const articleId = articleUrl; // ××¤×©×¨ ×œ×©× ×•×ª ××ª ×”×©× ×× ×ª×¨×¦×”

  return (
    <div className="flex flex-col lg:flex-row gap-10 mt-12" dir="rtl">
      
      {/* ×¦×“ ×©×××œ: ×ª×’×•×‘×•×ª ×§×™×™××•×ª + ×¤×™×™×¡×‘×•×§ */}      
      <div className="lg:w-1/2 w-full space-y-6">
        <h3 className="text-xl font-bold border-red-600 border-t-2 pb-2">×ª×’×•×‘×•×ª ×”×’×•×œ×©×™×</h3>

        
        {/* ×ª×’×•×‘×•×ª ×¤×™×™×¡×‘×•×§ */}
        <FacebookComments url={articleUrl} />
      </div>

      {/* ×¦×“ ×™××™×Ÿ: ×˜×•×¤×¡ ×”×©××¨×ª ×ª×’×•×‘×” (×›×•×œ×œ articleId) */}
      <div className="lg:w-1/2 w-full">
        <CommentForm articleId={articleId} />
      </div>
    </div>
  );
}



// components/MainGridContentDesktop.jsx
'use client';
import React, { useEffect, useState } from 'react';
import ArticleCard from './ArticleCards/ArticleCard';
import SectionWithHeader from './SectionWithHeader';
import useIsMobile from '@/hooks/useIsMobile';
import SidebarFixed from './SidebarFixed';
import LeftSidebar from './LeftSidebar';

const API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL;

export default function MainGridContent() {
  const isMobile = useIsMobile();
  const [articles, setArticles] = useState([]);
  const [loading, setLoading] = useState(true);
  const [offsetY, setOffsetY] = useState(0);

  useEffect(() => {
    const handleScroll = () => {
      setOffsetY(window.scrollY * 0.3);
    };
    window.addEventListener("scroll", handleScroll);
    return () => window.removeEventListener("scroll", handleScroll);
  }, []);

  useEffect(() => {
    async function fetchArticles() {
      try {
        const res = await fetch(`${API_URL}/api/articles?populate=*`);
        const json = await res.json();

        const mapped = json.data?.map((a) => {
          return {
            id: a.id,
                title: a.title,
                slug: a.slug,
                image: a.image?.url ? `${API_URL}${a.image.url}` : '/default-image.jpg',
                imageAlt: a.imageAlt || '',
                category: a.category || 'general',
                subcategory: Array.isArray(a.subcategory)
                  ? a.subcategory
                  : [a.subcategory ?? 'general'],
                description: a.description,
                headline: a.headline || a.title,
                subdescription: a.subdescription,
                href: `/articles/${a.slug}`,
                tags: a.tags || [],
          };
        }) || [];

        setArticles(mapped);
      } catch (err) {
        console.error("âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×›×ª×‘×•×ª:", err);
      } finally {
        setLoading(false);
      }
    }

    fetchArticles();
  }, []);

  const categories = [...new Set(articles.map(article => article.category))];

  return (
    <div className="w-full flex flex-col xl:flex-row h-auto min-h-screen bg-gray-100">
      {/* ×ª×•×›×Ÿ ×¨××©×™ (×™××™×Ÿ) */}
      <div className="xl:w-1/2 flex-shrink-0 px-0 sm:px-0 py-0 lg:border-l xl:border-red-500">
        <div className="bg-white p-2 rounded-xl shadow space-y-0">
          {categories.map(category => (
            <div key={category}>
              <SectionWithHeader title={category} href={`/${category}`} />
              <div className="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-0">
                {articles
                  .filter(article => article.category === category && article.slug && article.href)
                  .map(article => (
                    <ArticleCard key={article.slug || article.id} article={article} />
                  ))}
              </div>
            </div>
          ))}
        </div>
      </div>

      {/* ×‘×œ×•×§×™× ×¦×“×“×™×™× */}
      {isMobile ? (
        <div className="w-full flex flex-col gap-6 px-0 sm:px-0 py-0">
          <SidebarFixed />
        <div className="w-[300px] h-fit sticky top-0">
          <LeftSidebar />
        </div>

        </div>
      ) : (
        <>
          <div className="xl:w-1/4 flex-shrink-0 px-0 sm:px-0 py-0 border-l border-red-500">
            <SidebarFixed />
          </div>
          <div className="lg:w-1/4 flex-shrink-0 px-0 sm:px-0 py-0 border-red-500">
            <LeftSidebar />
          </div>
        </>
      )}
    </div>
  );
}

////////////////
//components\ArticleCards\ArticleCard.jsx
'use client';
import React, { useState } from 'react';
import Link from 'next/link';
import Image from 'next/image';

export default function ArticleCard({ article }) { // ×”-`article` ×›××Ÿ ×”×•× ×›×‘×¨ ×”××•×‘×™×™×§×˜ ×”×××•×¤×” ×™×©×™×¨×•×ª
  const [isTouched, setIsTouched] = useState(false);

  const handleTouchStart = () => setIsTouched(true);

  const showDescription = isTouched ? true : false;

  // ×”-imageUrl ×›×‘×¨ ×××•×¨ ×œ×”×™×•×ª ××œ× ×•××¢×•×‘×“ ×‘-MainGridContentDesktop
  // ×”-API_URL ×›×‘×¨ ×›×œ×•×œ ×‘-imageUrl
  const imageUrl = article.image; // ×’×™×©×” ×™×©×™×¨×” ×œ-image ×›×™ ×”×•× ×›×‘×¨ URL ××œ×
  const imageAltText = article.imageAlt || article.title || 'Article image'; // ×’×™×©×” ×™×©×™×¨×” ×œ-imageAlt/title

  return (
    <Link
      href={article.href} // ×’×™×©×” ×™×©×™×¨×” ×œ-href
      className="group block relative overflow-hidden rounded-lg shadow-md transition-all duration-300 hover:shadow-xl"
      onTouchStart={handleTouchStart}
    >
      <div className="relative aspect-[1/1] w-full">
        {imageUrl && typeof imageUrl === 'string' && imageUrl !== '/default-image.jpg' ? ( // ×•×“× ×©×™×© URL ×•×–×” ×œ× ×ª××•× ×ª ×‘×¨×™×¨×ª ××—×“×œ ×¨×™×§×”
          <Image
            src={imageUrl}
            alt={imageAltText}
            fill
            className="object-cover w-full h-full group-hover:scale-105 transition-transform duration-300"
          />
        ) : (
          <div className="flex items-center justify-center h-full bg-gray-200 text-gray-500">
            ××™×Ÿ ×ª××•× ×”
          </div>
        )}

        <div
          className={`absolute bottom-0 w-full text-white p-4 transition-all duration-300
          ${showDescription ? 'bg-[#e60000]/150' : 'bg-gradient-to-t from-black/90 via-black/70 to-transparent group-hover:bg-[#e60000]/90'}`}
        >
          <h3 className={`text-lg font-bold transition-all duration-300 ${showDescription ? 'mb-2' : 'group-hover:mb-2'}`}>
            {article.title} {/* ×’×™×©×” ×™×©×™×¨×” ×œ-title */}
          </h3>

          <p className={`text-sm overflow-hidden transition-all duration-300
            ${showDescription ? 'max-h-20 opacity-100' : 'max-h-0 opacity-0 group-hover:max-h-20 group-hover:opacity-100'}`}>
            {article.description} {/* ×’×™×©×” ×™×©×™×¨×” ×œ-description */}
          </p>
        </div>
      </div>
    </Link>
  );
}

///
import MainGridContentMobile from '@/components/MainGridContentMobile';
<div className="xl:hidden">
        <MainGridContentMobile articles={articles} />
      </div>
////
//components\MainGridContentMobile.jsx
'use client';
import React from 'react';

import articles from '@/data/articles';
export default function MainGridContentMobile() {
  const categories = [...new Set(articles.map(article => article.category))];

  return (
    <div className="w-full px-0 md:px-0 overflow-x-hidden" dir="rtl">
      
    </div>
  );
}
///

// components/LeftSidebar.jsx
'use client';
import React, { useState, useEffect } from 'react';
import Image from 'next/image';

const tabs = ['××—×¨×•× ×™×', '×¤×•×¤×•×œ×¨×™', '×ª×’×•×‘×•×ª'];
const API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL;

export default function LeftSidebar() {
  const [activeTab, setActiveTab] = useState('×ª×’×•×‘×•×ª');
  const [articles, setArticles] = useState([]);

  useEffect(() => {
    async function fetchArticles() {
      try {
        const res = await fetch(`${API_URL}/api/articles?populate=*`);
        const json = await res.json();
        const data = json.data || [];

        const mapped = data.map((a) => ({
          id: a.id,
          title: a.title,
          slug: a.slug,
          image: a.image?.data?.attributes?.url || '/default-image.jpg',
          date: a.publishedAt?.split('T')[0] || '',
          category: a.category || '××—×¨×•× ×™×',
        }));

        setArticles(mapped);
      } catch (err) {
        console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ×›×ª×‘×•×ª ××”Ö¾Strapi:', err);
      }
    }

    fetchArticles();
  }, []);

  const filteredArticles = articles.filter((a) => a.category === activeTab);

  return (
    <div className="flex flex-col min-h-0 bg-white rounded-xl shadow-md w-full overflow-hidden text-sm">
      {/* ×˜××‘×™× */}
      <div className="flex border-b text-sm font-semibold" dir="rtl">
        {tabs.map((tab) => (
          <button
            key={tab}
            onClick={() => setActiveTab(tab)}
            className={`w-1/3 text-center py-2 ${
              activeTab === tab
                ? 'text-black border-b-2 border-red-500 bg-white'
                : 'text-gray-500 bg-gray-100'
            }`}
          >
            {tab}
          </button>
        ))}
      </div>

      {/* ×›×ª×‘×•×ª */}
      <div className="p-3 space-y-3 flex-1" dir="rtl">
        <h4 className="font-bold text-base px-1">×ª×’×™×•×ª</h4>
        <div className="space-y-3">
          {filteredArticles.slice(0, 5).map((article) => (
            <a
              key={article.id}
              href={`/articles/${article.slug}`}
              className="flex gap-3 items-start hover:opacity-90"
            >
              <div className="w-20 h-14 relative rounded overflow-hidden flex-shrink-0">
                <Image
                  src={article.image}
                  alt={article.title}
                  layout="fill"
                  objectFit="cover"
                  className="rounded"
                />
              </div>
              <div className="flex flex-col text-right">
                <p className="font-semibold text-sm leading-snug line-clamp-2">
                  {article.title}
                </p>
                <span className="text-xs text-gray-500 mt-1">{article.date}</span>
              </div>
            </a>
          ))}
        </div>
      </div>
    </div>
  );
}
//////////////////

////components\ArticleCards\ArticleCard.jsx
'use client';
import React, { useState } from 'react';
import Link from 'next/link';
import Image from 'next/image';

export default function ArticleCard({ article }) {
  const [isTouched, setIsTouched] = useState(false);

  const handleTouchStart = () => setIsTouched(true);
  // ××•×¤×¦×™×•× ×œ×™: ×›×“×™ ×œ×¡×’×•×¨ ×‘×—×–×¨×” ××—×¨×™ ××’×¢
  // const handleTouchEnd = () => setIsTouched(false);

  const showDescription = isTouched ? true : false;

  return (
    <Link
      href={article.href}
      className="group block relative overflow-hidden rounded-lg shadow-md transition-all duration-300 hover:shadow-xl"
      onTouchStart={handleTouchStart}
    >
      <div className="relative h-64">
        <Image
          src={article.image}
          alt={article.title}
          fill
          className="object-cover w-full h-full group-hover:scale-105 transition-transform duration-300"
        />
        
        {/* ×©×›×‘×ª ×¨×§×¢ ××“×•××” ×‘×©×§×™×¤×•×ª ×”×“×¨×’×ª×™×ª */}
        <div
          className={`absolute bottom-0 w-full text-white p-4 transition-all duration-300
          ${showDescription ? 'bg-[#e60000]/150' : 'bg-gradient-to-t from-black/90 via-black/70 to-transparent group-hover:bg-[#e60000]/90'}`}
        >
          <h3 className={`text-lg font-bold transition-all duration-300 ${showDescription ? 'mb-2' : 'group-hover:mb-2'}`}>
            {article.title}
          </h3>

          <p className={`text-sm overflow-hidden transition-all duration-300 
            ${showDescription ? 'max-h-20 opacity-100' : 'max-h-0 opacity-0 group-hover:max-h-20 group-hover:opacity-100'}`}>
            {article.description}
          </p>
        </div>
      </div>
    </Link>
  );
}

//////////////
// components/MainGridContentDesktop.jsx
'use client';
import React, { useEffect, useState } from 'react';
import ArticleCard from './ArticleCards/ArticleCard';
import SectionWithHeader from './SectionWithHeader';
import useIsMobile from '@/hooks/useIsMobile';
import SidebarFixed from './SidebarFixed';
import LeftSidebar from './LeftSidebar';

const API_URL = process.env.NEXT_PUBLIC_STRAPI_API_URL;

export default function MainGridContent() {
  const isMobile = useIsMobile();
  const [articles, setArticles] = useState([]);
  const [loading, setLoading] = useState(true);
  const [offsetY, setOffsetY] = useState(0);

  useEffect(() => {
    const handleScroll = () => {
      setOffsetY(window.scrollY * 0.3);
    };
    window.addEventListener("scroll", handleScroll);
    return () => window.removeEventListener("scroll", handleScroll);
  }, []);

  useEffect(() => {
    async function fetchArticles() {
      try {
        const res = await fetch(`${API_URL}/api/articles?populate=*`);
        const json = await res.json();

        const mapped = json.data?.map((item) => {
          return {
            title: item.title || '×œ×œ× ×›×•×ª×¨×ª',
            slug: item.slug,
            href: `/articles/${item.slug}`,
            image: item.imageSrc
              ? `${API_URL}${item.imageSrc}`
              : '/default-image.jpg',
            category: item.category || 'general',
            subcategory: Array.isArray(item.subcategory)
              ? item.subcategory
              : item.subcategory ? [item.subcategory] : ['×›×œ×œ×™'],
            description: item.description,
            ...item,
          };
        }) || [];

        setArticles(mapped);
      } catch (err) {
        console.error("âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×›×ª×‘×•×ª:", err);
      } finally {
        setLoading(false);
      }
    }

    fetchArticles();
  }, []);

  const categories = [...new Set(articles.map(article => article.category))];

  return (
    <div className="w-full flex flex-col xl:flex-row h-auto min-h-screen bg-gray-100">
      {/* ×ª×•×›×Ÿ ×¨××©×™ (×™××™×Ÿ) */}
      <div className="xl:w-1/2 flex-shrink-0 px-0 sm:px-0 py-0 lg:border-l xl:border-red-500">
        <div className="bg-white p-2 rounded-xl shadow space-y-1">
          {categories.map(category => (
            <div key={category}>
              <SectionWithHeader title={category} href={`/${category}`} />
              <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-1">
                {articles
                  .filter(article => article.category === category && article.slug && article.href)
                  .map(article => (
                    <ArticleCard key={article.slug || article.id} article={article} />
                  ))}
              </div>
            </div>
          ))}
        </div>
      </div>

      {/* ×‘×œ×•×§×™× ×¦×“×“×™×™× */}
      {isMobile ? (
        <div className="w-full flex flex-col gap-6 px-0 sm:px-0 py-0">
          <SidebarFixed />
          <LeftSidebar />
        </div>
      ) : (
        <>
          <div className="xl:w-1/4 flex-shrink-0 px-0 sm:px-0 py-0 border-l border-red-500">
            <SidebarFixed />
          </div>
          <div className="lg:w-1/4 flex-shrink-0 px-0 sm:px-0 py-0 border-red-500">
            <LeftSidebar />
          </div>
        </>
      )}
    </div>
  );
}



///////////////////
///app\articles\[slug]\page.jsx
import articlesData from '@/data/articles';
import PageContainer from "@/components/PageContainer";
import ArticleHeader from "@/components/ArticleHeader";
import SimpleKeyValueTable from "@/components/SimpleKeyValueTable";
import Tags from "@/components/Tags";
import SimilarArticles from "@/components/SimilarArticles";
import { notFound } from "next/navigation";
import CommentsSection from "@/components/CommentsSection";
import InlineImage from "@/components/InlineImage";
import Gallery from "@/components/Gallery";
import categoryLabels from '@/data/categoryLabels'; // âœ… ××™×™×‘××™× ××ª ×”××™×œ×•×Ÿ

export default function ArticlePage({ params }) {
  const rawArticle = articlesData.find((a) => a.slug === params.slug);
  if (!rawArticle) return notFound();

  const defaultArticle = {
    title: "×›×ª×‘×” ×œ×œ× ×›×•×ª×¨×ª",
    description: "××™×Ÿ ×ª×™××•×¨ ×–××™×Ÿ",
    image: "/default-image.jpg",
    imageSrc: "/default-image.jpg",
    imageAlt: "×ª××•× ×” ×›×œ×œ×™×ª",
    author: "××¢×¨×›×ª OnMotor",
    date: "2025-06-22",
    time: "10:00",
    tags: [],
    content: "",
    tableData: {},
    href: "",
    category: "general",
    subcategory: "general",
    headline: "×›×•×ª×¨×ª ×‘×ª×•×š ×”×›×ª×‘×”",
    subdescription: "",
  };

  const article = { ...defaultArticle, ...rawArticle };
  const paragraphs = article.content?.split("\n\n") || [];

  // âœ… ×™×¦×™×¨×ª × ×ª×™×‘ ×“×™× ××™ ×œÖ¾breadcrumbs
  const breadcrumbs = [
    { label: "×“×£ ×”×‘×™×ª", href: "/" },
  ];

  if (article.category) {
    breadcrumbs.push({
      label: categoryLabels[article.category] || article.category,
      href: `/${article.category}`,
    });
  }

  if (article.subcategory) {
    breadcrumbs.push({
      label: categoryLabels[article.subcategory] || article.subcategory,
      href: `/${article.category}/${article.subcategory}`,
    });
  }

  breadcrumbs.push({ label: article.title });

  // âœ… ×¤×¡×§××•×ª (×˜×§×¡×˜ ××• ×ª××•× ×•×ª ××©×•×‘×¦×•×ª)
  const renderParagraph = (text, i) => {
    if (text.startsWith("[[img:") && text.endsWith("]]")) {
      const parts = text.slice(6, -2).split("|");
      const [src, alt = "", caption = ""] = parts;
      return (
        <InlineImage key={i} src={src.trim()} alt={alt.trim()} caption={caption.trim()} />
      );
    }
    return (
      <p key={i} className="text-gray-800 text-2xl leading-relaxed">{text}</p>
    );
  };

  return (
    <PageContainer title={article.title} breadcrumbs={breadcrumbs}>
      <div className="mx-auto max-w-[740px] space-y-6 text-right leading-relaxed text-base text-gray-800">
        <ArticleHeader
          author={article.author}
          date={article.date}
          time={article.time}
          image={article.image}
          imageSrc={article.imageSrc}
          imageAlt={article.imageAlt}
          title={article.headline || article.title}
          subdescription={article.subdescription}
        />

        {article.description && (
          <p className="font-bold text-3xl text-gray-800">{article.description}</p>
        )}

        {paragraphs.map(renderParagraph)}

        {article.tableData && <SimpleKeyValueTable data={article.tableData} />}

        <Gallery galleryPath={article.galleryPath || `/images/articles/${article.slug}/gallery`} />

        <Tags tags={article.tags} />

        <SimilarArticles currentSlug={article.slug} category={article.category} />

        <CommentsSection articleUrl={`https://onmotor-media.com${article.href}`} />
      </div>
    </PageContainer>
  );
}


/////////
// components/AuthBox.jsx
'use client';

import React, { useState, useEffect, useRef } from 'react';
import useIsMobile from '@/hooks/useIsMobile';
import { FaChevronUp } from 'react-icons/fa';
import { loginUser, logoutUser, getCurrentUser } from '@/utils/auth';
import { useRouter } from 'next/navigation';

export default function AuthBox({ mode = 'inline', boxRef }) {
  const isMobile = useIsMobile();
  const router = useRouter();
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [rememberMe, setRememberMe] = useState(false);
  const [loginError, setLoginError] = useState('');
  const [loginSuccess, setLoginSuccess] = useState(false);
  const [isOpen, setIsOpen] = useState(true);
  const [user, setUser] = useState(null);
  const [isLoadingLogin, setIsLoadingLogin] = useState(false);

  const [showReset, setShowReset] = useState(false);
  const [resetEmail, setResetEmail] = useState('');
  const [resetStatus, setResetStatus] = useState('');
  const [isLoadingReset, setIsLoadingReset] = useState(false);

  const [showRegister, setShowRegister] = useState(false);
  const [registerEmail, setRegisterEmail] = useState('');
  const [registerPassword, setRegisterPassword] = useState('');
  const [registerConfirm, setRegisterConfirm] = useState('');
  const [registerStatus, setRegisterStatus] = useState('');
  const [isLoadingRegister, setIsLoadingRegister] = useState(false);

  const [showChangePassword, setShowChangePassword] = useState(false);
  const [currentPassword, setCurrentPassword] = useState('');
  const [newPassword, setNewPassword] = useState('');
  const [changeStatus, setChangeStatus] = useState('');
  const [isLoadingChangePassword, setIsLoadingChangePassword] = useState(false);

  const resetRef = useRef(null);
  const registerRef = useRef(null);
  const changePassRef = useRef(null);

  useEffect(() => {
    (async () => {
      const stored = await getCurrentUser();
      setUser(stored);
    })();
    const lastEmail = localStorage.getItem('lastEmail');
    if (lastEmail) setEmail(lastEmail);
  }, []);

  useEffect(() => {
    if (isMobile && isOpen && boxRef?.current) {
      boxRef.current.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  }, [isOpen, isMobile, boxRef, user]);

  useEffect(() => {
    if (showReset && resetRef.current) {
      resetRef.current.scrollIntoView({ behavior: 'smooth', block: 'end' });
    } else if (showRegister && registerRef.current) {
      registerRef.current.scrollIntoView({ behavior: 'smooth', block: 'end' });
    } else if (showChangePassword && changePassRef.current) {
      changePassRef.current.scrollIntoView({ behavior: 'smooth', block: 'end' });
    }
  }, [showReset, showRegister, showChangePassword]);

  const handleLogin = async () => {
    setIsLoadingLogin(true);
    try {
      const res = await fetch('/api/user/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password }),
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || 'Login failed');

      loginUser(data.user);
      setUser(data.user);
      if (rememberMe) localStorage.setItem('lastEmail', email);
      setLoginSuccess(true);
      setLoginError('');
    } catch (err) {
      setLoginError(err.message);
      setLoginSuccess(false);
    } finally {
      setIsLoadingLogin(false);
    }
  };

  const handleLogout = async () => {
    await logoutUser();
    localStorage.removeItem('lastEmail');
    setUser(null);
    router.refresh();
  };

  const handleDeleteAccount = async () => {
    if (!confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×”×—×©×‘×•×Ÿ?')) return;
    try {
      const res = await fetch('/api/user/delete', { method: 'DELETE' });
      if (!res.ok) throw new Error('Error deleting account');
      await logoutUser();
      setUser(null);
      alert('×”×—×©×‘×•×Ÿ × ××—×§ ×‘×”×¦×œ×—×”');
      router.refresh();
    } catch {
      alert('××™×¨×¢×” ×©×’×™××” ×‘××—×™×§×ª ×”×—×©×‘×•×Ÿ');
    }
  };

  const handleForgotPassword = async () => {
    setIsLoadingReset(true);
    setResetStatus('');
    const res = await fetch('/api/user/forgot-password', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email: resetEmail }),
    });
    setResetStatus(res.ok ? '× ×©×œ×—×” ×¡×™×¡××” ×—×“×©×” ×œ××™××™×™×œ ×©×œ×š' : '××™×¨×¢×” ×©×’×™××”');
    setIsLoadingReset(false);
  };

  const handleRegister = async () => {
    if (registerPassword !== registerConfirm) {
      setRegisterStatus('×”×¡×™×¡×××•×ª ×œ× ×ª×•×××•×ª');
      return;
    }
    setIsLoadingRegister(true);
    const res = await fetch('/api/user/register', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email: registerEmail, password: registerPassword }),
    });
    const data = await res.json();
    setRegisterStatus(res.ok ? '× ×¨×©××ª ×‘×”×¦×œ×—×”!' : data.error || '×©×’×™××” ×‘×”×¨×©××”');
    setIsLoadingRegister(false);
  };

  const handleChangePassword = async () => {
    setIsLoadingChangePassword(true);
    const res = await fetch('/api/user/change-password', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ currentPassword, newPassword }),
    });
    setChangeStatus(res.ok ? '×”×¡×™×¡××” ×¢×•×“×›× ×” ×‘×”×¦×œ×—×”' : '×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”×¡×™×¡××”');
    setIsLoadingChangePassword(false);
  };

  return (
    <div dir="rtl" className="text-center" ref={boxRef}>
      {isMobile && mode === 'side' && (
        <button
          onClick={() => setIsOpen(false)}
          className="text-sm bg-white text-black px-2 py-2 rounded shadow hover:bg-gray-200 transition"
        >
          ×¡×’×•×¨ <FaChevronUp className="inline" />
        </button>
      )}

      <div className="transition-all duration-500 ease-in-out overflow-hidden mt-2 max-w-md px-0 bg-white text-black border border-gray-300 rounded p-1 text-sm shadow-md">
        <h3 className="font-semibold text-black mb-6">
          {user ? '× ×™×”×•×œ ×—×©×‘×•×Ÿ' : '×”×ª×—×‘×¨×•×ª'}
        </h3>

        {user ? (
          <>
            <p className="mb-4">×©×œ×•×, {user.email}</p>
            <div className="flex flex-col gap-2 mb-4 items-center">
              <button
                onClick={handleLogout}
                className="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"
              >
                ×”×ª× ×ª×§
              </button>
              <button
                onClick={handleDeleteAccount}
                className="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700"
              >
                ××—×™×§×ª ×—×©×‘×•×Ÿ
              </button>
            </div>
            <div className="text-xs text-center space-x-2 flex justify-center">
              <button
                onClick={() => {
                  setShowChangePassword(true);
                  setShowReset(false);
                  setShowRegister(false);
                }}
                className="text-blue-600 underline"
              >
                ×©× ×” ×¡×™×¡××
              </button>
              <span>|</span>
              <button
                onClick={() => {
                  setShowReset(true);
                  setShowChangePassword(false);
                  setShowRegister(false);
                }}
                className="text-blue-600 underline"
              >
                ×©×›×—×ª×™ ×¡×™×¡××
              </button>
            </div>
          </>
        ) : (
          <>
            <input
              type="email"
              placeholder="××™××™×™×œ"
              value={email}
              onChange={e => setEmail(e.target.value)}
              className="w-[90%] px-2 py-1 mb-2 border border-gray-300 rounded text-right text-sm"
            />
            <input
              type="password"
              placeholder="×¡×™×¡××"
              value={password}
              onChange={e => setPassword(e.target.value)}
              className="w-[90%] px-2 py-1 mb-2 border border-gray-300 rounded text-right text-sm"
            />
            <div className="flex items-center justify-start mb-2">
              <input
                type="checkbox"
                id="rememberMe"
                checked={rememberMe}
                onChange={e => setRememberMe(e.target.checked)}
                className="ml-2"
              />
              <label htmlFor="rememberMe" className="text-sm text-black">×”×©××¨ ××—×•×‘×¨</label>
            </div>
            <button
              onClick={handleLogin}
              className="bg-[#e60000] text-white px-3 py-1 rounded hover:bg-red-700 text-sm w-full flex items-center justify-center"
            >
              {isLoadingLogin
                ? <span className="loader mr-2 w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></span>
                : '×”×ª×—×‘×¨'}
            </button>
            {loginError && <p className="text-red-600 mt-1 text-xs">{loginError}</p>}
            {loginSuccess && <p className="text-green-600 mt-1 text-xs">×”×ª×—×‘×¨×ª ×‘×”×¦×œ×—×”!</p>}

            <div className="mt-3 text-xs text-center space-x-1 flex flex-wrap justify-center">
              <button
                onClick={() => { setShowRegister(true); setShowReset(false); setShowChangePassword(false); }}
                className="text-blue-600 underline"
              >×¦×•×¨ ×—×©×‘×•×Ÿ</button>
              <span>|</span>
              <button
                onClick={() => { setShowReset(true); setShowRegister(false); setShowChangePassword(false); }}
                className="text-blue-600 underline"
              >×©×›×—×ª×™ ×¡×™×¡××”</button>
              <span>|</span>
              <button
                onClick={() => { setShowChangePassword(true); setShowReset(false); setShowRegister(false); }}
                className="text-blue-600 underline"
              >×©× ×” ×¡×™×¡××”</button>
            </div>
          </>
        )}

        


        {showReset && (
          <div ref={resetRef} className="mt-4 bg-gray-100 p-3 rounded text-right text-sm relative">
            <button onClick={() => setShowReset(false)} className="absolute top-2 left-2 text-gray-500 hover:text-black">âœ–</button>
            <h4 className="font-semibold mb-2 pr-6">×©×›×—×ª×™ ×¡×™×¡××”</h4>
            <input
              type="email"
              placeholder="××™××™×™×œ ×œ××™×¤×•×¡"
              value={resetEmail}
              onChange={e => setResetEmail(e.target.value)}
              className="w-full px-2 py-1 mb-2 border border-gray-300 rounded"
            />
            <button onClick={handleForgotPassword} className="bg-blue-600 text-white px-3 py-1 rounded text-sm">
              {isLoadingReset ? '×©×•×œ×—...' : '×©×œ×— ×¡×™×¡××” ×—×“×©×”'}
            </button>
            {resetStatus && <p className="text-green-600 mt-2 text-xs">{resetStatus}</p>}
          </div>
        )}

        {showRegister && (
          <div ref={registerRef} className="mt-4 bg-gray-100 p-3 rounded text-right text-sm relative">
            <button onClick={() => setShowRegister(false)} className="absolute top-2 left-2 text-gray-500 hover:text-black">âœ–</button>
            <h4 className="font-semibold mb-2 pr-6">×¦×•×¨ ×—×©×‘×•×Ÿ</h4>
            <input
              type="email"
              placeholder="××™××™×™×œ"
              value={registerEmail}
              onChange={e => setRegisterEmail(e.target.value)}
              className="w-full px-2 py-1 mb-2 border border-gray-300 rounded"
            />
            <input
              type="password"
              placeholder="×¡×™×¡××”"
              value={registerPassword}
              onChange={e => setRegisterPassword(e.target.value)}
              className="w-full px-2 py-1 mb-2 border border-gray-300 rounded"
            />
            <input
              type="password"
              placeholder="××™××•×ª ×¡×™×¡××”"
              value={registerConfirm}
              onChange={e => setRegisterConfirm(e.target.value)}
              className="w-full px-2 py-1 mb-2 border border-gray-300 rounded"
            />
            <button onClick={handleRegister} className="bg-green-600 text-white px-3 py-1 rounded text-sm">
              {isLoadingRegister ? '× ×¨×©×...' : '×”×¨×©××”'}
            </button>
            {registerStatus && <p className="text-green-600 mt-2 text-xs">{registerStatus}</p>}
          </div>
        )}

        {showChangePassword && (
          <div ref={changePassRef} className="mt-4 bg-gray-100 p-3 rounded text-right text-sm relative">
            <button onClick={() => setShowChangePassword(false)} className="absolute top-2 left-2 text-gray-500 hover:text-black">âœ–</button>
            <h4 className="font-semibold mb-2 pr-6">×©× ×” ×¡×™×¡××”</h4>
            <input
              type="password"
              placeholder="×¡×™×¡××” × ×•×›×—×™×ª"
              value={currentPassword}
              onChange={e => setCurrentPassword(e.target.value)}
              className="w-full px-2 py-1 mb-2 border border-gray-300 rounded"
            />
            <input
              type="password"
              placeholder="×¡×™×¡××” ×—×“×©×”"
              value={newPassword}
              onChange={e => setNewPassword(e.target.value)}
              className="w-full px-2 py-1 mb-2 border border-gray-300 rounded"
            />
            <button onClick={handleChangePassword} className="bg-yellow-600 text-white px-3 py-1 rounded text-sm">
              {isLoadingChangePassword ? '××¢×“×›×Ÿ...' : '×¢×“×›×Ÿ ×¡×™×¡××”'}
            </button>
            {changeStatus && <p className="text-green-600 mt-2 text-xs">{changeStatus}</p>}
          </div>
        )}
      </div>
    </div>
  );
}


// C:\Users\yosef\onmotor-media - Copy\components\AuthBox.jsx
'use client';

import React, { useState, useEffect, useRef } from 'react';
import useIsMobile from '@/hooks/useIsMobile';
import { FaChevronUp } from 'react-icons/fa';
import { loginUser, logoutUser, getCurrentUser } from '@/utils/auth';
import { useRouter } from 'next/navigation';

export default function AuthBox({ mode = 'inline', boxRef }) {
  const isMobile = useIsMobile();
  
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [rememberMe, setRememberMe] = useState(false);
  const [loginError, setLoginError] = useState('');
  const [loginSuccess, setLoginSuccess] = useState(false);
  const [isOpen, setIsOpen] = useState(true);
  const [user, setUser] = useState(null);
  const [isLoadingLogin, setIsLoadingLogin] = useState(false);

  const [showReset, setShowReset] = useState(false);
  const [resetEmail, setResetEmail] = useState('');
  const [resetStatus, setResetStatus] = useState('');
  const [isLoadingReset, setIsLoadingReset] = useState(false);

  const [showRegister, setShowRegister] = useState(false);
  const [registerEmail, setRegisterEmail] = useState('');
  const [registerPassword, setRegisterPassword] = useState('');
  const [registerConfirm, setRegisterConfirm] = useState('');
  const [registerStatus, setRegisterStatus] = useState('');
  const [isLoadingRegister, setIsLoadingRegister] = useState(false);

  const [showChangePassword, setShowChangePassword] = useState(false);
  const [currentPassword, setCurrentPassword] = useState('');
  const [newPassword, setNewPassword] = useState('');
  const [changeStatus, setChangeStatus] = useState('');
  const [isLoadingChangePassword, setIsLoadingChangePassword] = useState(false);

  const resetRef = useRef(null);
  const registerRef = useRef(null);
  const changePassRef = useRef(null);

  useEffect(() => {
    const stored = getCurrentUser();
    setUser(stored);
    const lastEmail = localStorage.getItem('lastEmail');
    if (lastEmail) setEmail(lastEmail);
  }, []);

  useEffect(() => {
    if (isMobile && isOpen && boxRef?.current) {
      boxRef.current.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  }, [isOpen, isMobile, boxRef, user]);

  useEffect(() => {
    if (showReset && resetRef.current) {
      resetRef.current.scrollIntoView({ behavior: 'smooth', block: 'end' });
    } else if (showRegister && registerRef.current) {
      registerRef.current.scrollIntoView({ behavior: 'smooth', block: 'end' });
    } else if (showChangePassword && changePassRef.current) {
      changePassRef.current.scrollIntoView({ behavior: 'smooth', block: 'end' });
    }
  }, [showReset, showRegister, showChangePassword]);

  const handleLogin = async () => {
    setIsLoadingLogin(true);
    try {
      const res = await fetch('/api/user/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password }),
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || 'Login failed');

      loginUser(data.user);
      setUser(data.user);
      if (rememberMe) localStorage.setItem('lastEmail', email);
      setLoginSuccess(true);
      setLoginError('');
    } catch (err) {
      setLoginError(err.message);
      setLoginSuccess(false);
    } finally {
      setIsLoadingLogin(false);
    }
  };

  const handleLogout = () => {
    logoutUser();
    localStorage.removeItem('lastEmail');
    setUser(null);
  };

  const handleDeleteAccount = async () => {
    if (!confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×”×—×©×‘×•×Ÿ?')) return;
    try {
      const res = await fetch('/api/user/delete', { method: 'DELETE' });
      if (!res.ok) throw new Error('Error deleting account');
      logoutUser();
      setUser(null);
      alert('×”×—×©×‘×•×Ÿ × ××—×§ ×‘×”×¦×œ×—×”');
    } catch {
      alert('××™×¨×¢×” ×©×’×™××” ×‘××—×™×§×ª ×”×—×©×‘×•×Ÿ');
    }
  };

  const handleForgotPassword = async () => {
    setIsLoadingReset(true);
    setResetStatus('');
    const res = await fetch('/api/user/forgot-password', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email: resetEmail }),
    });
    setResetStatus(res.ok ? '× ×©×œ×—×” ×¡×™×¡××” ×—×“×©×” ×œ××™××™×™×œ ×©×œ×š' : '××™×¨×¢×” ×©×’×™××”');
    setIsLoadingReset(false);
  };

  const handleRegister = async () => {
    if (registerPassword !== registerConfirm) {
      setRegisterStatus('×”×¡×™×¡×××•×ª ×œ× ×ª×•×××•×ª');
      return;
    }
    setIsLoadingRegister(true);
    const res = await fetch('/api/user/register', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email: registerEmail, password: registerPassword }),
    });
    const data = await res.json();
    setRegisterStatus(res.ok ? '× ×¨×©××ª ×‘×”×¦×œ×—×”!' : data.error || '×©×’×™××” ×‘×”×¨×©××”');
    setIsLoadingRegister(false);
  };

  const handleChangePassword = async () => {
    setIsLoadingChangePassword(true);
    const res = await fetch('/api/user/change-password', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ currentPassword, newPassword }),
    });
    setChangeStatus(res.ok ? '×”×¡×™×¡××” ×¢×•×“×›× ×” ×‘×”×¦×œ×—×”' : '×©×’×™××” ×‘×¢×“×›×•×Ÿ ×”×¡×™×¡××”');
    setIsLoadingChangePassword(false);
  };

  return (
    <div dir="rtl" className="text-center" ref={boxRef}>
      {isMobile && mode === 'side' && (
        <button
          onClick={() => setIsOpen(false)}
          className="text-sm bg-white text-black px-2 py-2 rounded shadow hover:bg-gray-200 transition"
        >
          ×¡×’×•×¨ <FaChevronUp className="inline" />
        </button>
      )}

      <div className="transition-all duration-500 ease-in-out overflow-hidden mt-2 max-w-md px-0 bg-white text-black border border-gray-300 rounded p-1 text-sm shadow-md">
        <h3 className="font-semibold text-black mb-6">
          {user ? '× ×™×”×•×œ ×—×©×‘×•×Ÿ' : '×”×ª×—×‘×¨×•×ª'}
        </h3>

        {user ? (
          <>
            <p className="mb-4">×©×œ×•×, {user.email}</p>
            <div className="flex flex-col gap-2 mb-4 items-center">
              <button
                onClick={handleLogout}
                className="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"
              >
                ×”×ª× ×ª×§
              </button>
              <button
                onClick={handleDeleteAccount}
                className="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700"
              >
                ××—×™×§×ª ×—×©×‘×•×Ÿ
              </button>
            </div>
            <div className="text-xs text-center space-x-2 flex justify-center">
              <button
                onClick={() => {
                  setShowChangePassword(true);
                  setShowReset(false);
                  setShowRegister(false);
                }}
                className="text-blue-600 underline"
              >
                ×©× ×” ×¡×™×¡××
              </button>
              <span>|</span>
              <button
                onClick={() => {
                  setShowReset(true);
                  setShowChangePassword(false);
                  setShowRegister(false);
                }}
                className="text-blue-600 underline"
              >
                ×©×›×—×ª×™ ×¡×™×¡××
              </button>
            </div>
          </>
        ) : (
          <>
            <input
              type="email"
              placeholder="××™××™×™×œ"
              value={email}
              onChange={e => setEmail(e.target.value)}
              className="w-[90%] px-2 py-1 mb-2 border border-gray-300 rounded text-right text-sm"
            />
            <input
              type="password"
              placeholder="×¡×™×¡××"
              value={password}
              onChange={e => setPassword(e.target.value)}
              className="w-[90%] px-2 py-1 mb-2 border border-gray-300 rounded text-right text-sm"
            />
            <div className="flex items-center justify-start mb-2">
              <input
                type="checkbox"
                id="rememberMe"
                checked={rememberMe}
                onChange={e => setRememberMe(e.target.checked)}
                className="ml-2"
              />
              <label htmlFor="rememberMe" className="text-sm text-black">×”×©××¨ ××—×•×‘×¨</label>
            </div>
            <button
              onClick={handleLogin}
              className="bg-[#e60000] text-white px-3 py-1 rounded hover:bg-red-700 text-sm w-full flex items-center justify-center"
            >
              {isLoadingLogin
                ? <span className="loader mr-2 w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></span>
                : '×”×ª×—×‘×¨'}
            </button>
            {loginError && <p className="text-red-600 mt-1 text-xs">{loginError}</p>}
            {loginSuccess && <p className="text-green-600 mt-1 text-xs">×”×ª×—×‘×¨×ª ×‘×”×¦×œ×—×”!</p>}

            <div className="mt-3 text-xs text-center space-x-1 flex flex-wrap justify-center">
              <button
                onClick={() => { setShowRegister(true); setShowReset(false); setShowChangePassword(false); }}
                className="text-blue-600 underline"
              >×¦×•×¨ ×—×©×‘×•×Ÿ</button>
              <span>|</span>
              <button
                onClick={() => { setShowReset(true); setShowRegister(false); setShowChangePassword(false); }}
                className="text-blue-600 underline"
              >×©×›×—×ª×™ ×¡×™×¡××”</button>
              <span>|</span>
              <button
                onClick={() => { setShowChangePassword(true); setShowReset(false); setShowRegister(false); }}
                className="text-blue-600 underline"
              >×©× ×” ×¡×™×¡××”</button>
            </div>
          </>
        )}

        {showReset && (
          <div ref={resetRef} className="mt-4 bg-gray-100 p-3 rounded text-right text-sm relative">
            <button onClick={() => setShowReset(false)} className="absolute top-2 left-2 text-gray-500 hover:text-black">âœ–</button>
            <h4 className="font-semibold mb-2 pr-6">×©×›×—×ª×™ ×¡×™×¡××”</h4>
            <input
              type="email"
              placeholder="××™××™×™×œ ×œ××™×¤×•×¡"
              value={resetEmail}
              onChange={e => setResetEmail(e.target.value)}
              className="w-full px-2 py-1 mb-2 border border-gray-300 rounded"
            />
            <button onClick={handleForgotPassword} className="bg-blue-600 text-white px-3 py-1 rounded text-sm">
              {isLoadingReset ? '×©×•×œ×—...' : '×©×œ×— ×¡×™×¡××” ×—×“×©×”'}
            </button>
            {resetStatus && <p className="text-green-600 mt-2 text-xs">{resetStatus}</p>}
          </div>
        )}

        {showRegister && (
          <div ref={registerRef} className="mt-4 bg-gray-100 p-3 rounded text-right text-sm relative">
            <button onClick={() => setShowRegister(false)} className="absolute top-2 left-2 text-gray-500 hover:text-black">âœ–</button>
            <h4 className="font-semibold mb-2 pr-6">×¦×•×¨ ×—×©×‘×•×Ÿ</h4>
            <input
              type="email"
              placeholder="××™××™×™×œ"
              value={registerEmail}
              onChange={e => setRegisterEmail(e.target.value)}
              className="w-full px-2 py-1 mb-2 border border-gray-300 rounded"
            />
            <input
              type="password"
              placeholder="×¡×™×¡××”"
              value={registerPassword}
              onChange={e => setRegisterPassword(e.target.value)}
              className="w-full px-2 py-1 mb-2 border border-gray-300 rounded"
            />
            <input
              type="password"
              placeholder="××™××•×ª ×¡×™×¡××”"
              value={registerConfirm}
              onChange={e => setRegisterConfirm(e.target.value)}
              className="w-full px-2 py-1 mb-2 border border-gray-300 rounded"
            />
            <button onClick={handleRegister} className="bg-green-600 text-white px-3 py-1 rounded text-sm">
              {isLoadingRegister ? '× ×¨×©×...' : '×”×¨×©××”'}
            </button>
            {registerStatus && <p className="text-green-600 mt-2 text-xs">{registerStatus}</p>}
          </div>
        )}

        {showChangePassword && (
          <div ref={changePassRef} className="mt-4 bg-gray-100 p-3 rounded text-right text-sm relative">
            <button onClick={() => setShowChangePassword(false)} className="absolute top-2 left-2 text-gray-500 hover:text-black">âœ–</button>
            <h4 className="font-semibold mb-2 pr-6">×©× ×” ×¡×™×¡××”</h4>
            <input
              type="password"
              placeholder="×¡×™×¡××” × ×•×›×—×™×ª"
              value={currentPassword}
              onChange={e => setCurrentPassword(e.target.value)}
              className="w-full px-2 py-1 mb-2 border border-gray-300 rounded"
            />
            <input
              type="password"
              placeholder="×¡×™×¡××” ×—×“×©×”"
              value={newPassword}
              onChange={e => setNewPassword(e.target.value)}
              className="w-full px-2 py-1 mb-2 border border-gray-300 rounded"
            />
            <button onClick={handleChangePassword} className="bg-yellow-600 text-white px-3 py-1 rounded text-sm">
              {isLoadingChangePassword ? '××¢×“×›×Ÿ...' : '×¢×“×›×Ÿ ×¡×™×¡××”'}
            </button>
            {changeStatus && <p className="text-green-600 mt-2 text-xs">{changeStatus}</p>}
          </div>
        )}
      </div>
    </div>
  );
}



// File: strapi/config/database.js
module.exports = ({ env }) => ({
  connection: {
    client: 'sqlite',
    connection: {
      filename: env('DATABASE_FILENAME', '.tmp/data.db'),
    },
    useNullAsDefault: true,
  },
});


//data\articles\newsMotorcycle.js
const newsMotorcycle = [
{
  id: 101,
  slug: "ktm-990-duke-2024",
  title: "ktm-990-duke-2024 ",
  headline: "×”××”×¤×›×” ×‘×“×¨×š: ×”×›×™×¨×• ××ª ×”Ö¾KTM 990 DUKE ×”×—×“×© â€“ ×”×“×•×›×¡ ×—×–×¨ ×œ×›×‘×™×© ×—× ××ª××™×“",
  description: "×× ×—×©×‘×ª× ×©×›×‘×¨ ×¨××™×ª× ×”×›×•×œ ×‘×–×™×¨×ª ×”× ×™×™×§×“ ×”×‘×™× ×•× ×™×™×...",
  subdescription: "×‘-×§×˜× ×œ× ××—×›×™× ×œ××ª×—×¨×™× ×•×™×¦××• ×¢× ××›×•× ×” ×©××¢×œ×” ×¢×¨×’×•× ×•×ª",
  href: "/articles/ktm-990-duke-2024",
  image: "/images/articles/ktm-990-duke-2024/ktm990.jpg",
  imageSrc: "/images/articles/ktm-990-duke-2024/ktm990-main.jpg",
  galleryPath: "/images/articles/ktm-990-duke-2024/gallery",
  imageAlt: "×”Ö¾KTM 990 Duke ×”×—×“×© ×‘×¤×¢×•×œ×”",

  category: "news",
  subcategory: ["global",],

  display: {
    homepage: true,
    sidebar: false,
    mainSlider: true,
    newsletter: false
  },

  priority: 1,

  author: "×™×•×¡×£ ×¡×‘×’",
  date: "22.06.2025",
  time: "14:50",
  tags: ["KTM", "DUKE", "××•×¤× ×•×¢×™×"],
  content: "   ",

 tableData: {
      "× ×¤×— ×× ×•×¢": "947 ×¡×\"×§",
      "×ª×¦×•×¨×ª ×× ×•×¢": "×˜×•×•×™×Ÿ ××§×‘×™×œ×™, 4 ×¤×¢×™××•×ª, 8 ×©×¡×ª×•××™×",
      "×”×¡×¤×§ ××¨×‘×™": "123 ×›\"×¡ @ 9,500 ×¡×œ\"×“",
      "××•×× ×˜ ××¨×‘×™": "10.3 ×§×’\"× @ 6,750 ×¡×œ\"×“",
      "×”×™×œ×•×›×™×": "6 ×”×™×œ×•×›×™× ×¢× quickshifter ×“×•-×›×™×•×•× ×™",
      "××¢×¨×›×ª ×§×™×¨×•×¨": "×§×™×¨×•×¨ ××™×",
      "×©×œ×“×”": "××¡×‘×š ×›×¨×•××•×œ (Chromoly Trellis Frame)",
      "××©×§×œ ×™×‘×©": "179 ×§\"×’",
      "××©×§×œ ×¨×˜×•×‘": "×›Ö¾199 ×§\"×’",
      "××™×›×œ ×“×œ×§": "14 ×œ×™×˜×¨",
      "×¦×¨×™×›×ª ×“×œ×§ ×××•×¦×¢×ª": "×›Ö¾4.5 ×œ'/100 ×§\"×",
      "×§×•×˜×¨ ×’×œ×’×œ ×§×“××™": "17 ××™× ×¥'",
      "×§×•×˜×¨ ×’×œ×’×œ ××—×•×¨×™": "17 ××™× ×¥'",
      "×¦××™×’ ×§×“××™": "120/70-ZR17",
      "×¦××™×’ ××—×•×¨×™": "180/55-ZR17",
      "×‘×•×œ× ×§×“××™": "WP APEX 43 ×\"×, ×”×¤×™×š, ×›×•×•× ×•×Ÿ ××œ×",
      "×‘×•×œ× ××—×•×¨×™": "WP APEX, ×–×¨×•×¢ ××—×ª, ×›×•×•× ×•×Ÿ ××œ×",
      "×‘×œ××™× ×§×“××™×™×": "Brembo, ×“×™×¡×§ ×›×¤×•×œ 300 ×\"×",
      "×‘×œ× ××—×•×¨×™": "×“×™×¡×§ ×‘×•×“×“ 240 ×\"×",
      "××¢×¨×›×•×ª ×¢×–×¨": "ABS ×‘×¤× ×™×™×”, ×‘×§×¨×ª ××—×™×–×”, ×•×•×™×œ×™, ×–×™× ×•×§, ×¨×›×™×‘×”, ×©×™×•×˜, ××¡×š TFT",
      "×’×•×‘×” ××•×©×‘": "825 ×\"×",
      "×‘×¡×™×¡ ×’×œ×’×œ×™×": "1,482 ×\"×",
      "××¨×•×•×— ×’×—×•×Ÿ": "186 ×\"×",
      "××¢×¨×›×ª ×ª××•×¨×”": "LED ××œ××” ×›×•×œ×œ DRL",
      "××—×™×¨ ×‘×™×©×¨××œ (×”×¢×¨×›×”)": "×›Ö¾89,000 ×©\"×—"
    }
  },
  {
  id: 102,
  slug: "new-moto-parking-tlv",
  title: "×—× ×™×•×Ÿ ×—×“×© ×œ××•×¤× ×•×¢×™× ×‘×ª×œ ××‘×™×‘",
  headline: "×¤×ª×¨×•×Ÿ ×—×“×© ×œ×¨×•×›×‘×™×: ×—× ×™×•×Ÿ ×™×™×¢×•×“×™ ×œ××•×¤× ×•×¢×™× × ×¤×ª×— ×‘×“×¨×•× ×ª×œ ××‘×™×‘",
  description: "××—×¨×™ ×©× ×™× ×©×œ ×ª×œ×•× ×•×ª ××¦×“ ×¨×•×›×‘×™ ×“×•Ö¾×’×œ×’×œ×™, ×”×¢×™×¨ ×ª×œ ××‘×™×‘ ×—×•× ×›×ª ×—× ×™×•×Ÿ ×—×“×© ×•×™×™×¢×•×“×™ ×œ××•×¤× ×•×¢×™× ×‘×©×›×•× ×ª ×¤×œ×•×¨× ×˜×™×Ÿ.",
  subdescription: "×”×—× ×™×•×Ÿ ××¦×™×¢ ×¢×©×¨×•×ª ××§×•××•×ª ×—× ×™×™×”, ××¦×œ××•×ª ××‘×˜×—×” ×•×¢××“×•×ª ×˜×¢×™× ×” ×œ×›×œ×™× ×—×©××œ×™×™×.",
  href: "/articles/new-moto-parking-tlv",
  image: "/images/articles/new-moto-parking-tlv/parking.jpg",
  imageSrc: "/images/articles/new-moto-parking-tlv/parking-main.jpg",
  galleryPath: "/images/articles/new-moto-parking-tlv/gallery",
  imageAlt: "×—× ×™×•×Ÿ ××•×¤× ×•×¢×™× ×™×™×¢×•×“×™ ×—×“×© ×‘×“×¨×•× ×ª×œ ××‘×™×‘",

  category: "news",
  subcategory: ["local"],

  display: {
    homepage: true,
    sidebar: true,
    mainSlider: false,
    newsletter: false
  },

  priority: 2,

  author: "×™×•×¡×£ ×¡×‘×’",
  date: "29.06.2025",
  time: "14:30",
  tags: ["", " ", ""],
  content:"    " ,
ğŸ“ 

  tableData: {
    " " : " ",
    " ": " "}
}
];

export default newsMotorcycle;



// app/api/register/route.js
import fs from 'fs';
import path from 'path';
import bcrypt from 'bcryptjs';
import { sendEmail } from '@/utils/mailer';
import { buildEmailTemplate } from '@/utils/emailTemplate';


const usersPath = path.join(process.cwd(), 'data', 'users.json');

function readUsers() {
  if (!fs.existsSync(usersPath)) return [];
  return JSON.parse(fs.readFileSync(usersPath, 'utf-8'));
}

function writeUsers(users) {
  fs.writeFileSync(usersPath, JSON.stringify(users, null, 2), 'utf-8');
}

export async function POST(request) {
  const { email, password } = await request.json();

  if (!email || !password) {
    return new Response(JSON.stringify({ error: '×—×¡×¨ ××™××™×™×œ ××• ×¡×™×¡××”' }), { status: 400 });
  }

  const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{6,}$/;
  if (!passwordRegex.test(password)) {
    return new Response(JSON.stringify({
      error: '×”×¡×™×¡××” ×—×™×™×‘×ª ×œ×”×›×™×œ ×œ×¤×—×•×ª 6 ×ª×•×•×™×, ×›×•×œ×œ ××•×ª ×’×“×•×œ×”, ××•×ª ×§×˜× ×” ×•××¡×¤×¨'
    }), { status: 400 });
  }

  const users = readUsers();
  const emailExists = users.find(u => u.email === email);

  if (emailExists) {
    return new Response(JSON.stringify({ error: '××™××™×™×œ ×›×‘×¨ ×¨×©×•×' }), { status: 409 });
  }

  const hashedPassword = await bcrypt.hash(password, 10);
  const newUser = {
    id: Date.now(),
    email,
    password: hashedPassword
  };

  users.push(newUser);
  writeUsers(users);

  try {
    await sendEmail({
  to: email,
  subject: '×‘×¨×•×š ×”×‘× ×œ-OnMotor Media',
  html: buildEmailTemplate(email, '×‘×¨×•×š ×”×‘× ×œÖ¾OnMotor Media', `
    <p>×ª×•×“×” ×©× ×¨×©××ª ×œ××ª×¨ <strong>OnMotor Media</strong>!</p>
    <p>×©××—×™× ×©×”×¦×˜×¨×¤×ª ×œ××©×¤×—×ª ×”×¨×•×›×‘×™× ×©×œ× ×• ğŸï¸</p>
    <a href="https://onmotormedia.com" style="
      display:inline-block;
      margin-top:20px;
      background:#d32f2f;
      color:white;
      padding:10px 20px;
      text-decoration:none;
      border-radius:5px;
      font-weight:bold;">×›× ×™×¡×” ×œ××ª×¨</a>
  `)
});

  } catch (err) {
    console.error('Failed to send welcome email:', err);
  }

  return new Response(JSON.stringify({ success: true, user: { email } }), {
    status: 201,
    headers: { 'Content-Type': 'application/json' }
  });
}



×¤×§×•×“×•×ª
dot -Tpng tree.dot -o tree.png

npm run dev

×¡×™×›×•×
.env (×‘×©×•×¨×©) ×¢× DATABASE_URL="file:./dev.db".

schema.prisma ×‘×ª×™×§×™×™×ª prisma/ ×›×¤×™ ×©×”×•×“×’×.

npx prisma migrate dev --name init ×›×“×™ ×œ×‘× ×•×ª ×”×›×œ.

npx prisma studio ×œ×•×•×™×“×•× ×•×¡×§×™×¨×ª ×”× ×ª×•× ×™×.

×™×™×‘×•× ×•×©×™××•×© ×‘Ö¾@prisma/client ×‘×§×•×“ ×©×œ×š.

×›×¢×ª ×™×© ×œ×š ×‘×¡×™×¡ × ×ª×•× ×™× SQLite ××§×•××™ ×•××•×›×Ÿ ×œ×¤×™×ª×•×—, ×¢× ××•×“×œ Article ×•×œ-Prisma Client ×–××™×Ÿ ×œ×›×œ ×§×¨×™××” ×•×›×ª×™×‘×”. ×‘×”×¦×œ×—×”!


AuthNewsletterBox  ××™×™×‘× ××œ×™×• ../hooks/useIsMobile ×¤×¢×™×œ 
// ××§×•×©×¨ ×œ
//maingridcompontent maingridcontentdesktop mobilemenu 
//slidingmobilemenu
// ×¨×›×™×‘ ×”×¨×©××” ×œ××ª×¨ ×•×œ×§×‘×œ×ª ×—×“×©×•×ª ×‘××™×™×œ 

ArticleCard    ×›×œ×•××¨ ×œ× ××™×™×‘× ×œ×‘×“ × ×§×¡×˜ ×•×›×• ×¤×¢×™×œ
// ××§×•×©×¨ ×œ maingridcontent&mobail&desktop
// ×¨×›×™×‘ ×œ××™×§×•× ×”×ª××•× ×” ×•×”×›×™×ª×•×‘ ×‘×›×ª×‘×•×ª ×‘×“×£ ×”×¨××©×™ ××¡×•×“×¨ ×›×‘×¨ ×œ××•×‘×™×™×œ ×•×œ××—×©×‘
// ×¨×›×™×‘ ×œ××™×§×•× ×”×ª××•× ×” ×‘×›×ª×‘×•×ª ××¡×•×“×¨ ×›×‘×¨ ×œ××•×‘×™×™×œ ×•×œ××—×©×‘

ClientLayout ×¤×¢×™×œ
// ×¤×¨×™×¡×” ×•××™×§×•× ×‘×“×£ ×”×¨××©×™, ×—×œ×•×§×” ×œ××‘× ×™×, ×—×œ×•×§×ª ×”×“×£ ×‘××—×©×‘
//××§×•×©×¨ Layout

FloatingArticles
//××§×•×©×¨  ×œ(pagecontablayout) ×œ× × ×‘×“×§

Footer
//×¤×©×•×˜ ×¤×•×˜×¨

Header
//×¨××©×™×ª ×¨×’×™×œ
//××§×•×©×¨ ×œ
//×× ×•×¢ ×—×™×¤×•×© - ×ª×¤×¨×™×˜ - ×ª×¤×¨×™×˜ × ×™×™×“ - ××™×™×§×•× ×™×

MainArticles
///×œ× ××§×•×©×¨ ×œ× ×¤×¢×™×œ

MainGridContent
///×œ× ××§×•×©×¨ ×œ× ×¤×¢×™×œ

MainGridContentDesktop
// ××§×•×©×¨ Page

MainGridContentMobile
// ××§×•×©×¨ Page


MobileMenu
//×ª×¤×¨×™×˜ × ×¤×ª×— ×‘× ×™×™×“ 
××§×•×©×¨ ×œ×”×“×¨

SlidingMobileMenu
/// ×œ× ××§×•×©×¨ ×œ× ×¤×¢×™×œ

MobileMenuButton
/// ×œ× ××§×•×©×¨ ×œ× ×¤×¢×™×œ

MobileSocialMenu
// ××§×•×©×¨ MobileMenu
// ××™×™×‘× SocialIcons

NavigationMenu
// ××§×•×©×¨ MobileMenu Header

NewsTicker
//××§×•×©×¨ ClientLayout

PageContentLayout   × ××—×§
// Page\news   C:\Users\yosef\onmotor-media - Copy\app\news\page.jsx × ××—×§  je

/////
SearchBar ××§×•×©×¨ ×¤×¢×™×œ
// header mobilemenu slidingmobilemenu  
×‘×”××©×š ×œ×©×œ×‘:
××™×™×§×•×Ÿ ×—×™×¤×•×© ğŸ”
×× ×™××¦×™×” ×œ×”×¦×¢×•×ª
×˜×¢×™× ×” ×Ö¾API
/////

SectionWithHeader ×œ× ××§×•×©×¨ ×œ× ×¤×¢×™×œ

SocialIcons ××§×•×©×¨ ×¤×¢×™×œ
//


PageContainer.jsx ×¤×¢×™×œ
//×©××© ×›×ª×‘× ×™×ª ×œ×›×œ ×¢××•×“ ×ª×•×›×Ÿ 

Breadcrumbs.jsx ×œ× ××§×•×©×¨ ×œ× ×¤×¢×™×œ
// ×‘××™×“×ª ×”×¦×•×¨×š (×œ××©×œ: "×“×£ ×”×‘×™×ª / ×—×“×©×•×ª / ×¡×§×™×¨×” ×—×“×©×”")

NewsContent
//×œ× ×¤×¢×™×œ

jsconfig.json ×¤×¢×™×œ 
// ×©×™×˜×” ×œ×™×‘×•×

searchSuggestions  //data\searchSuggestions.js
// × ×ª×•× ×™× ×œ×× ×•×¢ ×—×™×¤×•×© ××§×•×©×¨ ×œ searchbar

lib\generateSearchSuggestions.js
// ××™×™×¦×¨ ×“××˜×” ×œ×× ×•×¢ ×—×™×¤×•×© ××‘×•×¡×¡ ×ª×•×›×Ÿ ×§×™×™×/×ª×•×›×Ÿ ×—×“×©


////
// components/SimpleKeyValueTable.jsx 
×˜×‘×œ×” ×“×™× ××™×ª ×œ×¤×™ ××¤×ª×—×•×ª
////

/////
app/articles/[slug]/page.jsx ×§×•×‘×¥ ×›×ª×‘×” ×“×™× ××™×ª


/////

////
âœ…Gallery.jsx
×’×œ×¨×™×™×ª ×ª××•× ×•×ª
import Gallery from "@/components/Gallery";
{/* ğŸ–¼ï¸ ×’×œ×¨×™×” ×‘×¡×•×£ ×”×›×ª×‘×” ×× ×§×™×™××ª */}  ×‘×ª×—×ª×™×ª ArticlePage, ×œ×¤× ×™ </PageContainer>:
<Gallery images={article.gallery || []} />

///

/// 
âœ… components/InlineImage.jsx
import InlineImage from "@/components/InlineImage";
<InlineImage
  src="/images/articles/ktm990-mid.jpg"
  alt="KTM 990 - ××‘×˜ ×¦×“×“×™"
  caption="×”Ö¾KTM 990 ×‘×¤×•×–×™×¦×™×™×ª ×¤×¢×•×œ×”"
  [[img:/× ×ª×™×‘/×œ×ª××•× ×”.jpg|alt ×˜×§×¡×˜|×›×™×ª×•×‘ ××ª×—×ª ×œ×ª××•× ×”]]

/>
////


×©×œ×‘ 4 (×¨×©×•×ª): ××‘× ×” ×§×‘×¦×™× ××•×¦×¢
bash
Copy
Edit
/app
  /news/page.jsx
  /reviews/page.jsx
  /tips/page.jsx
  /gear/page.jsx

/components
  /CategoryPage.jsx
  /SectionWithHeader.jsx
  /ArticleCard.jsx

/data
  /articlesData.js


  ××‘× ×” ×§×‘×¦×™× ××•×¦×¢ ×œ×›×ª×‘×•×ª
  app/
â”œâ”€â”€ articles/
â”‚   â””â”€â”€ [slug]/
â”‚       â””â”€â”€ page.jsx         â† ×ª×¦×•×’×ª ×¢××•×“ ×”×›×ª×‘×”
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ArticleHeader.jsx     â† ×›×•×ª×‘ + ×ª××¨×™×š + ×©×¢×” + ×ª××•× ×” ×¨××©×™×ª
â”‚   â”œâ”€â”€ ArticleContent.jsx    â† ×’×•×£ ×”×›×ª×‘×” (×›×•×œ×œ ×˜×‘×œ×” ×“×™× ××™×ª)
â”‚   â”œâ”€â”€ Tags.jsx       â† ×ª×’×™×•×ª
â”‚   â”œâ”€â”€ RelatedArticles.jsx   â† ×›×ª×‘×•×ª ×§×©×•×¨×•×ª
â”‚   â”œâ”€â”€ CommentForm.jsx       â† ×˜×•×¤×¡ ×ª×’×•×‘×” ×¨×’×™×œ
â”‚   â””â”€â”€ FacebookComments.jsx  â† ×¤×œ××’×™×Ÿ ×¤×™×™×¡×‘×•×§
â”œâ”€â”€ data/
â”‚   â””â”€â”€ articlesData.js       â† × ×ª×•× ×™ ×›×ª×‘×•×ª

//////
app/
â”œâ”€â”€ articles/
â”‚   â””â”€â”€ [slug]/
â”‚       â””â”€â”€ page.jsx               â† ×“×£ ×”×›×ª×‘×” â€“ ×“×™× ××™ ×œ×¤×™ ×›×ª×•×‘×ª URL
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ PageContainer.jsx         â† ×¢×•×˜×£ ××ª ×”×“×£ ×›×•×œ×• (×›×•×ª×¨×ª + ×‘×¨×“×§×¨××‘×¡)
â”‚   â”œâ”€â”€ ArticleHeader.jsx         â† ××¦×™×’: ×©× ×”×›×•×ª×‘, ×ª××¨×™×š, ×©×¢×”, ×ª××•× ×” ×¨××©×™×ª
â”‚   â”œâ”€â”€ ArticleContent.jsx        â† ××¤×¦×œ ×œ×¤×¡×§××•×ª + ××¦×™×’ ××ª ×ª×•×›×Ÿ ×”×›×ª×‘×”
â”‚   â”œâ”€â”€ SimpleKeyValueTable.jsx   â† ×˜×‘×œ×ª × ×ª×•× ×™× ×“×™× ××™×ª ××ª×•×š ××™×œ×•×Ÿ
â”‚   â”œâ”€â”€ Tags.jsx           â† ××¦×™×’ ×ª×’×™×•×ª ×œ×—×™×¦×” ×¢× ×§×™×©×•×¨×™×
â”‚   â”œâ”€â”€SimilarArticles.jsx       â† ×›×ª×‘×•×ª ×“×•××•×ª (×œ×¤×™ ×§×˜×’×•×¨×™×” ××• ×ª×’×™×•×ª)
â”‚   â”œâ”€â”€ CommentForm.jsx           â† ×˜×•×¤×¡ ×ª×’×•×‘×” ×‘××ª×¨ (×©× + ×ª×•×›×Ÿ ×ª×’×•×‘×”)
â”‚   â””â”€â”€ FacebookComments.jsx      â† ×ª×’×•×‘×•×ª ×¤×™×™×¡×‘×•×§ (×¤×œ××’×™×Ÿ)

data/
â””â”€â”€ articlesData.js  â† ××§×•×¨ ×›×œ ×”× ×ª×•× ×™× ×©×œ ×”×›×ª×‘×•×ª (×›×•×œ×œ ×ª×•×›×Ÿ ××œ×, ×ª××•× ×•×ª, ×˜×‘×œ×”, ×›×•×ª×‘ ×•×›×•')

////
×§×©×¨×™× ×‘×™×Ÿ ×”×§×‘×¦×™× (×–×¨×™××ª × ×ª×•× ×™×)

page.jsx  â†  ×§×•×¨× ××ª ×›×œ ×”× ×ª×•× ×™× ×œ×¤×™ slug ××”Ö¾articlesData.js
   â””â”€â”€ PageContainer
       â”œâ”€â”€ ArticleHeader       â† ××§×‘×œ: author, date, time, image
       â”œâ”€â”€ ArticleContent      â† ××§×‘×œ: content (split ×œ×¤×¡×§××•×ª)
       â”œâ”€â”€ SimpleKeyValueTable â† ××§×‘×œ: tableData
       â”œâ”€â”€ Tags         â† ××§×‘×œ: tags
       â”œâ”€â”€ FacebookComments    â† ×§×‘×•×¢
       â”œâ”€â”€ CommentForm         â† ×§ // ×œ×˜×¤×œ ×‘×©××™×¨×ª ×ª×’×•×‘×•×ª ××• ××¢×¨×›×ª ×œ×‘×“×™×§×ª ×”×ª×’×•×‘×”// ×§×‘×•×¢
       â””â”€â”€ RelatedArticles     â† ××§×‘×œ: category / tags
///
components\CommentsSection.jsx
××‘× ×” ×ª×’×•×‘×•×ª
///

////
×¡×¤×¨ ×—×•×§×™× ××‘×•×¡×¡ ×‘×™× ×” ××œ××›×•×ª×™×ª
/app
â”‚
â”œâ”€â”€ /law-book                   â† ×¡×¤×¨ ×”×—×•×§×™× âœ…
â”‚   â”œâ”€â”€ page.jsx                â† ×¢××•×“ ×¨××©×™ ×©×œ ×”×§×˜×’×•×¨×™×” âœ…
â”‚   â”œâ”€â”€ ask-question.jsx        â† ×“×£ ×œ×©×œ×™×—×ª ×©××œ×” ×—×“×©×” (×™×›×•×œ ×œ×”×™×•×ª ××•×“×œ ××• ××–×•×¨ ×‘×“×£ ×”×¨××©×™) âœ…
â”‚   â””â”€â”€ /[questionId]           â† ×“×£ ×©×œ ×©××œ×” ×‘×•×“×“×ª (×“×™× ×××™) âœ…
â”‚       â””â”€â”€ page.jsx  âœ…
â”‚
â”œâ”€â”€ /api   âœ…
â”‚   â””â”€â”€ /law-book    âœ…  
â”‚       â””â”€â”€ ask.js              â† API Route ×©×©×•×œ×— ×©××œ×” ×œ-OpenAI ×•××—×–×™×¨ ×ª×©×•×‘×”  âœ…
â”‚
/components
â”œâ”€â”€ LawBookForm.jsx             â† ×¨×›×™×‘ ×ª×™×‘×ª ×©××œ×” âœ…
â”œâ”€â”€ LawBookAnswer.jsx           â† ×”×¦×’×ª ×ª×©×•×‘×” âœ…
â”œâ”€â”€ LawBookQuestionList.jsx     â† ×¨×©×™××ª ×©××œ×•×ª × ×¤×•×¦×•×ª âœ…
â””â”€â”€ Loader.jsx                  â† ×˜×•×¢×Ÿ (×¡×¤×™× ×¨) âœ…

âœ… ×¡×¤×¨ ×”×—×•×§×™× â€“ ×ª×©×ª×™×ª ×¨××©×•× ×™×ª (AI Q&A)

ğŸ“… ×ª××¨×™×š ×”×§××”: 2025-06-22  
âš™ï¸ ××¦×‘: ×”×•×§× ×‘×¡×™×¡ ××œ× â€“ ×¦×“ ×œ×§×•×— + API  
ğŸ“ ××™×§×•×: /app/law-book + /components + /api/law-book

---

law-book/page.jsx  â†  ×“×£ ×¨××©×™ ×¢× ×ª×™×‘×ª ×©××œ×” ×•×¨×©×™××ª ×©××œ×•×ª  
   â””â”€â”€ LawBookForm             â† ×˜×•×¤×¡ ×©××œ×” â†’ onQuestionSubmit  
       â””â”€â”€ Loader              â† ×× ×™××¦×™×™×ª ×˜×¢×™× ×”  
   â””â”€â”€ LawBookQuestionList     â† ××§×‘×œ: questions (××¢×¨×š ×©×œ ×©××œ×”+×ª×©×•×‘×”)

law-book/[questionId]/page.jsx  â†  ×“×£ ×œ×©××œ×” ×‘×•×“×“×ª  
   â””â”€â”€ LawBookAnswer           â† ××§×‘×œ: questionId â†’ ×ª×¦×•×’×” ×¢×ª×™×“×™×ª ×× ×ª×•× ×™ DB

api/law-book/ask.js  â†  API Route ×œ×©×œ×™×—×ª ×©××œ×” ×œÖ¾OpenAI  
   â†³ ××§×‘×œ POST ×¢× ×©××œ×”  
   â†³ ××—×–×™×¨ ×ª×©×•×‘×” ×Ö¾GPT ×¢× × ×™×¡×•×— ×¨×©××™, ××‘×•×¡×¡ ×—×•×§×™×  
   â†³ ×“×•×¨×© ×”×’×“×¨×ª ××©×ª× ×” ×¡×‘×™×‘×” OPENAI_API_KEY ×‘×§×•×‘×¥ .env.local

components/LawBookForm.jsx         â† ×˜×•×¤×¡ ×©××œ×” ×¢× textarea ×•×›×¤×ª×•×¨ ×©×œ×™×—×”  
components/LawBookQuestionList.jsx â† ××¦×™×’ ×©××œ×•×ª ×•×ª×©×•×‘×•×ª ×œ××—×¨ ×©×œ×™×—×”  
components/LawBookAnswer.jsx       â† ××¦×™×’ ×ª×©×•×‘×” ×‘×“×£ ×¢×¦×××™  
components/Loader.jsx              â† ×˜×•×¢×Ÿ... (×‘××”×œ×š ×©×œ×™×—×ª ×©××œ×”)

---

ğŸ› ï¸ ×”×¢×¨×•×ª:
â†’ ×—×•×‘×” ×œ×”×’×“×™×¨ `.env.local` ×¢×:
   OPENAI_API_KEY=your-key-here

â†’ ×‘×¢×ª×™×“:
   - ××—×¡×•×Ÿ × ×ª×•× ×™× ×‘Ö¾Supabase / MongoDB  
   - ×©×œ×™×¤×ª ×ª×©×•×‘×•×ª ×™×©× ×•×ª ×œ×¤×™ ×“××™×•×Ÿ ×©××œ×”  
   - ×ª×’×•×‘×•×ª ×’×•×œ×©×™× ×•×“×™×¨×•×’ ××™×›×•×ª ×ª×©×•×‘×”  
   - ××™× ×˜×’×¨×¦×™×” ×¢× ×× ×•×¢ RAG (×©×œ×™×¤×ª ×—×•×§×™× ×××¡××›×™×)

////××‘× ×” ×ª×™×§×™×•×ª ×œ×›×ª×‘×•×ª ×•×œ×›×œ ×¢××•×“
/components/ArticleCards
  ArticleCard.jsx              â† ×ª×¦×•×’×ª ×‘×¨×™×¨×ª ××—×“×œ (××” ×©×™×© ×œ×š ×¢×›×©×™×•)
  ArticleCardCompact.jsx       â† ×œ×’×¨×™×“ ×¦×¤×•×£ ××• ×¡×™×™×“×‘×¨
  ArticleCardWide.jsx          â† ×œ×›×¨×˜×™×¡ ×¨×•×—×‘×™ ×¢× ×ª××•× ×” ××™××™×Ÿ
  ArticleCardOverlay.jsx       â† ×œ××©×œ ×¢× ×ª×’×™×•×ª, ×ª××¨×™×š, ×§×˜×’×•×¨×™×” ××•×¦×’×ª

////

/data/
  â””â”€â”€ /articles/
        â”œâ”€â”€ news.js
        â”œâ”€â”€ tips.js
        â”œâ”€â”€ reviews.js
        â”œâ”€â”€ tests.js
        â””â”€â”€ index.js (×××—×“ ××ª ×›×•×œ×)


///app\news\global\page.jsx

import PageContainer from '@/components/PageContainer';
import ArticleCard from '@/components/ArticleCards/ArticleCard';
import articlesData from '@/data/articles';

export default function GlobalNews() {
  const globalArticles = articlesData.filter(
    a => a.category === 'news' && a.subcategory === 'global'
  );

  return (
    <PageContainer
      title="×—×“×©×•×ª ××”×¢×•×œ×"
      breadcrumbs={[
        { label: '×“×£ ×”×‘×™×ª', href: '/' },
        { label: '×—×“×©×•×ª', href: '/news' },
        { label: '×—×“×©×•×ª ××”×¢×•×œ×' }
      ]}
    >
      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        {globalArticles.map(article => (
          <ArticleCard key={article.id} article={article} />
        ))}
      </div>
    </PageContainer>
  );
}

///app\news\local\page.jsx

import PageContainer from '@/components/PageContainer';
import ArticleCard from '@/components/ArticleCards/ArticleCard';
import articlesData from '@/data/articles';

export default function LocalNews() {
  const localArticles = articlesData.filter(
    a => a.category === 'news' && a.subcategory === 'local'
  );

  return (
    <PageContainer
      title="×—×“×©×•×ª ××§×•××™×•×ª"
      breadcrumbs={[
        { label: '×“×£ ×”×‘×™×ª', href: '/' },
        { label: '×—×“×©×•×ª', href: '/news' },
        { label: '×—×“×©×•×ª ××§×•××™×•×ª' }
      ]}
    >
      <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        {localArticles.map(article => (
          <ArticleCard key={article.id} article={article} />
        ))}
      </div>
    </PageContainer>
  );
}

/////
///app\news\[subcategory]\page.jsx

/////
××¢×¨×š ×œ×›×ª×‘×”
const forumArticles = [
  {
    id: 1001,
    slug: "example-slug",
    title: "×›×•×ª×¨×ª ×œ×“×•×’××”",
    headline: "×›×•×ª×¨×ª ××©× ×™×ª ×× ×™×©",
    description: "",
    subdescription: "",
    href: "/articles/example-slug",
    image: "/images/articles/example-slug/cover.jpg",
    imageSrc: "/images/articles/example-slug/main.jpg",
    galleryPath: "/images/articles/example-slug/gallery",
    imageAlt: "×ª×™××•×¨ ×ª××•× ×”",

    category: "forum",
    subcategory: "tech", // ××• "rides", ××• "sale"

    display: {
      homepage: false,
      sidebar: false,
      mainSlider: false,
      newsletter: false
    },

    priority: 1,

    author: "×©× ×”×›×•×ª×‘",
    date: "25.06.2025",
    time: "12:00",
    tags: ["×“×•×’××”", "×¤×•×¨×•×"],
    content: ``,
    tableData: {}
  },
];

export default forumArticles;
///


//components\AuthNewsletterBox.jsx
'use client';
import React, { useState, useEffect } from 'react';
import useIsMobile from '@/hooks/useIsMobile';
import { FaChevronDown, FaChevronUp } from 'react-icons/fa';
import { loginUser } from '@/utils/auth'; // âœ… ×œ×•×•×“× ×©×§×™×™× ×”×§×•×‘×¥ ×”×–×”

export default function AuthNewsletterBox({ mode = 'inline' }) {
  const isMobile = useIsMobile();
  const [hydrated, setHydrated] = useState(false);

  const [email, setEmail] = useState('');
  const [success, setSuccess] = useState(false);
  const [username, setUsername] = useState('');
  const [password, setPassword] = useState('');
  const [loginError, setLoginError] = useState('');
  const [loginSuccess, setLoginSuccess] = useState(false);
  const [agreed, setAgreed] = useState(false);
  const [isOpen, setIsOpen] = useState(true);
  const [showTerms, setShowTerms] = useState(false);

  useEffect(() => {
    setHydrated(true);
  }, []);

  const handleLogin = async () => {
    try {
      const res = await fetch('/api/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password }),
      });

      if (!res.ok) throw new Error('×©× ××©×ª××© ××• ×¡×™×¡××” ×©×’×•×™×™×');

      await res.json();
      loginUser(username); // âœ… ×©××•×¨ ××ª ×”××©×ª××©
      setLoginSuccess(true);
      setLoginError('');
      window.location.reload(); // âœ… ×˜×¢×Ÿ ××ª ×”×“×£ ××—×“×© ×›×“×™ ×œ×©×§×£ ×”×ª×—×‘×¨×•×ª
    } catch (err) {
      setLoginError(err.message);
      setLoginSuccess(false);
    }
  };

  const handleSubscribe = async (e) => {
    e.preventDefault();
    if (!agreed) {
      alert('×™×© ×œ××©×¨ ××ª ×ª× ××™ ×”×©×™××•×© ×¢×œ ×× ×ª ×œ×”×™×¨×©×');
      return;
    }
    setSuccess(true);
    setTimeout(() => setSuccess(false), 3000);
  };

  if (!hydrated || (isMobile && mode === 'side' && !isOpen)) {
    return (
      <div dir="rtl" className="text-center">
        <button
          onClick={() => setIsOpen(true)}
          className="text-sm bg-white text-black px-3 py-2 rounded shadow hover:bg-gray-200 transition"
        >
          ×”×ª×—×‘×¨×•×ª / ×”×¨×©××” <FaChevronDown className="inline" />
        </button>
      </div>
    );
  }

  return (
    <div dir="rtl" className="text-center">
      {isMobile && mode === 'side' && (
        <button
          onClick={() => setIsOpen(false)}
          className="text-sm bg-white text-black px-3 py-2 rounded shadow hover:bg-gray-200 transition"
        >
          ×¡×’×•×¨ ×”×ª×—×‘×¨×•×ª / ×”×¨×©××” <FaChevronUp className="inline" />
        </button>
      )}

      <div
        className={`transition-all duration-500 ease-in-out overflow-hidden mt-4
          ${mode === 'inline' ? 'w-[320px] bg-white text-black' : ''}
          ${mode === 'modal' ? '' : mode === 'side' ? 'fixed top-32 left-4 bg-white z-50 w-[320px]' : ''}
          border border-gray-300 rounded p-6 text-sm shadow-md`}
      >
        <form onSubmit={handleSubscribe} className="mb-4">
          <label className="block mb-1 font-semibold text-black"> ×”×¨×©××” ×œ× ×™×•×–×œ×˜×¨ </label>
          <input
            type="email"
            value={email}
            onChange={(e) => setEmail(e.target.value)}
            placeholder="onmotormedia@gmail.com"
            className="w-full px-1 py-1 border border-gray-300 rounded text-right text-sm"
          />
          <div className={`flex items-center mt-2 ${isMobile ? 'justify-end' : ''}`}>
            <input
              type="checkbox"
              id="agree"
              className="ml-2 accent-[#e60000]"
              checked={agreed}
              onChange={(e) => setAgreed(e.target.checked)}
            />
            <label htmlFor="agree" className="text-xs text-gray-700">
              ×× ×™ ××¡×›×™× ×œ{' '}
              <button
                type="button"
                className="text-blue-600 underline hover:text-blue-800"
                onClick={() => setShowTerms(true)}
              >
                ×ª× ××™ ×”×©×™××•×© ×©×œ ×”××ª×¨
              </button>
            </label>
          </div>
          <button
            type="submit"
            className="mt-2 bg-[#e60000] text-white px-3 py-1 rounded hover:bg-red-700 text-sm w-full"
          >
            ×©×œ×—
          </button>
          {success && <p className="text-green-600 mt-1 text-xs">×”×”×¨×©××” ×”×¦×œ×™×—×”!</p>}
        </form>

        <div className="border-t pt-3">
          <h3 className="font-semibold text-black mb-2">×”×ª×—×‘×¨×•×ª</h3>
          <input
            type="text"
            placeholder="×©× ××©×ª××©"
            value={username}
            onChange={(e) => setUsername(e.target.value)}
            className="w-full px-2 py-1 mb-2 border border-gray-300 rounded text-right text-sm"
          />
          <input
            type="password"
            placeholder="×¡×™×¡××”"
            value={password}
            onChange={(e) => setPassword(e.target.value)}
            className="w-full px-2 py-1 mb-2 border border-gray-300 rounded text-right text-sm"
          />
          <div className={`flex items-center mb-2 ${isMobile ? 'justify-end' : ''}`}>
            <input id="remember" type="checkbox" className="ml-2 accent-[#e60000]" />
            <label htmlFor="remember" className="text-xs text-gray-700">×–×›×•×¨ ××•×ª×™</label>
          </div>
          <button
            type="button"
            onClick={handleLogin}
            className="bg-[#e60000] text-white px-3 py-1 rounded hover:bg-red-700 text-sm w-full"
          >
            ×”×ª×—×‘×¨
          </button>

          {loginError && <p className="text-red-600 mt-1 text-xs">{loginError}</p>}
          {loginSuccess && <p className="text-green-600 mt-1 text-xs">×”×ª×—×‘×¨×ª ×‘×”×¦×œ×—×”!</p>}

          <div className="mt-2 text-center text-xs">
            <a href="/auth/signup" className="text-[#e60000] hover:underline ml-2">×¦×•×¨ ×—×©×‘×•×Ÿ</a>
            |
            <a href="/auth/forgot-password" className="text-[#e60000] hover:underline mr-2">×©×›×—×ª×™ ×¡×™×¡××”</a>
          </div>
        </div>
      </div>

      {showTerms && (
        <div className="fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center">
          <div className="bg-white rounded-lg p-6 max-w-md w-full text-right text-sm relative shadow-lg">
            <button
              onClick={() => setShowTerms(false)}
              className="absolute top-2 left-3 text-gray-600 hover:text-black"
            >
              âœ–
            </button>
            <h2 className="text-lg font-bold mb-2">×ª× ××™ ×”×©×™××•×©</h2>
            <p className="mb-4">
              ×©×™××•×© ×‘××ª×¨ OnMotor Media ×›×¤×•×£ ×œ×”×¡×›××” ×œ×ª× ××™ ×”×©×™××•×©. × × ×œ× ×œ×¤×¨×¡× ×ª×›× ×™× ×¤×•×’×¢× ×™×™×, ×œ× ×—×•×§×™×™× ××• ×›××œ×• ×”×¤×•×’×¢×™× ×‘×–×›×•×™×•×ª ×™×•×¦×¨×™×. ×”××©×ª××© ××—×¨××™ ×œ×ª×•×›×Ÿ ×©×”×•× ××¤×¨×¡×.
            </p>
            <button
              onClick={() => setShowTerms(false)}
              className="bg-[#e60000] text-white px-4 py-1 rounded hover:bg-red-700"
            >
              ××™×©×•×¨
            </button>
          </div>
        </div>
      )}
    </div>
  );
}
///

 ×§×‘×¦×™× ×‘×¦×“ ×”×©×¨×ª (API)
1. /app/api/forgot-password/route.js
 ×××¤×¡ ×¡×™×¡××” ×¢"×™ ×©×œ×™×—×ª ×¡×™×¡××” ×–×× ×™×ª ×œ××™××™×™×œ ×©×œ ×”××©×ª××©.

2. /app/api/change-password/route.js
 ××©× ×” ×¡×™×¡××” ×§×™×™××ª ×œ××©×ª××© ××—×•×‘×¨ ×œ××—×¨ ××™××•×ª ×¡×™×¡××” × ×•×›×—×™×ª.

3. /app/api/login/route.js
 ××××ª ×”×ª×—×‘×¨×•×ª ×œ×¤×™ ×©× ××©×ª××© ××• ××™××™×™×œ, ××—×–×™×¨ ××ª ×¤×¨×˜×™ ×”××©×ª××© ×× ×”×¦×œ×™×—.

 ×§×‘×¦×™× ×‘×¦×“ ×”×œ×§×•×— (React Components + Utilities)
4. /components/AuthBox.jsx
 ×§×•×¤×¡×” ×¢× ×˜×¤×¡×™×: ×”×ª×—×‘×¨×•×ª, ×”×¨×©××”, ×©×›×—×ª×™ ×¡×™×¡××”, ×©×™× ×•×™ ×¡×™×¡××”.
 ×ª×•××š ×’× ×‘××•×‘×™×™×œ (××¦×‘ "side") ×¢× ×’×œ×™×œ×” ××•×˜×•××˜×™×ª ×•×”×ª×××ª ×¨×•×—×‘.

5. /components/NewsletterBox.jsx
 ×˜×•×¤×¡ ×”×¨×©××” ×œ× ×™×•×–×œ×˜×¨.
 ×›×•×œ×œ ×˜×™×¤×•×œ ×‘×¤×ª×™×—×” ×•×¡×’×™×¨×” ×‘××•×‘×™×™×œ, ×’×œ×™×œ×” ××•×˜×•××˜×™×ª, ××•×“××œ ×©×œ ×ª× ××™ ×©×™××•×©.

 Utilities
6. /utils/auth.js
 × ×™×”×•×œ ××¦×‘ ×”×ª×—×‘×¨×•×ª ×‘Ö¾localStorage â€“ ×›×•×œ×œ:

getCurrentUser() â€“ ×”×—×–×¨×ª ×”××©×ª××© ×”× ×•×›×—×™

loginUser() â€“ ×©××™×¨×ª ×”×ª×—×‘×¨×•×ª

logoutUser() â€“ × ×™×ª×•×§

isLoggedIn() â€“ ×‘×“×™×§×ª ×”×ª×—×‘×¨×•×ª

 Hooks
7. /hooks/useIsMobile.js (×”×•×–×›×¨ ×‘×©×™××•×©)
 ×”×•×§ ×©×‘×•×“×§ ×× ×”×ª×¦×•×’×” ×”×™× ×‘××•×‘×™×™×œ, ×‘×©×™××•×© ×‘×¨×›×™×‘×™× AuthBox ×•Ö¾NewsletterBox.

 ×§×‘×¦×™ JSON/× ×ª×•× ×™×
8. /data/users.json
 ×§×•×‘×¥ × ×ª×•× ×™× ×”×××›×¡×Ÿ ××ª ×›×œ ×”××©×ª××©×™× ×›×•×œ×œ ×¡×™×¡×××•×ª ××•×¦×¤× ×•×ª.
 ××©××© ×œ×›×œ ×¤×¢×•×œ×•×ª ×§×¨×™××”/×¢×“×›×•×Ÿ ××©×ª××©×™× ×‘××¢×¨×›×ª.

